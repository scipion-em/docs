

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>tomo.objects &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/scipion-modes/how-to-install.html">Installing Scipion v3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/user-documentation.html#processing-how-to-s">Processing How Toâ€™s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/facilities/facilities.html">Streaming Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/facilities/acquisition-simulation.html">Tutorial for Facilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/appion/appion.html">appion package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/atomstructutils/atomstructutils.html">atomstructutils package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/atsas/atsas.html">atsas package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/bamfordlab/bamfordlab.html">bamfordlab package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/bsoft/bsoft.html">bsoft package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/ccp4/ccp4.html">ccp4 package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/chimera/chimera.html">chimera package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/cistem/cistem.html">cistem package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/cryoef/cryoef.html">cryoef package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/cryosparc2/cryosparc2.html">cryosparc2 package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/deepfinder/deepfinder.html">deepfinder package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/dynamo/dynamo.html">dynamo package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/eman2/eman2.html">eman2 package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/emxlib/emxlib.html">emxlib package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/fsc3d/fsc3d.html">fsc3d package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/gautomatch/gautomatch.html">gautomatch package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/gctf/gctf.html">gctf package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/imod/imod.html">imod package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/localrec/localrec.html">localrec package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/locscale/locscale.html">locscale package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/motioncorr/motioncorr.html">motioncorr package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/novactf/novactf.html">novactf package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/phenix/phenix.html">phenix package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pyworkflow/pyworkflow.html">pyworkflow package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pwem/pwem.html">pwem package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/relion/relion.html">relion package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/resmap/resmap.html">resmap package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/scipion/scipion.html">scipion package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/sphire/sphire.html">sphire package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/spider/spider.html">spider package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tomo/tomo.html">tomo package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tomoj/tomoj.html">tomoj package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/topaz/topaz.html">topaz package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/xmipp2/xmipp2.html">xmipp2 package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/xmipp3/xmipp3.html">xmipp3 package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/xmipptomo/xmipptomo.html">xmipptomo package</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../tomo.html">tomo</a> &raquo;</li>
        
      <li>tomo.objects</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tomo.objects</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#  **************************************************************************</span>
<span class="c1"># *</span>
<span class="c1"># * Authors:     J.M. De la Rosa Trevin (delarosatrevin@scilifelab.se) [1]</span>
<span class="c1"># *</span>
<span class="c1"># * [1] SciLifeLab, Stockholm University</span>
<span class="c1"># *</span>
<span class="c1"># * This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># * it under the terms of the GNU General Public License as published by</span>
<span class="c1"># * the Free Software Foundation; either version 2 of the License, or</span>
<span class="c1"># * (at your option) any later version.</span>
<span class="c1"># *</span>
<span class="c1"># * This program is distributed in the hope that it will be useful,</span>
<span class="c1"># * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># * GNU General Public License for more details.</span>
<span class="c1"># *</span>
<span class="c1"># * You should have received a copy of the GNU General Public License</span>
<span class="c1"># * along with this program; if not, write to the Free Software</span>
<span class="c1"># * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA</span>
<span class="c1"># * 02111-1307  USA</span>
<span class="c1"># *</span>
<span class="c1"># *  All comments concerning this program package may be sent to the</span>
<span class="c1"># *  e-mail address &#39;scipion@cnb.csic.es&#39;</span>
<span class="c1"># *</span>
<span class="c1"># **************************************************************************</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="kn">from</span> <span class="nn">pyworkflow.object</span> <span class="k">import</span> <span class="n">Integer</span>
<span class="kn">import</span> <span class="nn">pyworkflow.object</span> <span class="k">as</span> <span class="nn">pwobj</span>
<span class="kn">import</span> <span class="nn">pyworkflow.utils.path</span> <span class="k">as</span> <span class="nn">path</span>
<span class="kn">import</span> <span class="nn">pwem.objects.data</span> <span class="k">as</span> <span class="nn">data</span>
<span class="kn">from</span> <span class="nn">pwem.convert.transformations</span> <span class="k">import</span> <span class="n">euler_matrix</span>
<span class="kn">import</span> <span class="nn">pwem.emlib</span> <span class="k">as</span> <span class="nn">emlib</span>
<span class="kn">from</span> <span class="nn">pwem.emlib.image</span> <span class="k">import</span> <span class="n">ImageHandler</span>


<div class="viewcode-block" id="TiltImageBase"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase">[docs]</a><span class="k">class</span> <span class="nc">TiltImageBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Base class for TiltImageM and TiltImage. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tiltAngle</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tiltAngle&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tsId&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="c1"># Use the acquisition order as objId</span>
        <span class="k">if</span> <span class="s1">&#39;acquisitionOrder&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setObjId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;acquisitionOrder&#39;</span><span class="p">]))</span>

<div class="viewcode-block" id="TiltImageBase.getTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase.getTsId">[docs]</a>    <span class="k">def</span> <span class="nf">getTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get unique TiltSerie ID, usually retrieved from the</span>
<span class="sd">        file pattern provided by the user at the import time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TiltImageBase.setTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase.setTsId">[docs]</a>    <span class="k">def</span> <span class="nf">setTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TiltImageBase.getTiltAngle"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase.getTiltAngle">[docs]</a>    <span class="k">def</span> <span class="nf">getTiltAngle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tiltAngle</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TiltImageBase.setTiltAngle"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase.setTiltAngle">[docs]</a>    <span class="k">def</span> <span class="nf">setTiltAngle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tiltAngle</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TiltImageBase.getAcquisitionOrder"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase.getAcquisitionOrder">[docs]</a>    <span class="k">def</span> <span class="nf">getAcquisitionOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getObjId</span><span class="p">()</span></div>

<div class="viewcode-block" id="TiltImageBase.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyAttributes</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;_tiltAngle&#39;</span><span class="p">,</span> <span class="s1">&#39;_tsId&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">copyId</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copyObjId</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TiltImage"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImage">[docs]</a><span class="k">class</span> <span class="nc">TiltImage</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">TiltImageBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Tilt image &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">TiltImageBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="TiltImage.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImage.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="n">TiltImageBase</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="n">copyId</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TiltSeriesBase"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase">[docs]</a><span class="k">class</span> <span class="nc">TiltSeriesBase</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">SetOfImages</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">SetOfImages</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tsId&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="c1"># TiltSeries will always be used inside a SetOfTiltSeries</span>
        <span class="c1"># so, let&#39;s do no store the mapper path by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mapperPath</span><span class="o">.</span><span class="n">setStore</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="TiltSeriesBase.getTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.getTsId">[docs]</a>    <span class="k">def</span> <span class="nf">getTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get unique TiltSerie ID, usually retrieved from the</span>
<span class="sd">        file pattern provided by the user at the import time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TiltSeriesBase.setTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.setTsId">[docs]</a>    <span class="k">def</span> <span class="nf">setTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TiltSeriesBase.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information (id and other properties) but</span>
<span class="sd">        not _mapperPath or _size from other set of tomograms to current one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="n">copyId</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_mapperPath&#39;</span><span class="p">,</span> <span class="s1">&#39;_size&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TiltSeriesBase.append"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tiltImage</span><span class="p">):</span>
        <span class="n">tiltImage</span><span class="o">.</span><span class="n">setTsId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTsId</span><span class="p">())</span>
        <span class="n">data</span><span class="o">.</span><span class="n">SetOfImages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tiltImage</span><span class="p">)</span></div>

<div class="viewcode-block" id="TiltSeriesBase.clone"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_mapperPath&#39;</span><span class="p">,</span> <span class="s1">&#39;_size&#39;</span><span class="p">)):</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getClass</span><span class="p">()()</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="n">ignoreAttrs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clone</span></div>

<div class="viewcode-block" id="TiltSeriesBase.close"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Do nothing on close, since the db will be closed by SetOfTiltSeries</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="TiltSeriesBase.getScannedPixelSize"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.getScannedPixelSize">[docs]</a>    <span class="k">def</span> <span class="nf">getScannedPixelSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getMagnification</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="n">mag</span></div>

<div class="viewcode-block" id="TiltSeriesBase.generateTltFile"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.generateTltFile">[docs]</a>    <span class="k">def</span> <span class="nf">generateTltFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tltFilePath</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates an angle file in .tlt format in the specified location. If reverse is set to true the angles in</span>
<span class="sd">        file are sorted in the opposite order&quot;&quot;&quot;</span>
        <span class="n">angleList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ti</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">angleList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">getTiltAngle</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="n">angleList</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tltFilePath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">angle</span> <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angleList</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TiltSeries"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeries">[docs]</a><span class="k">class</span> <span class="nc">TiltSeries</span><span class="p">(</span><span class="n">TiltSeriesBase</span><span class="p">):</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">TiltImage</span>

<div class="viewcode-block" id="TiltSeries.applyTransform"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeries.applyTransform">[docs]</a>    <span class="k">def</span> <span class="nf">applyTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputFilePath</span><span class="p">):</span>
        <span class="n">ih</span> <span class="o">=</span> <span class="n">ImageHandler</span><span class="p">()</span>
        <span class="n">inputFilePath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">()</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span>
        <span class="n">newStack</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># TODO: Handle output tilt-series datatype format</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">()</span><span class="o">.</span><span class="n">hasTransform</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ti</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ti</span><span class="o">.</span><span class="n">hasTransform</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">newStack</span><span class="p">:</span>
                        <span class="n">ih</span><span class="o">.</span><span class="n">createEmptyImage</span><span class="p">(</span><span class="n">fnOut</span><span class="o">=</span><span class="n">outputFilePath</span><span class="p">,</span>
                                            <span class="n">xDim</span><span class="o">=</span><span class="n">ti</span><span class="o">.</span><span class="n">getXDim</span><span class="p">(),</span>
                                            <span class="n">yDim</span><span class="o">=</span><span class="n">ti</span><span class="o">.</span><span class="n">getYDim</span><span class="p">(),</span>
                                            <span class="n">nDim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getSize</span><span class="p">())</span>
                        <span class="n">newStack</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">transform</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">getTransform</span><span class="p">()</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()</span>
                    <span class="n">transformArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
                    <span class="n">ih</span><span class="o">.</span><span class="n">applyTransform</span><span class="p">(</span><span class="n">inputFile</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:mrcs@&#39;</span> <span class="o">+</span> <span class="n">inputFilePath</span><span class="p">,</span>
                                      <span class="n">outputFile</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;@&#39;</span> <span class="o">+</span> <span class="n">outputFilePath</span><span class="p">,</span>
                                      <span class="n">transformMatrix</span><span class="o">=</span><span class="n">transformArray</span><span class="p">,</span>
                                      <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">getYDim</span><span class="p">(),</span> <span class="n">ti</span><span class="o">.</span><span class="n">getXDim</span><span class="p">()))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;ERROR: Some tilt-image is missing from transform object associated.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">createLink</span><span class="p">(</span><span class="n">inputFilePath</span><span class="p">,</span> <span class="n">outputFilePath</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfTiltSeriesBase"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase">[docs]</a><span class="k">class</span> <span class="nc">SetOfTiltSeriesBase</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">SetOfImages</span><span class="p">):</span>
    <span class="n">EXPOSE_ITEMS</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="sd">&quot;&quot;&quot; Base class for SetOfTiltImages and SetOfTiltImagesM.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">SetOfImages</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="SetOfTiltSeriesBase.iterClassItems"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.iterClassItems">[docs]</a>    <span class="k">def</span> <span class="nf">iterClassItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterDisabled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over the images of a class.</span>
<span class="sd">        Params:</span>
<span class="sd">            iterDisabled: If True, also include the disabled items. &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterItems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">iterDisabled</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="bp">cls</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">iterDisabled</span> <span class="ow">or</span> <span class="n">img</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                        <span class="k">yield</span> <span class="n">img</span></div>

    <span class="k">def</span> <span class="nf">_setItemMapperPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the mapper path of this class according to the mapper</span>
<span class="sd">        path of the SetOfClasses and also the prefix according to class id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span><span class="o">.</span><span class="n">_mapperPath</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">(),</span> <span class="n">item</span><span class="o">.</span><span class="n">getTsId</span><span class="p">()))</span>
        <span class="n">item</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_insertItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create the SetOfImages assigned to a class.</span>
<span class="sd">        If the file exists, it will load the Set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="n">_insertItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">properties</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Set.write(self)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Setup the mapper classes before returning the item. &quot;&quot;&quot;</span>
        <span class="n">classItem</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">SetOfImages</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">classItem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">classItem</span>

<div class="viewcode-block" id="SetOfTiltSeriesBase.getFirstItem"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.getFirstItem">[docs]</a>    <span class="k">def</span> <span class="nf">getFirstItem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">classItem</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">classItem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">classItem</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesBase.iterItems"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.iterItems">[docs]</a>    <span class="k">def</span> <span class="nf">iterItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orderBy</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;ASC&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orderBy</span><span class="o">=</span><span class="n">orderBy</span><span class="p">,</span>
                                         <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">item</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesBase.copyItems"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.copyItems">[docs]</a>    <span class="k">def</span> <span class="nf">copyItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputTs</span><span class="p">,</span>
                  <span class="n">orderByTs</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">updateTsCallback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">orderByTi</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">updateTiCallback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy items (TiltSeries and TiltImages) from the input Set.</span>
<span class="sd">         Params:</span>
<span class="sd">            inputTs: input TiltSeries (or movies) from where to copy elements.</span>
<span class="sd">            orderByTs: optional orderBy value for iterating over TiltSeries</span>
<span class="sd">            updateTsCallback: optional callback after TiltSeries is created</span>
<span class="sd">            orderByTi: optional orderBy value for iterating over TiltImages</span>
<span class="sd">            updateTiCallback: optional callback after TiltImage is created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inputTs</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">orderBy</span><span class="o">=</span><span class="n">orderByTs</span><span class="p">)):</span>
            <span class="n">tsOut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ITEM_TYPE</span><span class="p">()</span>
            <span class="n">tsOut</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
            <span class="n">tsOut</span><span class="o">.</span><span class="n">copyObjId</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">updateTsCallback</span><span class="p">:</span>
                <span class="n">updateTsCallback</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">tsOut</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tsOut</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ti</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">orderBy</span><span class="o">=</span><span class="n">orderByTi</span><span class="p">)):</span>
                <span class="n">tiOut</span> <span class="o">=</span> <span class="n">tsOut</span><span class="o">.</span><span class="n">ITEM_TYPE</span><span class="p">()</span>
                <span class="n">tiOut</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
                <span class="n">tiOut</span><span class="o">.</span><span class="n">copyObjId</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
                <span class="n">tiOut</span><span class="o">.</span><span class="n">setLocation</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">getLocation</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">updateTiCallback</span><span class="p">:</span>
                    <span class="n">updateTiCallback</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">ti</span><span class="p">,</span> <span class="n">tsOut</span><span class="p">,</span> <span class="n">tiOut</span><span class="p">)</span>
                <span class="n">tsOut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tiOut</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tsOut</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesBase.updateDim"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.updateDim">[docs]</a>    <span class="k">def</span> <span class="nf">updateDim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update dimensions of this set base on the first element. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">())</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesBase.getScannedPixelSize"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.getScannedPixelSize">[docs]</a>    <span class="k">def</span> <span class="nf">getScannedPixelSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getMagnification</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="n">mag</span></div></div>


<div class="viewcode-block" id="SetOfTiltSeries"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeries">[docs]</a><span class="k">class</span> <span class="nc">SetOfTiltSeries</span><span class="p">(</span><span class="n">SetOfTiltSeriesBase</span><span class="p">):</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">TiltSeries</span></div>


<div class="viewcode-block" id="TiltImageM"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageM">[docs]</a><span class="k">class</span> <span class="nc">TiltImageM</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Movie</span><span class="p">,</span> <span class="n">TiltImageBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Tilt movie. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Movie</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">TiltImageBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="TiltImageM.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageM.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Movie</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="n">TiltImageBase</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="n">copyId</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TiltSeriesM"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesM">[docs]</a><span class="k">class</span> <span class="nc">TiltSeriesM</span><span class="p">(</span><span class="n">TiltSeriesBase</span><span class="p">):</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">TiltImageM</span></div>


<div class="viewcode-block" id="SetOfTiltSeriesM"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM">[docs]</a><span class="k">class</span> <span class="nc">SetOfTiltSeriesM</span><span class="p">(</span><span class="n">SetOfTiltSeriesBase</span><span class="p">):</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">TiltSeriesM</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">SetOfTiltSeriesBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gainFile</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_darkFile</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">String</span><span class="p">()</span>
        <span class="c1"># Store the frames range to avoid loading the items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_firstFramesRange</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">FramesRange</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfTiltSeriesM.setGain"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM.setGain">[docs]</a>    <span class="k">def</span> <span class="nf">setGain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gain</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gainFile</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">gain</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesM.getGain"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM.getGain">[docs]</a>    <span class="k">def</span> <span class="nf">getGain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gainFile</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesM.setDark"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM.setDark">[docs]</a>    <span class="k">def</span> <span class="nf">setDark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dark</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_darkFile</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">dark</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesM.getDark"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM.getDark">[docs]</a>    <span class="k">def</span> <span class="nf">getDark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_darkFile</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesM.getFramesRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM.getFramesRange">[docs]</a>    <span class="k">def</span> <span class="nf">getFramesRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstFramesRange</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesM.setFramesRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM.setFramesRange">[docs]</a>    <span class="k">def</span> <span class="nf">setFramesRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_firstFramesRange</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesM.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy SoM specific information plus inherited &quot;&quot;&quot;</span>
        <span class="n">SetOfTiltSeriesBase</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gainFile</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getGain</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_darkFile</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getDark</span><span class="p">())</span></div></div>
        <span class="c1">#self._firstFramesRange.set(other.getFramesRange())</span>


<div class="viewcode-block" id="TiltSeriesDict"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict">[docs]</a><span class="k">class</span> <span class="nc">TiltSeriesDict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Helper class that to store TiltSeries and TiltImage but</span>
<span class="sd">    using dictionaries for quick access.</span>
<span class="sd">    This class also contains some logic related to the streaming:</span>
<span class="sd">    - Check for new input items that needs to be processed</span>
<span class="sd">    - Check for items already done that needs to be saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outputSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">newItemsCallback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">doneItemsCallback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the dict.</span>
<span class="sd">        :param inputSet: The set with input items. It will be monitored</span>
<span class="sd">            for new items from streaming.</span>
<span class="sd">        :param newItemsCallback: When new items are discovered, this</span>
<span class="sd">            function will be called</span>
<span class="sd">        :param doneItemsCallback: When some items are done, this function</span>
<span class="sd">            will be called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__inputSet</span> <span class="o">=</span> <span class="n">inputSet</span>
        <span class="k">if</span> <span class="n">inputSet</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__inputClosed</span> <span class="o">=</span> <span class="n">inputSet</span><span class="o">.</span><span class="n">isStreamClosed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastCheck</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__finalCheck</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__newItemsCallback</span> <span class="o">=</span> <span class="n">newItemsCallback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__doneItemsCallback</span> <span class="o">=</span> <span class="n">doneItemsCallback</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__new</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__finished</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># Reported as finished tasks, but not saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__done</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># Finished and saved tasks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">outputSet</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">outputSet</span><span class="p">:</span>
                <span class="c1"># We don&#39;t need tilt-images for done items</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addTs</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">includeTi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__done</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">getTsId</span><span class="p">())</span>

<div class="viewcode-block" id="TiltSeriesDict.addTs"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.addTs">[docs]</a>    <span class="k">def</span> <span class="nf">addTs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">includeTi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a clone of the tiltseries. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict</span><span class="p">[</span><span class="n">ts</span><span class="o">.</span><span class="n">getTsId</span><span class="p">()]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span> <span class="n">OrderedDict</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">includeTi</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ti</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addTi</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span></div>

<div class="viewcode-block" id="TiltSeriesDict.hasTs"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.hasTs">[docs]</a>    <span class="k">def</span> <span class="nf">hasTs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tsId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict</span></div>

<div class="viewcode-block" id="TiltSeriesDict.getTs"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.getTs">[docs]</a>    <span class="k">def</span> <span class="nf">getTs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict</span><span class="p">[</span><span class="n">tsId</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="TiltSeriesDict.addTi"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.addTi">[docs]</a>    <span class="k">def</span> <span class="nf">addTi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ti</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getTiDict</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">getTsId</span><span class="p">())[</span><span class="n">ti</span><span class="o">.</span><span class="n">getObjId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span></div>

<div class="viewcode-block" id="TiltSeriesDict.getTi"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.getTi">[docs]</a>    <span class="k">def</span> <span class="nf">getTi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="p">,</span> <span class="n">tiObjId</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTiDict</span><span class="p">(</span><span class="n">tsId</span><span class="p">)[</span><span class="n">tiObjId</span><span class="p">]</span></div>

<div class="viewcode-block" id="TiltSeriesDict.getTiDict"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.getTiDict">[docs]</a>    <span class="k">def</span> <span class="nf">getTiDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict</span><span class="p">[</span><span class="n">tsId</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="TiltSeriesDict.getTiList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.getTiList">[docs]</a>    <span class="k">def</span> <span class="nf">getTiList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTiDict</span><span class="p">(</span><span class="n">tsId</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ts</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">ts</span>

    <span class="c1"># ---- Streaming related methods -------------</span>
<div class="viewcode-block" id="TiltSeriesDict.update"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkNewInput</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkNewOutput</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_checkNewInput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># print(&quot;&gt;&gt;&gt; DEBUG: _checkNewInput &quot;)</span>

        <span class="n">inputSetFn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__inputSet</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span>
        <span class="n">mTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">inputSetFn</span><span class="p">))</span>
        <span class="c1"># if self.__lastCheck:</span>
        <span class="c1"># print(&#39;Last check: %s, modification: %s&#39;</span>
        <span class="c1">#       % (pwutils.prettyTime(self.__lastCheck),</span>
        <span class="c1">#          pwutils.prettyTime(mTime)))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastCheck</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastCheck</span> <span class="o">&lt;=</span> <span class="n">mTime</span><span class="p">:</span>
            <span class="n">updatedSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__inputSet</span><span class="o">.</span><span class="n">getClass</span><span class="p">()(</span><span class="n">filename</span><span class="o">=</span><span class="n">inputSetFn</span><span class="p">)</span>
            <span class="n">updatedSet</span><span class="o">.</span><span class="n">loadAllProperties</span><span class="p">()</span>
            <span class="n">newItems</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">updatedSet</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTs</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">getTsId</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addTs</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">includeTi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">newItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">getTsId</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__inputClosed</span> <span class="o">=</span> <span class="n">updatedSet</span><span class="o">.</span><span class="n">isStreamClosed</span><span class="p">()</span>
            <span class="n">updatedSet</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">newItems</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__newItemsCallback</span><span class="p">(</span><span class="n">newItems</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastCheck</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_checkNewOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># print(&quot;&gt;&gt;&gt; DEBUG: _checkNewInput &quot;)</span>
        <span class="c1"># First check that we have some items in the finished</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="n">doneItems</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__finished</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__finished</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">doneItems</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allDone</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__finalCheck</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__done</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">doneItems</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__doneItemsCallback</span><span class="p">(</span><span class="n">doneItems</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allDone</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__finalCheck</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="TiltSeriesDict.setFinished"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.setFinished">[docs]</a>    <span class="k">def</span> <span class="nf">setFinished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">tsIdList</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Notify that all TiltSeries in the list of ids are finished. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__finished</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tsIdList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div>

<div class="viewcode-block" id="TiltSeriesDict.allDone"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.allDone">[docs]</a>    <span class="k">def</span> <span class="nf">allDone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return True if input stream is closed and all task are done. &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;&gt;&gt;&gt; DEBUG: allDone\n&quot;</span>
        <span class="c1">#       &quot;    inputClosed: %s\n&quot;</span>
        <span class="c1">#       &quot;    len(dict):   %s\n&quot;</span>
        <span class="c1">#       &quot;    len(done):   %s&quot; % (self.__inputClosed, len(self.__dict),</span>
        <span class="c1">#                                len(self.__done)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__inputClosed</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__done</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TomoAcquisition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition">[docs]</a><span class="k">class</span> <span class="nc">TomoAcquisition</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Acquisition</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Acquisition</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleMin</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;angleMin&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleMax</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;angleMax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_step</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleAxis1</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;angleAxis1&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleAxis2</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;angleAxis2&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

<div class="viewcode-block" id="TomoAcquisition.getAngleMax"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.getAngleMax">[docs]</a>    <span class="k">def</span> <span class="nf">getAngleMax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angleMax</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TomoAcquisition.setAngleMax"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.setAngleMax">[docs]</a>    <span class="k">def</span> <span class="nf">setAngleMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleMax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TomoAcquisition.getAngleMin"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.getAngleMin">[docs]</a>    <span class="k">def</span> <span class="nf">getAngleMin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angleMin</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TomoAcquisition.setAngleMin"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.setAngleMin">[docs]</a>    <span class="k">def</span> <span class="nf">setAngleMin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleMin</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TomoAcquisition.getStep"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.getStep">[docs]</a>    <span class="k">def</span> <span class="nf">getStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TomoAcquisition.setStep"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.setStep">[docs]</a>    <span class="k">def</span> <span class="nf">setStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TomoAcquisition.getAngleAxis1"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.getAngleAxis1">[docs]</a>    <span class="k">def</span> <span class="nf">getAngleAxis1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angleAxis1</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TomoAcquisition.setAngleAxis1"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.setAngleAxis1">[docs]</a>    <span class="k">def</span> <span class="nf">setAngleAxis1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleAxis1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TomoAcquisition.getAngleAxis2"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.getAngleAxis2">[docs]</a>    <span class="k">def</span> <span class="nf">getAngleAxis2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angleAxis2</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TomoAcquisition.setAngleAxis2"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.setAngleAxis2">[docs]</a>    <span class="k">def</span> <span class="nf">setAngleAxis2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleAxis2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Tomogram"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Tomogram">[docs]</a><span class="k">class</span> <span class="nc">Tomogram</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Volume</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Volume</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tsId&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

<div class="viewcode-block" id="Tomogram.getTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Tomogram.getTsId">[docs]</a>    <span class="k">def</span> <span class="nf">getTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get unique TiltSeries ID, usually retrieved from the</span>
<span class="sd">        file pattern provided by the user at the import time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Tomogram.setTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Tomogram.setTsId">[docs]</a>    <span class="k">def</span> <span class="nf">setTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tomogram.getAcquisition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Tomogram.getAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">getAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span></div>

<div class="viewcode-block" id="Tomogram.setAcquisition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Tomogram.setAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">setAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acquisition</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="n">acquisition</span></div>

<div class="viewcode-block" id="Tomogram.hasAcquisition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Tomogram.hasAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">hasAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getAngleMin</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getAngleMax</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfTomograms"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTomograms">[docs]</a><span class="k">class</span> <span class="nc">SetOfTomograms</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">SetOfVolumes</span><span class="p">):</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">Tomogram</span>
    <span class="n">EXPOSE_ITEMS</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">SetOfVolumes</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="n">TomoAcquisition</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfTomograms.updateDim"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTomograms.updateDim">[docs]</a>    <span class="k">def</span> <span class="nf">updateDim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update dimensions of this set base on the first element. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="Coordinate3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D">[docs]</a><span class="k">class</span> <span class="nc">Coordinate3D</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class holds the (x,y) position and other information</span>
<span class="sd">    associated with a coordinate&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volumePointer</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Pointer</span><span class="p">(</span><span class="n">objDoStore</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eulerMatrix</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Transform</span><span class="p">()</span>

<div class="viewcode-block" id="Coordinate3D.getX"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getX">[docs]</a>    <span class="k">def</span> <span class="nf">getX</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate3D.setX"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setX">[docs]</a>    <span class="k">def</span> <span class="nf">setX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.shiftX"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.shiftX">[docs]</a>    <span class="k">def</span> <span class="nf">shiftX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shiftX</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">shiftX</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.getY"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getY">[docs]</a>    <span class="k">def</span> <span class="nf">getY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate3D.setY"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setY">[docs]</a>    <span class="k">def</span> <span class="nf">setY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.shiftY"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.shiftY">[docs]</a>    <span class="k">def</span> <span class="nf">shiftY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shiftY</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">shiftY</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.getZ"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getZ">[docs]</a>    <span class="k">def</span> <span class="nf">getZ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate3D.setZ"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setZ">[docs]</a>    <span class="k">def</span> <span class="nf">setZ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.setMatrix"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">setMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eulerMatrix</span><span class="o">.</span><span class="n">setMatrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.getMatrix"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">getMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eulerMatrix</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate3D.euler2Matrix"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.euler2Matrix">[docs]</a>    <span class="k">def</span> <span class="nf">euler2Matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eulerMatrix</span><span class="o">.</span><span class="n">setMatrix</span><span class="p">(</span><span class="n">euler_matrix</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span></div>

<div class="viewcode-block" id="Coordinate3D.eulerAngles"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.eulerAngles">[docs]</a>    <span class="k">def</span> <span class="nf">eulerAngles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()</span>
        <span class="n">sy</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">singular</span> <span class="o">=</span> <span class="n">sy</span> <span class="o">&lt;</span> <span class="mf">1e-6</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">singular</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sy</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sy</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span></div>

<div class="viewcode-block" id="Coordinate3D.scale"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.scale">[docs]</a>    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Scale x, y and z coordinates by a given factor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.getPosition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getPosition">[docs]</a>    <span class="k">def</span> <span class="nf">getPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the position of the coordinate as a (x, y) tuple.</span>
<span class="sd">        mode: select if the position is the center of the box</span>
<span class="sd">        or in the top left corner.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getX</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getY</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getZ</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate3D.setPosition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setPosition">[docs]</a>    <span class="k">def</span> <span class="nf">setPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setZ</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.getVolume"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getVolume">[docs]</a>    <span class="k">def</span> <span class="nf">getVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the micrograph object to which</span>
<span class="sd">        this coordinate is associated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volumePointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate3D.setVolume"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setVolume">[docs]</a>    <span class="k">def</span> <span class="nf">setVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the micrograph to which this coordinate belongs. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volumePointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">volume</span><span class="o">.</span><span class="n">getObjId</span><span class="p">())</span></div>

<div class="viewcode-block" id="Coordinate3D.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy information from other coordinate. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPosition</span><span class="p">(</span><span class="o">*</span><span class="n">coord</span><span class="o">.</span><span class="n">getPosition</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setObjId</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">getObjId</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setBoxSize</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">getBoxSize</span><span class="p">())</span></div>

<div class="viewcode-block" id="Coordinate3D.setBoxSize"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setBoxSize">[docs]</a>    <span class="k">def</span> <span class="nf">setBoxSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boxSize</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span> <span class="o">=</span> <span class="n">boxSize</span></div>

<div class="viewcode-block" id="Coordinate3D.getBoxSize"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getBoxSize">[docs]</a>    <span class="k">def</span> <span class="nf">getBoxSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span></div>

<div class="viewcode-block" id="Coordinate3D.getVolId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getVolId">[docs]</a>    <span class="k">def</span> <span class="nf">getVolId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate3D.setVolId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setVolId">[docs]</a>    <span class="k">def</span> <span class="nf">setVolId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volId</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">volId</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.invertY"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.invertY">[docs]</a>    <span class="k">def</span> <span class="nf">invertY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">()</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getY</span><span class="p">())</span></div>
        <span class="c1"># else: error TODO</span>

<div class="viewcode-block" id="Coordinate3D.getVolName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getVolName">[docs]</a>    <span class="k">def</span> <span class="nf">getVolName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="SetOfCoordinates3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D">[docs]</a><span class="k">class</span> <span class="nc">SetOfCoordinates3D</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Encapsulate the logic of a set of volumes coordinates.</span>
<span class="sd">    Each coordinate has a (x,y,z) position and is related to a Volume</span>
<span class="sd">    The SetOfCoordinates3D can also have information about TiltPairs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">Coordinate3D</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_precedentsPointer</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Pointer</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfCoordinates3D.getBoxSize"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.getBoxSize">[docs]</a>    <span class="k">def</span> <span class="nf">getBoxSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the box size of the particles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.setBoxSize"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.setBoxSize">[docs]</a>    <span class="k">def</span> <span class="nf">setBoxSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boxSize</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the box size of the particles. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">boxSize</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.getSamplingRate"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.getSamplingRate">[docs]</a>    <span class="k">def</span> <span class="nf">getSamplingRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the sampling rate of the particles. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.setSamplingRate"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.setSamplingRate">[docs]</a>    <span class="k">def</span> <span class="nf">setSamplingRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the sampling rate of the particles. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">sampling</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.iterVolumes"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.iterVolumes">[docs]</a>    <span class="k">def</span> <span class="nf">iterVolumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over the objects set associated with this</span>
<span class="sd">        set of coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPrecedents</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.iterVolumeCoordinates"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.iterVolumeCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">iterVolumeCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterates over the set of coordinates belonging to that micrograph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.iterCoordinates"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.iterCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">iterCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over the coordinates associated with a tomogram.</span>
<span class="sd">        If tomogram=None, the iteration is performed over the whole</span>
<span class="sd">        set of coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">volume</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">volId</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">volId</span> <span class="o">=</span> <span class="n">volume</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Volume</span><span class="p">):</span>
            <span class="n">volId</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">getObjId</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Invalid input micrograph of type </span><span class="si">%s</span><span class="s1">&#39;</span>
                            <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">volume</span><span class="p">))</span>

        <span class="c1"># Iterate over all coordinates if micId is None,</span>
        <span class="c1"># otherwise use micId to filter the where selection</span>
        <span class="n">coordWhere</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span> <span class="k">if</span> <span class="n">volId</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;_volId=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">volId</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">coordWhere</span><span class="p">):</span>
            <span class="n">coord</span><span class="o">.</span><span class="n">setVolume</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPrecedents</span><span class="p">()[</span><span class="n">coord</span><span class="o">.</span><span class="n">getVolId</span><span class="p">()])</span>
            <span class="k">yield</span> <span class="n">coord</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.getPrecedents"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.getPrecedents">[docs]</a>    <span class="k">def</span> <span class="nf">getPrecedents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the SetOfTomograms or Tilt Series associated with</span>
<span class="sd">                this SetOfCoordinates&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precedentsPointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.setPrecedents"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.setPrecedents">[docs]</a>    <span class="k">def</span> <span class="nf">setPrecedents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">precedents</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the tomograms  or Tilt Series associated with this set of coordinates.</span>
<span class="sd">                Params:</span>
<span class="sd">                    tomograms: Either a SetOfTomograms or Tilt Series object or a pointer to it.</span>
<span class="sd">                &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">precedents</span><span class="o">.</span><span class="n">isPointer</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_precedentsPointer</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">precedents</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_precedentsPointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">precedents</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.getFiles"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.getFiles">[docs]</a>    <span class="k">def</span> <span class="nf">getFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filePaths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">filePaths</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">filePaths</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.getSummary"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.getSummary">[docs]</a>    <span class="k">def</span> <span class="nf">getSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Number of particles picked: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSize</span><span class="p">())</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Particle size: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBoxSize</span><span class="p">())</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information (id and other properties) but not _mapperPath or _size</span>
<span class="sd">        from other set of objects to current one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setBoxSize</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getBoxSize</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSamplingRate</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPrecedents</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getPrecedents</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; String representation of a set of coordinates. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span><span class="o">.</span><span class="n">hasValue</span><span class="p">():</span>
            <span class="n">boxSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">boxStr</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">%d</span><span class="s1"> x </span><span class="si">%d</span><span class="s1"> x </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">boxSize</span><span class="p">,</span> <span class="n">boxSize</span><span class="p">,</span> <span class="n">boxSize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boxStr</span> <span class="o">=</span> <span class="s1">&#39;No-Box&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%d</span><span class="s2"> items, </span><span class="si">%s%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getClassName</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSize</span><span class="p">(),</span>
                                     <span class="n">boxStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appendStreamState</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="SetOfCoordinates3D.getFirstItem"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.getFirstItem">[docs]</a>    <span class="k">def</span> <span class="nf">getFirstItem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">coord</span><span class="o">.</span><span class="n">setVolume</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPrecedents</span><span class="p">()[</span><span class="n">coord</span><span class="o">.</span><span class="n">getVolId</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">coord</span></div>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add a pointer to a Tomogram before returning the Coordinate3D&#39;&#39;&#39;</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">)</span>
        <span class="n">coord</span><span class="o">.</span><span class="n">setVolume</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPrecedents</span><span class="p">()[</span><span class="n">coord</span><span class="o">.</span><span class="n">getVolId</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">coord</span></div>


<div class="viewcode-block" id="SubTomogram"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram">[docs]</a><span class="k">class</span> <span class="nc">SubTomogram</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Volume</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Volume</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coordinate</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volName</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">String</span><span class="p">()</span>

<div class="viewcode-block" id="SubTomogram.hasCoordinate3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.hasCoordinate3D">[docs]</a>    <span class="k">def</span> <span class="nf">hasCoordinate3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordinate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SubTomogram.setCoordinate3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.setCoordinate3D">[docs]</a>    <span class="k">def</span> <span class="nf">setCoordinate3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinate</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coordinate</span> <span class="o">=</span> <span class="n">coordinate</span></div>

<div class="viewcode-block" id="SubTomogram.getCoordinate3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.getCoordinate3D">[docs]</a>    <span class="k">def</span> <span class="nf">getCoordinate3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordinate</span></div>

<div class="viewcode-block" id="SubTomogram.getAcquisition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.getAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">getAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span></div>

<div class="viewcode-block" id="SubTomogram.setAcquisition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.setAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">setAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acquisition</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="n">acquisition</span></div>

<div class="viewcode-block" id="SubTomogram.hasAcquisition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.hasAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">hasAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getAngleMin</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getAngleMax</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SubTomogram.getVolId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.getVolId">[docs]</a>    <span class="k">def</span> <span class="nf">getVolId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the tomogram id if the coordinate is not None.</span>
<span class="sd">        or have set the _volId property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span><span class="o">.</span><span class="n">hasValue</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasCoordinate3D</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCoordinate3D</span><span class="p">()</span><span class="o">.</span><span class="n">getVolId</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SubTomogram.setVolId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.setVolId">[docs]</a>    <span class="k">def</span> <span class="nf">setVolId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volId</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">volId</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubTomogram.getVolName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.getVolName">[docs]</a>    <span class="k">def</span> <span class="nf">getVolName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the tomogram filename if the coordinate is not None.</span>
<span class="sd">        or have set the _volName property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volName</span><span class="o">.</span><span class="n">hasValue</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volName</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasCoordinate3D</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCoordinate3D</span><span class="p">()</span><span class="o">.</span><span class="n">getVolName</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volName</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SubTomogram.setVolName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.setVolName">[docs]</a>    <span class="k">def</span> <span class="nf">setVolName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volName</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">volName</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfSubTomograms"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfSubTomograms">[docs]</a><span class="k">class</span> <span class="nc">SetOfSubTomograms</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">SetOfVolumes</span><span class="p">):</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">SubTomogram</span>
    <span class="n">REP_TYPE</span> <span class="o">=</span> <span class="n">SubTomogram</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">SetOfVolumes</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="n">TomoAcquisition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coordsPointer</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Pointer</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfSubTomograms.hasCoordinates3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfSubTomograms.hasCoordinates3D">[docs]</a>    <span class="k">def</span> <span class="nf">hasCoordinates3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordsPointer</span><span class="o">.</span><span class="n">hasValue</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfSubTomograms.getCoordinates3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfSubTomograms.getCoordinates3D">[docs]</a>    <span class="k">def</span> <span class="nf">getCoordinates3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the SetOfCoordinates associated with</span>
<span class="sd">        this SetOfParticles&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordsPointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfSubTomograms.setCoordinates3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfSubTomograms.setCoordinates3D">[docs]</a>    <span class="k">def</span> <span class="nf">setCoordinates3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the SetOfCoordinates associates with</span>
<span class="sd">        this set of particles.</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coordsPointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AverageSubTomogram"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.AverageSubTomogram">[docs]</a><span class="k">class</span> <span class="nc">AverageSubTomogram</span><span class="p">(</span><span class="n">SubTomogram</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a set of Averages.</span>
<span class="sd">    It is a SetOfParticles but it is useful to differentiate outputs.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">SubTomogram</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="SetOfAverageSubTomograms"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfAverageSubTomograms">[docs]</a><span class="k">class</span> <span class="nc">SetOfAverageSubTomograms</span><span class="p">(</span><span class="n">SetOfSubTomograms</span><span class="p">):</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">AverageSubTomogram</span>
    <span class="n">REP_TYPE</span> <span class="o">=</span> <span class="n">AverageSubTomogram</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">SetOfSubTomograms</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="ClassSubTomogram"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.ClassSubTomogram">[docs]</a><span class="k">class</span> <span class="nc">ClassSubTomogram</span><span class="p">(</span><span class="n">SetOfSubTomograms</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represent a Class that groups SubTomogram objects.</span>
<span class="sd">    The representative of the class is an AverageSubTomogram.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">REP_TYPE</span> <span class="o">=</span> <span class="n">AverageSubTomogram</span>

<div class="viewcode-block" id="ClassSubTomogram.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.ClassSubTomogram.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information (id and other properties) but not</span>
<span class="sd">        _mapperPath or _size from other set of SubTomograms to current one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_mapperPath&#39;</span><span class="p">,</span> <span class="s1">&#39;_size&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="ClassSubTomogram.clone"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.ClassSubTomogram.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getClass</span><span class="p">()()</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_mapperPath&#39;</span><span class="p">,</span> <span class="s1">&#39;_size&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">clone</span></div>

<div class="viewcode-block" id="ClassSubTomogram.close"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.ClassSubTomogram.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Do nothing on close, since the db will be closed by SetOfClasses</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="SetOfClassesSubTomograms"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfClassesSubTomograms">[docs]</a><span class="k">class</span> <span class="nc">SetOfClassesSubTomograms</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">SetOfClasses</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Store results from a subtomogram averaging method. &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">ClassSubTomogram</span>
    <span class="n">REP_TYPE</span> <span class="o">=</span> <span class="n">AverageSubTomogram</span></div>


<div class="viewcode-block" id="LandmarkModel"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel">[docs]</a><span class="k">class</span> <span class="nc">LandmarkModel</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents the set of landmarks belonging to an specific Tilt-series.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modelName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">tsId</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modelName</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>

<div class="viewcode-block" id="LandmarkModel.getTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.getTsId">[docs]</a>    <span class="k">def</span> <span class="nf">getTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="p">)</span></div>

<div class="viewcode-block" id="LandmarkModel.getFileName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.getFileName">[docs]</a>    <span class="k">def</span> <span class="nf">getFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span><span class="p">)</span></div>

<div class="viewcode-block" id="LandmarkModel.getModelName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.getModelName">[docs]</a>    <span class="k">def</span> <span class="nf">getModelName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_modelName</span><span class="p">)</span></div>

<div class="viewcode-block" id="LandmarkModel.setTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.setTsId">[docs]</a>    <span class="k">def</span> <span class="nf">setTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">tsId</span><span class="p">)</span></div>

<div class="viewcode-block" id="LandmarkModel.setFileName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.setFileName">[docs]</a>    <span class="k">def</span> <span class="nf">setFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span></div>

<div class="viewcode-block" id="LandmarkModel.setModelName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.setModelName">[docs]</a>    <span class="k">def</span> <span class="nf">setModelName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modelName</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span></div>

<div class="viewcode-block" id="LandmarkModel.addLandmark"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.addLandmark">[docs]</a>    <span class="k">def</span> <span class="nf">addLandmark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xCoor</span><span class="p">,</span> <span class="n">yCoor</span><span class="p">,</span>  <span class="n">tiltIm</span><span class="p">,</span> <span class="n">chainId</span><span class="p">,</span> <span class="n">xResid</span><span class="p">,</span> <span class="n">yResid</span><span class="p">):</span>
        <span class="n">fieldNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;xCoor&#39;</span><span class="p">,</span> <span class="s1">&#39;yCoor&#39;</span><span class="p">,</span> <span class="s1">&#39;tiltIm&#39;</span><span class="p">,</span> <span class="s1">&#39;chainId&#39;</span><span class="p">,</span> <span class="s1">&#39;xResid&#39;</span><span class="p">,</span> <span class="s1">&#39;yResid&#39;</span><span class="p">]</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">())</span> <span class="k">else</span> <span class="s2">&quot;w&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">(),</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldNames</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span><span class="s1">&#39;xCoor&#39;</span><span class="p">:</span> <span class="n">xCoor</span><span class="p">,</span>
                             <span class="s1">&#39;yCoor&#39;</span><span class="p">:</span> <span class="n">yCoor</span><span class="p">,</span>
                             <span class="s1">&#39;tiltIm&#39;</span><span class="p">:</span> <span class="n">tiltIm</span><span class="p">,</span>
                             <span class="s1">&#39;chainId&#39;</span><span class="p">:</span> <span class="n">chainId</span><span class="p">,</span>
                             <span class="s1">&#39;xResid&#39;</span><span class="p">:</span> <span class="n">xResid</span><span class="p">,</span>
                             <span class="s1">&#39;yResid&#39;</span><span class="p">:</span> <span class="n">yResid</span><span class="p">})</span></div></div>


<div class="viewcode-block" id="SetOfLandmarkModels"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfLandmarkModels">[docs]</a><span class="k">class</span> <span class="nc">SetOfLandmarkModels</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a class that groups a set of landmark models.&quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">LandmarkModel</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mesh"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Mesh">[docs]</a><span class="k">class</span> <span class="nc">Mesh</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mesh object: it stores the coordinates of the points (specified by the user) needed to define</span>
<span class="sd">    the triangulation of a volume.</span>
<span class="sd">    A Mesh object can be consider as a point cloud in 3D containing the coordinates needed to divide a given region of</span>
<span class="sd">    space into planar triangles interconnected that will result in a closed surface.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volumePointer</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Pointer</span><span class="p">(</span><span class="n">objDoStore</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>

<div class="viewcode-block" id="Mesh.getPath"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Mesh.getPath">[docs]</a>    <span class="k">def</span> <span class="nf">getPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Mesh.setPath"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Mesh.setPath">[docs]</a>    <span class="k">def</span> <span class="nf">setPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mesh.getGroup"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Mesh.getGroup">[docs]</a>    <span class="k">def</span> <span class="nf">getGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Mesh.setGroup"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Mesh.setGroup">[docs]</a>    <span class="k">def</span> <span class="nf">setGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mesh.getMesh"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Mesh.getMesh">[docs]</a>    <span class="k">def</span> <span class="nf">getMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPath</span><span class="p">()</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">numMeshes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">array</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">idm</span> <span class="ow">in</span> <span class="n">numMeshes</span><span class="p">:</span>
            <span class="n">mesh_group</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">array</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">idm</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh_group</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">mesh</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getGroup</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Mesh.getVolume"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Mesh.getVolume">[docs]</a>    <span class="k">def</span> <span class="nf">getVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the tomogram object to which</span>
<span class="sd">        this mesh is associated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volumePointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Mesh.setVolume"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Mesh.setVolume">[docs]</a>    <span class="k">def</span> <span class="nf">setVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the tomogram to which this mesh belongs. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volumePointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">volume</span><span class="o">.</span><span class="n">getObjId</span><span class="p">())</span></div>

<div class="viewcode-block" id="Mesh.getVolId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Mesh.getVolId">[docs]</a>    <span class="k">def</span> <span class="nf">getVolId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Mesh (path=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPath</span><span class="p">()</span></div>


<div class="viewcode-block" id="SetOfMeshes"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfMeshes">[docs]</a><span class="k">class</span> <span class="nc">SetOfMeshes</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Store a series of meshes. &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">Mesh</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volumesPointer</span> <span class="o">=</span> <span class="n">pwobj</span><span class="o">.</span><span class="n">Pointer</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfMeshes.setVolumes"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfMeshes.setVolumes">[docs]</a>    <span class="k">def</span> <span class="nf">setVolumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volumes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the tomograms associated with this set of coordinates.</span>
<span class="sd">        Params:</span>
<span class="sd">            tomograms: Either a SetOfTomograms object or a pointer to it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">volumes</span><span class="o">.</span><span class="n">isPointer</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_volumesPointer</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_volumesPointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfMeshes.getVolumes"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfMeshes.getVolumes">[docs]</a>    <span class="k">def</span> <span class="nf">getVolumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the SetOfTomograms associated with</span>
<span class="sd">        this SetOfCoordinates&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volumesPointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfMeshes.iterItems"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfMeshes.iterItems">[docs]</a>    <span class="k">def</span> <span class="nf">iterItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orderBy</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;ASC&#39;</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Redefine iteration to set the acquisition to images. &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orderBy</span><span class="o">=</span><span class="n">orderBy</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span>
                                 <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">):</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">setVolume</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getVolumes</span><span class="p">()[</span><span class="n">mesh</span><span class="o">.</span><span class="n">getVolId</span><span class="p">()])</span>
            <span class="k">yield</span> <span class="n">mesh</span></div>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add a pointer to a Tomogram before returning the Coordinate3D&#39;&#39;&#39;</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">setVolume</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getVolumes</span><span class="p">()[</span><span class="n">mesh</span><span class="o">.</span><span class="n">getVolId</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">mesh</span></div>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: release-3.0.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../dm_facilitiesUpdate/index.html">dm_facilitiesUpdate</a></dd>
            <dd><a href="../../dm_reducingApiMenu/index.html">dm_reducingApiMenu</a></dd>
            <dd><a href="../../gh-pages/index.html">gh-pages</a></dd>
            <dd><a href="../../release-2.0.0/index.html">release-2.0.0</a></dd>
            <dd><a href="../../release-3.0.0/_modules/tomo/objects.html">release-3.0.0</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>