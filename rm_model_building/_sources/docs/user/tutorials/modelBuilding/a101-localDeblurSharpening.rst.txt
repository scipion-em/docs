.. _`app:localDeblurSharpening`:

Local Deblur Sharpening protocol
================================

Protocol designed to apply :math:`LocalDeblur`, the automatic local
resolution-based method that increases map signal at medium/high
resolution :raw-latex:`\citep{ramirez2018}`, in . Unlike similar
approaches, :math:`LocalDeblur` does not need any prior atomic model,
avoiding artificial structure factor corrections. Since the map gets
much more interpretability, the modeling process results much easier.
This type of sharpening is recommended for maps showing a broad range of
resolutions, as it is usually common with membrane proteins or
macromolecules highly flexible. In all those cases, applying a global
sharpening method, like :math:`Relion` , does not optimize the result
when you have very different local resolution values because a global
operation cannot improve all parts of the map. However, when changes in
resolution are small there isn’t almost difference between applying a
global or a local sharpening method. For example, in maps with high
symmetry, like viruses, resolution is quite homogenous. The absence of
high differences in resolution determines that at high resolution the
results of global or local sharpening methods are almost the same.

-  Requirements to run this protocol and visualize results:

   -  plugin:

   -  plugin:

   -  plugin:

-  | menu:
   | ( (A))

-  Protocol form parameters ( (B)):

   .. figure:: Images_appendix/Fig208.pdf
      :alt: Protocol . A: Protocol location in menu. B: Protocol form.
      :name: fig:app_localdeblur_1
      :width: 90.0%

      Protocol . A: Protocol location in menu. B: Protocol form.

   -  : Unfiltered electron density map previously downloaded or
      generated in .

   -  : Resolution map generated by protocols like . The resolution
      value in the corresponding voxel of the is assigned to each voxel
      of the .

   -  : Since :math:`LocalDeblur` is based on an iterative formula
      repeated until a convergence criterion is reached, is the step
      size advanced parameter that modulates the speed of convergence.
      The default value, = 1, indicates that the method itself
      establishes automatically the value of . Although the default
      value is small enough to guarantee the convergence and large
      enough to speed it up, the value can be increased by the user to
      accelerate the convergence process. Unlike the default value, that
      grows along the convergence process, the value selected by the
      user will be maintained constant. Falling into a local minimum is
      a risk derived of increasing the convergence speed.

   -  : Weight assigned to the difference between the local resolution
      and the spatial frequency of the center of each bandpass filter.
      This difference weighted by is the base to compute the local
      weight of each channel in the filter bank, that correlates the
      input map with the sharpened map. The bigger the value of , the
      lower the weight of each channel in the filter bank. Maximum
      weights are obtained when local resolution and spatial frequency
      of the center of each bandpass filter show identical values. As it
      has been empirically observed K=0.025 produces good results for
      most of tests performed. No big differences have been detected
      with K values ranging between 0.01 and 0.05. In the particular
      case of low resolution maps (lower than 6 Å), 0.01 seems to be a
      good choice.

-  | Protocol execution:
   | Adding specific map/structure label is recommended in section, at
     the form top. To add the label, open the protocol form, press the
     pencil symbol at the right side of box, complete the label in the
     new opened window, press OK and, finally, close the protocol. This
     label will be shown in the output summary content (see below). If
     you want to run again this protocol, do not forget to set to the .
   | Press the red button at the form bottom.

-  Visualization of protocol results:

   | To visualize the total number of sharpened maps generated according
     to the number of iterations until convergence, press with the right
     mouse the black arrow placed in the lower part of the framework
     (Protocol output:
   | ). The option will appear, select it. The sharpened map epochs will
     be detailed. The sharpening algorithm stops when the difference
     between two successive iterations is lower than 1%, thus generating
     a variable number of maps before stopping. You can select any of
     them and visualize the slices with :math:`ShowJ`
     (https://github.com/I2PC/scipion/wiki/ShowJ), the default viewer.
     To visualize the slices press the symbol that appears below in the
     main menu. The :math:`ShowJ` window menu () allows to open the
     selected map in :math:`ChimeraX` graphics window.

   Nevertheless, the :math:`ChimeraX` graphics window can also be opened
   to compare the input and the last iteration sharpened map. After
   executing the protocol, press and the :math:`ChimeraX` graphics
   window will be opened. Volumes are referred to the origin of
   coordinates in . To show the relative position of the volumes, the
   three coordinate axes are represented; X axis (red), Y axis (yellow),
   and Z axis (blue) (). Coordinate axes, the imported volume and the
   last sharpened one () are model numbers , and , respectively, in
   :math:`ChimeraX` panel. Volume coordinates and pixel size can be
   checked in :math:`ChimeraX` main menu .

-  Summary content:

   -  | Protocol output (below framework):
      | ;
      | SetOfVolumes (number of items, x, y, and z dimensions, sampling
        rate).

   -  | box:
      | .
