

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>reliontomo.protocols.protocol_base_tomo &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/how-to-install.html">Installing Scipion v3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html#processing-how-to-s">Processing How Toâ€™s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/facilities.html">On-the-fly processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/customize-report.html">Summary Reports</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/api/scipion-API.html">Scipion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/api/plugins-API.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/api/xmipp-API.html">Xmipp API</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/misc/contact-us.html">Contact Us</a></li>
</ul>
<p class="caption"><span class="caption-text">Licences</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/license.html">Licenses</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../reliontomo.html">reliontomo</a> &raquo;</li>
        
      <li>reliontomo.protocols.protocol_base_tomo</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for reliontomo.protocols.protocol_base_tomo</h1><div class="highlight"><pre>
<span></span><span class="c1"># *</span>
<span class="c1"># * Authors:     Scipion Team</span>
<span class="c1"># *</span>
<span class="c1"># * Unidad de  Bioinformatica of Centro Nacional de Biotecnologia , CSIC</span>
<span class="c1"># *</span>
<span class="c1"># * This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># * it under the terms of the GNU General Public License as published by</span>
<span class="c1"># * the Free Software Foundation; either version 2 of the License, or</span>
<span class="c1"># * (at your option) any later version.</span>
<span class="c1"># *</span>
<span class="c1"># * This program is distributed in the hope that it will be useful,</span>
<span class="c1"># * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># * GNU General Public License for more details.</span>
<span class="c1"># *</span>
<span class="c1"># * You should have received a copy of the GNU General Public License</span>
<span class="c1"># * along with this program; if not, write to the Free Software</span>
<span class="c1"># * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA</span>
<span class="c1"># * 02111-1307  USA</span>
<span class="c1"># *</span>
<span class="c1"># *  All comments concerning this program package may be sent to the</span>
<span class="c1"># *  e-mail address &#39;scipion-users@lists.sourceforge.net&#39;</span>
<span class="c1"># *</span>
<span class="c1"># **************************************************************************</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains the protocol base class for Relion protocols</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="k">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">exists</span><span class="p">,</span> <span class="n">abspath</span>

<span class="kn">import</span> <span class="nn">pyworkflow.protocol.params</span> <span class="k">as</span> <span class="nn">params</span>
<span class="kn">from</span> <span class="nn">pwem.objects</span> <span class="k">import</span> <span class="n">SetOfClasses3D</span>
<span class="kn">from</span> <span class="nn">pwem.protocols</span> <span class="k">import</span> <span class="n">EMProtocol</span>
<span class="kn">from</span> <span class="nn">pyworkflow.protocol.constants</span> <span class="k">import</span> <span class="n">LEVEL_ADVANCED</span>
<span class="kn">from</span> <span class="nn">pyworkflow.utils.path</span> <span class="k">import</span> <span class="n">cleanPath</span>

<span class="kn">from</span> <span class="nn">reliontomo.constants</span> <span class="k">import</span> <span class="n">V30_VALIDATION_MSG</span>
<span class="kn">from</span> <span class="nn">relion.convert</span> <span class="k">import</span> <span class="n">convertBinaryVol</span><span class="p">,</span> <span class="n">MASK_FILL_ZERO</span><span class="p">,</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">relion</span> <span class="k">import</span> <span class="n">ANGULAR_SAMPLING_LIST</span>
<span class="kn">from</span> <span class="nn">reliontomo</span> <span class="k">import</span> <span class="n">Plugin</span>
<span class="kn">from</span> <span class="nn">reliontomo.convert</span> <span class="k">import</span> <span class="n">writeSetOfSubtomograms</span>


<div class="viewcode-block" id="ProtRelionBaseTomo"><a class="viewcode-back" href="../../../api/reliontomo/reliontomo.protocols.protocol_base_tomo.html#reliontomo.protocols.protocol_base_tomo.ProtRelionBaseTomo">[docs]</a><span class="k">class</span> <span class="nc">ProtRelionBaseTomo</span><span class="p">(</span><span class="n">EMProtocol</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class cointains the common functionalities for all Relion protocols.</span>
<span class="sd">    In subclasses there should be little changes about how to create the command line</span>
<span class="sd">    and the files produced.</span>

<span class="sd">    Most of the Relion protocols, have two modes: NORMAL or CONTINUE. That&#39;s why</span>
<span class="sd">    some of the function have a template pattern approach to define the behaivour</span>
<span class="sd">    depending on the case.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_label</span> <span class="o">=</span> <span class="s1">&#39;3d classify&#39;</span>
    <span class="n">OUTPUT_TYPE</span> <span class="o">=</span> <span class="n">SetOfClasses3D</span>
    <span class="n">FILE_KEYS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;optimiser&#39;</span><span class="p">,</span> <span class="s1">&#39;sampling&#39;</span><span class="p">]</span>
    <span class="n">PREFIXES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
    <span class="n">modelTable</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
    <span class="n">claasesTable</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
    <span class="n">dataTable</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
    <span class="n">nClasses</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="n">EMProtocol</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This function is mean to be called after the</span>
<span class="sd">        working dir for the protocol have been set. (maybe after recovery from mapper)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_createFilenameTemplates</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_createIterTemplates</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ClassFnTemplate</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(rootDir)s</span><span class="s1">/relion_it</span><span class="si">%(iter)03d</span><span class="s1">_class</span><span class="si">%(ref)03d</span><span class="s1">.mrc:mrc&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">doContinue</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">continueRun</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">referenceVolume</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_createFilenameTemplates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Centralize how files are called for iterations and references. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extraIter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getExtraPath</span><span class="p">(</span><span class="s1">&#39;relion_it</span><span class="si">%(iter)03d</span><span class="s1">_&#39;</span><span class="p">)</span>
        <span class="n">myDict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;input_star&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPath</span><span class="p">(</span><span class="s1">&#39;input_subtomograms.star&#39;</span><span class="p">),</span>
            <span class="s1">&#39;data_scipion&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">extraIter</span> <span class="o">+</span> <span class="s1">&#39;data_scipion.sqlite&#39;</span><span class="p">,</span>
            <span class="s1">&#39;projections&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">extraIter</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%(half)s</span><span class="s1">class</span><span class="si">%(ref3d)03d</span><span class="s1">_projections.sqlite&#39;</span><span class="p">,</span>
            <span class="s1">&#39;classes_scipion&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">extraIter</span> <span class="o">+</span> <span class="s1">&#39;classes_scipion.sqlite&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">extraIter</span> <span class="o">+</span> <span class="s1">&#39;model.star&#39;</span><span class="p">,</span>
            <span class="s1">&#39;shiny&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getExtraPath</span><span class="p">(</span><span class="s1">&#39;shiny.star&#39;</span><span class="p">),</span>
            <span class="s1">&#39;optimiser&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">extraIter</span> <span class="o">+</span> <span class="s1">&#39;optimiser.star&#39;</span><span class="p">,</span>
            <span class="s1">&#39;angularDist_xmipp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">extraIter</span> <span class="o">+</span> <span class="s1">&#39;angularDist_xmipp.xmd&#39;</span><span class="p">,</span>
            <span class="s1">&#39;all_avgPmax_xmipp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTmpPath</span><span class="p">(</span><span class="s1">&#39;iterations_avgPmax_xmipp.xmd&#39;</span><span class="p">),</span>
            <span class="s1">&#39;all_changes_xmipp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTmpPath</span><span class="p">(</span><span class="s1">&#39;iterations_changes_xmipp.xmd&#39;</span><span class="p">),</span>
            <span class="s1">&#39;selected_volumes&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTmpPath</span><span class="p">(</span><span class="s1">&#39;selected_volumes_xmipp.xmd&#39;</span><span class="p">),</span>
            <span class="s1">&#39;dataFinal&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getExtraPath</span><span class="p">(</span><span class="s2">&quot;relion_data.star&quot;</span><span class="p">),</span>
            <span class="s1">&#39;modelFinal&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getExtraPath</span><span class="p">(</span><span class="s2">&quot;relion_model.star&quot;</span><span class="p">),</span>
            <span class="s1">&#39;finalvolume&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getExtraPath</span><span class="p">(</span><span class="s2">&quot;relion_class</span><span class="si">%(ref3d)03d</span><span class="s2">.mrc:mrc&quot;</span><span class="p">)</span>

        <span class="p">}</span>
        <span class="c1"># add to keys, data.star, optimiser.star and sampling.star</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FILE_KEYS</span><span class="p">:</span>
            <span class="n">myDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extraIter</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.star&#39;</span> <span class="o">%</span> <span class="n">key</span>
            <span class="n">key_xmipp</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_xmipp&#39;</span>
            <span class="n">myDict</span><span class="p">[</span><span class="n">key_xmipp</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extraIter</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.xmd&#39;</span> <span class="o">%</span> <span class="n">key</span>
        <span class="c1"># add other keys that depends on prefixes</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PREFIXES</span><span class="p">:</span>
            <span class="n">myDict</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">model&#39;</span> <span class="o">%</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extraIter</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">model.star&#39;</span> <span class="o">%</span> <span class="n">p</span>
            <span class="n">myDict</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">volume&#39;</span> <span class="o">%</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extraIter</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s1">&#39;class</span><span class="si">%(ref3d)03d</span><span class="s1">.mrc:mrc&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_updateFilenamesDict</span><span class="p">(</span><span class="n">myDict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_createIterTemplates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Setup the regex on how to find iterations. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iterTemplate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getFileName</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;000&#39;</span><span class="p">,</span> <span class="s1">&#39;???&#39;</span><span class="p">)</span>
        <span class="c1"># Iterations will be identify by _itXXX_ where XXX is the iteration number</span>
        <span class="c1"># and is restricted to only 3 digits.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iterRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;_it(\d{3,3})_&#39;</span><span class="p">)</span>

    <span class="c1"># --------------------------- DEFINE param functions --------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_defineParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addSection</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input&#39;</span><span class="p">)</span>
        <span class="c1"># Some hidden variables to be used for conditions</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addHidden</span><span class="p">(</span><span class="s1">&#39;isClassify&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IS_CLASSIFY</span><span class="p">)</span>

        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;doContinue&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Continue from a previous run?&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;If you set to *Yes*, you should select a previous&#39;</span>
                           <span class="s1">&#39;run of type *</span><span class="si">%s</span><span class="s1">* class and most of the input parameters&#39;</span>
                           <span class="s1">&#39;will be taken from it.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getClassName</span><span class="p">())</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;inputSubtomograms&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">PointerParam</span><span class="p">,</span>
                      <span class="n">pointerClass</span><span class="o">=</span><span class="s1">&#39;SetOfSubTomograms&#39;</span><span class="p">,</span>
                      <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;not doContinue&#39;</span><span class="p">,</span>
                      <span class="n">important</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Input subtomograms&quot;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Select the input subtomograms from the project.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;maskDiameterA&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">IntParam</span><span class="p">,</span>
                      <span class="n">default</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;not doContinue&#39;</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Particle mask diameter (A)&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The experimental images will be masked with a soft circular mask &#39;</span>
                           <span class="s1">&#39;with this &lt;diameter&gt;. &#39;</span>
                           <span class="s1">&#39;Make sure this diameter is not set too small because that may mask &#39;</span>
                           <span class="s1">&#39;away part of the signal! If set to a value larger than the image &#39;</span>
                           <span class="s1">&#39;size no masking will be performed.</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                           <span class="s1">&#39;The same diameter will also be used for a spherical mask of the &#39;</span>
                           <span class="s1">&#39;reference structures if no user-provided mask is specified.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;continueRun&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">PointerParam</span><span class="p">,</span>
                      <span class="n">pointerClass</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getClassName</span><span class="p">(),</span>
                      <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;doContinue&#39;</span><span class="p">,</span>
                      <span class="n">allowsNull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Select previous run&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Select a previous run to continue from.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;continueIter&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">StringParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">,</span>
                      <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;doContinue&#39;</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Continue from iteration&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Select from which iteration do you want to continue.&#39;</span>
                           <span class="s1">&#39;if you use *last*, then the last iteration will be used.&#39;</span>
                           <span class="s1">&#39;otherwise, a valid iteration number should be provided.&#39;</span><span class="p">)</span>

        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;numberOfClasses&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">IntParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                      <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;not doContinue and isClassify&#39;</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Number of classes:&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The number of classes (K) for a multi-reference refinement.&#39;</span>
                           <span class="s1">&#39;These classes will be made in an unsupervised manner from a single&#39;</span>
                           <span class="s1">&#39;reference by division of the data into random subsets during the&#39;</span>
                           <span class="s1">&#39;first iteration.&#39;</span><span class="p">)</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">addGroup</span><span class="p">(</span><span class="s1">&#39;Reference 3D map&#39;</span><span class="p">,</span>
                              <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;not doContinue&#39;</span><span class="p">)</span>
        <span class="n">group</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;referenceVolume&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">PointerParam</span><span class="p">,</span>
                       <span class="n">pointerClass</span><span class="o">=</span><span class="s1">&#39;Volume&#39;</span><span class="p">,</span>
                       <span class="n">allowsNull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Input volume&quot;</span><span class="p">,</span>
                       <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;not doContinue&#39;</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Initial reference 3D map, it should have the same &#39;</span>
                            <span class="s1">&#39;dimensions and the same pixel size as your input particles.&#39;</span><span class="p">)</span>
        <span class="n">group</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;isMapAbsoluteGreyScale&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Is initial 3D map on absolute greyscale?&quot;</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The probabilities are based on squared differences, &#39;</span>
                            <span class="s1">&#39;so that the absolute grey scale is important. </span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="s1">&#39;Probabilities are calculated based on a Gaussian noise model,&#39;</span>
                            <span class="s1">&#39;which contains a squared difference term between the reference and the experimental &#39;</span>
                            <span class="s1">&#39;image. This has a consequence that the reference needs to be on the same absolute &#39;</span>
                            <span class="s1">&#39;intensity greyscale as the experimental images. RELION and XMIPP reconstruct maps at &#39;</span>
                            <span class="s1">&#39;their absolute intensity greyscale. Other packages may perform internal normalisations of &#39;</span>
                            <span class="s1">&#39;the reference density, which will result in incorrect grey-scales. Therefore: if the map &#39;</span>
                            <span class="s1">&#39;was reconstructed in RELION or in XMIPP, set this option to Yes, otherwise set it to No. &#39;</span>
                            <span class="s1">&#39;If set to No, RELION will use a (grey-scale invariant) cross-correlation criterion in the &#39;</span>
                            <span class="s1">&#39;first iteration, and prior to the second iteration the map will be filtered again using &#39;</span>
                            <span class="s1">&#39;the initial low-pass filter. This procedure is relatively quick and typically does not &#39;</span>
                            <span class="s1">&#39;negatively affect the outcome of the subsequent MAP refinement. Therefore, if in doubt it &#39;</span>
                            <span class="s1">&#39;is recommended to set this option to No.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addSymmetry</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="n">group</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;initialLowPassFilterA&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">FloatParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Initial low-pass filter (A)&#39;</span><span class="p">,</span>
                       <span class="n">help</span><span class="o">=</span><span class="s1">&#39;It is recommended to strongly low-pass filter your initial reference map. &#39;</span>
                            <span class="s1">&#39;If it has not yet been low-pass filtered, it may be done internally using this option. &#39;</span>
                            <span class="s1">&#39;If set to 0, no low-pass filter will be applied to the initial reference(s).&#39;</span><span class="p">)</span>

        <span class="n">form</span><span class="o">.</span><span class="n">addSection</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;CTF&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;contuinueMsg&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">LabelParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;CTF parameters are not available in continue mode&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;doContinue&#39;</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;doCTF&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Do CTF-correction?&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;not doContinue&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;If set to Yes, CTFs will be corrected inside the MAP refinement. &#39;</span>
                           <span class="s1">&#39;The resulting algorithm intrinsically implements the optimal linear, &#39;</span>
                           <span class="s1">&#39;or Wiener filter. Note that input particles should contains CTF parameters.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;ignoreCTFUntilFirstPeak&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">expertLevel</span><span class="o">=</span><span class="n">LEVEL_ADVANCED</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ignore CTFs until first peak?&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;doCTF and not doContinue&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;If set to Yes, then CTF-amplitude correction will only be performed from the first peak &#39;</span>
                           <span class="s1">&#39;of each CTF onward. This can be useful if the CTF model is inadequate at the lowest &#39;</span>
                           <span class="s1">&#39;resolution. Still, in general using higher amplitude contrast on the CTFs (e.g. 10-20%) &#39;</span>
                           <span class="s1">&#39;often yields better results. Therefore, this option is not generally recommended.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;ctfFlipPhases&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">expertLevel</span><span class="o">=</span><span class="n">LEVEL_ADVANCED</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Perform only CTF phase-flipping?&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;doCTF and not doContinue&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;hasReferenceCTFCorrected&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;not doContinue&#39;</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Has reference been CTF-corrected?&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Set this option to Yes if the reference map represents CTF-unaffected density, &#39;</span>
                           <span class="s1">&#39;e.g. it was created using Wiener filtering inside RELION or from a PDB. If set to No, &#39;</span>
                           <span class="s1">&#39;then in the first iteration, the Fourier transforms of the reference projections &#39;</span>
                           <span class="s1">&#39;are not multiplied by the CTFs.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;ctfMultiplied&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">expertLevel</span><span class="o">=</span><span class="n">LEVEL_ADVANCED</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Has the data been pre-multiplied by the CTF?&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;not doContinue&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;ctfPhaseFlipped&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">expertLevel</span><span class="o">=</span><span class="n">LEVEL_ADVANCED</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Has the data been CTF phase-flipped?&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;not doContinue&#39;</span><span class="p">)</span>

        <span class="n">form</span><span class="o">.</span><span class="n">addSection</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Optimisation&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IS_CLASSIFY</span><span class="p">:</span>
            <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;numberOfIterations&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">IntParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Number of iterations&#39;</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Number of iterations to be performed. Note that the current implementation does NOT &#39;</span>
                               <span class="s1">&#39;comprise a convergence criterium. Therefore, the calculations will need to be stopped &#39;</span>
                               <span class="s1">&#39;by the user if further iterations do not yield improvements in resolution or classes. &#39;</span>
                               <span class="s1">&#39;If continue option is True, you going to do this number of new iterations (e.g. if &#39;</span>
                               <span class="s1">&#39;*Continue from iteration* is set 3 and this param is set 25, the final iteration of the &#39;</span>
                               <span class="s1">&#39;protocol will be the 28th.&#39;</span><span class="p">)</span>
            <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;regularisationParamT&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">IntParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Regularisation parameter T&#39;</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Bayes law strictly determines the relative weight between the contribution of the &#39;</span>
                               <span class="s1">&#39;experimental data and the prior. &#39;</span>
                               <span class="s1">&#39;However, in practice one may need to adjust this weight to put slightly more weight on &#39;</span>
                               <span class="s1">&#39;the experimental &#39;</span>
                               <span class="s1">&#39;data to allow optimal results. Values greater than 1 for this regularisation parameter &#39;</span>
                               <span class="s1">&#39;(T in the JMB2011 paper) put more weight on the experimental data. Values around 2-4 &#39;</span>
                               <span class="s1">&#39;have been observed to be useful for 3D refinements, values of 1-2 for 2D refinements. &#39;</span>
                               <span class="s1">&#39;Too small values yield too-low resolution structures; too high values result in &#39;</span>
                               <span class="s1">&#39;over-estimated resolutions and overfitting.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;maskZero&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">EnumParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Yes, fill with zeros&#39;</span><span class="p">,</span> <span class="s1">&#39;No, fill with random noise&#39;</span><span class="p">],</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mask particles with zeros?&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;not doContinue&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;If set to &lt;Yes&gt;, then in the individual particles, the area outside a circle with the &#39;</span>
                           <span class="s1">&#39;radius of the particle will be set to zeros prior to taking the Fourier transform. &#39;</span>
                           <span class="s1">&#39;This will remove noise and therefore increase sensitivity in the alignment and &#39;</span>
                           <span class="s1">&#39;classification. However, it will also introduce correlations between the Fourier &#39;</span>
                           <span class="s1">&#39;components that are not modelled. When set to &lt;No&gt;, then the solvent area is filled with &#39;</span>
                           <span class="s1">&#39;random noise, which prevents introducing correlations.High-resolution refinements (e.g. &#39;</span>
                           <span class="s1">&#39;in 3D auto-refine) tend to work better when filling the solvent area with random noise, &#39;</span>
                           <span class="s1">&#39;some classifications go better when using zeros.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;referenceMask&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">PointerParam</span><span class="p">,</span> <span class="n">pointerClass</span><span class="o">=</span><span class="s1">&#39;VolumeMask&#39;</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Reference mask (optional)&#39;</span><span class="p">,</span> <span class="n">allowsNull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;A volume mask containing a (soft) mask with the same dimensions &#39;</span>
                           <span class="s1">&#39;as the reference(s), and values between 0 and 1, with 1 being 100% protein &#39;</span>
                           <span class="s1">&#39;and 0 being 100</span><span class="si">% s</span><span class="s1">olvent. The reconstructed reference map will be multiplied &#39;</span>
                           <span class="s1">&#39;by this mask. If no mask is given, a soft spherical mask based on the &lt;radius&gt; &#39;</span>
                           <span class="s1">&#39;of the mask for the experimental images will be applied.</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                           <span class="s1">&#39;In some cases, for example for non-empty icosahedral viruses, it is also useful &#39;</span>
                           <span class="s1">&#39;to use a second mask. Check _Advaced_ level and select another volume mask&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;solventMask&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">PointerParam</span><span class="p">,</span> <span class="n">pointerClass</span><span class="o">=</span><span class="s1">&#39;VolumeMask&#39;</span><span class="p">,</span>
                      <span class="n">expertLevel</span><span class="o">=</span><span class="n">LEVEL_ADVANCED</span><span class="p">,</span> <span class="n">allowsNull</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Second reference mask (optional)&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;For all white (value 1) pixels in this second mask the &#39;</span>
                           <span class="s1">&#39;corresponding pixels in the reconstructed map are set to the average value of &#39;</span>
                           <span class="s1">&#39;these pixels. Thereby, for example, the higher density inside the virion may be &#39;</span>
                           <span class="s1">&#39;set to a constant. Note that this second mask should have one-values inside the &#39;</span>
                           <span class="s1">&#39;virion and zero-values in the capsid and the solvent areas.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IS_CLASSIFY</span><span class="p">:</span>
            <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;limitResolEStep&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">FloatParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Limit resolution E-step to (A)&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;not doContinue&quot;</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s1">&#39;If set to a positive number, then the expectation step &#39;</span>
                               <span class="s1">&#39;(i.e. the alignment) will be done only including the Fourier &#39;</span>
                               <span class="s1">&#39;components up to this resolution (in Angstroms). This is useful &#39;</span>
                               <span class="s1">&#39;to prevent overfitting, as the classification runs in RELION are &#39;</span>
                               <span class="s1">&#39;not to be guaranteed to be 100</span><span class="si">% o</span><span class="s1">verfitting-free (unlike the &#39;</span>
                               <span class="s1">&#39;_3D auto-refine_ with its gold-standard FSC). In particular for very &#39;</span>
                               <span class="s1">&#39;difficult data sets, e.g. of very small or featureless particles, &#39;</span>
                               <span class="s1">&#39;this has been shown to give much better class averages. In such &#39;</span>
                               <span class="s1">&#39;cases, values in the range of 7-12 Angstroms have proven useful.&#39;</span><span class="p">)</span>
            <span class="c1"># Change the Sampling section name depending if classify or refine 3D</span>
            <span class="n">form</span><span class="o">.</span><span class="n">addSection</span><span class="p">(</span><span class="s1">&#39;Sampling&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span><span class="o">.</span><span class="n">addSection</span><span class="p">(</span><span class="s1">&#39;Auto-Sampling&#39;</span><span class="p">)</span>
            <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;noteAutoSampling&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">LabelParam</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Note that initial sampling rates will be auto-incremented!&#39;</span><span class="p">)</span>

        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;doImageAlignment&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Perform image alignment?&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="s2">&quot;isClassify&quot;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;If set to No, then rather than performing both alignment &#39;</span>
                           <span class="s1">&#39;and classification, only classification will be performed. &#39;</span>
                           <span class="s1">&#39;This allows the use of very focused masks.This requires &#39;</span>
                           <span class="s1">&#39;that the optimal orientations of all particles are already &#39;</span>
                           <span class="s1">&#39;calculated.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;angularSamplingDeg&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">EnumParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                      <span class="n">choices</span><span class="o">=</span><span class="n">ANGULAR_SAMPLING_LIST</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Angular sampling interval (deg)&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;not isClassify or doImageAlignment&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;There are only a few discrete angular samplings possible because &#39;</span>
                           <span class="s1">&#39;we use the HealPix library to generate the sampling of the first &#39;</span>
                           <span class="s1">&#39;two Euler angles on the sphere. The samplings are approximate numbers &#39;</span>
                           <span class="s1">&#39;and vary slightly over the sphere.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;offsetSearchRangePix&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">FloatParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                      <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;not isClassify or doImageAlignment&#39;</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Offset search range (pix)&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Probabilities will be calculated only for translations in a circle &#39;</span>
                           <span class="s1">&#39;with this radius (in pixels). The center of this circle changes at &#39;</span>
                           <span class="s1">&#39;every iteration and is placed at the optimal translation for each &#39;</span>
                           <span class="s1">&#39;image in the previous iteration.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;offsetSearchStepPix&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">FloatParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                      <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;not isClassify or doImageAlignment&#39;</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Offset search step (pix)&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Translations will be sampled with this step-size (in pixels). &#39;</span>
                           <span class="s1">&#39;Translational sampling is also done using the adaptive approach. &#39;</span>
                           <span class="s1">&#39;Therefore, if adaptive=1, the translations will first be evaluated&#39;</span>
                           <span class="s1">&#39;on a 2x coarser grid.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IS_CLASSIFY</span><span class="p">:</span>
            <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;localAngularSearch&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;doImageAlignment&#39;</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Perform local angular search?&#39;</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s1">&#39;If set to Yes, then rather than performing exhaustive angular searches, &#39;</span>
                               <span class="s1">&#39;local searches within the range given below will be performed. A prior &#39;</span>
                               <span class="s1">&#39;Gaussian distribution centered at the optimal orientation in the previous &#39;</span>
                               <span class="s1">&#39;iteration and with a stddev of 1/3 of the range given below will be enforced. &#39;</span>
                               <span class="s1">&#39;NOTE: activate this option will enable the gpu calculating in Compute tab.&#39;</span><span class="p">)</span>
            <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;localAngularSearchRange&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">FloatParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                          <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;localAngularSearch&#39;</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Local angular search range&#39;</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Local angular searches will be performed within +/- &#39;</span>
                               <span class="s1">&#39;the given amount (in degrees) from the optimal orientation &#39;</span>
                               <span class="s1">&#39;in the previous iteration. A Gaussian prior (also see &#39;</span>
                               <span class="s1">&#39;previous option) will be applied, so that orientations &#39;</span>
                               <span class="s1">&#39;closer to the optimal orientation in the previous iteration &#39;</span>
                               <span class="s1">&#39;will get higher weights than those further away.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;localSearchAutoSamplingDeg&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">EnumParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                          <span class="n">choices</span><span class="o">=</span><span class="n">ANGULAR_SAMPLING_LIST</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Local search from auto-sampling (deg)&#39;</span><span class="p">,</span>
                          <span class="n">help</span><span class="o">=</span><span class="s1">&#39;In the automated procedure to increase the angular samplings,</span><span class="se">\n</span><span class="s1">&#39;</span>
                               <span class="s1">&#39;local angular searches of -6/+6 times the sampling rate will</span><span class="se">\n</span><span class="s1">&#39;</span>
                               <span class="s1">&#39;be used from this angular sampling rate onwards.&#39;</span><span class="p">)</span>

        <span class="n">form</span><span class="o">.</span><span class="n">addSection</span><span class="p">(</span><span class="s1">&#39;Compute&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defineComputeParams</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

        <span class="n">form</span><span class="o">.</span><span class="n">addSection</span><span class="p">(</span><span class="s1">&#39;Additional&#39;</span><span class="p">)</span>
        <span class="n">joinHalves</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;--low_resol_join_halves 40 (only not continue mode)&quot;</span>
                      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">IS_CLASSIFY</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;keepOnlyLastIterFiles&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span>
                      <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">expertLevel</span><span class="o">=</span><span class="n">LEVEL_ADVANCED</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Keep only files from last iteration?&quot;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s2">&quot;If Yes is chosen, only the files which correspond to the last &quot;</span>
                           <span class="s2">&quot;iteration will be saved in the protocol&#39;s extra directory. Otherwise, &quot;</span>
                           <span class="s2">&quot;files corresponding to each iteration will be kept.&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;oversampling&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">IntParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">expertLevel</span><span class="o">=</span><span class="n">LEVEL_ADVANCED</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Over-sampling&quot;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Adaptive oversampling order to speed-up &quot;</span>
                           <span class="s2">&quot;calculations (0=no oversampling, 1=2x, 2=4x, etc)&quot;</span><span class="p">)</span>

        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;extraParams&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">StringParam</span><span class="p">,</span>
                      <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Additional arguments&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s2">&quot;In this box command-line arguments may be &quot;</span>
                           <span class="s2">&quot;provided that are not generated by the GUI. This &quot;</span>
                           <span class="s2">&quot;may be useful for testing developmental options &quot;</span>
                           <span class="s2">&quot;and/or expert use of the program, e.g: </span><span class="se">\n</span><span class="s2">&quot;</span>
                           <span class="s2">&quot;--verb 1</span><span class="se">\n</span><span class="s2">&quot;</span>
                           <span class="s2">&quot;--pad 2</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">joinHalves</span><span class="p">)</span>

        <span class="n">form</span><span class="o">.</span><span class="n">addParallelSection</span><span class="p">(</span><span class="n">threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mpi</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<div class="viewcode-block" id="ProtRelionBaseTomo.addSymmetry"><a class="viewcode-back" href="../../../api/reliontomo/reliontomo.protocols.protocol_base_tomo.html#reliontomo.protocols.protocol_base_tomo.ProtRelionBaseTomo.addSymmetry">[docs]</a>    <span class="k">def</span> <span class="nf">addSymmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="p">):</span>
        <span class="n">container</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;symmetryGroup&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">StringParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;c1&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Symmetry&quot;</span><span class="p">,</span>
                           <span class="n">help</span><span class="o">=</span><span class="s1">&#39;If the molecule is asymmetric, set Symmetry group to C1. Note their are multiple possibilities for icosahedral symmetry: </span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;* I1: No-Crowther 222 (standard in Heymann, Chagoyen &amp; Belnap, JSB, 151 (2005) 196-207)</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;* I2: Crowther 222                                                                     </span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;* I3: 52-setting (as used in SPIDER?)                                                  </span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;* I4: A different 52 setting                                                           </span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;The command *relion_refine --sym D2 --print_symmetry_ops* prints a list of all symmetry operators for symmetry group D2. RELION uses XMIPP</span><span class="se">\&#39;</span><span class="s1">s libraries for symmetry operations. Therefore, look at the XMIPP Wiki for more details:  http://xmipp.cnb.csic.es/twiki/bin/view/Xmipp/WebHome?topic=Symmetry&#39;</span><span class="p">)</span></div>

    <span class="o">@</span> <span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">_defineComputeParams</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;useParallelDisk&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Use parallel disc I/O?&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;If set to Yes, all MPI slaves will read &#39;</span>
                           <span class="s1">&#39;their own images from disc. Otherwise, only &#39;</span>
                           <span class="s1">&#39;the master will read images and send them &#39;</span>
                           <span class="s1">&#39;through the network to the slaves. Parallel &#39;</span>
                           <span class="s1">&#39;file systems like gluster of fhgfs are good &#39;</span>
                           <span class="s1">&#39;at parallel disc I/O. NFS may break with many &#39;</span>
                           <span class="s1">&#39;slaves reading in parallel.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;pooledSubtomos&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">IntParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Number of pooled particles:&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Particles are processed in individual batches &#39;</span>
                           <span class="s1">&#39;by MPI slaves. During each batch, a stack of &#39;</span>
                           <span class="s1">&#39;particle images is only opened and closed &#39;</span>
                           <span class="s1">&#39;once to improve disk access times. All &#39;</span>
                           <span class="s1">&#39;particle images of a single batch are read &#39;</span>
                           <span class="s1">&#39;into memory together. The size of these &#39;</span>
                           <span class="s1">&#39;batches is at least one particle per thread &#39;</span>
                           <span class="s1">&#39;used. The nr_pooled_particles parameter &#39;</span>
                           <span class="s1">&#39;controls how many particles are read together &#39;</span>
                           <span class="s1">&#39;for each thread. If it is set to 3 and one &#39;</span>
                           <span class="s1">&#39;uses 8 threads, batches of 3x8=24 particles &#39;</span>
                           <span class="s1">&#39;will be read together. This may improve &#39;</span>
                           <span class="s1">&#39;performance on systems where disk access, and &#39;</span>
                           <span class="s1">&#39;particularly metadata handling of disk &#39;</span>
                           <span class="s1">&#39;access, is a problem. It has a modest cost of &#39;</span>
                           <span class="s1">&#39;increased RAM usage.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;allParticlesRam&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Pre-read all particles into RAM?&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;If set to Yes, all particle images will be &#39;</span>
                           <span class="s1">&#39;read into computer memory, which will greatly &#39;</span>
                           <span class="s1">&#39;speed up calculations on systems with slow &#39;</span>
                           <span class="s1">&#39;disk access. However, one should of course be &#39;</span>
                           <span class="s1">&#39;careful with the amount of RAM available. &#39;</span>
                           <span class="s1">&#39;Because particles are read in &#39;</span>
                           <span class="s1">&#39;float-precision, it will take </span><span class="se">\n</span><span class="s1">&#39;</span>
                           <span class="s1">&#39;( N * (box_size)^2 * 4 / (1024 * 1024 &#39;</span>
                           <span class="s1">&#39;* 1024) ) Giga-bytes to read N particles into &#39;</span>
                           <span class="s1">&#39;RAM. For 100 thousand 200x200 images, that &#39;</span>
                           <span class="s1">&#39;becomes 15Gb, or 60 Gb for the same number of &#39;</span>
                           <span class="s1">&#39;400x400 particles. Remember that running a &#39;</span>
                           <span class="s1">&#39;single MPI slave on each node that runs as &#39;</span>
                           <span class="s1">&#39;many threads as available cores will have &#39;</span>
                           <span class="s1">&#39;access to all available RAM.</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                           <span class="s1">&#39;If parallel disc I/O is set to No, then only &#39;</span>
                           <span class="s1">&#39;the master reads all particles into RAM and &#39;</span>
                           <span class="s1">&#39;sends those particles through the network to &#39;</span>
                           <span class="s1">&#39;the MPI slaves during the refinement &#39;</span>
                           <span class="s1">&#39;iterations.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;combineItersDisc&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Combine iterations through disc?&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;If set to Yes, at the end of every iteration &#39;</span>
                           <span class="s1">&#39;all MPI slaves will write out a large file &#39;</span>
                           <span class="s1">&#39;with their accumulated results. The MPI &#39;</span>
                           <span class="s1">&#39;master will read in all these files, combine &#39;</span>
                           <span class="s1">&#39;them all, and write out a new file with the &#39;</span>
                           <span class="s1">&#39;combined results. All MPI slaves will then &#39;</span>
                           <span class="s1">&#39;read in the combined results. This reduces &#39;</span>
                           <span class="s1">&#39;heavy load on the network, but increases load &#39;</span>
                           <span class="s1">&#39;on the disc I/O. This will affect the time it &#39;</span>
                           <span class="s1">&#39;takes between the progress-bar in the &#39;</span>
                           <span class="s1">&#39;expectation step reaching its end (the mouse &#39;</span>
                           <span class="s1">&#39;gets to the cheese) and the start of the &#39;</span>
                           <span class="s1">&#39;ensuing maximisation step. It will depend on &#39;</span>
                           <span class="s1">&#39;your system setup which is most efficient.&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;doGpu&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">BooleanParam</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;doImageAlignment or not isClassify&#39;</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Use GPU acceleration?&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;If set to Yes, the job will try to use GPU &#39;</span>
                           <span class="s1">&#39;acceleration. This will be ignored if skipping alignment &#39;</span>
                           <span class="s1">&#39;(From relion_refine_mpi, classification case: &#39;</span>
                           <span class="s1">&#39;you cannot use accelerators when &#39;</span>
                           <span class="s1">&#39;skipping alignments).&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;gpusToUse&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">StringParam</span><span class="p">,</span>
                      <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;doGpu and (doImageAlignment or not isClassify)&#39;</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;GPUs to use:&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;It can be used to provide a list of which GPUs &#39;</span>
                           <span class="s1">&#39;(e. g. &quot;0:1:2:3&quot;) to use. MPI-processes are &#39;</span>
                           <span class="s1">&#39;separated by &quot;:&quot;, threads by &quot;,&quot;. &#39;</span>
                           <span class="s1">&#39;For example: &quot;0,0:1,1:0,0:1,1&quot;&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addParam</span><span class="p">(</span><span class="s1">&#39;scratchDir&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">PathParam</span><span class="p">,</span>
                      <span class="n">condition</span><span class="o">=</span><span class="s1">&#39;not allParticlesRam&#39;</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Copy particles to scratch directory (optional): &#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s1">&#39;If a directory is provided here, then the job &#39;</span>
                           <span class="s1">&#39;will create a sub-directory in it called &#39;</span>
                           <span class="s1">&#39;relion_volatile. If that relion_volatile &#39;</span>
                           <span class="s1">&#39;directory already exists, it will be wiped. &#39;</span>
                           <span class="s1">&#39;Then, the program will copy all input &#39;</span>
                           <span class="s1">&#39;particles into a large stack inside the &#39;</span>
                           <span class="s1">&#39;relion_volatile subdirectory. Provided this &#39;</span>
                           <span class="s1">&#39;directory is on a fast local drive (e.g. an &#39;</span>
                           <span class="s1">&#39;SSD drive), processing in all the iterations &#39;</span>
                           <span class="s1">&#39;will be faster. If the job finishes &#39;</span>
                           <span class="s1">&#39;correctly, the relion_volatile directory will &#39;</span>
                           <span class="s1">&#39;be wiped. If the job crashes, you may want to &#39;</span>
                           <span class="s1">&#39;remove it yourself.&#39;</span><span class="p">)</span>

    <span class="c1"># --------------------------- INSERT steps functions --------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_insertAllSteps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_insertFunctionStep</span><span class="p">(</span><span class="s1">&#39;convertInputStep&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_insertRelionStep</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_insertFunctionStep</span><span class="p">(</span><span class="s1">&#39;createOutputStep&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_insertRelionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Prepare the command line arguments before calling Relion. &quot;&quot;&quot;</span>

        <span class="c1"># Join in a single line all key, value pairs of the args dict</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doContinue</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setContinueArgs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setNormalArgs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extraParams</span><span class="o">.</span><span class="n">hasValue</span><span class="p">():</span>
            <span class="n">params</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">extraParams</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_insertFunctionStep</span><span class="p">(</span><span class="s1">&#39;runRelionStep&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="c1"># --------------------------- STEPS functions --------------------------------------------</span>
<div class="viewcode-block" id="ProtRelionBaseTomo.convertInputStep"><a class="viewcode-back" href="../../../api/reliontomo/reliontomo.protocols.protocol_base_tomo.html#reliontomo.protocols.protocol_base_tomo.ProtRelionBaseTomo.convertInputStep">[docs]</a>    <span class="k">def</span> <span class="nf">convertInputStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create the input file in STAR format as expected by Relion.&quot;&quot;&quot;</span>

        <span class="n">subtomoSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getInputParticles</span><span class="p">()</span>
        <span class="n">subtomosStar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getFileName</span><span class="p">(</span><span class="s1">&#39;input_star&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Converting set from &#39;</span><span class="si">%s</span><span class="s2">&#39; into &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subtomoSet</span><span class="o">.</span><span class="n">getFileName</span><span class="p">(),</span> <span class="n">subtomosStar</span><span class="p">))</span>
        <span class="n">writeSetOfSubtomograms</span><span class="p">(</span><span class="n">subtomoSet</span><span class="p">,</span> <span class="n">subtomosStar</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProtRelionBaseTomo.runRelionStep"><a class="viewcode-back" href="../../../api/reliontomo/reliontomo.protocols.protocol_base_tomo.html#reliontomo.protocols.protocol_base_tomo.ProtRelionBaseTomo.runRelionStep">[docs]</a>    <span class="k">def</span> <span class="nf">runRelionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Execute the relion steps with the give params. &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">+=</span> <span class="s1">&#39; --j </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfThreads</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runJob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getProgram</span><span class="p">(),</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProtRelionBaseTomo.createOutputStep"><a class="viewcode-back" href="../../../api/reliontomo/reliontomo.protocols.protocol_base_tomo.html#reliontomo.protocols.protocol_base_tomo.ProtRelionBaseTomo.createOutputStep">[docs]</a>    <span class="k">def</span> <span class="nf">createOutputStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>  <span class="c1"># should be implemented in subclasses</span></div>

    <span class="c1"># --------------------------- INFO functions --------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Plugin</span><span class="o">.</span><span class="n">IS_30</span><span class="p">():</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V30_VALIDATION_MSG</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doContinue</span><span class="p">:</span>
            <span class="n">continueProtocol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">continueRun</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">continueProtocol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="n">continueProtocol</span><span class="o">.</span><span class="n">getObjId</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">getObjId</span><span class="p">()):</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;In Scipion you must create a new Relion run&#39;</span><span class="p">)</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;and select the continue option rather than&#39;</span><span class="p">)</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;select continue from the same run.&#39;</span><span class="p">)</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># add a new line</span>
            <span class="n">errors</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validateContinue</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getInputParticles</span><span class="p">()</span><span class="o">.</span><span class="n">isOddX</span><span class="p">():</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Relion only works with even values for the image dimensions!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfPhaseFlipped</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfMultiplied</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;CTF options</span><span class="se">\n</span><span class="s2">&quot;</span>
                          <span class="s2">&quot;*Has the data been pre-multiplied by the CTF?* </span><span class="se">\n</span><span class="s2">&quot;</span>
                          <span class="s2">&quot;and </span><span class="se">\n</span><span class="s2">&quot;</span>
                          <span class="s2">&quot;*Has the data been CTF phase-flipped?* </span><span class="se">\n</span><span class="s2">&quot;</span>
                          <span class="s2">&quot;are *exclusive*. Only one of them can be enabled at the same time.&quot;</span><span class="p">)</span>

            <span class="n">errors</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validateNormal</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">errors</span>

    <span class="k">def</span> <span class="nf">_validateNormal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Should be overriden in subclasses to</span>
<span class="sd">        return summary message for NORMAL EXECUTION.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_validateContinue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Should be overriden in subclasses to</span>
<span class="sd">        return summary messages for CONTINUE EXECUTION.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_citations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cites</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">cites</span>

    <span class="k">def</span> <span class="nf">_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>
        <span class="nb">iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastIter</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">iter</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">iterMsg</span> <span class="o">=</span> <span class="s1">&#39;Calculating iteration </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">iter</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasAttribute</span><span class="p">(</span><span class="s1">&#39;numberOfIterations&#39;</span><span class="p">):</span>
                <span class="n">iterMsg</span> <span class="o">+=</span> <span class="s1">&#39;/</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getnumberOfIters</span><span class="p">()</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span><span class="n">iterMsg</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Initializing...&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doContinue</span><span class="p">:</span>
            <span class="n">summary</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summaryContinue</span><span class="p">()</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summaryNormal</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">summary</span>

    <span class="k">def</span> <span class="nf">_summaryNormal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Should be overriden in subclasses to</span>
<span class="sd">        return summary message for NORMAL EXECUTION.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_summaryContinue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Should be overriden in subclasses to</span>
<span class="sd">        return summary messages for CONTINUE EXECUTION.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Should be overriden in each protocol.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># --------------------------- UTILS functions --------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_getProgram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program</span><span class="o">=</span><span class="s1">&#39;relion_refine&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the program name depending on the MPI use or not. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfMpi</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">program</span> <span class="o">+=</span> <span class="s1">&#39;_mpi&#39;</span>
        <span class="k">return</span> <span class="n">program</span>

    <span class="k">def</span> <span class="nf">_getInputParticles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doContinue</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputSubtomograms</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">continueRun</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">inputSubtomograms</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputSubtomograms</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_getIterNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the list of iteration files, give the iterTemplate. &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iterTemplate</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterRegex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># group 1 is 3 digits iteration number</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_lastIter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getIterNumber</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_firstIter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getIterNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_getIterClasses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a classes .sqlite file for this iteration.</span>
<span class="sd">        If the file doesn&#39;t exists, it will be created by</span>
<span class="sd">        converting from this iteration data.star file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getFileName</span><span class="p">(</span><span class="s1">&#39;classes_scipion&#39;</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="n">it</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">clean</span><span class="p">:</span>
            <span class="n">cleanPath</span><span class="p">(</span><span class="n">data_classes</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">data_classes</span><span class="p">):</span>
            <span class="n">clsSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT_TYPE</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">data_classes</span><span class="p">)</span>
            <span class="n">clsSet</span><span class="o">.</span><span class="n">setImages</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputParticles</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fillClassesFromIter</span><span class="p">(</span><span class="n">clsSet</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span>
            <span class="n">clsSet</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
            <span class="n">clsSet</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">data_classes</span>

    <span class="k">def</span> <span class="nf">_getContinueIter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">continueRun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">continueRun</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">continueRun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">continueRun</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doContinue</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">continueIter</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;last&#39;</span><span class="p">:</span>
                <span class="n">continueIter</span> <span class="o">=</span> <span class="n">continueRun</span><span class="o">.</span><span class="n">_lastIter</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">continueIter</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">continueIter</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">continueIter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">continueIter</span>

    <span class="k">def</span> <span class="nf">_getnumberOfIters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getContinueIter</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfIterations</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_setNormalArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="c1"># Params only appear in the command line if their value is different than the default</span>
        <span class="n">maskDiameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskDiameterA</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">maskDiameter</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getInputParticles</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">()</span>
            <span class="n">maskDiameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getInputParticles</span><span class="p">()</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">()</span> <span class="o">*</span> <span class="n">x</span>

        <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;--i&#39;</span><span class="p">:</span> <span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getFileName</span><span class="p">(</span><span class="s1">&#39;input_star&#39;</span><span class="p">)),</span>
                     <span class="s1">&#39;--particle_diameter&#39;</span><span class="p">:</span> <span class="n">maskDiameter</span><span class="p">,</span>
                     <span class="s1">&#39;--angpix&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getInputParticles</span><span class="p">()</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">(),</span>
                     <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setMaskArgs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setCTFArgs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskZero</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="n">MASK_FILL_ZERO</span><span class="p">:</span>
            <span class="c1"># --zero_mask (false) : Mask surrounding background in particles to zero</span>
            <span class="c1"># (by default the solvent area is filled with random noise)</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--zero_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IS_CLASSIFY</span><span class="p">:</span>
            <span class="c1"># --K (1) : Number of references to be refined</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--K&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfClasses</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limitResolEStep</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># --strict_highres_exp (-1) : Resolution limit (in Angstrom) to</span>
                <span class="c1"># restrict probability calculations in the expectation step</span>
                <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--strict_highres_exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limitResolEStep</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">refVol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">referenceVolume</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">refVol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--ref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">convertBinaryVol</span><span class="p">(</span><span class="n">refVol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTmpPath</span><span class="p">()))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isMapAbsoluteGreyScale</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="c1"># --firstiter_cc (false) : Perform CC-calculation in the first iteration (use</span>
            <span class="c1"># this if references are not on the absolute intensity scale)</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--firstiter_cc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># --ini_high (-1) : Resolution (in Angstroms) to which to limit refinement in</span>
        <span class="c1"># the first iteration</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--ini_high&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialLowPassFilterA</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="c1"># Symmetry group</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--sym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetryGroup</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="c1"># args[&#39;--memory_per_thread&#39;] = self.memoryPreThreads.get()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setBasicArgs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setComputeArgs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setContinueArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">continueRun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">continueRun</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">continueRun</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IS_CLASSIFY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copyAttributes</span><span class="p">(</span><span class="n">continueRun</span><span class="p">,</span> <span class="s1">&#39;regularisationParamT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setBasicArgs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--continue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">continueRun</span><span class="o">.</span><span class="n">_getFileName</span><span class="p">(</span><span class="s1">&#39;optimiser&#39;</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_getContinueIter</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_setComputeArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="c1"># Params only appear in the command line if their value is different than the default</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useParallelDisk</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="c1"># --no_parallel_disc_io (false) : Do NOT let parallel (MPI) processes access the</span>
            <span class="c1"># disc simultaneously (use this option with NFS)</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--no_parallel_disc_io&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># --pool (1) : Number of images to pool for each thread task</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--pool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pooledSubtomos</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allParticlesRam</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="c1"># --preread_images (false) : Use this to let the master process read all particles</span>
            <span class="c1"># into memory. Be careful you have enough RAM for large data sets!</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--preread_images&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">scracthDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scratchDir</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">scracthDir</span><span class="p">:</span>
            <span class="c1"># --scratch_dir () : If provided, particle stacks will be copied to this local</span>
            <span class="c1"># scratch disk prior to refinement.</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--scratch_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">combineItersDisc</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="c1"># --dont_combine_weights_via_disc (false) : Send the large arrays of summed</span>
            <span class="c1"># weights through the MPI network, instead of writing large files to disc</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--dont_combine_weights_via_disc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doGpu</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IS_CLASSIFY</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">doImageAlignment</span><span class="o">.</span><span class="n">get</span><span class="p">())</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">IS_CLASSIFY</span><span class="p">:</span>
                <span class="c1"># Captured from relion_refine_mpi:</span>
                <span class="c1"># ERROR: you cannot use accelerators when skipping alignments</span>
                <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--gpu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpusToUse</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_setBasicArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a dictionary with basic arguments. &quot;&quot;&quot;</span>
        <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;--flatten_solvent&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;--norm&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;--scale&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;--o&#39;</span><span class="p">:</span> <span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getExtraPath</span><span class="p">(</span><span class="s1">&#39;relion&#39;</span><span class="p">)),</span>
                     <span class="s1">&#39;--oversampling&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">oversampling</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                     <span class="p">})</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IS_CLASSIFY</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--tau2_fudge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularisationParamT</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--iter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getnumberOfIters</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setSamplingArgs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setCTFArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="c1"># Params only appear in the command line if their value is different than the default</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doCTF</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="c1"># --ctf (false) : Perform CTF correction?</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--ctf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasReferenceCTFCorrected</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="c1"># --ctf_corrected_ref (false) : Have the input references been CTF-amplitude corrected?</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--ctf_corrected_ref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignoreCTFUntilFirstPeak</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="c1"># --ctf_intact_first_peak (false) : Ignore CTFs until their first peak?</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--ctf_intact_first_peak&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfMultiplied</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="c1"># --ctf_multiplied (false) : Have the data been premultiplied with their CTF?</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--ctf_multiplied&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfPhaseFlipped</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="c1"># --ctf_phase_flipped (false) : Have the data been CTF phase-flipped?</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--ctf_multiplied&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfFlipPhases</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="c1"># --only_flip_phases (false) : Only perform CTF phase-flipping?</span>
            <span class="c1"># (default is full amplitude-correction)</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--only_flip_phases&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_setMaskArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">referenceMask</span><span class="o">.</span><span class="n">hasValue</span><span class="p">():</span>
            <span class="n">args</span><span class="p">[</span>
                <span class="s1">&#39;--solvent_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">referenceMask</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">getFileName</span><span class="p">())</span>  <span class="c1"># FIXE: CHANGE BY LOCATION, convert if necessary</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solventMask</span><span class="o">.</span><span class="n">hasValue</span><span class="p">():</span>
            <span class="n">args</span><span class="p">[</span>
                <span class="s1">&#39;--solvent_mask2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solventMask</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">getFileName</span><span class="p">())</span>  <span class="c1"># FIXME: CHANGE BY LOCATION, convert if necessary</span>

    <span class="k">def</span> <span class="nf">_cleanUndesiredFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove all files generated by relion_refine excepting the ones which</span>
<span class="sd">        correspond to the last iteration.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_getRlnCurrentResolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">starFile</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">starFile</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modelTable</span><span class="o">.</span><span class="n">readStar</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="s1">&#39;model_general&#39;</span><span class="p">)</span>
            <span class="c1"># Model table has only one row, while classes table has the same number of rows as classes found</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelTable</span><span class="o">.</span><span class="n">_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rlnCurrentResolution</span><span class="p">)</span>

    <span class="o">@</span> <span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">_getCTFFileFromSubtomo</span><span class="p">(</span><span class="n">subtomo</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">subtomo</span><span class="o">.</span><span class="n">getCoordinate3D</span><span class="p">()</span><span class="o">.</span><span class="n">_3dcftMrcFile</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: dependabot/pip/jinja2-2.11.3
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="protocol_base_tomo.html">dependabot/pip/jinja2-2.11.3</a></dd>
            <dd><a href="../../../../dependabot_pip_pygments-2.7.4/index.html">dependabot/pip/pygments-2.7.4</a></dd>
            <dd><a href="../../../../dependabot_pip_urllib3-1.26.5/index.html">dependabot/pip/urllib3-1.26.5</a></dd>
            <dd><a href="../../../../gh-pages/index.html">gh-pages</a></dd>
            <dd><a href="../../../../release-2.0.0/index.html">release-2.0.0</a></dd>
            <dd><a href="../../../../release-3.0.0/index.html">release-3.0.0</a></dd>
            <dd><a href="../../../../rsanchezgarc-patch-1/index.html">rsanchezgarc-patch-1</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>