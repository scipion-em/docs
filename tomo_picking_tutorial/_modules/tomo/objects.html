

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>tomo.objects &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/scipion-modes/how-to-install.html">Installing Scipion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/user-documentation.html#processing-how-to-s">Processing How Toâ€™s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/facilities/facilities.html">On-the-fly processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/facilities/customize-report.html">Summary Reports</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/api/scipion-API.html">Scipion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/api/plugins-API.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/api/xmipp-API.html">Xmipp API</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/misc/contact-us.html">Contact Us</a></li>
</ul>
<p class="caption"><span class="caption-text">Licences</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/license.html">Licenses</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../tomo.html">tomo</a> &raquo;</li>
        
      <li>tomo.objects</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tomo.objects</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#  **************************************************************************</span>
<span class="c1"># *</span>
<span class="c1"># * Authors:     J.M. De la Rosa Trevin (delarosatrevin@scilifelab.se) [1]</span>
<span class="c1"># *</span>
<span class="c1"># * [1] SciLifeLab, Stockholm University</span>
<span class="c1"># *</span>
<span class="c1"># * This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># * it under the terms of the GNU General Public License as published by</span>
<span class="c1"># * the Free Software Foundation; either version 2 of the License, or</span>
<span class="c1"># * (at your option) any later version.</span>
<span class="c1"># *</span>
<span class="c1"># * This program is distributed in the hope that it will be useful,</span>
<span class="c1"># * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># * GNU General Public License for more details.</span>
<span class="c1"># *</span>
<span class="c1"># * You should have received a copy of the GNU General Public License</span>
<span class="c1"># * along with this program; if not, write to the Free Software</span>
<span class="c1"># * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA</span>
<span class="c1"># * 02111-1307  USA</span>
<span class="c1"># *</span>
<span class="c1"># *  All comments concerning this program package may be sent to the</span>
<span class="c1"># *  e-mail address &#39;scipion@cnb.csic.es&#39;</span>
<span class="c1"># *</span>
<span class="c1"># **************************************************************************</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">statistics</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="kn">from</span> <span class="nn">pyworkflow.object</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Pointer</span><span class="p">,</span> <span class="n">Boolean</span><span class="p">,</span> <span class="n">CsvList</span>
<span class="kn">from</span> <span class="nn">pwem.objects</span> <span class="kn">import</span> <span class="n">Transform</span>
<span class="kn">import</span> <span class="nn">pyworkflow.utils.path</span> <span class="k">as</span> <span class="nn">path</span>
<span class="kn">import</span> <span class="nn">pwem.objects.data</span> <span class="k">as</span> <span class="nn">data</span>
<span class="kn">from</span> <span class="nn">pwem.convert.transformations</span> <span class="kn">import</span> <span class="n">euler_matrix</span>
<span class="kn">from</span> <span class="nn">pwem.emlib.image</span> <span class="kn">import</span> <span class="n">ImageHandler</span>

<span class="kn">import</span> <span class="nn">tomo.constants</span> <span class="k">as</span> <span class="nn">const</span>


<div class="viewcode-block" id="TiltImageBase"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase">[docs]</a><span class="k">class</span> <span class="nc">TiltImageBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Base class for TiltImageM and TiltImage. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tiltAngle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">acquisitionOrder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tiltAngle</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">tiltAngle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">tsId</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acqOrder</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">acquisitionOrder</span><span class="p">)</span>

<div class="viewcode-block" id="TiltImageBase.getTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase.getTsId">[docs]</a>    <span class="k">def</span> <span class="nf">getTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get unique TiltSerie ID, usually retrieved from the</span>
<span class="sd">        file pattern provided by the user at the import time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TiltImageBase.setTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase.setTsId">[docs]</a>    <span class="k">def</span> <span class="nf">setTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TiltImageBase.getTiltAngle"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase.getTiltAngle">[docs]</a>    <span class="k">def</span> <span class="nf">getTiltAngle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tiltAngle</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TiltImageBase.setTiltAngle"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase.setTiltAngle">[docs]</a>    <span class="k">def</span> <span class="nf">setTiltAngle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tiltAngle</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TiltImageBase.getAcquisitionOrder"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase.getAcquisitionOrder">[docs]</a>    <span class="k">def</span> <span class="nf">getAcquisitionOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acqOrder</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TiltImageBase.setAcquisitionOrder"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase.setAcquisitionOrder">[docs]</a>    <span class="k">def</span> <span class="nf">setAcquisitionOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acqOrder</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TiltImageBase.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageBase.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copyTM</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyAttributes</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;_tiltAngle&#39;</span><span class="p">,</span> <span class="s1">&#39;_tsId&#39;</span><span class="p">,</span> <span class="s1">&#39;_acqOrder&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">copyId</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copyObjId</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">copyTM</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">hasTransform</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copyAttributes</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;_transform&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TiltImage"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImage">[docs]</a><span class="k">class</span> <span class="nc">TiltImage</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">TiltImageBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Tilt image &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">TiltImageBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="TiltImage.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImage.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copyTM</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="n">TiltImageBase</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="n">copyId</span><span class="p">,</span> <span class="n">copyTM</span><span class="o">=</span><span class="n">copyTM</span><span class="p">)</span></div>

<div class="viewcode-block" id="TiltImage.parseFileName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImage.parseFileName">[docs]</a>    <span class="k">def</span> <span class="nf">parseFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method returns the filename of the Tilt-Image adding a specified suffix and changing its extension.</span>
<span class="sd">        :param suffix: String to be added at the end of the location path (before extension).</span>
<span class="sd">        :param extension: String containing the new extension of the filename.</span>
<span class="sd">        :return: String containing the parsed filename with the specified suffix and extension.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">())</span>
        <span class="n">fileName</span><span class="p">,</span> <span class="n">fileExtension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">extension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fileExtension</span> <span class="o">=</span> <span class="n">extension</span>

        <span class="k">return</span> <span class="n">fileName</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="n">fileExtension</span></div></div>


<div class="viewcode-block" id="TiltSeriesBase"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase">[docs]</a><span class="k">class</span> <span class="nc">TiltSeriesBase</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">SetOfImages</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">SetOfImages</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tsId&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="c1"># TiltSeries will always be used inside a SetOfTiltSeries</span>
        <span class="c1"># so, let&#39;s do no store the mapper path by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mapperPath</span><span class="o">.</span><span class="n">setStore</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="n">TomoAcquisition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span> <span class="o">=</span> <span class="n">Transform</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anglesCount</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>

<div class="viewcode-block" id="TiltSeriesBase.getAnglesCount"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.getAnglesCount">[docs]</a>    <span class="k">def</span> <span class="nf">getAnglesCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anglesCount</span></div>

<div class="viewcode-block" id="TiltSeriesBase.setAnglesCount"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.setAnglesCount">[docs]</a>    <span class="k">def</span> <span class="nf">setAnglesCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anglesCount</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="TiltSeriesBase.getTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.getTsId">[docs]</a>    <span class="k">def</span> <span class="nf">getTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get unique TiltSerie ID, usually retrieved from the</span>
<span class="sd">        file pattern provided by the user at the import time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TiltSeriesBase.setTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.setTsId">[docs]</a>    <span class="k">def</span> <span class="nf">setTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TiltSeriesBase.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information (id and other properties) but</span>
<span class="sd">        not _mapperPath or _size from other set of tomograms to current one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="n">copyId</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_mapperPath&#39;</span><span class="p">,</span> <span class="s1">&#39;_size&#39;</span><span class="p">])</span></div>
        <span class="c1"># self.copyAttributes(other, [&#39;_tsId&#39;, &#39;_anglesCount&#39;])</span>

<div class="viewcode-block" id="TiltSeriesBase.append"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tiltImage</span><span class="p">):</span>
        <span class="n">tiltImage</span><span class="o">.</span><span class="n">setTsId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTsId</span><span class="p">())</span>
        <span class="n">data</span><span class="o">.</span><span class="n">SetOfImages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tiltImage</span><span class="p">)</span></div>

<div class="viewcode-block" id="TiltSeriesBase.clone"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_mapperPath&#39;</span><span class="p">,</span> <span class="s1">&#39;_size&#39;</span><span class="p">)):</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getClass</span><span class="p">()()</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="n">ignoreAttrs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clone</span></div>

<div class="viewcode-block" id="TiltSeriesBase.close"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Do nothing on close, since the db will be closed by SetOfTiltSeries</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="TiltSeriesBase.getScannedPixelSize"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.getScannedPixelSize">[docs]</a>    <span class="k">def</span> <span class="nf">getScannedPixelSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getMagnification</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="n">mag</span></div>

<div class="viewcode-block" id="TiltSeriesBase.generateTltFile"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.generateTltFile">[docs]</a>    <span class="k">def</span> <span class="nf">generateTltFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tltFilePath</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Generates an angle file in .tlt format in the specified location. If reverse is set to true the angles in</span>
<span class="sd">        file are sorted in the opposite order.</span>
<span class="sd">        :param tltFilePath: String containing the path where the file is created.</span>
<span class="sd">        :param reverse: Boolean indicating if the angle list must be reversed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">angleList</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ti</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">orderBy</span><span class="o">=</span><span class="s2">&quot;_tiltAngle&quot;</span><span class="p">):</span>
            <span class="n">angleList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">getTiltAngle</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="n">angleList</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tltFilePath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">angle</span> <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angleList</span><span class="p">)</span></div>

<div class="viewcode-block" id="TiltSeriesBase.hasOrigin"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.hasOrigin">[docs]</a>    <span class="k">def</span> <span class="nf">hasOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method indicating if the TiltSeries object has a defined origin. &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TiltSeriesBase.setOrigin"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.setOrigin">[docs]</a>    <span class="k">def</span> <span class="nf">setOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newOrigin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to set the origin of the TiltSeries object.</span>
<span class="sd">        :param newOrigin: Scipion Transform object indicating the origin to be set to the TiltSeries.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span> <span class="o">=</span> <span class="n">newOrigin</span></div>

<div class="viewcode-block" id="TiltSeriesBase.getOrigin"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.getOrigin">[docs]</a>    <span class="k">def</span> <span class="nf">getOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to get the origin associated to the TiltSeries. If there is no origin associated to the the object</span>
<span class="sd">        it may create a default one.</span>
<span class="sd">        :param force: Boolean indicating if the method must return a default origin in case the object has no one</span>
<span class="sd">        associated.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasOrigin</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getDefaultOrigin</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_getDefaultOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sampling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Transform</span><span class="p">()</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDim</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">/=</span> <span class="o">-</span><span class="mf">2.</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">setShifts</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="o">-</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">sampling</span><span class="p">,</span> <span class="n">y</span> <span class="o">/</span> <span class="o">-</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">sampling</span><span class="p">,</span> <span class="n">z</span> <span class="o">*</span> <span class="n">sampling</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span>  <span class="c1"># The identity matrix</span>

<div class="viewcode-block" id="TiltSeriesBase.getShiftsFromOrigin"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.getShiftsFromOrigin">[docs]</a>    <span class="k">def</span> <span class="nf">getShiftsFromOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to return the origin shift from the Scipion Transform object. &quot;&quot;&quot;</span>

        <span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOrigin</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">getShifts</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span></div>
        <span class="c1"># x, y, z are floats in Angstroms</span>

<div class="viewcode-block" id="TiltSeriesBase.updateOriginWithResize"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesBase.updateOriginWithResize">[docs]</a>    <span class="k">def</span> <span class="nf">updateOriginWithResize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">resizeFactor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method to update the origin after resizing the TiltSeries. &quot;&quot;&quot;</span>

        <span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOrigin</span><span class="p">()</span>

        <span class="n">xOri</span><span class="p">,</span> <span class="n">yOri</span><span class="p">,</span> <span class="n">zOri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getShiftsFromOrigin</span><span class="p">()</span>

        <span class="n">origin</span><span class="o">.</span><span class="n">setShifts</span><span class="p">(</span><span class="n">xOri</span> <span class="o">*</span> <span class="n">resizeFactor</span><span class="p">,</span>
                         <span class="n">yOri</span> <span class="o">*</span> <span class="n">resizeFactor</span><span class="p">,</span>
                         <span class="n">zOri</span> <span class="o">*</span> <span class="n">resizeFactor</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setOrigin</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span></div></div>
        <span class="c1"># x, y, z are floats in Angstroms</span>


<div class="viewcode-block" id="TiltSeries"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeries">[docs]</a><span class="k">class</span> <span class="nc">TiltSeries</span><span class="p">(</span><span class="n">TiltSeriesBase</span><span class="p">):</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">TiltImage</span>

<div class="viewcode-block" id="TiltSeries.applyTransform"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeries.applyTransform">[docs]</a>    <span class="k">def</span> <span class="nf">applyTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputFilePath</span><span class="p">):</span>
        <span class="n">ih</span> <span class="o">=</span> <span class="n">ImageHandler</span><span class="p">()</span>
        <span class="n">inputFilePath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">()</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span>
        <span class="n">newStack</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># TODO: Handle output tilt-series datatype format</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">()</span><span class="o">.</span><span class="n">hasTransform</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ti</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ti</span><span class="o">.</span><span class="n">hasTransform</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">newStack</span><span class="p">:</span>
                        <span class="n">ih</span><span class="o">.</span><span class="n">createEmptyImage</span><span class="p">(</span><span class="n">fnOut</span><span class="o">=</span><span class="n">outputFilePath</span><span class="p">,</span>
                                            <span class="n">xDim</span><span class="o">=</span><span class="n">ti</span><span class="o">.</span><span class="n">getXDim</span><span class="p">(),</span>
                                            <span class="n">yDim</span><span class="o">=</span><span class="n">ti</span><span class="o">.</span><span class="n">getYDim</span><span class="p">(),</span>
                                            <span class="n">nDim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getSize</span><span class="p">())</span>
                        <span class="n">newStack</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">transform</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">getTransform</span><span class="p">()</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()</span>
                    <span class="n">transformArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
                    <span class="n">ih</span><span class="o">.</span><span class="n">applyTransform</span><span class="p">(</span><span class="n">inputFile</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:mrcs@&#39;</span> <span class="o">+</span> <span class="n">inputFilePath</span><span class="p">,</span>
                                      <span class="n">outputFile</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;@&#39;</span> <span class="o">+</span> <span class="n">outputFilePath</span><span class="p">,</span>
                                      <span class="n">transformMatrix</span><span class="o">=</span><span class="n">transformArray</span><span class="p">,</span>
                                      <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">getYDim</span><span class="p">(),</span> <span class="n">ti</span><span class="o">.</span><span class="n">getXDim</span><span class="p">()))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;ERROR: Some tilt-image is missing from transform object associated.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">createLink</span><span class="p">(</span><span class="n">inputFilePath</span><span class="p">,</span> <span class="n">outputFilePath</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_dimStr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the string representing the dimensions. &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> x </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="SetOfTiltSeriesBase"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase">[docs]</a><span class="k">class</span> <span class="nc">SetOfTiltSeriesBase</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">SetOfImages</span><span class="p">):</span>
    <span class="n">EXPOSE_ITEMS</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">USE_CREATE_COPY_FOR_SUBSET</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="sd">&quot;&quot;&quot; Base class for SetOfTiltImages and SetOfTiltImagesM.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">SetOfImages</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anglesCount</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="n">TomoAcquisition</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfTiltSeriesBase.getAnglesCount"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.getAnglesCount">[docs]</a>    <span class="k">def</span> <span class="nf">getAnglesCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anglesCount</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesBase.setAnglesCount"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.setAnglesCount">[docs]</a>    <span class="k">def</span> <span class="nf">setAnglesCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anglesCount</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesBase.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy information (sampling rate and ctf)</span>
<span class="sd">        from other set of images to current one&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyAttributes</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;_anglesCount&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesBase.iterClassItems"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.iterClassItems">[docs]</a>    <span class="k">def</span> <span class="nf">iterClassItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterDisabled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over the images of a class.</span>
<span class="sd">        Params:</span>
<span class="sd">            iterDisabled: If True, also include the disabled items. &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterItems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">iterDisabled</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="bp">cls</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">iterDisabled</span> <span class="ow">or</span> <span class="n">img</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                        <span class="k">yield</span> <span class="n">img</span></div>

    <span class="k">def</span> <span class="nf">_setItemMapperPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the mapper path of this class according to the mapper</span>
<span class="sd">        path of the SetOfClasses and also the prefix according to class id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span><span class="o">.</span><span class="n">_mapperPath</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">(),</span> <span class="n">item</span><span class="o">.</span><span class="n">getTsId</span><span class="p">()))</span>
        <span class="n">item</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_insertItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create the SetOfImages assigned to a class.</span>
<span class="sd">        If the file exists, it will load the Set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="n">_insertItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">properties</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Set.write(self)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Setup the mapper classes before returning the item. &quot;&quot;&quot;</span>
        <span class="n">classItem</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">SetOfImages</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">classItem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">classItem</span>

<div class="viewcode-block" id="SetOfTiltSeriesBase.getFirstItem"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.getFirstItem">[docs]</a>    <span class="k">def</span> <span class="nf">getFirstItem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">classItem</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">classItem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">classItem</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesBase.iterItems"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.iterItems">[docs]</a>    <span class="k">def</span> <span class="nf">iterItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">item</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesBase.copyItems"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.copyItems">[docs]</a>    <span class="k">def</span> <span class="nf">copyItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputTs</span><span class="p">,</span>
                  <span class="n">orderByTs</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">updateTsCallback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">orderByTi</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">updateTiCallback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy items (TiltSeries and TiltImages) from the input Set.</span>
<span class="sd">         Params:</span>
<span class="sd">            inputTs: input TiltSeries (or movies) from where to copy elements.</span>
<span class="sd">            orderByTs: optional orderBy value for iterating over TiltSeries</span>
<span class="sd">            updateTsCallback: optional callback after TiltSeries is created</span>
<span class="sd">            orderByTi: optional orderBy value for iterating over TiltImages</span>
<span class="sd">            updateTiCallback: optional callback after TiltImage is created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inputTs</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">orderBy</span><span class="o">=</span><span class="n">orderByTs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">ts</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                <span class="n">tsOut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ITEM_TYPE</span><span class="p">()</span>
                <span class="n">tsOut</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
                <span class="n">tsOut</span><span class="o">.</span><span class="n">copyObjId</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">updateTsCallback</span><span class="p">:</span>
                    <span class="n">updateTsCallback</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">tsOut</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tsOut</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ti</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">orderBy</span><span class="o">=</span><span class="n">orderByTi</span><span class="p">)):</span>
                    <span class="n">tiOut</span> <span class="o">=</span> <span class="n">tsOut</span><span class="o">.</span><span class="n">ITEM_TYPE</span><span class="p">()</span>
                    <span class="n">tiOut</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
                    <span class="n">tiOut</span><span class="o">.</span><span class="n">copyObjId</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
                    <span class="n">tiOut</span><span class="o">.</span><span class="n">setLocation</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">getLocation</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">updateTiCallback</span><span class="p">:</span>
                        <span class="n">updateTiCallback</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">ti</span><span class="p">,</span> <span class="n">tsOut</span><span class="p">,</span> <span class="n">tiOut</span><span class="p">)</span>
                    <span class="n">tsOut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tiOut</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tsOut</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesBase.updateDim"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.updateDim">[docs]</a>    <span class="k">def</span> <span class="nf">updateDim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update dimensions of this set base on the first element. &quot;&quot;&quot;</span>
        <span class="n">firstItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDim</span><span class="p">(</span><span class="n">firstItem</span><span class="o">.</span><span class="n">getDim</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anglesCount</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">firstItem</span><span class="o">.</span><span class="n">getSize</span><span class="p">())</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesBase.getScannedPixelSize"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesBase.getScannedPixelSize">[docs]</a>    <span class="k">def</span> <span class="nf">getScannedPixelSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getMagnification</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="n">mag</span></div></div>


<div class="viewcode-block" id="SetOfTiltSeries"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeries">[docs]</a><span class="k">class</span> <span class="nc">SetOfTiltSeries</span><span class="p">(</span><span class="n">SetOfTiltSeriesBase</span><span class="p">):</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">TiltSeries</span>

    <span class="k">def</span> <span class="nf">_dimStr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the string representing the dimensions. &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> x </span><span class="si">%s</span><span class="s1"> x </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_anglesCount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="TiltImageM"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageM">[docs]</a><span class="k">class</span> <span class="nc">TiltImageM</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Movie</span><span class="p">,</span> <span class="n">TiltImageBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Tilt movie. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Movie</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">TiltImageBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="TiltImageM.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltImageM.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copyTM</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Movie</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="n">TiltImageBase</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="n">copyId</span><span class="p">,</span> <span class="n">copyTM</span><span class="o">=</span><span class="n">copyTM</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TiltSeriesM"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesM">[docs]</a><span class="k">class</span> <span class="nc">TiltSeriesM</span><span class="p">(</span><span class="n">TiltSeriesBase</span><span class="p">):</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">TiltImageM</span></div>


<div class="viewcode-block" id="SetOfTiltSeriesM"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM">[docs]</a><span class="k">class</span> <span class="nc">SetOfTiltSeriesM</span><span class="p">(</span><span class="n">SetOfTiltSeriesBase</span><span class="p">):</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">TiltSeriesM</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">SetOfTiltSeriesBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gainFile</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_darkFile</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="c1"># Store the frames range to avoid loading the items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_firstFramesRange</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">FramesRange</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfTiltSeriesM.setGain"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM.setGain">[docs]</a>    <span class="k">def</span> <span class="nf">setGain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gain</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gainFile</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">gain</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesM.getGain"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM.getGain">[docs]</a>    <span class="k">def</span> <span class="nf">getGain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gainFile</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesM.setDark"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM.setDark">[docs]</a>    <span class="k">def</span> <span class="nf">setDark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dark</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_darkFile</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">dark</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesM.getDark"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM.getDark">[docs]</a>    <span class="k">def</span> <span class="nf">getDark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_darkFile</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesM.getFramesRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM.getFramesRange">[docs]</a>    <span class="k">def</span> <span class="nf">getFramesRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstFramesRange</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesM.setFramesRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM.setFramesRange">[docs]</a>    <span class="k">def</span> <span class="nf">setFramesRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_firstFramesRange</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfTiltSeriesM.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTiltSeriesM.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy SoM specific information plus inherited &quot;&quot;&quot;</span>
        <span class="n">SetOfTiltSeriesBase</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gainFile</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getGain</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_darkFile</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getDark</span><span class="p">())</span></div>
        <span class="c1"># self._firstFramesRange.set(other.getFramesRange())</span>

    <span class="k">def</span> <span class="nf">_dimStr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the string representing the dimensions. &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> x </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_anglesCount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span><span class="p">)</span></div>


<div class="viewcode-block" id="TiltSeriesDict"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict">[docs]</a><span class="k">class</span> <span class="nc">TiltSeriesDict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Helper class that to store TiltSeries and TiltImage but</span>
<span class="sd">    using dictionaries for quick access.</span>
<span class="sd">    This class also contains some logic related to the streaming:</span>
<span class="sd">    - Check for new input items that needs to be processed</span>
<span class="sd">    - Check for items already done that needs to be saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outputSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">newItemsCallback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">doneItemsCallback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the dict.</span>
<span class="sd">        :param inputSet: The set with input items. It will be monitored</span>
<span class="sd">            for new items from streaming.</span>
<span class="sd">        :param newItemsCallback: When new items are discovered, this</span>
<span class="sd">            function will be called</span>
<span class="sd">        :param doneItemsCallback: When some items are done, this function</span>
<span class="sd">            will be called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__inputSet</span> <span class="o">=</span> <span class="n">inputSet</span>
        <span class="k">if</span> <span class="n">inputSet</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__inputClosed</span> <span class="o">=</span> <span class="n">inputSet</span><span class="o">.</span><span class="n">isStreamClosed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastCheck</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__finalCheck</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__newItemsCallback</span> <span class="o">=</span> <span class="n">newItemsCallback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__doneItemsCallback</span> <span class="o">=</span> <span class="n">doneItemsCallback</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__new</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__finished</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># Reported as finished tasks, but not saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__done</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># Finished and saved tasks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">outputSet</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">outputSet</span><span class="p">:</span>
                <span class="c1"># We don&#39;t need tilt-images for done items</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addTs</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">includeTi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__done</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">getTsId</span><span class="p">())</span>

<div class="viewcode-block" id="TiltSeriesDict.addTs"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.addTs">[docs]</a>    <span class="k">def</span> <span class="nf">addTs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">includeTi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a clone of the tiltseries. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict</span><span class="p">[</span><span class="n">ts</span><span class="o">.</span><span class="n">getTsId</span><span class="p">()]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span> <span class="n">OrderedDict</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">includeTi</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ti</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addTi</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span></div>

<div class="viewcode-block" id="TiltSeriesDict.hasTs"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.hasTs">[docs]</a>    <span class="k">def</span> <span class="nf">hasTs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tsId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict</span></div>

<div class="viewcode-block" id="TiltSeriesDict.getTs"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.getTs">[docs]</a>    <span class="k">def</span> <span class="nf">getTs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict</span><span class="p">[</span><span class="n">tsId</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="TiltSeriesDict.addTi"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.addTi">[docs]</a>    <span class="k">def</span> <span class="nf">addTi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ti</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getTiDict</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">getTsId</span><span class="p">())[</span><span class="n">ti</span><span class="o">.</span><span class="n">getObjId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span></div>

<div class="viewcode-block" id="TiltSeriesDict.getTi"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.getTi">[docs]</a>    <span class="k">def</span> <span class="nf">getTi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="p">,</span> <span class="n">tiObjId</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTiDict</span><span class="p">(</span><span class="n">tsId</span><span class="p">)[</span><span class="n">tiObjId</span><span class="p">]</span></div>

<div class="viewcode-block" id="TiltSeriesDict.getTiDict"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.getTiDict">[docs]</a>    <span class="k">def</span> <span class="nf">getTiDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict</span><span class="p">[</span><span class="n">tsId</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="TiltSeriesDict.getTiList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.getTiList">[docs]</a>    <span class="k">def</span> <span class="nf">getTiList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTiDict</span><span class="p">(</span><span class="n">tsId</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ts</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">ts</span>

    <span class="c1"># ---- Streaming related methods -------------</span>
<div class="viewcode-block" id="TiltSeriesDict.update"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkNewInput</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkNewOutput</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_checkNewInput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># print(&quot;&gt;&gt;&gt; DEBUG: _checkNewInput &quot;)</span>

        <span class="n">inputSetFn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__inputSet</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span>
        <span class="n">mTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">inputSetFn</span><span class="p">))</span>
        <span class="c1"># if self.__lastCheck:</span>
        <span class="c1"># print(&#39;Last check: %s, modification: %s&#39;</span>
        <span class="c1">#       % (pwutils.prettyTime(self.__lastCheck),</span>
        <span class="c1">#          pwutils.prettyTime(mTime)))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastCheck</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastCheck</span> <span class="o">&lt;=</span> <span class="n">mTime</span><span class="p">:</span>
            <span class="n">updatedSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__inputSet</span><span class="o">.</span><span class="n">getClass</span><span class="p">()(</span><span class="n">filename</span><span class="o">=</span><span class="n">inputSetFn</span><span class="p">)</span>
            <span class="n">updatedSet</span><span class="o">.</span><span class="n">loadAllProperties</span><span class="p">()</span>
            <span class="n">newItems</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">updatedSet</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTs</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">getTsId</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addTs</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">includeTi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">newItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">getTsId</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__inputClosed</span> <span class="o">=</span> <span class="n">updatedSet</span><span class="o">.</span><span class="n">isStreamClosed</span><span class="p">()</span>
            <span class="n">updatedSet</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">newItems</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__newItemsCallback</span><span class="p">(</span><span class="n">newItems</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastCheck</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_checkNewOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># print(&quot;&gt;&gt;&gt; DEBUG: _checkNewInput &quot;)</span>
        <span class="c1"># First check that we have some items in the finished</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="n">doneItems</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__finished</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__finished</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">doneItems</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allDone</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__finalCheck</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__done</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">doneItems</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__doneItemsCallback</span><span class="p">(</span><span class="n">doneItems</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allDone</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__finalCheck</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="TiltSeriesDict.setFinished"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.setFinished">[docs]</a>    <span class="k">def</span> <span class="nf">setFinished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">tsIdList</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Notify that all TiltSeries in the list of ids are finished. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__finished</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tsIdList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div>

<div class="viewcode-block" id="TiltSeriesDict.allDone"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TiltSeriesDict.allDone">[docs]</a>    <span class="k">def</span> <span class="nf">allDone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return True if input stream is closed and all task are done. &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;&gt;&gt;&gt; DEBUG: allDone\n&quot;</span>
        <span class="c1">#       &quot;    inputClosed: %s\n&quot;</span>
        <span class="c1">#       &quot;    len(dict):   %s\n&quot;</span>
        <span class="c1">#       &quot;    len(done):   %s&quot; % (self.__inputClosed, len(self.__dict),</span>
        <span class="c1">#                                len(self.__done)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__inputClosed</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__done</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TomoAcquisition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition">[docs]</a><span class="k">class</span> <span class="nc">TomoAcquisition</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Acquisition</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angleMin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">angleMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">angleAxis1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">angleAxis2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">accumDose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tiltAxisAngle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Acquisition</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleMin</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">angleMin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleMax</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">angleMax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_step</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleAxis1</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">angleAxis1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleAxis2</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">angleAxis2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_accumDose</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">accumDose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tiltAxisAngle</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">tiltAxisAngle</span><span class="p">)</span>

<div class="viewcode-block" id="TomoAcquisition.getTiltAxisAngle"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.getTiltAxisAngle">[docs]</a>    <span class="k">def</span> <span class="nf">getTiltAxisAngle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tiltAxisAngle</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TomoAcquisition.setTiltAxisAngle"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.setTiltAxisAngle">[docs]</a>    <span class="k">def</span> <span class="nf">setTiltAxisAngle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tiltAxisAngle</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TomoAcquisition.getAngleMax"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.getAngleMax">[docs]</a>    <span class="k">def</span> <span class="nf">getAngleMax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angleMax</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TomoAcquisition.setAngleMax"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.setAngleMax">[docs]</a>    <span class="k">def</span> <span class="nf">setAngleMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleMax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TomoAcquisition.getAngleMin"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.getAngleMin">[docs]</a>    <span class="k">def</span> <span class="nf">getAngleMin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angleMin</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TomoAcquisition.setAngleMin"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.setAngleMin">[docs]</a>    <span class="k">def</span> <span class="nf">setAngleMin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleMin</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TomoAcquisition.getStep"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.getStep">[docs]</a>    <span class="k">def</span> <span class="nf">getStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TomoAcquisition.setStep"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.setStep">[docs]</a>    <span class="k">def</span> <span class="nf">setStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TomoAcquisition.getAngleAxis1"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.getAngleAxis1">[docs]</a>    <span class="k">def</span> <span class="nf">getAngleAxis1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angleAxis1</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TomoAcquisition.setAngleAxis1"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.setAngleAxis1">[docs]</a>    <span class="k">def</span> <span class="nf">setAngleAxis1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleAxis1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TomoAcquisition.getAngleAxis2"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.getAngleAxis2">[docs]</a>    <span class="k">def</span> <span class="nf">getAngleAxis2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angleAxis2</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TomoAcquisition.setAngleAxis2"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.setAngleAxis2">[docs]</a>    <span class="k">def</span> <span class="nf">setAngleAxis2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angleAxis2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="TomoAcquisition.getAccumDose"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.getAccumDose">[docs]</a>    <span class="k">def</span> <span class="nf">getAccumDose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accumDose</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TomoAcquisition.setAccumDose"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoAcquisition.setAccumDose">[docs]</a>    <span class="k">def</span> <span class="nf">setAccumDose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_accumDose</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Tomogram"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Tomogram">[docs]</a><span class="k">class</span> <span class="nc">Tomogram</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Volume</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Class to hold the tomogram abstraction inside Scipion. The origin (self._origin) of the volume is set as the</span>
<span class="sd">    location of the first coordinate loaded from the binary file. The volume may be displaced by setting a different</span>
<span class="sd">    origin using the methods implemented in the inherited class data.Image in scipion-em plugin.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Volume</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tsId&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Tomogram.getTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Tomogram.getTsId">[docs]</a>    <span class="k">def</span> <span class="nf">getTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get unique TiltSeries ID, usually retrieved from the</span>
<span class="sd">        file pattern provided by the user at the import time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Tomogram.setTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Tomogram.setTsId">[docs]</a>    <span class="k">def</span> <span class="nf">setTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tomogram.getAcquisition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Tomogram.getAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">getAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span></div>

<div class="viewcode-block" id="Tomogram.setAcquisition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Tomogram.setAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">setAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acquisition</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="n">acquisition</span></div>

<div class="viewcode-block" id="Tomogram.hasAcquisition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Tomogram.hasAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">hasAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getAngleMin</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getAngleMax</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tomogram.getDim"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Tomogram.getDim">[docs]</a>    <span class="k">def</span> <span class="nf">getDim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return image dimensions as tuple: (Xdim, Ydim, Zdim)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pwem.emlib.image</span> <span class="kn">import</span> <span class="n">ImageHandler</span>

            <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:mrc&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">ImageHandler</span><span class="p">()</span><span class="o">.</span><span class="n">getDimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

                <span class="c1"># Some volumes in mrc format can have the z dimension</span>
                <span class="c1"># as n dimension, so we need to consider this case.</span>
                <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Tomogram.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Tomogram.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyAttributes</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;_acquisition&#39;</span><span class="p">,</span> <span class="s1">&#39;_tsId&#39;</span><span class="p">,</span> <span class="s1">&#39;_origin&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfTomograms"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTomograms">[docs]</a><span class="k">class</span> <span class="nc">SetOfTomograms</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">SetOfVolumes</span><span class="p">):</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">Tomogram</span>
    <span class="n">EXPOSE_ITEMS</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">SetOfVolumes</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="n">TomoAcquisition</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfTomograms.updateDim"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTomograms.updateDim">[docs]</a>    <span class="k">def</span> <span class="nf">updateDim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update dimensions of this set base on the first element. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="TomoMask"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoMask">[docs]</a><span class="k">class</span> <span class="nc">TomoMask</span><span class="p">(</span><span class="n">Tomogram</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Object used to represent segmented tomograms</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Tomogram</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volName</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>

<div class="viewcode-block" id="TomoMask.getVolName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoMask.getVolName">[docs]</a>    <span class="k">def</span> <span class="nf">getVolName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the reference tomogram file for the current tomoMask.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volName</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="TomoMask.setVolName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoMask.setVolName">[docs]</a>    <span class="k">def</span> <span class="nf">setVolName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tomoName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the reference tomogram file for the current tomoMask.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volName</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">tomoName</span><span class="p">)</span></div>

<div class="viewcode-block" id="TomoMask.getTomogram"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.TomoMask.getTomogram">[docs]</a>    <span class="k">def</span> <span class="nf">getTomogram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Generate the reference tomogram object for the current tomoMask.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tomo</span> <span class="o">=</span> <span class="n">Tomogram</span><span class="p">()</span>
        <span class="n">tomo</span><span class="o">.</span><span class="n">setLocation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getVolName</span><span class="p">())</span>
        <span class="n">tomo</span><span class="o">.</span><span class="n">setSamplingRate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">())</span>
        <span class="n">tomo</span><span class="o">.</span><span class="n">setAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getAcquisition</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">tomo</span></div></div>


<div class="viewcode-block" id="SetOfTomoMasks"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfTomoMasks">[docs]</a><span class="k">class</span> <span class="nc">SetOfTomoMasks</span><span class="p">(</span><span class="n">SetOfTomograms</span><span class="p">):</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">TomoMask</span>
    <span class="n">EXPOSE_ITEMS</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Coordinate3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D">[docs]</a><span class="k">class</span> <span class="nc">Coordinate3D</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class holds the (x,y,z) position and other information</span>
<span class="sd">    associated with a coordinate&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volumePointer</span> <span class="o">=</span> <span class="n">Pointer</span><span class="p">(</span><span class="n">objDoStore</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eulerMatrix</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Transform</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_groupId</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>  <span class="c1"># This may refer to a mesh, ROI, vesicle or any group of coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tomoId</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tomoId&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>  <span class="c1"># Used to access to the corresponding tomogram from each</span>
        <span class="c1"># coord (it&#39;s the tsId)</span>

<div class="viewcode-block" id="Coordinate3D.getX"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getX">[docs]</a>    <span class="k">def</span> <span class="nf">getX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">originFunction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See getPosition method for a full description of how &quot;originFunction&quot;</span>
<span class="sd">        works&quot;&quot;&quot;</span>
        <span class="n">origin_Scipion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolumeOrigin</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">originFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">())</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">aux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="n">origin_Scipion</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">-</span> <span class="n">origin</span> <span class="o">-</span> <span class="n">origin_Scipion</span></div>

<div class="viewcode-block" id="Coordinate3D.setX"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setX">[docs]</a>    <span class="k">def</span> <span class="nf">setX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">originFunction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See setPosition method for a full description of how &quot;originFunction&quot;</span>
<span class="sd">        works&quot;&quot;&quot;</span>
        <span class="n">origin_Scipion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolumeOrigin</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">originFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">())</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">aux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="n">origin_Scipion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">origin_Scipion</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.shiftX"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.shiftX">[docs]</a>    <span class="k">def</span> <span class="nf">shiftX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shiftX</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">shiftX</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.getY"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getY">[docs]</a>    <span class="k">def</span> <span class="nf">getY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">originFunction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See getPosition method for a full description of how &quot;originFunction&quot;</span>
<span class="sd">        works&quot;&quot;&quot;</span>
        <span class="n">origin_Scipion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolumeOrigin</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">originFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">())</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">aux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="n">origin_Scipion</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">-</span> <span class="n">origin</span> <span class="o">-</span> <span class="n">origin_Scipion</span></div>

<div class="viewcode-block" id="Coordinate3D.setY"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setY">[docs]</a>    <span class="k">def</span> <span class="nf">setY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">originFunction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See setPosition method for a full description of how &quot;originFunction&quot;</span>
<span class="sd">        works&quot;&quot;&quot;</span>
        <span class="n">origin_Scipion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolumeOrigin</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">originFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">())</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">aux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="n">origin_Scipion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">origin_Scipion</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.shiftY"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.shiftY">[docs]</a>    <span class="k">def</span> <span class="nf">shiftY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shiftY</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">shiftY</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.getZ"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getZ">[docs]</a>    <span class="k">def</span> <span class="nf">getZ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">originFunction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See getPosition method for a full description of how &quot;originFunction&quot;</span>
<span class="sd">        works&quot;&quot;&quot;</span>
        <span class="n">origin_Scipion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolumeOrigin</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">originFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">())</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">aux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="n">origin_Scipion</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">-</span> <span class="n">origin</span> <span class="o">-</span> <span class="n">origin_Scipion</span></div>

<div class="viewcode-block" id="Coordinate3D.setZ"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setZ">[docs]</a>    <span class="k">def</span> <span class="nf">setZ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">originFunction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See setPosition method for a full description of how &quot;originFunction&quot;</span>
<span class="sd">        works&quot;&quot;&quot;</span>
        <span class="n">origin_Scipion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolumeOrigin</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">originFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">())</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">aux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="n">origin_Scipion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">origin_Scipion</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.shiftZ"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.shiftZ">[docs]</a>    <span class="k">def</span> <span class="nf">shiftZ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shiftZ</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">shiftZ</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.setMatrix"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">setMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eulerMatrix</span><span class="o">.</span><span class="n">setMatrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.getMatrix"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">getMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eulerMatrix</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate3D.hasTransform"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.hasTransform">[docs]</a>    <span class="k">def</span> <span class="nf">hasTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eulerMatrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Coordinate3D.euler2Matrix"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.euler2Matrix">[docs]</a>    <span class="k">def</span> <span class="nf">euler2Matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eulerMatrix</span><span class="o">.</span><span class="n">setMatrix</span><span class="p">(</span><span class="n">euler_matrix</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span></div>

<div class="viewcode-block" id="Coordinate3D.eulerAngles"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.eulerAngles">[docs]</a>    <span class="k">def</span> <span class="nf">eulerAngles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()</span>
        <span class="n">sy</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">singular</span> <span class="o">=</span> <span class="n">sy</span> <span class="o">&lt;</span> <span class="mf">1e-6</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">singular</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sy</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sy</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span></div>

<div class="viewcode-block" id="Coordinate3D.scale"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.scale">[docs]</a>    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Scale x, y and z coordinates by a given factor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.getPosition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getPosition">[docs]</a>    <span class="k">def</span> <span class="nf">getPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">originFunction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the position a Coordinate3D refered to a given origin defined by originFunction.</span>
<span class="sd">        The input of the method is a funtion (originFunction) which moves the coordinate</span>
<span class="sd">        position refered to the bottom left corner to other origin (retrieved by originFunction) in the grid.</span>

<span class="sd">        Parameters:</span>

<span class="sd">            :param function originFunction: Function to return a Vector to refer a coordinate to the bottom left corner</span>
<span class="sd">                                            from a given convention.</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; origin = originFunction((Lx, Ly, Lz))</span>
<span class="sd">            &gt;&gt;&gt; (vx, vy, vz)  # Vector to refer (x,y,z) coordinate to an origin from the bottom left corner</span>

<span class="sd">        Firstly, the Scipion origin vector stored in the Tomogram associated to the Coordinate3D</span>
<span class="sd">        will be applied to refer the current coordinate to the bottom left coordinate of the Tomogram.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getX</span><span class="p">(</span><span class="n">originFunction</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getY</span><span class="p">(</span><span class="n">originFunction</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getZ</span><span class="p">(</span><span class="n">originFunction</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.setPosition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setPosition">[docs]</a>    <span class="k">def</span> <span class="nf">setPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">originFunction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the position of the coordinate to be saved in the Coordinate3D object.</span>
<span class="sd">        The inputs of the method are the (x,y,z) position of the coordinate and a</span>
<span class="sd">        funtion (originFunction) which moves the current position to the bottom left</span>
<span class="sd">        corner of the Tomogram with dimensions Lx, Ly, Lz.</span>

<span class="sd">        Parameters:</span>

<span class="sd">            :param int x: Position of the coordinate in the X axis</span>
<span class="sd">            :param int y: Position of the coordinate in the Y axis</span>
<span class="sd">            :param int z: Position of the coordinate in the Z axis</span>
<span class="sd">            :param function originFunction: Function to return a Vector to refer a coordinate to the bottom left corner from a</span>
<span class="sd">                                            given convention.</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; origin = originFunction((Lx, Ly, Lz))</span>
<span class="sd">            &gt;&gt;&gt; (vx, vy, vz)  # Vector to refer (x,y,z) coordinate to the bottom left corner</span>

<span class="sd">        In this way, it is possible to apply the Scipion origin vector stored in the</span>
<span class="sd">        Tomogram associated to the Coordinate3D which moves the positions referred to</span>
<span class="sd">        the bottom left corner of a grid to the center of gravity of the grid (or any</span>
<span class="sd">        other origin specified by the user).</span>

<span class="sd">        IMPORTANT NOTE: For this method to work properly, it is needed to associate the Tomogram</span>
<span class="sd">        before doing a call to this method.</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; coord = Coordinate3D()</span>
<span class="sd">            &gt;&gt;&gt; coord.setPosition(x, y, z, originFunction)</span>
<span class="sd">            &gt;&gt;&gt; Error: Tomogram is still NoneType</span>
<span class="sd">            &gt;&gt;&gt; coord.setVolume(Tomogram)</span>
<span class="sd">            &gt;&gt;&gt; coord.setPosition(x, y, z, originFunction)</span>
<span class="sd">            &gt;&gt;&gt; Exit: Everything runs normally</span>

<span class="sd">        This requirement is only needed for &quot;setPostion&quot; method. The remaining attributes of the object</span>
<span class="sd">        can be set either before or after calling &quot;setVolume&quot; method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setX</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">originFunction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">originFunction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setZ</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">originFunction</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.getVolume"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getVolume">[docs]</a>    <span class="k">def</span> <span class="nf">getVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the micrograph object to which</span>
<span class="sd">        this coordinate is associated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volumePointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate3D.setVolume"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setVolume">[docs]</a>    <span class="k">def</span> <span class="nf">setVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the micrograph to which this coordinate belongs. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volumePointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">volume</span><span class="o">.</span><span class="n">getObjId</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">volume</span><span class="o">.</span><span class="n">getTsId</span><span class="p">():</span>  <span class="c1"># See getCoordinate3D() --&gt; as a tomo is necessary to be created, the tomoId (tsId),</span>
            <span class="c1"># which may have been previously stored is deleted when calling setVolume</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTomoId</span><span class="p">(</span><span class="n">volume</span><span class="o">.</span><span class="n">getTsId</span><span class="p">())</span></div>

<div class="viewcode-block" id="Coordinate3D.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy information from other coordinate. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPosition</span><span class="p">(</span><span class="o">*</span><span class="n">coord</span><span class="o">.</span><span class="n">getPosition</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">CENTER_GRAVITY</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setObjId</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">getObjId</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setBoxSize</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">getBoxSize</span><span class="p">())</span></div>

<div class="viewcode-block" id="Coordinate3D.setBoxSize"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setBoxSize">[docs]</a>    <span class="k">def</span> <span class="nf">setBoxSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boxSize</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span> <span class="o">=</span> <span class="n">boxSize</span></div>

<div class="viewcode-block" id="Coordinate3D.getBoxSize"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getBoxSize">[docs]</a>    <span class="k">def</span> <span class="nf">getBoxSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span></div>

<div class="viewcode-block" id="Coordinate3D.getVolId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getVolId">[docs]</a>    <span class="k">def</span> <span class="nf">getVolId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate3D.setVolId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setVolId">[docs]</a>    <span class="k">def</span> <span class="nf">setVolId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volId</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">volId</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.invertY"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.invertY">[docs]</a>    <span class="k">def</span> <span class="nf">invertY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">()</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getY</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">SCIPION</span><span class="p">),</span> <span class="n">const</span><span class="o">.</span><span class="n">SCIPION</span><span class="p">)</span></div>
        <span class="c1"># else: error TODO</span>

<div class="viewcode-block" id="Coordinate3D.getVolName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getVolName">[docs]</a>    <span class="k">def</span> <span class="nf">getVolName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate3D.getGroupId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getGroupId">[docs]</a>    <span class="k">def</span> <span class="nf">getGroupId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groupId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate3D.setGroupId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setGroupId">[docs]</a>    <span class="k">def</span> <span class="nf">setGroupId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupId</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_groupId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">groupId</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate3D.hasGroupId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.hasGroupId">[docs]</a>    <span class="k">def</span> <span class="nf">hasGroupId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groupId</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Coordinate3D.getVolumeOrigin"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getVolumeOrigin">[docs]</a>    <span class="k">def</span> <span class="nf">getVolumeOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angstrom</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the a vector that can be used to move the position of the Coordinate3D</span>
<span class="sd">        (referred to the center of the Tomogram or other origin specified by the user)</span>
<span class="sd">        to the bottom left corner of the Tomogram</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">vol</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;3D coordinate must be referred to a volume to get its origin.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">angstrom</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">vol</span><span class="o">.</span><span class="n">getShiftsFromOrigin</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sr</span> <span class="o">=</span> <span class="n">vol</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">()</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">vol</span><span class="o">.</span><span class="n">getShiftsFromOrigin</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">sr</span><span class="p">,</span> <span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">sr</span><span class="p">,</span> <span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">sr</span></div>

<div class="viewcode-block" id="Coordinate3D.getTomoId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.getTomoId">[docs]</a>    <span class="k">def</span> <span class="nf">getTomoId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tomoId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate3D.setTomoId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Coordinate3D.setTomoId">[docs]</a>    <span class="k">def</span> <span class="nf">setTomoId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tomoId</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tomoId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">tomoId</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfCoordinates3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D">[docs]</a><span class="k">class</span> <span class="nc">SetOfCoordinates3D</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Encapsulate the logic of a set of volumes coordinates.</span>
<span class="sd">    Each coordinate has a (x,y,z) position and is related to a Volume</span>
<span class="sd">    The SetOfCoordinates3D can also have information about TiltPairs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">Coordinate3D</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_precedentsPointer</span> <span class="o">=</span> <span class="n">Pointer</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfCoordinates3D.getBoxSize"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.getBoxSize">[docs]</a>    <span class="k">def</span> <span class="nf">getBoxSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the box size of the particles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.setBoxSize"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.setBoxSize">[docs]</a>    <span class="k">def</span> <span class="nf">setBoxSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boxSize</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the box size of the particles. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">boxSize</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.getSamplingRate"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.getSamplingRate">[docs]</a>    <span class="k">def</span> <span class="nf">getSamplingRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the sampling rate of the particles. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.setSamplingRate"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.setSamplingRate">[docs]</a>    <span class="k">def</span> <span class="nf">setSamplingRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the sampling rate of the particles. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">sampling</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.iterVolumes"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.iterVolumes">[docs]</a>    <span class="k">def</span> <span class="nf">iterVolumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over the objects set associated with this</span>
<span class="sd">        set of coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPrecedents</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.iterVolumeCoordinates"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.iterVolumeCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">iterVolumeCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterates over the set of coordinates belonging to that micrograph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.iterCoordinates"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.iterCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">iterCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">orderBy</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over the coordinates associated with a tomogram.</span>
<span class="sd">        If volume=None, the iteration is performed over the whole</span>
<span class="sd">        set of coordinates.</span>

<span class="sd">        IMPORTANT NOTE: During the storing process in the database, Coordinates3D will lose their</span>
<span class="sd">        pointer to ther associated Tomogram. This method overcomes this problem by retrieving and</span>
<span class="sd">        relinking the Tomogram as if nothing would ever happened.</span>

<span class="sd">        It is recommended to use this method when working with Coordinates3D, being the common</span>
<span class="sd">        &quot;iterItems&quot; deprecated for this set.</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; for coord in coordSet.iterItems()</span>
<span class="sd">            &gt;&gt;&gt;     print(coord.getVolName())</span>
<span class="sd">            &gt;&gt;&gt;     Error: Tomogram associated to Coordinate3D is NoneType (pointer lost)</span>
<span class="sd">            &gt;&gt;&gt; for coord in coordSet.iterCoordinates()</span>
<span class="sd">            &gt;&gt;&gt;     print(coord.getVolName())</span>
<span class="sd">            &gt;&gt;&gt;     &#39;/path/to/Tomo.file&#39; retrieved correctly</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">volume</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">volId</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">volId</span> <span class="o">=</span> <span class="n">volume</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Volume</span><span class="p">):</span>
            <span class="n">volId</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">getObjId</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Invalid input tomogram of type </span><span class="si">%s</span><span class="s1">&#39;</span>
                            <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">volume</span><span class="p">))</span>

        <span class="c1"># Iterate over all coordinates if tomoId is None,</span>
        <span class="c1"># otherwise use tomoId to filter the where selection</span>
        <span class="n">coordWhere</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span> <span class="k">if</span> <span class="n">volId</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;_volId=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">volId</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">coordWhere</span><span class="p">,</span> <span class="n">orderBy</span><span class="o">=</span><span class="n">orderBy</span><span class="p">):</span>
            <span class="n">coord</span><span class="o">.</span><span class="n">setVolume</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPrecedents</span><span class="p">()[</span><span class="n">coord</span><span class="o">.</span><span class="n">getVolId</span><span class="p">()])</span>
            <span class="k">yield</span> <span class="n">coord</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.getPrecedents"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.getPrecedents">[docs]</a>    <span class="k">def</span> <span class="nf">getPrecedents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the SetOfTomograms or Tilt Series associated with</span>
<span class="sd">                this SetOfCoordinates&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precedentsPointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.setPrecedents"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.setPrecedents">[docs]</a>    <span class="k">def</span> <span class="nf">setPrecedents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">precedents</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the tomograms  or Tilt Series associated with this set of coordinates.</span>
<span class="sd">                Params:</span>
<span class="sd">                    tomograms: Either a SetOfTomograms or Tilt Series object or a pointer to it.</span>
<span class="sd">                &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">precedents</span><span class="o">.</span><span class="n">isPointer</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_precedentsPointer</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">precedents</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_precedentsPointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">precedents</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.getFiles"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.getFiles">[docs]</a>    <span class="k">def</span> <span class="nf">getFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filePaths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">filePaths</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">filePaths</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.getSummary"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.getSummary">[docs]</a>    <span class="k">def</span> <span class="nf">getSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Number of particles picked: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSize</span><span class="p">())</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Particle size: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBoxSize</span><span class="p">())</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfCoordinates3D.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information (id and other properties) but not _mapperPath or _size</span>
<span class="sd">        from other set of objects to current one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setBoxSize</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getBoxSize</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSamplingRate</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPrecedents</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getPrecedents</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; String representation of a set of coordinates. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span><span class="o">.</span><span class="n">hasValue</span><span class="p">():</span>
            <span class="n">boxSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">boxStr</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">%d</span><span class="s1"> x </span><span class="si">%d</span><span class="s1"> x </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">boxSize</span><span class="p">,</span> <span class="n">boxSize</span><span class="p">,</span> <span class="n">boxSize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boxStr</span> <span class="o">=</span> <span class="s1">&#39;No-Box&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%d</span><span class="s2"> items, </span><span class="si">%s%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getClassName</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSize</span><span class="p">(),</span>
                                     <span class="n">boxStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appendStreamState</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="SetOfCoordinates3D.getFirstItem"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCoordinates3D.getFirstItem">[docs]</a>    <span class="k">def</span> <span class="nf">getFirstItem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">coord</span><span class="o">.</span><span class="n">setVolume</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPrecedents</span><span class="p">()[</span><span class="n">coord</span><span class="o">.</span><span class="n">getVolId</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">coord</span></div>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a pointer to a Tomogram before returning the Coordinate3D&quot;&quot;&quot;</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">)</span>
        <span class="c1"># In case pointer is lost in a for loop</span>
        <span class="c1"># clone = self.getPrecedents().getClass()()</span>
        <span class="c1"># clone.copy(self)</span>
        <span class="c1"># coord.setVolume(clone[coord.getVolId()])</span>
        <span class="n">coord</span><span class="o">.</span><span class="n">setVolume</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPrecedents</span><span class="p">()[</span><span class="n">coord</span><span class="o">.</span><span class="n">getVolId</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">coord</span></div>


<div class="viewcode-block" id="SubTomogram"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram">[docs]</a><span class="k">class</span> <span class="nc">SubTomogram</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Volume</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">Volume</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coordinate</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volName</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>

<div class="viewcode-block" id="SubTomogram.hasCoordinate3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.hasCoordinate3D">[docs]</a>    <span class="k">def</span> <span class="nf">hasCoordinate3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordinate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SubTomogram.setCoordinate3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.setCoordinate3D">[docs]</a>    <span class="k">def</span> <span class="nf">setCoordinate3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinate</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coordinate</span> <span class="o">=</span> <span class="n">coordinate</span></div>

<div class="viewcode-block" id="SubTomogram.getCoordinate3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.getCoordinate3D">[docs]</a>    <span class="k">def</span> <span class="nf">getCoordinate3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Since the object Coordinate3D needs a volume, use the information stored in the</span>
<span class="sd">        SubTomogram to reconstruct the corresponding Tomogram associated to its Coordinate3D&quot;&quot;&quot;</span>
        <span class="n">tomo</span> <span class="o">=</span> <span class="n">Tomogram</span><span class="p">()</span>
        <span class="n">subtomoOrigin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOrigin</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">subtomoOrigin</span><span class="p">:</span>
            <span class="n">tomo</span><span class="o">.</span><span class="n">setOrigin</span><span class="p">(</span><span class="n">subtomoOrigin</span><span class="p">)</span>
        <span class="n">tomo</span><span class="o">.</span><span class="n">setLocation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getVolName</span><span class="p">())</span>
        <span class="n">tomo</span><span class="o">.</span><span class="n">setSamplingRate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">())</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordinate</span>
        <span class="n">coord</span><span class="o">.</span><span class="n">setVolume</span><span class="p">(</span><span class="n">tomo</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coord</span></div>

<div class="viewcode-block" id="SubTomogram.getAcquisition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.getAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">getAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span></div>

<div class="viewcode-block" id="SubTomogram.setAcquisition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.setAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">setAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acquisition</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="n">acquisition</span></div>

<div class="viewcode-block" id="SubTomogram.hasAcquisition"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.hasAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">hasAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getAngleMin</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getAngleMax</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SubTomogram.getVolId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.getVolId">[docs]</a>    <span class="k">def</span> <span class="nf">getVolId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the tomogram id if the coordinate is not None.</span>
<span class="sd">        or have set the _volId property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span><span class="o">.</span><span class="n">hasValue</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasCoordinate3D</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCoordinate3D</span><span class="p">()</span><span class="o">.</span><span class="n">getVolId</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SubTomogram.setVolId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.setVolId">[docs]</a>    <span class="k">def</span> <span class="nf">setVolId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volId</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">volId</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubTomogram.getVolName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.getVolName">[docs]</a>    <span class="k">def</span> <span class="nf">getVolName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the tomogram filename if the coordinate is not None.</span>
<span class="sd">        or have set the _volName property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volName</span><span class="o">.</span><span class="n">hasValue</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volName</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SubTomogram.setVolName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.setVolName">[docs]</a>    <span class="k">def</span> <span class="nf">setVolName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volName</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">volName</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubTomogram.getVolumeOrigin"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SubTomogram.getVolumeOrigin">[docs]</a>    <span class="k">def</span> <span class="nf">getVolumeOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angstrom</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the a vector that can be used to move the position of the Coordinate3D</span>
<span class="sd">        associated to the SubTomogram (referred to the center of the Tomogram or other</span>
<span class="sd">        origin specified by the user) to the bottom left corner of the Tomogram</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">angstrom</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getShiftsFromOrigin</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">()</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getShiftsFromOrigin</span><span class="p">()</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">sr</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">sr</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">sr</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfSubTomograms"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfSubTomograms">[docs]</a><span class="k">class</span> <span class="nc">SetOfSubTomograms</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">SetOfVolumes</span><span class="p">):</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">SubTomogram</span>
    <span class="n">REP_TYPE</span> <span class="o">=</span> <span class="n">SubTomogram</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="n">TomoAcquisition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coordsPointer</span> <span class="o">=</span> <span class="n">Pointer</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfSubTomograms.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfSubTomograms.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information (sampling rate and ctf)</span>
<span class="sd">        from other set of images to current one&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;_coordsPointer&#39;</span><span class="p">):</span>  <span class="c1"># Like the vesicles in pyseg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copyAttributes</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;_coordsPointer&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfSubTomograms.hasCoordinates3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfSubTomograms.hasCoordinates3D">[docs]</a>    <span class="k">def</span> <span class="nf">hasCoordinates3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordsPointer</span><span class="o">.</span><span class="n">hasValue</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfSubTomograms.getCoordinates3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfSubTomograms.getCoordinates3D">[docs]</a>    <span class="k">def</span> <span class="nf">getCoordinates3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the SetOfCoordinates associated with</span>
<span class="sd">        this SetOfParticles&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordsPointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfSubTomograms.setCoordinates3D"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfSubTomograms.setCoordinates3D">[docs]</a>    <span class="k">def</span> <span class="nf">setCoordinates3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the SetOfCoordinates associates with</span>
<span class="sd">        this set of particles.</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coordsPointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AverageSubTomogram"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.AverageSubTomogram">[docs]</a><span class="k">class</span> <span class="nc">AverageSubTomogram</span><span class="p">(</span><span class="n">SubTomogram</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a Average SubTomogram.</span>
<span class="sd">        It is a SubTomogram but it is useful to differentiate outputs.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">SubTomogram</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="SetOfAverageSubTomograms"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfAverageSubTomograms">[docs]</a><span class="k">class</span> <span class="nc">SetOfAverageSubTomograms</span><span class="p">(</span><span class="n">SetOfSubTomograms</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a set of Averages.</span>
<span class="sd">    It is a SetOfSubTomograms but it is useful to differentiate outputs.&quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">AverageSubTomogram</span>
    <span class="n">REP_TYPE</span> <span class="o">=</span> <span class="n">AverageSubTomogram</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">SetOfSubTomograms</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="ClassSubTomogram"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.ClassSubTomogram">[docs]</a><span class="k">class</span> <span class="nc">ClassSubTomogram</span><span class="p">(</span><span class="n">SetOfSubTomograms</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represent a Class that groups SubTomogram objects.</span>
<span class="sd">    The representative of the class is an AverageSubTomogram.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">REP_TYPE</span> <span class="o">=</span> <span class="n">AverageSubTomogram</span>

<div class="viewcode-block" id="ClassSubTomogram.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.ClassSubTomogram.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information (id and other properties) but not</span>
<span class="sd">        _mapperPath or _size from other set of SubTomograms to current one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_mapperPath&#39;</span><span class="p">,</span> <span class="s1">&#39;_size&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="ClassSubTomogram.clone"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.ClassSubTomogram.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getClass</span><span class="p">()()</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_mapperPath&#39;</span><span class="p">,</span> <span class="s1">&#39;_size&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">clone</span></div>

<div class="viewcode-block" id="ClassSubTomogram.close"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.ClassSubTomogram.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Do nothing on close, since the db will be closed by SetOfClasses</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="SetOfClassesSubTomograms"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfClassesSubTomograms">[docs]</a><span class="k">class</span> <span class="nc">SetOfClassesSubTomograms</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">SetOfClasses</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Store results from a subtomogram averaging method. &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">ClassSubTomogram</span>
    <span class="n">REP_TYPE</span> <span class="o">=</span> <span class="n">AverageSubTomogram</span></div>


<div class="viewcode-block" id="LandmarkModel"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel">[docs]</a><span class="k">class</span> <span class="nc">LandmarkModel</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents the set of landmarks belonging to an specific tilt-series.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modelName</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">tsId</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modelName</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tiltSeries</span> <span class="o">=</span> <span class="n">Pointer</span><span class="p">(</span><span class="n">objDoStore</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<div class="viewcode-block" id="LandmarkModel.getTiltSeries"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.getTiltSeries">[docs]</a>    <span class="k">def</span> <span class="nf">getTiltSeries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the tilt-series associated with this landmark model. &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tiltSeries</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="LandmarkModel.setTiltSeries"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.setTiltSeries">[docs]</a>    <span class="k">def</span> <span class="nf">setTiltSeries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tiltSeries</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the tilt-series from which this landmark model were calculated.</span>
<span class="sd">        :param tiltSeries: Either a TiltSeries object or a pointer to it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">tiltSeries</span><span class="o">.</span><span class="n">isPointer</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tiltSeries</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tiltSeries</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tiltSeries</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">tiltSeries</span><span class="p">)</span></div>

<div class="viewcode-block" id="LandmarkModel.getTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.getTsId">[docs]</a>    <span class="k">def</span> <span class="nf">getTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="p">)</span></div>

<div class="viewcode-block" id="LandmarkModel.getFileName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.getFileName">[docs]</a>    <span class="k">def</span> <span class="nf">getFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span><span class="p">)</span></div>

<div class="viewcode-block" id="LandmarkModel.getModelName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.getModelName">[docs]</a>    <span class="k">def</span> <span class="nf">getModelName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_modelName</span><span class="p">)</span></div>

<div class="viewcode-block" id="LandmarkModel.setTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.setTsId">[docs]</a>    <span class="k">def</span> <span class="nf">setTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">tsId</span><span class="p">)</span></div>

<div class="viewcode-block" id="LandmarkModel.setFileName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.setFileName">[docs]</a>    <span class="k">def</span> <span class="nf">setFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span></div>

<div class="viewcode-block" id="LandmarkModel.setModelName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.setModelName">[docs]</a>    <span class="k">def</span> <span class="nf">setModelName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modelName</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span></div>

<div class="viewcode-block" id="LandmarkModel.addLandmark"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.addLandmark">[docs]</a>    <span class="k">def</span> <span class="nf">addLandmark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xCoor</span><span class="p">,</span> <span class="n">yCoor</span><span class="p">,</span> <span class="n">tiltIm</span><span class="p">,</span> <span class="n">chainId</span><span class="p">,</span> <span class="n">xResid</span><span class="p">,</span> <span class="n">yResid</span><span class="p">):</span>
        <span class="n">fieldNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;xCoor&#39;</span><span class="p">,</span> <span class="s1">&#39;yCoor&#39;</span><span class="p">,</span> <span class="s1">&#39;tiltIm&#39;</span><span class="p">,</span> <span class="s1">&#39;chainId&#39;</span><span class="p">,</span> <span class="s1">&#39;xResid&#39;</span><span class="p">,</span> <span class="s1">&#39;yResid&#39;</span><span class="p">]</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">())</span> <span class="k">else</span> <span class="s2">&quot;w&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">(),</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldNames</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span><span class="s1">&#39;xCoor&#39;</span><span class="p">:</span> <span class="n">xCoor</span><span class="p">,</span>
                             <span class="s1">&#39;yCoor&#39;</span><span class="p">:</span> <span class="n">yCoor</span><span class="p">,</span>
                             <span class="s1">&#39;tiltIm&#39;</span><span class="p">:</span> <span class="n">tiltIm</span><span class="p">,</span>
                             <span class="s1">&#39;chainId&#39;</span><span class="p">:</span> <span class="n">chainId</span><span class="p">,</span>
                             <span class="s1">&#39;xResid&#39;</span><span class="p">:</span> <span class="n">xResid</span><span class="p">,</span>
                             <span class="s1">&#39;yResid&#39;</span><span class="p">:</span> <span class="n">yResid</span><span class="p">})</span></div>

<div class="viewcode-block" id="LandmarkModel.retrieveInfoTable"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.LandmarkModel.retrieveInfoTable">[docs]</a>    <span class="k">def</span> <span class="nf">retrieveInfoTable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This methods return a table containing the information of the lankmark model. One landmark pero line</span>
<span class="sd">        specifying in order: xCoor, YCoor, tiltIm, chainId, xResid, yResid&quot;&quot;&quot;</span>

        <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span>

        <span class="n">outputInfo</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="c1"># Ignore header</span>
            <span class="nb">next</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                <span class="n">vector</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">outputInfo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outputInfo</span></div></div>


<div class="viewcode-block" id="SetOfLandmarkModels"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfLandmarkModels">[docs]</a><span class="k">class</span> <span class="nc">SetOfLandmarkModels</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a class that groups a set of landmark models.&quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">LandmarkModel</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setOfTiltSeriesPointer</span> <span class="o">=</span> <span class="n">Pointer</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a pointer to a tilt-series before returning the landmark model&quot;&quot;&quot;</span>

        <span class="n">lm</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">itemId</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">completeLandmarkModel</span><span class="p">(</span><span class="n">lm</span><span class="p">)</span>

<div class="viewcode-block" id="SetOfLandmarkModels.completeLandmarkModel"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfLandmarkModels.completeLandmarkModel">[docs]</a>    <span class="k">def</span> <span class="nf">completeLandmarkModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method completes a landmark model object setting in execution time the tilt-series associated to it,</span>
<span class="sd">        since it is not possible to save pointers in the item classes of the set.</span>

<span class="sd">        IMPORTANT: this method must be implement every time it is necesary to retrive information from the tilt-series</span>
<span class="sd">        associated to the landmark models that compose the set.&quot;&quot;&quot;</span>

        <span class="n">tsId</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">getTsId</span><span class="p">()</span>

        <span class="c1"># Check for tilt series in set with coincident tsId</span>
        <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSetOfTiltSeries</span><span class="p">()</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="s2">&quot;_tsId==&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">tsId</span><span class="p">):</span>
            <span class="n">lm</span><span class="o">.</span><span class="n">setTiltSeries</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lm</span></div>

<div class="viewcode-block" id="SetOfLandmarkModels.getLandmarkModelFromTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfLandmarkModels.getLandmarkModelFromTsId">[docs]</a>    <span class="k">def</span> <span class="nf">getLandmarkModelFromTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsId</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method return the landmark model belonging to the set that has a coincident input tsId.</span>

<span class="sd">        :param tsId: tilt-series ID to search the landmark model into the set.&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">lm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="s2">&quot;_tsId==&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">tsId</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">lm</span></div>

<div class="viewcode-block" id="SetOfLandmarkModels.getSetOfTiltSeries"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfLandmarkModels.getSetOfTiltSeries">[docs]</a>    <span class="k">def</span> <span class="nf">getSetOfTiltSeries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pointer</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the set of tilt-series associated with this set of landmark models. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">pointer</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setOfTiltSeriesPointer</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setOfTiltSeriesPointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfLandmarkModels.setSetOfTiltSeries"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfLandmarkModels.setSetOfTiltSeries">[docs]</a>    <span class="k">def</span> <span class="nf">setSetOfTiltSeries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setOfTiltSeries</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the set of tilt-series from which this set of landmark models were calculted.</span>
<span class="sd">        :param tiltSeries: Either a TiltSeries object or a pointer to it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">setOfTiltSeries</span><span class="o">.</span><span class="n">isPointer</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setOfTiltSeriesPointer</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">setOfTiltSeries</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setOfTiltSeriesPointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">setOfTiltSeries</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MeshPoint"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.MeshPoint">[docs]</a><span class="k">class</span> <span class="nc">MeshPoint</span><span class="p">(</span><span class="n">Coordinate3D</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mesh object: it stores the coordinates of the points (specified by the user) needed to define</span>
<span class="sd">    the triangulation of a volume.</span>
<span class="sd">    A Mesh object can be consider as a point cloud in 3D containing the coordinates needed to divide a given region of</span>
<span class="sd">    space into planar triangles interconnected that will result in a closed surface.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Coordinate3D</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volumeName</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Algebraic description of fitted mesh</span>

<div class="viewcode-block" id="MeshPoint.getVolumeName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.MeshPoint.getVolumeName">[docs]</a>    <span class="k">def</span> <span class="nf">getVolumeName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volumeName</span></div>

<div class="viewcode-block" id="MeshPoint.setVolumeName"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.MeshPoint.setVolumeName">[docs]</a>    <span class="k">def</span> <span class="nf">setVolumeName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volumeName</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">volName</span><span class="p">)</span></div>

<div class="viewcode-block" id="MeshPoint.getDescription"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.MeshPoint.getDescription">[docs]</a>    <span class="k">def</span> <span class="nf">getDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span></div>

<div class="viewcode-block" id="MeshPoint.setDescription"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.MeshPoint.setDescription">[docs]</a>    <span class="k">def</span> <span class="nf">setDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="n">description</span></div>

<div class="viewcode-block" id="MeshPoint.hasDescription"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.MeshPoint.hasDescription">[docs]</a>    <span class="k">def</span> <span class="nf">hasDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="SetOfMeshes"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfMeshes">[docs]</a><span class="k">class</span> <span class="nc">SetOfMeshes</span><span class="p">(</span><span class="n">SetOfCoordinates3D</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Store a series of meshes. &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">MeshPoint</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">SetOfCoordinates3D</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_numberOfMeshes</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>  <span class="c1"># Indicates how many meshes are in the set</span>

<div class="viewcode-block" id="SetOfMeshes.getNumberOfMeshes"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfMeshes.getNumberOfMeshes">[docs]</a>    <span class="k">def</span> <span class="nf">getNumberOfMeshes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numberOfMeshes</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfMeshes.setNumberOfMeshes"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfMeshes.setNumberOfMeshes">[docs]</a>    <span class="k">def</span> <span class="nf">setNumberOfMeshes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_numberOfMeshes</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Ellipsoid"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Ellipsoid">[docs]</a><span class="k">class</span> <span class="nc">Ellipsoid</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class represent an ellipsoid. This is an instance class of description attribute of object MeshPoint&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_center</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radii</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_algebraicDesc</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>

<div class="viewcode-block" id="Ellipsoid.getCenter"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Ellipsoid.getCenter">[docs]</a>    <span class="k">def</span> <span class="nf">getCenter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_center</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Ellipsoid.setCenter"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Ellipsoid.setCenter">[docs]</a>    <span class="k">def</span> <span class="nf">setCenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_center</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">center</span><span class="p">)</span></div>

<div class="viewcode-block" id="Ellipsoid.getRadii"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Ellipsoid.getRadii">[docs]</a>    <span class="k">def</span> <span class="nf">getRadii</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radii</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Ellipsoid.setRadii"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Ellipsoid.setRadii">[docs]</a>    <span class="k">def</span> <span class="nf">setRadii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radii</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radii</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">radii</span><span class="p">)</span></div>

<div class="viewcode-block" id="Ellipsoid.getAlgebraicDesc"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Ellipsoid.getAlgebraicDesc">[docs]</a>    <span class="k">def</span> <span class="nf">getAlgebraicDesc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_center</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Ellipsoid.setAlgebraicDesc"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Ellipsoid.setAlgebraicDesc">[docs]</a>    <span class="k">def</span> <span class="nf">setAlgebraicDesc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algebraicDesc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_algebraicDesc</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">algebraicDesc</span><span class="p">)</span></div>

<div class="viewcode-block" id="Ellipsoid.hasAlgebraicDesc"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.Ellipsoid.hasAlgebraicDesc">[docs]</a>    <span class="k">def</span> <span class="nf">hasAlgebraicDesc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_algebraicDesc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="CTFTomo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo">[docs]</a><span class="k">class</span> <span class="nc">CTFTomo</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">CTFModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represents a generic CTF model for a tilt-image. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">CTFModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusUDeviation</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isDefocusUDeviationInRange</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusVDeviation</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isDefocusVDeviationInRange</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="CTFTomo.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyAttributes</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;_defocusU&#39;</span><span class="p">,</span> <span class="s1">&#39;_defocusV&#39;</span><span class="p">,</span> <span class="s1">&#39;_defocusAngle&#39;</span><span class="p">,</span> <span class="s1">&#39;_defocusRatio&#39;</span><span class="p">,</span> <span class="s1">&#39;_psdFile&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;_resolution&#39;</span><span class="p">,</span> <span class="s1">&#39;_fitQuality&#39;</span><span class="p">,</span> <span class="s1">&#39;_index&#39;</span><span class="p">,</span> <span class="s1">&#39;_defocusUDeviation&#39;</span><span class="p">,</span> <span class="s1">&#39;_defocusVDeviation&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setIsDefocusUDeviationInRange</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getIsDefocusUDeviationInRange</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setIsDefocusVDeviationInRange</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getIsDefocusVDeviationInRange</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">hasPhaseShift</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setPhaseShift</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getPhaseShift</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">hasEstimationInfoAsList</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">hasAstigmatismInfoAsList</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_defocusUList</span> <span class="o">=</span> <span class="n">CsvList</span><span class="p">(</span><span class="n">pType</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_defocusVList</span> <span class="o">=</span> <span class="n">CsvList</span><span class="p">(</span><span class="n">pType</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngleList</span> <span class="o">=</span> <span class="n">CsvList</span><span class="p">(</span><span class="n">pType</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusUList</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getDefocusUList</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusVList</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getDefocusVList</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusAngleList</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getDefocusAngleList</span><span class="p">())</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_defocusUList</span> <span class="o">=</span> <span class="n">CsvList</span><span class="p">(</span><span class="n">pType</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusUList</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getDefocusUList</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">hasPhaseShiftInfoAsList</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_phaseShiftList</span> <span class="o">=</span> <span class="n">CsvList</span><span class="p">(</span><span class="n">pType</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setPhaseShiftList</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getPhaseShiftList</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">hasCutOnFrequncyInfoAsList</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cutOnFreqList</span> <span class="o">=</span> <span class="n">CsvList</span><span class="p">(</span><span class="n">pType</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCutOnFreqList</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getCutOnFreqList</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCutOnFreq</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getCutOnFreq</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">copyId</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copyObjId</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.ctfModelToCtfTomo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.ctfModelToCtfTomo">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">ctfModelToCtfTomo</span><span class="p">(</span><span class="n">ctfModel</span><span class="p">):</span>
        <span class="n">newCTFTomo</span> <span class="o">=</span> <span class="n">CTFTomo</span><span class="p">()</span>
        <span class="n">newCTFTomo</span><span class="o">.</span><span class="n">copyAttributes</span><span class="p">(</span><span class="n">ctfModel</span><span class="p">,</span> <span class="s1">&#39;_defocusU&#39;</span><span class="p">,</span> <span class="s1">&#39;_defocusV&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;_defocusAngle&#39;</span><span class="p">,</span> <span class="s1">&#39;_defocusRatio&#39;</span><span class="p">,</span> <span class="s1">&#39;_psdFile&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;_resolution&#39;</span><span class="p">,</span>  <span class="s1">&#39;_fitQuality&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newCTFTomo</span></div>

<div class="viewcode-block" id="CTFTomo.getIndex"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.getIndex">[docs]</a>    <span class="k">def</span> <span class="nf">getIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span></div>

<div class="viewcode-block" id="CTFTomo.setIndex"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.setIndex">[docs]</a>    <span class="k">def</span> <span class="nf">setIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.getdefocusUDeviation"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.getdefocusUDeviation">[docs]</a>    <span class="k">def</span> <span class="nf">getdefocusUDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusUDeviation</span></div>

<div class="viewcode-block" id="CTFTomo.setIsDefocusUDeviationInRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.setIsDefocusUDeviationInRange">[docs]</a>    <span class="k">def</span> <span class="nf">setIsDefocusUDeviationInRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isDefocusUDeviationInRange</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.getIsDefocusUDeviationInRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.getIsDefocusUDeviationInRange">[docs]</a>    <span class="k">def</span> <span class="nf">getIsDefocusUDeviationInRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isDefocusUDeviationInRange</span></div>

<div class="viewcode-block" id="CTFTomo.getdefocusVDeviation"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.getdefocusVDeviation">[docs]</a>    <span class="k">def</span> <span class="nf">getdefocusVDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusVDeviation</span></div>

<div class="viewcode-block" id="CTFTomo.setIsDefocusVDeviationInRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.setIsDefocusVDeviationInRange">[docs]</a>    <span class="k">def</span> <span class="nf">setIsDefocusVDeviationInRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isDefocusVDeviationInRange</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.getIsDefocusVDeviationInRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.getIsDefocusVDeviationInRange">[docs]</a>    <span class="k">def</span> <span class="nf">getIsDefocusVDeviationInRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isDefocusVDeviationInRange</span></div>

<div class="viewcode-block" id="CTFTomo.getCutOnFreq"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.getCutOnFreq">[docs]</a>    <span class="k">def</span> <span class="nf">getCutOnFreq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cutOnFreq</span></div>

<div class="viewcode-block" id="CTFTomo.setCutOnFreq"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.setCutOnFreq">[docs]</a>    <span class="k">def</span> <span class="nf">setCutOnFreq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cutOnFreq</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

    <span class="s2">&quot; List data methods allow compatibility with IMOD metadata. &quot;</span>

<div class="viewcode-block" id="CTFTomo.getDefocusUList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.getDefocusUList">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocusUList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusUList</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFTomo.setDefocusUList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.setDefocusUList">[docs]</a>    <span class="k">def</span> <span class="nf">setDefocusUList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defList</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusUList</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">defList</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.appendDefocusUList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.appendDefocusUList">[docs]</a>    <span class="k">def</span> <span class="nf">appendDefocusUList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusUList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.getDefocusVList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.getDefocusVList">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocusVList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusVList</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFTomo.setDefocusVList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.setDefocusVList">[docs]</a>    <span class="k">def</span> <span class="nf">setDefocusVList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defList</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusVList</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">defList</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.appendDefocusVList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.appendDefocusVList">[docs]</a>    <span class="k">def</span> <span class="nf">appendDefocusVList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusVList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.getDefocusAngleList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.getDefocusAngleList">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocusAngleList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngleList</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFTomo.setDefocusAngleList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.setDefocusAngleList">[docs]</a>    <span class="k">def</span> <span class="nf">setDefocusAngleList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defList</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngleList</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">defList</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.appendDefocusAngleList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.appendDefocusAngleList">[docs]</a>    <span class="k">def</span> <span class="nf">appendDefocusAngleList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngleList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.getPhaseShiftList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.getPhaseShiftList">[docs]</a>    <span class="k">def</span> <span class="nf">getPhaseShiftList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phaseShiftList</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFTomo.setPhaseShiftList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.setPhaseShiftList">[docs]</a>    <span class="k">def</span> <span class="nf">setPhaseShiftList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defList</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phaseShiftList</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">defList</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.appendPhaseShiftList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.appendPhaseShiftList">[docs]</a>    <span class="k">def</span> <span class="nf">appendPhaseShiftList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phaseShiftList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.getCutOnFreqList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.getCutOnFreqList">[docs]</a>    <span class="k">def</span> <span class="nf">getCutOnFreqList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cutOnFreqList</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFTomo.setCutOnFreqList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.setCutOnFreqList">[docs]</a>    <span class="k">def</span> <span class="nf">setCutOnFreqList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cutOnFreqList</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cutOnFreqList</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cutOnFreqList</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.appendCutOnFreqList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.appendCutOnFreqList">[docs]</a>    <span class="k">def</span> <span class="nf">appendCutOnFreqList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cutOnFreqList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.hasEstimationInfoAsList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.hasEstimationInfoAsList">[docs]</a>    <span class="k">def</span> <span class="nf">hasEstimationInfoAsList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method checks if the CTFTomo object contains estimation information in the form of a list. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_defocusUList&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_defocusUList&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="CTFTomo.hasAstigmatismInfoAsList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.hasAstigmatismInfoAsList">[docs]</a>    <span class="k">def</span> <span class="nf">hasAstigmatismInfoAsList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method checks if the CTFTomo object contains astigmatism information in the form of a list. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_defocusUList&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_defocusVList&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="CTFTomo.hasPhaseShiftInfoAsList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.hasPhaseShiftInfoAsList">[docs]</a>    <span class="k">def</span> <span class="nf">hasPhaseShiftInfoAsList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method checks if the CTFTomo object contains phase shift information in the form of a list. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_phaseShiftList&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="CTFTomo.hasCutOnFrequncyInfoAsList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.hasCutOnFrequncyInfoAsList">[docs]</a>    <span class="k">def</span> <span class="nf">hasCutOnFrequncyInfoAsList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method checks if the CTFTomo object contains cut-on frequency information in the form of a list. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_cutOnFreqList&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="CTFTomo.completeInfoFromList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.completeInfoFromList">[docs]</a>    <span class="k">def</span> <span class="nf">completeInfoFromList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method will set the _defocusU, _defocusV and _defocusAngle attributes from the provided CTF estimation</span>
<span class="sd">        information lists.</span>

<span class="sd">        Based on the IMOD program ctfphaseflip: &quot;The program  will assign that defocus value to the midpoint of the</span>
<span class="sd">        range of views.  For a view at a given tilt angle, it will find the defocus either by interpolating between</span>
<span class="sd">        two surrounding midpoint angles, if there are such angles, or by taking the nearest defocus value, if the</span>
<span class="sd">        angle is beyond the range of the available midpoint angles. &quot;</span>
<span class="sd">        - From IMOD documentation https://bio3d.colorado.edu/imod/doc/man/ctfphaseflip.html</span>

<span class="sd">        This method will assign as the defocus value and angle the median of the estimation list. &quot;&quot;&quot;</span>

        <span class="s2">&quot; DEFOCUS INFORMATION -----------------------------------------------------------------------------------------&quot;</span>

        <span class="s2">&quot; Check that at least one list is provided &quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasEstimationInfoAsList</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;CTFTomo object has no _defocusUList neither _defocusUList argument initialized. No &quot;</span>
                            <span class="s2">&quot;list information available.&quot;</span><span class="p">)</span>

        <span class="s2">&quot; Get the number of provided list (1 or 2) &quot;</span>
        <span class="n">numberOfProvidedList</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_defocusUList&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_defocusVList&quot;</span><span class="p">))</span> <span class="k">else</span> <span class="mi">1</span>

        <span class="s2">&quot; No astigmatism is estimated (only one list provided) &quot;</span>
        <span class="k">if</span> <span class="n">numberOfProvidedList</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">providedDefocusUList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefocusUList</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_defocusUList&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefocusVList</span><span class="p">()</span>
            <span class="n">providedDefocusUList</span> <span class="o">=</span> <span class="n">providedDefocusUList</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

            <span class="s2">&quot; DefocusAngle is set to 0 degrees &quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusAngle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="s2">&quot; DefocusU and DefocusV are set at the same value, equal to the middle estimation of the list &quot;</span>
            <span class="n">middlePoint</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">providedDefocusUList</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

            <span class="s2">&quot; If the size of the defocus list is even, mean the 2 centre values &quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">providedDefocusUList</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">providedDefocusUList</span><span class="p">[</span><span class="n">middlePoint</span><span class="p">])</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">providedDefocusUList</span><span class="p">[</span><span class="n">middlePoint</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusU</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusV</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="s2">&quot; If the size of defocus estimation is odd, get the centre value &quot;</span>

                <span class="n">value</span> <span class="o">=</span> <span class="n">providedDefocusUList</span><span class="p">[</span><span class="n">middlePoint</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusU</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusV</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="s2">&quot; Astigmatism is estimated (two lists are provided) &quot;</span>

            <span class="n">providedDefocusUList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefocusUList</span><span class="p">()</span>
            <span class="n">providedDefocusUList</span> <span class="o">=</span> <span class="n">providedDefocusUList</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

            <span class="n">providedDefocusVList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefocusVList</span><span class="p">()</span>
            <span class="n">providedDefocusVList</span> <span class="o">=</span> <span class="n">providedDefocusVList</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

            <span class="n">providedDefocusAngleList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefocusAngleList</span><span class="p">()</span>
            <span class="n">providedDefocusAngleList</span> <span class="o">=</span> <span class="n">providedDefocusAngleList</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

            <span class="s2">&quot; Check that the three list are equally long &quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">providedDefocusUList</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">providedDefocusVList</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="nb">len</span><span class="p">(</span><span class="n">providedDefocusUList</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">providedDefocusAngleList</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="nb">len</span><span class="p">(</span><span class="n">providedDefocusVList</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">providedDefocusAngleList</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;DefocusUList, DefocusVList and DefocusAngleList lengths must be equal.&quot;</span><span class="p">)</span>

            <span class="s2">&quot; DefocusU, DefocusV and DefocusAngle are set equal to the middle estimation of the list &quot;</span>
            <span class="n">middlePoint</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">providedDefocusUList</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

            <span class="s2">&quot; If the size of the defocus list is even, mean the 2 centre values &quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">providedDefocusUList</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">defocusU</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">providedDefocusUList</span><span class="p">[</span><span class="n">middlePoint</span><span class="p">])</span> <span class="o">+</span>
                            <span class="nb">float</span><span class="p">(</span><span class="n">providedDefocusUList</span><span class="p">[</span><span class="n">middlePoint</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">defocusV</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">providedDefocusVList</span><span class="p">[</span><span class="n">middlePoint</span><span class="p">])</span> <span class="o">+</span>
                            <span class="nb">float</span><span class="p">(</span><span class="n">providedDefocusVList</span><span class="p">[</span><span class="n">middlePoint</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">defocusAngle</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">providedDefocusAngleList</span><span class="p">[</span><span class="n">middlePoint</span><span class="p">])</span> <span class="o">+</span>
                                <span class="nb">float</span><span class="p">(</span><span class="n">providedDefocusAngleList</span><span class="p">[</span><span class="n">middlePoint</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusU</span><span class="p">(</span><span class="n">defocusU</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusV</span><span class="p">(</span><span class="n">defocusV</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusAngle</span><span class="p">(</span><span class="n">defocusAngle</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="s2">&quot; If the size of defocus estimation list is odd, get the centre value &quot;</span>

                <span class="n">defocusU</span> <span class="o">=</span> <span class="n">providedDefocusUList</span><span class="p">[</span><span class="n">middlePoint</span><span class="p">]</span>
                <span class="n">defocusV</span> <span class="o">=</span> <span class="n">providedDefocusVList</span><span class="p">[</span><span class="n">middlePoint</span><span class="p">]</span>
                <span class="n">defocusAngle</span> <span class="o">=</span> <span class="n">providedDefocusAngleList</span><span class="p">[</span><span class="n">middlePoint</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusU</span><span class="p">(</span><span class="n">defocusU</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusV</span><span class="p">(</span><span class="n">defocusV</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setDefocusAngle</span><span class="p">(</span><span class="n">defocusAngle</span><span class="p">)</span>

        <span class="s2">&quot; PHASE SHIFT INFORMATION -------------------------------------------------------------------------------------&quot;</span>

        <span class="s2">&quot; Check if phase shift information is also available &quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_phaseShiftList&quot;</span><span class="p">):</span>
            <span class="n">providedPhaseShiftList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPhaseShiftList</span><span class="p">()</span>
            <span class="n">providedPhaseShiftList</span> <span class="o">=</span> <span class="n">providedPhaseShiftList</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

            <span class="s2">&quot; Check that all the lists are equally long &quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">providedDefocusUList</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">providedPhaseShiftList</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;PhaseShiftList length must be equal to DefocusUList, DefocusVList and &quot;</span>
                                <span class="s2">&quot;DefocusAngleList lengths.&quot;</span><span class="p">)</span>

            <span class="s2">&quot; PhaseShift is set equal to the middle estimation of the list &quot;</span>
            <span class="n">middlePoint</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">providedPhaseShiftList</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

            <span class="s2">&quot; If the size of the phase shift list is even, mean the 2 centre values &quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">providedPhaseShiftList</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">phaseShift</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">providedPhaseShiftList</span><span class="p">[</span><span class="n">middlePoint</span><span class="p">])</span> <span class="o">+</span>
                              <span class="nb">float</span><span class="p">(</span><span class="n">providedPhaseShiftList</span><span class="p">[</span><span class="n">middlePoint</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">setPhaseShift</span><span class="p">(</span><span class="n">phaseShift</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="s2">&quot; If the size of phase shift list estimation is odd, get the centre value &quot;</span>

                <span class="n">phaseShift</span> <span class="o">=</span> <span class="n">providedPhaseShiftList</span><span class="p">[</span><span class="n">middlePoint</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">setPhaseShift</span><span class="p">(</span><span class="n">phaseShift</span><span class="p">)</span>

        <span class="s2">&quot; CUT-ON FREQUENCY INFORMATION --------------------------------------------------------------------------------&quot;</span>

        <span class="s2">&quot; Check if cut-on frequency information is also available &quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_cutOnFreqList&quot;</span><span class="p">):</span>
            <span class="n">providedCutOnFreqList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCutOnFreqList</span><span class="p">()</span>
            <span class="n">providedCutOnFreqList</span> <span class="o">=</span> <span class="n">providedCutOnFreqList</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

            <span class="s2">&quot; Check that all the lists are equally long &quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">providedPhaseShiftList</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">providedCutOnFreqList</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;CutOnFreqList length must be equal to PhaseShiftList, DefocusUList, DefocusVList and &quot;</span>
                                <span class="s2">&quot;DefocusAngleList lengths.&quot;</span><span class="p">)</span>

            <span class="s2">&quot; Cut-on frequency is set equal to the middle estimation of the list &quot;</span>
            <span class="n">middlePoint</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">providedCutOnFreqList</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

            <span class="s2">&quot; If the size of the cut-on frequency shift list is even, mean the 2 centre values &quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">providedCutOnFreqList</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cutOnFreq</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">providedCutOnFreqList</span><span class="p">[</span><span class="n">middlePoint</span><span class="p">])</span> <span class="o">+</span>
                             <span class="nb">float</span><span class="p">(</span><span class="n">providedCutOnFreqList</span><span class="p">[</span><span class="n">middlePoint</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">setCutOnFreq</span><span class="p">(</span><span class="n">cutOnFreq</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="s2">&quot; If the size of the cut-on frequency list estimation is odd, get the centre value &quot;</span>

                <span class="n">cutOnFreq</span> <span class="o">=</span> <span class="n">providedCutOnFreqList</span><span class="p">[</span><span class="n">middlePoint</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">setCutOnFreq</span><span class="p">(</span><span class="n">cutOnFreq</span><span class="p">)</span>

        <span class="s2">&quot; Standardize the input values &quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">standardize</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFTomo.getDefocusUDeviation"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.getDefocusUDeviation">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocusUDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDefocusU</span><span class="p">()</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.isDefocusUDeviationInRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.isDefocusUDeviationInRange">[docs]</a>    <span class="k">def</span> <span class="nf">isDefocusUDeviationInRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">percentage</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">defocusUDeviation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefocusUDeviation</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">defocusUDeviation</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">percentage</span> <span class="o">*</span> <span class="n">mean</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="CTFTomo.getDefocusVDeviation"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.getDefocusVDeviation">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocusVDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDefocusV</span><span class="p">()</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomo.isDefocusVDeviationInRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomo.isDefocusVDeviationInRange">[docs]</a>    <span class="k">def</span> <span class="nf">isDefocusVDeviationInRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">percentage</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">defocusVDeviation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefocusVDeviation</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">defocusVDeviation</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">percentage</span> <span class="o">*</span> <span class="n">mean</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="CTFTomoSeries"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries">[docs]</a><span class="k">class</span> <span class="nc">CTFTomoSeries</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represents a set of CTF models belonging to the same tilt-series. &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">CTFTomo</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tiltSeriesPointer</span> <span class="o">=</span> <span class="n">Pointer</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tiltSeriesPointer&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tsId&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isDefocusUDeviationInRange</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isDefocusVDeviationInRange</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># CtfModels will always be used inside a SetOfTiltSeries</span>
        <span class="c1"># so, let&#39;s do no store the mapper path by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mapperPath</span><span class="o">.</span><span class="n">setStore</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="CTFTomoSeries.clone"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_mapperPath&#39;</span><span class="p">,</span> <span class="s1">&#39;_size&#39;</span><span class="p">)):</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getClass</span><span class="p">()()</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="n">ignoreAttrs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clone</span></div>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Cancel closing the mapper since this class is an item of a set and shares the mapper with its parent set.</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="CTFTomoSeries.getTiltSeries"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.getTiltSeries">[docs]</a>    <span class="k">def</span> <span class="nf">getTiltSeries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the tilt-series associated with this CTF model series. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tiltSeriesPointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFTomoSeries.setTiltSeries"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.setTiltSeries">[docs]</a>    <span class="k">def</span> <span class="nf">setTiltSeries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tiltSeries</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the tilt-series from which this CTF model series were estimated.</span>
<span class="sd">        :param tiltSeries: Either a TiltSeries object or a pointer to it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tiltSeries</span><span class="o">.</span><span class="n">isPointer</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tiltSeriesPointer</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tiltSeries</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tiltSeriesPointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">tiltSeries</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomoSeries.getTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.getTsId">[docs]</a>    <span class="k">def</span> <span class="nf">getTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get unique TiltSeries ID, usually retrieved from the</span>
<span class="sd">        file pattern provided by the user at the import time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFTomoSeries.setTsId"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.setTsId">[docs]</a>    <span class="k">def</span> <span class="nf">setTsId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tsId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomoSeries.getNumberOfEstimationsInRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.getNumberOfEstimationsInRange">[docs]</a>    <span class="k">def</span> <span class="nf">getNumberOfEstimationsInRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the tilt-images range size used for estimation. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimationsInRange</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFTomoSeries.setNumberOfEstimationsInRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.setNumberOfEstimationsInRange">[docs]</a>    <span class="k">def</span> <span class="nf">setNumberOfEstimationsInRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimationRange</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the tilt-images range size used for estimation.</span>
<span class="sd">        :param estimationRange: Integer of the range size. &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_estimationsInRange</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">estimationRange</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomoSeries.getIMODDefocusFileFlag"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.getIMODDefocusFileFlag">[docs]</a>    <span class="k">def</span> <span class="nf">getIMODDefocusFileFlag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the format file from which the CTF estimation information has been acquired. This parameter is</span>
<span class="sd">        useful for posterior information and format conversions between IMOD and Scipion. The flag value &quot;is the sum of:</span>

<span class="sd">          1 if the file has astigmatism values</span>
<span class="sd">          2 if the astigmatism axis angle is in radians, not degrees</span>
<span class="sd">          4 if the file has phase shifts</span>
<span class="sd">          8 if the phase shifts are in radians, not degrees</span>
<span class="sd">         16 if tilt angles need to be inverted to match what the</span>
<span class="sd">             program expects (what Ctfplotter would produce)</span>
<span class="sd">             with the -invert option</span>
<span class="sd">         32 if the file has cut-on frequencies attenuating the phase</span>
<span class="sd">             at low frequencies&quot;</span>

<span class="sd">             from https://bio3d.colorado.edu/imod/doc/man/ctfphaseflip.html &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IMODDefocusFileFlag</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFTomoSeries.setIMODDefocusFileFlag"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.setIMODDefocusFileFlag">[docs]</a>    <span class="k">def</span> <span class="nf">setIMODDefocusFileFlag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the format file from which the CTF estimation information has been acquired.</span>
<span class="sd">        :param flag: Integer of the range size.</span>

<span class="sd">        This parameter is</span>
<span class="sd">        useful for posterior information and format conversions between IMOD and Scipion. The flag value &quot;is the sum of:</span>

<span class="sd">          1 if the file has astigmatism values</span>
<span class="sd">          2 if the astigmatism axis angle is in radians, not degrees</span>
<span class="sd">          4 if the file has phase shifts</span>
<span class="sd">          8 if the phase shifts are in radians, not degrees</span>
<span class="sd">         16 if tilt angles need to be inverted to match what the</span>
<span class="sd">             program expects (what Ctfplotter would produce)</span>
<span class="sd">             with the -invert option</span>
<span class="sd">         32 if the file has cut-on frequencies attenuating the phase</span>
<span class="sd">             at low frequencies&quot;</span>

<span class="sd">             from https://bio3d.colorado.edu/imod/doc/man/ctfphaseflip.html &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_IMODDefocusFileFlag</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomoSeries.setNumberOfEstimationsInRangeFromDefocusList"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.setNumberOfEstimationsInRangeFromDefocusList">[docs]</a>    <span class="k">def</span> <span class="nf">setNumberOfEstimationsInRangeFromDefocusList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the tilt-images estimation range size used for estimation from the defocus info list size. &quot;&quot;&quot;</span>

        <span class="n">estimationRange</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">ctfEstimation</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># Check that at least one list is provided</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">ctfEstimation</span><span class="p">,</span> <span class="s2">&quot;_defocusUList&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ctfEstimation</span><span class="p">,</span> <span class="s2">&quot;_defocusUList&quot;</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;CTFTomo object has no _defocusUList neither _defocusUList argument initialized. No &quot;</span>
                                <span class="s2">&quot;list information available.&quot;</span><span class="p">)</span>

            <span class="n">providedList</span> <span class="o">=</span> <span class="n">ctfEstimation</span><span class="o">.</span><span class="n">getDefocusUList</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ctfEstimation</span><span class="p">,</span> <span class="s2">&quot;_defocusUList&quot;</span><span class="p">)</span> \
                <span class="k">else</span> <span class="n">ctfEstimation</span><span class="o">.</span><span class="n">getDefocusVList</span><span class="p">()</span>
            <span class="n">providedList</span> <span class="o">=</span> <span class="n">providedList</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

            <span class="n">listLength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">providedList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">listLength</span> <span class="o">&gt;</span> <span class="n">estimationRange</span><span class="p">:</span>
                <span class="n">estimationRange</span> <span class="o">=</span> <span class="n">listLength</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setNumberOfEstimationsInRange</span><span class="p">(</span><span class="n">estimationRange</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomoSeries.getIsDefocusUDeviationInRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.getIsDefocusUDeviationInRange">[docs]</a>    <span class="k">def</span> <span class="nf">getIsDefocusUDeviationInRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isDefocusUDeviationInRange</span></div>

<div class="viewcode-block" id="CTFTomoSeries.setIsDefocusUDeviationInRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.setIsDefocusUDeviationInRange">[docs]</a>    <span class="k">def</span> <span class="nf">setIsDefocusUDeviationInRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isDefocusUDeviationInRange</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomoSeries.getIsDefocusVDeviationInRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.getIsDefocusVDeviationInRange">[docs]</a>    <span class="k">def</span> <span class="nf">getIsDefocusVDeviationInRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isDefocusVDeviationInRange</span></div>

<div class="viewcode-block" id="CTFTomoSeries.setIsDefocusVDeviationInRange"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.setIsDefocusVDeviationInRange">[docs]</a>    <span class="k">def</span> <span class="nf">setIsDefocusVDeviationInRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isDefocusVDeviationInRange</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomoSeries.calculateDefocusUDeviation"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.calculateDefocusUDeviation">[docs]</a>    <span class="k">def</span> <span class="nf">calculateDefocusUDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defocusUTolerance</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">defocusUValueList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ctfTomo</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">defocusUValueList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctfTomo</span><span class="o">.</span><span class="n">getDefocusU</span><span class="p">())</span>

        <span class="n">mean</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">defocusUValueList</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ctfTomo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">iterate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">ctfTomo</span><span class="o">.</span><span class="n">_defocusUDeviation</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ctfTomo</span><span class="o">.</span><span class="n">getDefocusUDeviation</span><span class="p">(</span><span class="n">mean</span><span class="p">))</span>
            <span class="n">isDefocusUDeviationInRange</span> <span class="o">=</span> <span class="n">ctfTomo</span><span class="o">.</span><span class="n">isDefocusUDeviationInRange</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span>
                                                                            <span class="n">percentage</span><span class="o">=</span><span class="n">defocusUTolerance</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isDefocusUDeviationInRange</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_isDefocusUDeviationInRange</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ctfTomo</span><span class="o">.</span><span class="n">_isDefocusUDeviationInRange</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">isDefocusUDeviationInRange</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ctfTomo</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFTomoSeries.calculateDefocusVDeviation"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.CTFTomoSeries.calculateDefocusVDeviation">[docs]</a>    <span class="k">def</span> <span class="nf">calculateDefocusVDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defocusVTolerance</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">defocusVValueList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ctfTomo</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">defocusVValueList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctfTomo</span><span class="o">.</span><span class="n">getDefocusV</span><span class="p">())</span>

        <span class="n">mean</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">defocusVValueList</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ctfTomo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">iterate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">ctfTomo</span><span class="o">.</span><span class="n">_defocusVDeviation</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ctfTomo</span><span class="o">.</span><span class="n">getDefocusVDeviation</span><span class="p">(</span><span class="n">mean</span><span class="p">))</span>
            <span class="n">isDefocusVDeviationInRange</span> <span class="o">=</span> <span class="n">ctfTomo</span><span class="o">.</span><span class="n">isDefocusVDeviationInRange</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span>
                                                                            <span class="n">percentage</span><span class="o">=</span><span class="n">defocusVTolerance</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isDefocusVDeviationInRange</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_isDefocusVDeviationInRange</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ctfTomo</span><span class="o">.</span><span class="n">_isDefocusVDeviationInRange</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">isDefocusVDeviationInRange</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ctfTomo</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfCTFTomoSeries"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCTFTomoSeries">[docs]</a><span class="k">class</span> <span class="nc">SetOfCTFTomoSeries</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represents a set of CTF model series belonging to the same set of tilt-series. &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">CTFTomoSeries</span>
    <span class="n">USE_CREATE_COPY_FOR_SUBSET</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setOfTiltSeriesPointer</span> <span class="o">=</span> <span class="n">Pointer</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tiltSeriesPointer&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

<div class="viewcode-block" id="SetOfCTFTomoSeries.copyInfo"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCTFTomoSeries.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSetOfTiltSeries</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getSetOfTiltSeries</span><span class="p">(</span><span class="n">pointer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span></div>

<div class="viewcode-block" id="SetOfCTFTomoSeries.getSetOfTiltSeries"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCTFTomoSeries.getSetOfTiltSeries">[docs]</a>    <span class="k">def</span> <span class="nf">getSetOfTiltSeries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pointer</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the tilt-series associated with this CTF model series. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setOfTiltSeriesPointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">pointer</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setOfTiltSeriesPointer</span></div>

<div class="viewcode-block" id="SetOfCTFTomoSeries.setSetOfTiltSeries"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCTFTomoSeries.setSetOfTiltSeries">[docs]</a>    <span class="k">def</span> <span class="nf">setSetOfTiltSeries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setOfTiltSeries</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the tilt-series from which this CTF model series were estimated.</span>
<span class="sd">        :param setOfTiltSeries: Either a TiltSeries object or a pointer to it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">setOfTiltSeries</span><span class="o">.</span><span class="n">isPointer</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setOfTiltSeriesPointer</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">setOfTiltSeries</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setOfTiltSeriesPointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">setOfTiltSeries</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfCTFTomoSeries.iterClassItems"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCTFTomoSeries.iterClassItems">[docs]</a>    <span class="k">def</span> <span class="nf">iterClassItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterDisabled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over the images of a class.</span>
<span class="sd">        Params:</span>
<span class="sd">            iterDisabled: If True, also include the disabled items. &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterItems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">iterDisabled</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="bp">cls</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">iterDisabled</span> <span class="ow">or</span> <span class="n">img</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                        <span class="k">yield</span> <span class="n">img</span></div>

    <span class="k">def</span> <span class="nf">_setItemMapperPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the mapper path of this class according to the mapper</span>
<span class="sd">        path of the SetOfClasses and also the prefix according to class id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span><span class="o">.</span><span class="n">_mapperPath</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,id</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">(),</span> <span class="n">item</span><span class="o">.</span><span class="n">getObjId</span><span class="p">()))</span>
        <span class="n">item</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_insertItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create the SetOfImages assigned to a class.</span>
<span class="sd">        If the file exists, it will load the Set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="n">_insertItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">properties</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Set.write(self)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Setup the mapper classes before returning the item. &quot;&quot;&quot;</span>
        <span class="n">classItem</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">)</span>

        <span class="n">objId</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">tiltSeries</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSetOfTiltSeries</span><span class="p">()</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">iterate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tiltSeries</span><span class="o">.</span><span class="n">getTsId</span><span class="p">()</span> <span class="o">==</span> <span class="n">classItem</span><span class="o">.</span><span class="n">getTsId</span><span class="p">():</span>
                <span class="n">objId</span> <span class="o">=</span> <span class="n">tiltSeries</span><span class="o">.</span><span class="n">getObjId</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">objId</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span><span class="s2">&quot;Could not find tilt-series with tsId = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">classItem</span><span class="o">.</span><span class="n">getTsId</span><span class="p">())</span>

        <span class="n">classItem</span><span class="o">.</span><span class="n">setTiltSeries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSetOfTiltSeries</span><span class="p">()[</span><span class="n">objId</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">classItem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">classItem</span>

<div class="viewcode-block" id="SetOfCTFTomoSeries.getFirstItem"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCTFTomoSeries.getFirstItem">[docs]</a>    <span class="k">def</span> <span class="nf">getFirstItem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">classItem</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">classItem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">classItem</span></div>

<div class="viewcode-block" id="SetOfCTFTomoSeries.iterItems"><a class="viewcode-back" href="../../api/tomo/tomo.objects.html#tomo.objects.SetOfCTFTomoSeries.iterItems">[docs]</a>    <span class="k">def</span> <span class="nf">iterItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orderBy</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;ASC&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">EMSet</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="n">orderBy</span><span class="o">=</span><span class="n">orderBy</span><span class="p">,</span>
                                         <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">):</span>

            <span class="n">objId</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">tiltSeries</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSetOfTiltSeries</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">tiltSeries</span><span class="o">.</span><span class="n">getTsId</span><span class="p">()</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">getTsId</span><span class="p">():</span>
                    <span class="n">objId</span> <span class="o">=</span> <span class="n">tiltSeries</span><span class="o">.</span><span class="n">getObjId</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">objId</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="p">(</span><span class="s2">&quot;Could not find tilt-series with tsId = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">item</span><span class="o">.</span><span class="n">getTsId</span><span class="p">())</span>

            <span class="n">item</span><span class="o">.</span><span class="n">setTiltSeries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSetOfTiltSeries</span><span class="p">()[</span><span class="n">objId</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="k">yield</span> <span class="n">item</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: tomo_picking_tutorial
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../gh-pages/index.html">gh-pages</a></dd>
            <dd><a href="../../../jj_denoise_segmentation_dirPicking_workshop/index.html">jj_denoise_segmentation_dirPicking_workshop</a></dd>
            <dd><a href="../../../release-2.0.0/index.html">release-2.0.0</a></dd>
            <dd><a href="../../../release-3.0.0/index.html">release-3.0.0</a></dd>
            <dd><a href="../../../rsanchezgarc-patch-1/index.html">rsanchezgarc-patch-1</a></dd>
            <dd><a href="objects.html">tomo_picking_tutorial</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>