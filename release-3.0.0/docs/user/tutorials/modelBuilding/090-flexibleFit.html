

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>11. Refinement: Flexible fitting &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="12. Structure validation and comparison" href="100-validation.html" />
    <link rel="prev" title="10. Merging 3D Maps and Atomic Structures: Rigid Fitting" href="080-rigidFit.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../scipion-modes/how-to-install.html">Installing Scipion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../user-documentation.html#tutorials">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../user-documentation.html#single-particle-tutorials">Single particle tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user-documentation.html#tomography-tutorials">Tomography tutorials</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../user-documentation.html#model-building">Model Building</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Model Building Tutorial</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="index.html#this-tutorial-is-work-in-progress">THIS TUTORIAL Is WORK IN PROGRESS</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html#contents">Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#appendices">Appendices</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../facilities/facilities.html">On-the-fly processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../facilities/customize-report.html">Summary Reports</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/scipion-API.html">Scipion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/plugins-API.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/xmipp-API.html">Xmipp API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/contact-us.html">Contact Us</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Licences</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">Licenses</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../user-documentation.html">Graphical interface manuals</a> &raquo;</li>
        
          <li><a href="index.html">Model Building Tutorial</a> &raquo;</li>
        
      <li><span class="section-number">11. </span>Refinement: Flexible fitting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/docs/user/tutorials/modelBuilding/090-flexibleFit.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="refinement-flexible-fitting">
<span id="refinementflexiblefitting"></span><h1><span class="section-number">11. </span>Refinement: Flexible fitting<a class="headerlink" href="#refinement-flexible-fitting" title="Permalink to this headline">¶</a></h1>
<p>Although the rigid fitting approximates <em>map</em> and atomic <em>model</em>, a detailed visual
inspection of <em>map</em> and <em>model</em> reveals that some residues are not perfectly fitted.
In order to get a better fit, not only of the carbon skeleton but also
of residue side chains, a flexible fitting or refinement has to be
accomplished. Refinement can thus be defined as the optimization process
of fitting <em>model</em> parameters to experimental data. Different strategies,
categorized as refinement in the real space and refinement in the
Fourier space, can be followed. Implemented in <em>Scipion</em> are two protocols for
real space refinement, <strong>ccp4-coot refinement</strong> (Appendix <a class="reference internal" href="a050-ccp4CootRefinement.html#app-ccp4cootrefinement"><span class="std std-ref">Coot refinement</span></a>, <span id="id1">[<a class="reference internal" href="z010-references.html#id15" title="P. Emsley, B. Lohkamp, W. G. Scott, and K. Cowtan. Features and development of Coot. Acta Crystallogr. D Biol. Crystallogr., 66(Pt 4):486–501, Apr 2010.">Emsley <em>et al.</em>, 2010</a>]</span>) and <strong>phenix-real space refine</strong> (Appendix <a class="reference internal" href="a140-realSpaceRefineProtocol.html#app-realspacerefineprotocol"><span class="std std-ref">Real space refine</span></a>, <span id="id2">[<a class="reference internal" href="z010-references.html#id16" title="Pavel V. Afonine, Billy K. Poon, Randy J. Read, Oleg V. Sobolev, Thomas C. Terwilliger, Alexandre Urzhumtsev, and Paul D. Adams. Real-space refinement in \it PHENIX for cryo-EM and crystallography. Acta Crystallographica Section D, 74(6):531–544, Jun 2018. URL: https://doi.org/10.1107/S2059798318006551, doi:10.1107/S2059798318006551.">Afonine <em>et al.</em>, 2018</a>]</span>), interactive and automatic, respectively,
and one automatic protocol to refine the <em>model</em> in the reciprocal space, <strong>ccp4-refmac</strong>
(Appendix <a class="reference internal" href="a060-ccp4Refmac.html#app-ccp4refmac"><span class="std std-ref">Refmac</span></a>, <span id="id3">[<a class="reference internal" href="z010-references.html#id17" title="A. A. Vagin, R. A. Steiner, A. A. Lebedev, L. Potterton, S. McNicholas, F. Long, and G. N. Murshudov. REFMAC5 dictionary: organization of prior chemical knowledge and guidelines for its use. Acta Crystallogr. D Biol. Crystallogr., 60(Pt 12 Pt 1):2184–2195, Dec 2004.">Vagin <em>et al.</em>, 2004</a>]</span>).</p>
<p>Observe the new steps in the modeling <em>Scipion</em> workflow in <a class="reference internal" href="#model-building-scipion-workflow-flexiblefit"><span class="std std-numref">Fig. 11.1</span></a>.</p>
<div class="figure align-center" id="model-building-scipion-workflow-flexiblefit">
<a class="reference internal image-reference" href="../../../../_images/Fig68.svg"><img alt="*Scipion* framework detailing the workflow to refine the model of the human *Hgb* :math:`\alpha` subunit in the map asymmetric unit." src="../../../../_images/Fig68.svg" width="100.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.1 </span><span class="caption-text"><em>Scipion</em> framework detailing the workflow to refine the model of the human <em>Hgb</em> <span class="math">\alpha</span> subunit in the map asymmetric unit.</span><a class="headerlink" href="#model-building-scipion-workflow-flexiblefit" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="ccp4-coot-refinement">
<h2><span class="section-number">11.1. </span>CCP4 <em>Coot</em> Refinement<a class="headerlink" href="#ccp4-coot-refinement" title="Permalink to this headline">¶</a></h2>
<p>Initially devoted to atomic models obtained by X-ray crystallography
methods, <em>Coot</em> (from Crystallopgraphic Object-Oriented Toolkit) is a 3D
computer graphics tool that allows simultaneous display of <em>map</em> and fitted <em>model</em> to
accomplish mostly interactive modeling operations. Although this
tutorial does not try to show every functionality of <em>Coot</em>, but indicate how
to open, close and save partial and final refined structures in <em>Scipion</em>, some
of <em>Coot</em> basic relevant commands will be shown. Initially, we are going to
refine our <em>model</em> with <em>Coot</em>. First of all, open the <strong>ccp4-coot refinement</strong> protocol (<a class="reference internal" href="#model-building-coot-refinement-protocol"><span class="std std-numref">Fig. 11.2</span></a> (1)), load the map
asymmetric units (2), with electron density normalized to 1 (<em>Coot</em> performs
this step by default), and the fitted structure <em>model</em> (3). To
read the protocol Help is recommended. After executing the protocol (4),
the <em>Coot</em> graphics window will appear to start working.</p>
<div class="figure align-center" id="model-building-coot-refinement-protocol">
<a class="reference internal image-reference" href="../../../../_images/Fig24.svg"><img alt="Filling in the *Coot* refinement protocol." src="../../../../_images/Fig24.svg" width="100.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.2 </span><span class="caption-text">Filling in the <em>Coot</em> refinement protocol.</span><a class="headerlink" href="#model-building-coot-refinement-protocol" title="Permalink to this image">¶</a></p>
</div>
<div class="line-block">
<div class="line">To check the objects downloaded in <em>Coot</em>, go to the second bar of the main
menu and select <em>Display Manager</em>. Maps (numbers <em>#1</em>, <em>#2</em> and <em>#3</em>) and model <em>Hgb_alpha_Atom_struct__3_007124.cif</em> (number <em>#0</em>) are
displayed on the left (<a class="reference internal" href="#model-building-coot-density-fit-analysis"><span class="std std-numref">Fig. 11.3</span></a> (A)). Remark that you have buttons to display
a particular map (1) and to increase or reduce map density scrolling
it (2). In this case, since we have selected the display of the
unsharpened map asymmetric unit, we can only observe this <em>map</em> together
with the <em>model</em>. If you want to check any of the sharpened maps, select it
and scroll it. Note that all maps should be aligned. Try to see
differences in details and connectivity of the map to assess if the
sharpened maps really optimize the map density compared to the
unsharpened one. If this is the case, try to follow the refinement
according to the density of the best map (the most optimized one)
checking the reliability of the density according to the unsharpened
map, specially in the most controversial areas. Since you count on
several sharpening maps you can also take advantage of the different
map optimizations that you could have in the distinct areas of the
map.</div>
</div>
<div class="line-block">
<div class="line">To start with the refinement process, we are going to identify the
part of <em>model</em> misfitted to the density map. Visual inspection
would clarify this point in some cases, although direct observation of
the <em>Density fit analysis</em> might be a shorter way. With this aim, go to the main menu of <em>Coot</em>
graphical window and select <em>Validate -&gt; Densisty fit analysis</em>. The density fit will be analyzed
regarding a specific map. To select any of them, go to the <em>Coot</em> right side
menu (<a class="reference internal" href="#model-building-coot-density-fit-analysis"><span class="std std-numref">Fig. 11.3</span></a> (B)(3)) and open the <em>Select Map for Fitting</em> window (C). This density analysis, that
you can see for the three map asymmetric units in <a class="reference internal" href="#model-building-coot-density-fit-analysis"><span class="std std-numref">Fig. 11.3</span></a> (D) shows that
residues 1, 51, 73, 138-142 do not fit perfectly to the density map.
The color range scale varies from green color (good fit) to red color
(bad fit). There are some differences among maps and, as it was
expected, the sharpened maps display higher restraints and show
additional residues partially misfitted.</div>
</div>
<div class="figure align-center" id="model-building-coot-density-fit-analysis">
<a class="reference internal image-reference" href="../../../../_images/Fig25.svg"><img alt="A. *Coot Display Manager*. B. *Coot* right side menu. C. *Coot Select Map for Fitting* window. D. Map density fit analysis of the *model* in *Coot* regarding the unsharpened map (upper), :math:`LocalDeblur` sharpened map (middle) and :math:`DeepEMhancer` sharpened map (lower)." src="../../../../_images/Fig25.svg" width="75.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.3 </span><span class="caption-text"><em>A</em>. <em>Coot Display Manager</em>. B. <em>Coot</em> right side menu. C. <em>Coot Select Map for Fitting</em> window. D. Map density fit analysis of the <em>model</em> in <em>Coot</em> regarding the unsharpened map (upper), <span class="math">LocalDeblur</span> sharpened map (middle) and <span class="math">DeepEMhancer</span> sharpened map (lower).</span><a class="headerlink" href="#model-building-coot-density-fit-analysis" title="Permalink to this image">¶</a></p>
</div>
<p>According to <a class="reference internal" href="#model-building-coot-density-fit-analysis"><span class="std std-numref">Fig. 11.3</span></a> (B), <em>MET</em> residue of the new chain <em>A</em> does not fit to the map
density. Maybe this residue has been processed post-translationally, as
we have anticipated in <a class="reference external" href="file:///home/marta/software/docs/_build/html/docs/user/tutorials/modelBuilding/030-inputDataDescription.html">Input data description</a> section. To solve this
question, go to <em>Coot</em> main menu and select <em>Draw -&gt; Go to Atom… -&gt; Chain A -&gt; A 1 MET</em> (<a class="reference internal" href="#model-building-coot-go-to-atom"><span class="std std-numref">Fig. 11.4</span></a> (A)). <em>MET</em> residue will be located in
the center of <em>Coot</em> graphics window. Check if this residue is surrounded by
any electron density. As <a class="reference internal" href="#model-building-coot-go-to-atom"><span class="std std-numref">Fig. 11.4</span></a> (B)(1) shows, no density associates to the
first chain residue. <em>MET</em> will thus be deleted. Then go to the lower right
side menu and select the symbol to delete items (B)(2). Select <em>Residue/Monomer</em> in the
opened <em>Delete item</em> window, and click the <em>MET</em> residue that you want to delete. Go again
to <em>Validate -&gt; Density fit analysis</em> and check if the orange bar shown in <em>MET</em> residue <a class="reference internal" href="#model-building-coot-density-fit-analysis"><span class="std std-numref">Fig. 11.3</span></a> (D) has disappeared.</p>
<div class="figure align-center" id="model-building-coot-go-to-atom">
<a class="reference internal image-reference" href="../../../../_images/Fig27.svg"><img alt="Removing post-translationally processed Methionine residue in *Coot*. Note that the icons shown in the image right side may be partially hidden if the screen is small." src="../../../../_images/Fig27.svg" width="80.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.4 </span><span class="caption-text">Removing post-translationally processed Methionine residue in <em>Coot</em>. Note that the icons shown in the image right side may be partially hidden if the screen is small.</span><a class="headerlink" href="#model-building-coot-go-to-atom" title="Permalink to this image">¶</a></p>
</div>
<div class="line-block">
<div class="line">Although in this particular example the most interesting
refinement strategy could be repair only the misfitted residues
because they are very few, in a more general case, in which we could
have many misfitted residues, an initial quick refinement may be
accomplished. With this purpose, first of all, go to the upper right
side menu (<a class="reference internal" href="#model-building-coot-go-to-atom"><span class="std std-numref">Fig. 11.4</span></a> (B)(3)) and select all four restrictions for <em>Regularization and Refinement</em> in the
respective window of parameters. Secondly, open the <em>Scipion</em> browser (<a class="reference internal" href="#model-building-cootini"><span class="std std-numref">Fig. 11.5</span></a> (1)) and
navigate to the <em>extra</em> directory, open the <em>coot.ini</em> text file (2), and modify the file
so it matches the information shown below (3).</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">myvars</span><span class="p">]</span>
<span class="n">imol</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">aa</span> <span class="n">main</span> <span class="n">chain</span><span class="p">:</span> <span class="n">A</span>
<span class="n">aa</span> <span class="n">auxiliary</span> <span class="n">chain</span><span class="p">:</span> <span class="n">AA</span>
<span class="n">aaNumber</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">step</span><span class="p">:</span> <span class="mi">10</span>
</pre></div>
</div>
<div class="figure align-center" id="model-building-cootini">
<a class="reference internal image-reference" href="../../../../_images/cootini.svg"><img alt="Editing coot.ini file." src="../../../../_images/cootini.svg" width="80.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.5 </span><span class="caption-text">Editing coot.ini file.</span><a class="headerlink" href="#model-building-cootini" title="Permalink to this image">¶</a></p>
</div>
<div class="line-block">
<div class="line">Finally, go back to <em>Coot</em> window and press “U” to initiate global variables
and “z” to refine the next upstream 10 residues. Go through those
residues, one by one, and accept refinement if you agree with it. If
you disagree with the refinement of any residue, perform the
interactive refinement, visualizing the residue side chain. Repeat the
refinement process with “z” until the end of the molecule. Check that
the red bar of residue number 53 (<a class="reference internal" href="#model-building-coot-density-fit-analysis"><span class="std std-numref">Fig. 11.3</span></a>) goes missing at the end of this process.</div>
</div>
<div class="line-block">
<div class="line">After this partially automatic and partially interactive processing,
go to <em>Draw -&gt; Go To Atom… -&gt; Chain A -&gt; A 2 VAL (VAL</em> is now the first residue of the <em>metHbg</em> <span class="math">\alpha</span> subunit) and start the detailed interactive refinement of the initial residues of
chain A. To accomplish this interactive refinement of a small group of
5 to 10 residues, select the blue circle in the upper right side menu
and click the initial and final residues of the small group of
residues (<a class="reference internal" href="#model-building-coot-go-to-atom"><span class="std std-numref">Fig. 11.4</span></a> (B)(4)). The group of selected residues gets flexible
enough to look manually for another spatial distribution. Following
these instructions, try to solve the misfit that you can find in <em>TYR</em> 141
residue at the end of the molecule. Specifically, try to improve the
result of the <em>Validate -&gt; Density fit analysis</em>, as you can see from (A) to (B) in <a class="reference internal" href="#model-building-coot-density-fit-analysis2"><span class="std std-numref">Fig. 11.6</span></a>, moving <em>TYR</em> 141
((A)(1)) to the nearest empty map density ((A)(2)). Accept the
refinement parameters after the displacement of <em>TYR</em> ((B)(3)). Finally,
check the <em>Density Fit Graph</em>.</div>
</div>
<div class="figure align-center" id="model-building-coot-density-fit-analysis2">
<a class="reference internal image-reference" href="../../../../_images/Fig28.svg"><img alt="*Coot* fit in the map density of residue *TYR* 141." src="../../../../_images/Fig28.svg" width="85.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.6 </span><span class="caption-text"><em>Coot</em> fit in the map density of residue <em>TYR</em> 141.</span><a class="headerlink" href="#model-building-coot-density-fit-analysis2" title="Permalink to this image">¶</a></p>
</div>
<div class="line-block">
<div class="line">Rotamer refinement is another refinement tool available in <em>Coot</em>. You can
try to improve your current <em>model</em> modifying rotamers reported
as incorrect in <em>Validate -&gt; Rotamer analysis</em>. Otherwise, the next refinement program in modeling
workflow (<em>PHENIX real space refine</em>) will perform rotamer refinement.</div>
</div>
<div class="line-block">
<div class="line">At the end of this interactive refinement with <em>Coot</em>, the refined atomic
structure has to be saved in <em>Scipion</em>. You can save the atomic structure with
its default name/label by pressing <code class="docutils literal notranslate"><span class="pre">w</span></code>. If you want to add a special
label to identify the atomic structure in the <em>Scipion</em> workflow you can save
that label in <em>Coot</em> main menu <em>Calculate -&gt; Scripting -&gt; Python</em> and the <em>Coot Python Scripting</em> window will be opened and you can
write there your label name, for example <em>label1_HBA_HUMAN</em>. This label will appear in
the <em>Summary</em> window of the <em>Scipion</em> framework (<a class="reference internal" href="#model-building-coot-summary"><span class="std std-numref">Fig. 11.7</span></a> (A)). Assuming that <em>#0</em> is your <em>model</em> number,
write in Command:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>scipion write (0, ’label1_HBA_HUMAN’)
</pre></div>
</div>
<div class="figure align-center" id="model-building-coot-summary">
<a class="reference internal image-reference" href="../../../../_images/Fig26.svg"><img alt="A. *Coot Summary* showing label names of each independent saved atomic structure (1, 3: user’s chosen labels; 2: default label). B. (1, 2, 3) Respective atomic structure file names in the *&quot;extra&quot;* folder." src="../../../../_images/Fig26.svg" width="85.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.7 </span><span class="caption-text"><em>A</em>. <em>Coot Summary</em> showing label names of each independent saved atomic structure (1, 3: user’s chosen labels; 2: default label). B. (1, 2, 3) Respective atomic structure file names in the <em>“extra”</em> folder.</span><a class="headerlink" href="#model-building-coot-summary" title="Permalink to this image">¶</a></p>
</div>
<div class="line-block">
<div class="line">In its interactive way, <strong>ccp4-coot refinement</strong> protocol can be launched again whenever you
want in <em>Scipion</em>, and the last atomic structure saved will be loaded in <em>Coot</em>
graphics window. This functionality of <em>Scipion</em> allows to stop the interactive
refinement and continue the process in the last refinement step,
maintaining each one of the intermediate refined structures saved in
order in the <em>Scipion</em> tutorial folder <em>/Runs/000XXX_CootRefine/extra</em> (<a class="reference internal" href="#model-building-coot-summary"><span class="std std-numref">Fig. 11.7</span></a> (B)). Remark that if you want to
continue with the refinement process you have to select the <em>Run mode</em> option <em>Continue</em>
when you edit the <em>Coot</em> refinement protocol. In this way, to go again to
intermediate refined structures is also possible. Finally, when you
reach the final refined structure, save it, and you may press <code class="docutils literal notranslate"><span class="pre">e</span></code> to fully
stop the <em>Coot</em> protocol.</div>
</div>
<div class="line-block">
<div class="line">A similar refinement process to that followed in <em>Coot</em> for <em>metHgb</em> <span class="math">\alpha</span>
subunit chain <em>A</em>, has to be carried out for the <em>metHgb</em> <span class="math">\beta</span> subunit.</div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">NOTE</span></code> about <em>chain IDs</em>: Check the <em>id</em> of each chain. Although you have the possibility of
changing this <em>id</em> in <em>ChimeraX</em>, as we have seen in the subsection <a class="reference external" href="file:///home/marta/software/docs/_build/html/docs/user/tutorials/modelBuilding/070-movingFromSequence.html">Structural
models of human metHgb subunits from templates</a> (<em>metHgb</em> <span class="math">\beta</span>
subunit), you also have the possibility of performing this task in <em>Coot</em>,
as it is shown in the next example in which we change the chain <em>id</em> from <em>A</em>
to <em>B</em>. To change the name of the chain, go to the <em>Coot</em> main menu and select
the option <em>Edit</em> (<a class="reference internal" href="#model-building-chimerax-asymm-unit-2"><span class="std std-numref">Fig. 11.8</span></a> (A)(1)) and then <em>Change chain IDs</em> and select the current name of the chain <em>A</em>
(<a class="reference internal" href="#model-building-chimerax-asymm-unit-2"><span class="std std-numref">Fig. 11.8</span></a> (B)(2)) by the new one, <em>B</em> (3).</div>
</div>
<div class="figure align-center" id="model-building-chimerax-asymm-unit-2">
<a class="reference internal image-reference" href="../../../../_images/Fig74.svg"><img alt="A. *Coot* main menu. B. *Coot* window to change chain IDs." src="../../../../_images/Fig74.svg" width="50.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.8 </span><span class="caption-text"><em>A</em>. <em>Coot</em> main menu. B. <em>Coot</em> window to change chain IDs.</span><a class="headerlink" href="#model-building-chimerax-asymm-unit-2" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="phenix-real-space-refine">
<h2><span class="section-number">11.2. </span><em>PHENIX</em> Real Space Refine<a class="headerlink" href="#phenix-real-space-refine" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">In order to compare the previous <em>Coot</em> interactive refinement with an
automatic refinement, we are going to use the <strong>phenix-real space refine</strong> protocol in parallel, as
indicated in <a class="reference internal" href="#model-building-scipion-workflow-flexiblefit"><span class="std std-numref">Fig. 11.1</span></a> (1). In addition, we can assess if the automatic refinement obtained with the protocol <strong>phenix-real space refine</strong> is able to complement and
improve the result of the <em>Coot</em> manual refinement (<a class="reference internal" href="#model-building-scipion-workflow-flexiblefit"><span class="std std-numref">Fig. 11.1</span></a> (2)). Protocol <strong>phenix-real space refine</strong>
implements in <em>Scipion</em> the <em>phenix.real_space_refine</em> program developed to address cryo-EM
structure-refinement requirements. Following a workflow similar to the <em>PHENIX</em>
reciprocal-space refinement program <em>phenix.refine</em>, basically devoted to
crystallography, <em>phenix.real_space_refine</em> program, mainly used in cryo-EM, is able to refine in
real space atomic models against maps, which are the experimental
data.</div>
</div>
<div class="line-block">
<div class="line">Start working by opening <strong>phenix-real space refine</strong> protocol (<a class="reference internal" href="#model-building-phenix-real-space-refine-protocol"><span class="std std-numref">Fig. 11.9</span></a> (1)), load as input volume the map
asymmetric unit saved in <em>Coot</em> that you consider the most optimized one (2,
the <span class="math">deepEMhancer</span> sharpened map in this case), write the volume
resolution (3), and load the atomic structure (<em>model Hgb_alpha_atom_struct_3_007124</em> in the
case 1 of <a class="reference internal" href="#model-building-scipion-workflow-flexiblefit"><span class="std std-numref">Fig. 11.1</span></a> or <em>model new_label_HBA_HUMAN</em> in the case 2 (4)). After executing the
protocol (6), results can be checked (7). Try to compare the <em>MolProbity statistics</em> that you
can see in the <em>Summary</em> of the <em>Scipion</em> framework after changing the <em>Advanced</em> parameter <em>Local grid search</em> (5) from <em>Yes</em>
to <em>No</em> (default value).</div>
</div>
<div class="figure align-center" id="model-building-phenix-real-space-refine-protocol">
<a class="reference internal image-reference" href="../../../../_images/Fig29.svg"><img alt="Completing *PHENIX* Real Space Refine protocol (Case 2 of :numref:`model_building_scipion_workflow_flexiblefit`)." src="../../../../_images/Fig29.svg" width="100.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.9 </span><span class="caption-text">Completing <em>PHENIX</em> Real Space Refine protocol (Case 2 of <a class="reference internal" href="#model-building-scipion-workflow-flexiblefit"><span class="std std-numref">Fig. 11.1</span></a>).</span><a class="headerlink" href="#model-building-phenix-real-space-refine-protocol" title="Permalink to this image">¶</a></p>
</div>
<p>The first tab of results shows the initial <em>model</em> atomic
structure (<a class="reference internal" href="#model-building-phenix-real-space-refine-chimera"><span class="std std-numref">Fig. 11.10</span></a> (pink)) as well as the refined one (green), both fitted to
the normalized map asymmetric unit saved in <em>Coot</em>.</p>
<div class="figure align-center" id="model-building-phenix-real-space-refine-chimera">
<a class="reference internal image-reference" href="../../../../_images/Fig30.svg"><img alt="*ChimeraX* visualization of refined *model* of *metHgb* :math:`\alpha` subunit by *PHENIX* Real Space Refine protocol (Case 2 of :numref:`model_building_scipion_workflow_flexiblefit`)." src="../../../../_images/Fig30.svg" width="65.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.10 </span><span class="caption-text"><em>ChimeraX</em> visualization of refined <em>model</em> of <em>metHgb</em> <span class="math">\alpha</span> subunit by <em>PHENIX</em> Real Space Refine protocol (Case 2 of <a class="reference internal" href="#model-building-scipion-workflow-flexiblefit"><span class="std std-numref">Fig. 11.1</span></a>).</span><a class="headerlink" href="#model-building-phenix-real-space-refine-chimera" title="Permalink to this image">¶</a></p>
</div>
<div class="line-block">
<div class="line">The rest of tabs detail different statistics useful to compare the
quality of distinct <span class="math">models</span> such as <span class="math">MolProbity</span>
statistics and <em>Real-space</em> correlations. <span class="math">MolProbity</span> results will be
discussed in the next section of validation and comparison. Regarding <em>Real-space</em>
correlations, different <em>models</em> can be compared by using the
global number of <em>CC(mask)</em>, which indicates the correlation <em>model</em>-to-<em>map</em> calculated considering the map region
masked around the <em>model</em>. You can check also individual
correlation values for each residue. Remark that residues with lower
correlation values might be susceptible to improve by additional
refinement in <em>Coot</em>. Have a look to those correlation values in the case 1 of Fig. <a class="reference internal" href="#model-building-scipion-workflow-flexiblefit"><span class="std std-numref">Fig. 11.1</span></a>
and answer the following questions: (Answers in appendix <a class="reference internal" href="a010-answers.html#app-solutions"><span class="std std-ref">Solutions</span></a>;
<strong>Question</strong><a class="reference external" href="refinementFlexibleFitting">1</a><strong>_1</strong>)</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-  What is the *CC(mask)* value?

-  Which one is the residue that shows the lower correlation value?
   Why?

-  What is that correlation value?

-  Which one is the second residue that shows the lower correlation
   value? Why?

-  What is that correlation value?

-  What is the correlation value of *HEME* group?
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">Now, compare these results with those obtained in the case 2 of <a class="reference internal" href="#model-building-scipion-workflow-flexiblefit"><span class="std std-numref">Fig. 11.1</span></a>, in
which we have run <em>PHENIX real space refine</em> after <em>Coot</em>. Have the above values of correlation
changed? (Answer in appendix <a class="reference internal" href="a010-answers.html#app-solutions"><span class="std std-ref">Solutions</span></a>; <strong>Question</strong><a class="reference external" href="refinementFlexibleFitting">1</a><strong>_2</strong>)</div>
</div>
<div class="line-block">
<div class="line">The conclusion of this part of refinement in real space is that <em>Coot</em> and <em>PHENIX real space refine</em>
might perform complementary tasks. The usage of both protocols may
improve the result, especially when partial processing or big
rearrangements of molecules are involved.</div>
</div>
<div class="line-block">
<div class="line">Before finishing our refinement workflow with <em>Refmac</em>, we can ask ourselves
how we can improve correlations in real space by modifying the <em>Advanced</em>
parameters in the protocol form. Will the correlation values change if
we set to “yes” optimization parameters previously set to “no”, and
increase the number of macro cycles from 5 to 30? Take into account
that this process takes much more time (around 6 times more) than the
previous one. (Answer in appendix <a class="reference internal" href="a010-answers.html#app-solutions"><span class="std std-ref">Solutions</span></a>; <strong>Question</strong><a class="reference external" href="refinementFlexibleFitting">1</a><strong>_3</strong>)</div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">NOTE:</span></code> An interesting application of the <em>PHENIX real space refine</em> visualization tools is the
possibility of load <em>Coot</em> from the <em>PHENIX</em> viewer and correct the structure of
outliers residues and clashes. A recurively use of <em>PHENIX real space refine</em> and <em>Coot</em> protocols is
thus possible.</div>
</div>
</div>
<div class="section" id="phenix-search-fit">
<h2><span class="section-number">11.3. </span><em>PHENIX</em> Search Fit<a class="headerlink" href="#phenix-search-fit" title="Permalink to this headline">¶</a></h2>
<p>An extension of <em>PHENIX</em> Real Space Refine is <strong>phenix-search fit</strong>, a protocol implemented in <em>Scipion</em> to fit
a small sequence of residues in a certain density of the map and,
afterwards, perform the subsequent refinement in the real space
(Appendix <a class="reference internal" href="a161-searcFitProtocol.html#app-searchfit"><span class="std std-ref">Search fit</span></a>). Let us to illustrate
the applicability of this protocol with the workflow described in the <a class="reference internal" href="#model-building-phenix-search-fit-1"><span class="std std-numref">Fig. 11.11</span></a>.</p>
<div class="figure align-center" id="model-building-phenix-search-fit-1">
<a class="reference internal image-reference" href="../../../../_images/Fig_search_fit_1.svg"><img alt="*Scipion* workflow including the **phenix-search fit** protocol." src="../../../../_images/Fig_search_fit_1.svg" width="65.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.11 </span><span class="caption-text"><em>Scipion</em> workflow including the <strong>phenix-search fit</strong> protocol.</span><a class="headerlink" href="#model-building-phenix-search-fit-1" title="Permalink to this image">¶</a></p>
</div>
<p>This example shows a small fraction of residues from the <em>metHgb</em> <span class="math">\alpha</span>
subunit that was not completely modeled, except for the skeleton of
<span class="math">\alpha</span> carbons. The sequence of the chain is perfectly known,
but for certain residues we were unable of tracing the lateral side
chains of those residues and only <em>ALA</em> residues appear in our atomic
structure. A detail of the small fragment of <em>ALA</em> residues can be observed in
the <a class="reference internal" href="#model-building-phenix-search-fit-2"><span class="std std-numref">Fig. 11.12</span></a> (red arrows). The protocol <strong>phenix-search fit</strong> might help us to replace the <em>ALA</em> residues by
the appropriate aminoacids.</p>
<div class="figure align-center" id="model-building-phenix-search-fit-2">
<a class="reference internal image-reference" href="../../../../_images/Fig_search_fit_2.svg"><img alt="Fragment of *ALA* residues fitted in the human *metHgb* asymmetric unit, as can be visualized in the protocol *ChimeraX rigid fit*(:numref:`model_building_phenix_search_fit_1` (2))." src="../../../../_images/Fig_search_fit_2.svg" width="65.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.12 </span><span class="caption-text">Fragment of <em>ALA</em> residues fitted in the human <em>metHgb</em> asymmetric unit, as can be visualized in the protocol <em>ChimeraX rigid fit</em> (<a class="reference internal" href="#model-building-phenix-search-fit-1"><span class="std std-numref">Fig. 11.11</span></a> (2)).</span><a class="headerlink" href="#model-building-phenix-search-fit-2" title="Permalink to this image">¶</a></p>
</div>
<p>As the <a class="reference internal" href="#model-building-phenix-search-fit-1"><span class="std std-numref">Fig. 11.11</span></a> indicates, the protocol <strong>phenix-search fit</strong> (4) requires three different inputs (1, 2 and 3):</p>
<ol class="arabic">
<li><p>Initial map that contains the density of the <em>metHgb</em> <span class="math">\alpha</span> subunit.
In this case we use the asymmetric unit map extracted previously (subsection <a class="reference external" href="file:///home/marta/software/docs/_build/html/docs/user/tutorials/modelBuilding/050-volumeScenario.html">Extraction of the asymmetric unit map</a>, <a class="reference internal" href="050-volumeScenario.html#model-building-extract-unit-cell"><span class="std std-numref">Fig. 7.12</span></a>).</p></li>
<li><div class="line-block">
<div class="line">Small fragment of atomic structure that contains the <em>ALA</em> small chain.
To create this fragment we start from the published atomic
structure of the human <em>metHgb</em> <span class="math">\alpha</span> subunit (included in the
model of the <em>PDB</em> ID <em>5NI1</em>, which can be downloaded from the database using
the protocol <strong>import atomic structure</strong>. Next, we use the protocol <strong>chimerax-operate</strong> to isolate the chain <em>A</em> of
the structure. The atomic structure <em>5NI1</em> is the only one input of the
protocol <strong>chimerax-operate</strong>. After the opening of <em>ChimeraX</em>, write in the command line:</div>
</div>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sel</span> <span class="mi">2</span> <span class="o">&amp;</span> <span class="o">~</span> <span class="c1">#2/A</span>
<span class="k">del</span> <span class="n">sel</span>
<span class="n">scipionwrite</span> <span class="c1">#2 prefix 5ni1_chainA_</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line">After saving the chain <em>A</em> of the atomic structure <em>5NI1</em>, run the protocol <strong>phenix-dock in map</strong>
(<a class="reference internal" href="080-rigidFit.html#model-building-dockinmap-protocol"><span class="std std-numref">Fig. 10.2</span></a>) to fit the chain <em>A</em> from the atomic structure 5NI1 in the <em>metHgb</em> asymmetric unit map density. Next, open again the protocol <strong>chimerax-rigid fit</strong> (<a class="reference internal" href="080-rigidFit.html#model-building-chimera-rigid-fit"><span class="std std-numref">Fig. 10.4</span></a>)
and, following the previous instructions and the next <em>ChimeraX</em> command
lines, finish the fitting, mutate the sequence between residues 94
and 118 to generate the <em>ALA</em> chain, and finally save the small mutated
fragment:</div>
</div>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fitmap</span> <span class="c1">#3 inMap #2</span>
<span class="n">scipionwrite</span> <span class="c1">#3 prefix 5ni1 chainA_fitted_</span>
<span class="n">select</span> <span class="c1">#3 &amp; ~ #3/A:94-118</span>
<span class="k">del</span> <span class="n">sel</span>
<span class="n">swapaa</span> <span class="c1">#3/A:94-118 ALA</span>
<span class="n">scipionwrite</span> <span class="c1">#3 prefix 5ni1_chainA_94_118_MutALA_</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Sequence of the <em>metHgb</em> <span class="math">\alpha</span> subunit imported previously in subsection <a class="reference external" href="file:///home/marta/software/docs/_build/html/docs/user/tutorials/modelBuilding/040-importInputData.html">Sequences</a> (<a class="reference internal" href="040-importInputData.html#model-building-import-sequence"><span class="std std-numref">Fig. 6.4</span></a>).</p></li>
</ol>
<p>With these three previous inputs we can complete the <strong>phenix-search fit</strong> protocol form (<a class="reference internal" href="#model-building-phenix-search-fit-3"><span class="std std-numref">Fig. 11.13</span></a>).
Open it in the <em>Scipion</em> left menu (1) and include the asymmetric unit map (2)
detailing its resolution (3), as well as the small fragment of mutated
structure previously saved (4), the sequence downloaded (5) and take
advantage of the two wizards on the right (6 and 7) to select the
initial and final residues that delimite the sequence to search.</p>
<div class="figure align-center" id="model-building-phenix-search-fit-3">
<a class="reference internal image-reference" href="../../../../_images/Fig_search_fit_3.svg"><img alt="Completing the **phenix-search fit** protocol in *Scipion*." src="../../../../_images/Fig_search_fit_3.svg" width="95.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.13 </span><span class="caption-text">Completing the <strong>phenix-search fit</strong> protocol in <em>Scipion</em>.</span><a class="headerlink" href="#model-building-phenix-search-fit-3" title="Permalink to this image">¶</a></p>
</div>
<p>After executing the <strong>phenix-search fit</strong> protocol (<a class="reference internal" href="#model-building-phenix-search-fit-3"><span class="std std-numref">Fig. 11.13</span></a> (8)) we can have a look to the results. By
pressing <em>Analyze Results</em> (<a class="reference internal" href="#model-building-phenix-search-fit-3"><span class="std std-numref">Fig. 11.13</span></a> (9)) a window with the Viewer menu is opened (<a class="reference internal" href="#model-building-phenix-search-fit-4"><span class="std std-numref">Fig. 11.14</span></a> (A)). This menu
allows to visualize a certain number of atomic structures, according to
their ranking scores, with lateral side chains fitted in the map density
(1). Those structures will be opened in <em>ChimeraX</em> (2) surrounded by the density
located at 3.0 Å of the structure (3). The number <em>1000</em> shown by default in (1)
allows displaying all atomic structures. By pressing <em>Summary Plot</em> (4) a pop up window
will open and show the score values of each structure, as well as the
average and standard deviation of those values (<a class="reference internal" href="#model-building-phenix-search-fit-4"><span class="std std-numref">Fig. 11.14</span></a> (B)). If we select the
visualization of a certain number of atomic structures, 5 for example,
as points the red arrow in <a class="reference internal" href="#model-building-phenix-search-fit-4"><span class="std std-numref">Fig. 11.14</span></a> (C), the five best score values will appear
remarked in red in the <em>Summary Plot</em>.</p>
<div class="figure align-center" id="model-building-phenix-search-fit-4">
<a class="reference internal image-reference" href="../../../../_images/Fig_search_fit_4.svg"><img alt="Visualization of **phenix-search fit** protocol results in *Scipion*. A. Results menu. B. Map-model fit score plot (total number of atomic structures). C. Upper part of the Map-model fit score plot (5 best atomic structures). D. Model panel in *ChimeraX* showing the 5 best atomic structures selected. E. Models 3 to 8 displayed inside the map density. F. Models *#3* and *#4*. G. Model *#4* compared with the same fragment of the atomic structure *5NI1*." src="../../../../_images/Fig_search_fit_4.svg" width="85.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.14 </span><span class="caption-text">Visualization of <strong>phenix-search fit</strong> protocol results in <em>Scipion</em>. A. Results menu. B. Map-model fit score plot (total number of atomic structures). C. Upper part of the Map-model fit score plot (5 best atomic structures). D. Model panel in <em>ChimeraX</em> showing the 5 best atomic structures selected. E. Models 3 to 8 displayed inside the map density. F. Models <em>#3</em> and <em>#4</em>. G. Model <em>#4</em> compared with the same fragment of the atomic structure <em>5NI1</em>.</span><a class="headerlink" href="#model-building-phenix-search-fit-4" title="Permalink to this image">¶</a></p>
</div>
<div class="line-block">
<div class="line">Panel D of the <a class="reference internal" href="#model-building-phenix-search-fit-4"><span class="std std-numref">Fig. 11.14</span></a> shows the model panel with the five best selected
structures, <em>4, 9, 11, 20</em> and <em>23</em>. The red arrow points the position of these
indexes. The respective score values are observed in red in <a class="reference internal" href="#model-building-phenix-search-fit-4"><span class="std std-numref">Fig. 11.14</span></a> (C). <a class="reference internal" href="#model-building-phenix-search-fit-4"><span class="std std-numref">Fig. 11.14</span></a> (E)
details the view of the five structures in the GUI of <em>ChimeraX</em> (models <em>#4</em> to <em>#8</em>), as
well as the input fragment of <em>ALA</em> (model <em>#3</em>). Remark that lateral side
chains are not shown by default. <a class="reference internal" href="#model-building-phenix-search-fit-4"><span class="std std-numref">Fig. 11.14</span></a> (F) compares this input model <em>#3</em> with
the best score structure (model <em>#4</em>). To display the lateral side chains
select each model and press “Show” in “Atoms” section of the toolbar.
In the same way, <a class="reference internal" href="#model-building-phenix-search-fit-4"><span class="std std-numref">Fig. 11.14</span></a> (F) compares this input model <em>#3</em> with the respective
fragment of the <em>PDB ID 5NI1</em> structure. To open it as model <em>#9</em> and align it with
rest of structures, write in <em>ChimeraX</em> comand line:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">open</span> <span class="mi">5</span><span class="n">ni1</span>
<span class="n">select</span> <span class="c1">#9 &amp; ~ #9/A:94-118</span>
<span class="k">del</span> <span class="n">sel</span>
<span class="n">mmaker</span> <span class="c1">#9 to #4</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">In spite of some small differences, most of lateral side chains align
quite well with the ones of the model <em>5NI1</em> traced on the experimental map.
Then, the best approximation of the atomic structure retrieved (model <em>#4</em>) can be selected to help with the tracing of a small fraction of the density map since the model <em>#4</em> seems to be quite close to the actual
atomic structure used as control (<em>PDB ID 5NI1</em>).</div>
</div>
</div>
<div class="section" id="ccp4-refmac">
<h2><span class="section-number">11.4. </span><em>CCP4 Refmac</em><a class="headerlink" href="#ccp4-refmac" title="Permalink to this headline">¶</a></h2>
<p>As in the case of <em>Coot</em>, <em>Refmac</em> (from maximum-likelihood Refinement of
Macromolecules) was initially developed to optimize models obtained by
X-ray crystallography methods but, unlike <em>Coot</em>, automatically and in
reciprocal space. The <em>models</em> refined in the real space with <em>Coot</em> and
<em>PHENIX real space refine</em>, successively, will be used as inputs to perform a second refinement
step in the Fourier space with <em>Refmac</em> protocol <strong>ccp4-refmac</strong>. Firstly, open the <em>Refmac</em> protocol
form (<a class="reference internal" href="#model-building-refmac-protocol"><span class="std std-numref">Fig. 11.15</span></a> (1)), load the volume generated by <em>Coot</em> (2), the atomic structure
obtained with <em>Coot</em> (case 3 of <a class="reference internal" href="#model-building-scipion-workflow-flexiblefit"><span class="std std-numref">Fig. 11.1</span></a>) (3) or with <em>PHENIX real space refine</em> after <em>Coot</em> (case 4 of <a class="reference internal" href="#model-building-scipion-workflow-flexiblefit"><span class="std std-numref">Fig. 11.1</span></a>), and the
volume resolution as maximum resolution (4). Execute the protocol (5)
and when it finishes, analyze the results (6).</p>
<div class="figure align-center" id="model-building-refmac-protocol">
<a class="reference internal image-reference" href="../../../../_images/Fig31.svg"><img alt="Filling in *Refmac* protocol (Case 3 of :numref:`model_building_scipion_workflow_flexiblefit`)." src="../../../../_images/Fig31.svg" width="100.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.15 </span><span class="caption-text">Filling in <em>Refmac</em> protocol (Case 3 of <a class="reference internal" href="#model-building-scipion-workflow-flexiblefit"><span class="std std-numref">Fig. 11.1</span></a>).</span><a class="headerlink" href="#model-building-refmac-protocol" title="Permalink to this image">¶</a></p>
</div>
<p>Clicking the first item in the display menu of results (<a class="reference internal" href="#model-building-refmac-display-results"><span class="std std-numref">Fig. 11.16</span></a> (1)), <em>ChimeraX</em> graphics
window will be opened showing the input volume, the initial <em>model (new_label_HBA_HUMAN)</em> obtained with <em>Coot</em> (<a class="reference internal" href="#model-building-refmac-chimera"><span class="std std-numref">Fig. 11.17</span></a>, pink), and the final <em>Refmac</em> refined <em>model</em> (<a class="reference internal" href="#model-building-refmac-chimera"><span class="std std-numref">Fig. 11.17</span></a>, green). By clicking the third item in the display menu
of results (<a class="reference internal" href="#model-building-refmac-display-results"><span class="std std-numref">Fig. 11.16</span></a> (2)), a summary of results are shown. Check if values of <em>R factor</em>
and <em>Rms BondLength</em> have improved with this refinement process in these three cases:</p>
<ul>
<li><div class="line-block">
<div class="line">Running <em>Refmac</em> after <em>Coot</em>:</div>
<div class="line">Can you see an improvement running <em>Refmac</em> immediately after <em>Coot</em>, thus
ignoring <em>model</em> improvements generated by <strong>phenix-real space refine</strong>? (Answers in
appendix <a class="reference internal" href="a010-answers.html#app-solutions"><span class="std std-ref">Solutions</span></a>; <strong>Question</strong><a class="reference external" href="refinementFlexibleFitting">1</a><strong>_4</strong>)</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Running <em>Refmac</em> after <strong>phenix-real space refine</strong> after <em>Coot</em>:</div>
<div class="line">Why the improvement seems to be very small? (Answers in appendix <a class="reference internal" href="a010-answers.html#app-solutions"><span class="std std-ref">Solutions</span></a>; <strong>Question</strong><a class="reference external" href="refinementFlexibleFitting">1</a><strong>_5</strong>)</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Running <em>Refmac</em> after <strong>phenix-real space refine</strong> without a mask:</div>
<div class="line">Compare previous <em>Refmac</em> results (after <em>Coot</em> and <strong>phenix-real space refine</strong>) with those obtained selecting
the option <em>No</em> in the protocol form parameter <em>Generate masked volume</em>. Use two different
volumes, the one generated by <em>Coot</em> protocol, and the one generated by
the <em>extract asymmetric unit</em> protocol. Are there any differences? Why? (Answers in appendix <a class="reference internal" href="a010-answers.html#app-solutions"><span class="std std-ref">Solutions</span></a>; <strong>Question</strong><a class="reference external" href="refinementFlexibleFitting">1</a><strong>_6</strong>)</div>
</div>
</li>
</ul>
<div class="figure align-center" id="model-building-refmac-display-results">
<a class="reference internal image-reference" href="../../../../_images/Fig32.svg"><img alt="Display menu of *Refmac* results." src="../../../../_images/Fig32.svg" width="65.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.16 </span><span class="caption-text">Display menu of <em>Refmac</em> results.</span><a class="headerlink" href="#model-building-refmac-display-results" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-center" id="model-building-refmac-chimera">
<a class="reference internal image-reference" href="../../../../_images/Fig33.svg"><img alt="*ChimeraX* visualization of refined *model* of *metHgb* :math:`\alpha` subunit by *Refmac* (Case 3 of :numref:`model_building_scipion_workflow_flexiblefit`)." src="../../../../_images/Fig33.svg" width="50.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.17 </span><span class="caption-text"><em>ChimeraX</em> visualization of refined <em>model</em> of <em>metHgb</em> <span class="math">\alpha</span> subunit by <em>Refmac</em> (Case 3 of <a class="reference internal" href="#model-building-scipion-workflow-flexiblefit"><span class="std std-numref">Fig. 11.1</span></a>).</span><a class="headerlink" href="#model-building-refmac-chimera" title="Permalink to this image">¶</a></p>
</div>
<p>Have a look to the rest of items in the display window of results.</p>
</div>
<div class="section" id="the-best-refinement-workflow">
<h2><span class="section-number">11.5. </span>The best refinement workflow<a class="headerlink" href="#the-best-refinement-workflow" title="Permalink to this headline">¶</a></h2>
<p>At this point we wonder about the optimal steps to follow in the
refinement process. Should we have to use <em>Coot</em> first, then <em>PHENIX</em>, then <em>Refmac</em>?, or
maybe, with a different <em>map</em> and <em>model</em>, should we start with the automatic
refinement and then go to the interactive one? The right answer is that there
is no a unique answer. The strategies and the number of steps of
refinement might differ and the only requirement is that the next step
in refinement should generate a better structure than the previous one.
This premise requires to apply common validation criteria to assess the
progressive improvement of our <em>model</em>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="100-validation.html" class="btn btn-neutral float-right" title="12. Structure validation and comparison" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="080-rigidFit.html" class="btn btn-neutral float-left" title="10. Merging 3D Maps and Atomic Structures: Rigid Fitting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: release-3.0.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../../../gh-pages/index.html">gh-pages</a></dd>
            <dd><a href="../../../../../release-2.0.0/index.html">release-2.0.0</a></dd>
            <dd><a href="090-flexibleFit.html">release-3.0.0</a></dd>
            <dd><a href="../../../../../rm_model_building/docs/user/tutorials/modelBuilding/090-flexibleFit.html">rm_model_building</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>