<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>11. DeepEMhancer Sharpening protocol &mdash; Scipion 3.0.0 documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="12. Extract asymmetric unit protocol" href="a070-extractUnitCell.html" />
    <link rel="prev" title="10. Create 3D Mask protocol" href="a061-create3DMask.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../../index.html" class="icon icon-home"> Scipion
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../scipion-modes/how-to-install.html">Installing Scipion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html#image-processing-resources">Image processing resources</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../user-documentation.html#tutorials">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../user-documentation.html#single-particle-tutorials">Single particle tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-documentation.html#tomography-tutorials">Tomography tutorials</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../user-documentation.html#model-building">Model Building</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Model Building by Homology</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="index.html#contents">Contents</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html#appendices">Appendices</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../Alphafold/index.html">Build initial model with Alphafold</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ModelAngelo/index.html">Build initial model with ModelAngelo</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../facilities/facilities.html">On-the-fly processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../facilities/customize-report.html">Summary Reports</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/scipion-API.html">Scipion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/plugins-API.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/xmipp-API.html">Xmipp API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc/contact-us.html">Contact Us</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Licences</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">Licenses</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Scipion</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../user-documentation.html">Graphical interface manuals</a> &raquo;</li>
          <li><a href="index.html">Model Building Tutorial</a> &raquo;</li>
      <li><span class="section-number">11. </span>DeepEMhancer Sharpening protocol</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/docs/user/tutorials/modelBuilding/Homology/a062-deepEMhancerSharpening.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="deepemhancer-sharpening-protocol">
<span id="app-deepemhancersharpening"></span><h1><span class="section-number">11. </span>DeepEMhancer Sharpening protocol<a class="headerlink" href="#deepemhancer-sharpening-protocol" title="Permalink to this heading"></a></h1>
<p>Protocol designed to apply <span class="math">DeepEMhancer</span>, the automatic map
postprocessing method that sharpens and masks part of the noise at
medium/high resolution <span id="id1">[<a class="reference internal" href="z010-references.html#id6" title="R Sanchez-Garcia, J Gomez-Blanco, A Cuervo, JM Carazo, COS Sorzano, and J Vargas. Deepemhancer: a deep learning solution for cryo-em volume post-processing. bioRxiv, 2020. URL: https://www.biorxiv.org/content/early/2020/08/17/2020.06.12.148296, arXiv:https://www.biorxiv.org/content/early/2020/08/17/2020.06.12.148296.full.pdf, doi:10.1101/2020.06.12.148296.">Sanchez-Garcia <em>et al.</em>, 2020</a>]</span>, in <em>Scipion</em>. Detailed
information of this method can be also obtained <a class="reference external" href="https://github.com/rsanchezgarc/deepEMhancer">here</a>.</p>
<ul>
<li><div class="line-block">
<div class="line">Requirements to run this protocol and visualize results:</div>
</div>
<ul>
<li><div class="line-block">
<div class="line"><em>Scipion</em> plugin: <strong>scipion-em</strong></div>
</div>
</li>
<li><div class="line-block">
<div class="line"><em>Scipion</em> plugin: <strong>scipion-em-xmipp</strong></div>
</div>
</li>
<li><div class="line-block">
<div class="line"><em>Scipion</em> plugin: <strong>scipion-em-chimera</strong></div>
</div>
</li>
</ul>
</li>
<li><div class="line-block">
<div class="line"><em>Scipion</em> menu:</div>
<div class="line"><em>Model building -&gt; Preprocess map</em> (<a class="reference internal" href="#model-building-app-deepemhancer-1"><span class="std std-numref">Fig. 11.18</span></a> (A))</div>
</div>
<div class="figure align-center" id="model-building-app-deepemhancer-1">
<a class="reference internal image-reference" href="../../../../../_images/Fig303.svg"><img alt="Protocol **xmipp3-deepEMhancer**. A: Protocol location in *Scipion* menu. B: Protocol form." src="../../../../../_images/Fig303.svg" width="90.0%" /></a>
<p class="caption"><span class="caption-number">Fig. 11.18 </span><span class="caption-text">Protocol <strong>xmipp3-deepEMhancer</strong>. A: Protocol location in <em>Scipion</em> menu. B: Protocol form.</span><a class="headerlink" href="#model-building-app-deepemhancer-1" title="Permalink to this image"></a></p>
</div>
</li>
<li><div class="line-block">
<div class="line">Protocol form parameters (<a class="reference internal" href="#model-building-app-deepemhancer-1"><span class="std std-numref">Fig. 11.18</span></a> (B)):</div>
</div>
<ul>
<li><div class="line-block">
<div class="line"><em>Would you like to use half maps?</em>: Although the result will be the same if you decide to use half maps or a non-sharpened non-masked map, a way to ensure that you have selected the right input map is providing half maps. Then, using half maps is the preferred option over a non-sharpened non-masked map. In addition, the algorithm has been trained with half maps. The first step performed by the protocol is to compute the average map. Then, select <em>Yes</em> whenever you can provide half maps, otherwise be sure you have the right average map, usually generated during the reconstruction process (map refinement). However, the algorithm does not work correctly using post-processed maps. So try to not use postprocessed maps. Since the two half maps can be obtained directly as independent maps or being associated to the average map, if you select <em>Yes</em> a new question will appear:</div>
</div>
<ul>
<li><div class="line-block">
<div class="line"><em>Are the half maps included in the volume?</em>: Select <em>Yes</em> if your input average map has the two half maps associated. If this is the case, complete the next form param. Otherwise, you should provide both half maps as independent preexisting objects. To add those half maps a couple of form params will apper to fill in with each half map:</div>
</div>
<ul>
<li><div class="line-block">
<div class="line"><em>Volume Half 1</em></div>
</div>
</li>
<li><div class="line-block">
<div class="line"><em>Volume Half 2</em></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><div class="line-block">
<div class="line"><em>Input Volume</em>: Unsharpened unmasked electron density map previously downloaded or generated in <em>Scipion</em>.</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><em>Input normalization</em>: We need apply normalization to accomodate the intensity values of the map to the specific range of values of the trained neural network. Three possible normalization methods are suggested:</div>
</div>
<ul>
<li><div class="line-block">
<div class="line"><em>Automatic normalization</em>: Default normalization mode that forces the noise average to be zero and the standard deviation 0.1 in an spheric shell around the specimen. Since then noise always displays a similar distribution, the network gets easier to distinguish noise from signal. This method usually works correctly in almost any case. Exceptions could be very long specimens (fiber proteins) or those having big empty spaces (big viruses).</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><em>Normalization from statistics</em>: Similar to the first one, though in this case users provide their own statistics of the noise (average and standard deviation). Using <em>ChimeraX</em> could be a good option to compute statistics of the noise such as min and max values, mean, standard deviation from the mean (SD) and root-mean-square deviation from zero (RMS) (<em>Chimera</em> command line <code class="docutils literal notranslate"><span class="pre">measure</span> <span class="pre">mapstats</span></code> with the option <code class="docutils literal notranslate"><span class="pre">subregion</span></code> as indicated in <a class="reference external" href="https://www.cgl.ucsf.edu/chimerax/docs/user/commands/measure.html#mapstats">CHIMERAX commands</a>.</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><em>Normalization from binary mask</em>: Select this option only if your input map is a masked map, which otherwise is not recomendable when this algorithm is used. The binary mask assigns 1 to the specimen and 0 to the remaining density.</div>
</div>
</li>
</ul>
</li>
<li><div class="line-block">
<div class="line"><em>Model power</em>: Deep learning model to use, three options are available:</div>
</div>
<ul>
<li><div class="line-block">
<div class="line"><em>tight target</em>: This default model is a equidistant balanced solution that works properly for maps that show resolution areas between 3.8 and 6 Å (wide range of resolution values).</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><em>highRes</em>: This model allows a deep sharpening and it is recommended for high resolution maps (lower than 4 Å).</div>
</div>
<div class="line-block">
<div class="line">(<code class="docutils literal notranslate"><span class="pre">NOTE:</span></code> In case your map shows a high heterogeneity with parts of high resolution, as well as areas of low resolution, using <em>tight target</em> and <em>highRes</em> is recommendable, studying which areas are better sharpened by each model).</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><em>wide target</em>: This is the most conservative model. It is recommended when you have areas in which signal and noise are almost identical. Whereas <em>tight target</em> and <em>highRes</em> might delete those regions considering them only noise, <em>wide target</em> will surely preserve them.</div>
</div>
</li>
</ul>
</li>
<li><div class="line-block">
<div class="line"><em>Remove small CC after processing</em>: Advanced param that improves the sharpening result by removing small connected components (usually noise). The default value of this param is <em>No</em> because the improvement usually does not make up for the additional time and computational resources invested.</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><em>Batch size</em>: Since <span class="math">DeepEMhancer</span> processes maps by dividing them in portions or smaller cubes that will be sent to GPUs, the value of batch size indicates the number of cubes that GPUs can simoultaneously process. Increase or reduce the default number according to the performance of the GPUs.</div>
</div>
</li>
</ul>
</li>
<li><div class="line-block">
<div class="line">Protocol execution:</div>
</div>
<div class="line-block">
<div class="line">Adding specific map/structure label is recommended in <em>Run name</em>
section, at the form top. To add the label, open the protocol form,
press the pencil symbol at the right side of <em>Run name</em> box,
complete the label in the new opened window, press OK and, finally,
close the protocol. This label will be shown in the output summary
content (see below). If you want to run again this protocol, do not
forget to set to <em>Restart</em> the <em>Run mode</em>.</div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">REMARK:</span></code> In this case you have the option <em>GPU IDs</em> that you have
to complete according to your GPU core indexes.</div>
</div>
<div class="line-block">
<div class="line">Press the <em>Execute</em> red button at the form bottom.</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Visualization of protocol results:</div>
</div>
<div class="line-block">
<div class="line">After executing the protocol, press <em>Analyze Results</em> and <em>ChimeraX</em> graphics
window will be opened by default. Both the input map(s) and the
sharpened map generated by <span class="math">DeepEMhancer</span>
(<em>deepPostProcess.mrc</em>) are referred to the origin of coordinates
in <em>ChimeraX</em>. To show the relative position of atomic structure and electron
density volume, the three coordinate axes are represented; X axis
(red), Y axis (yellow), and Z axis (blue). Coordinate axes, input
volume, and sharpened map are model numbers <em>#1</em>, <em>#2</em> , and <em>#3</em>,
respectively, in <em>ChimeraX Model Panel</em>. In case that half maps have been
included, the respective additional model numbers will be applied.</div>
</div>
<div class="line-block">
<div class="line">The possibility of visualizing the sharpened map by slices with <a class="reference external" href="../../../user/showJ">ShowJ</a> is also opened as commonly in <em>Scipion</em>, selecting in the <em>Output</em> of the <em>Summary</em> box, black arrow <em>xmipp3 - deepEMhancer -&gt; Volume</em>, the right mouse option <em>Open with DataViewer</em>.</div>
</div>
</li>
<li><p>Summary content:</p>
<ul>
<li><div class="line-block">
<div class="line">Protocol output (below <em>Scipion</em> framework):</div>
<div class="line"><em>xmipp3 - deepEMhancer -&gt; Volume</em>;</div>
<div class="line">Volume (x, y, and z dimensions, sampling rate).</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><em>SUMMARY</em> box:</div>
<div class="line"><em>Input</em>: type of map</div>
<div class="line"><em>Normalization</em>: normalization method.</div>
</div>
</li>
</ul>
</li>
</ul>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="a061-create3DMask.html" class="btn btn-neutral float-left" title="10. Create 3D Mask protocol" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="a070-extractUnitCell.html" class="btn btn-neutral float-right" title="12. Extract asymmetric unit protocol" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Scipion team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>