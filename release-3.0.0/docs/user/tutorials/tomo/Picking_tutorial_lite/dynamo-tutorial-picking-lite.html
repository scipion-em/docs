<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Picking tutorial for Tomography with Dynamo in Scipion &mdash; Scipion 3.0.0 documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../../index.html" class="icon icon-home"> Scipion
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../scipion-modes/how-to-install.html">Installing Scipion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html#image-processing-resources">Image processing resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../facilities/facilities.html">On-the-fly processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../facilities/customize-report.html">Summary Reports</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/scipion-API.html">Scipion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/plugins-API.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/xmipp-API.html">Xmipp API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc/contact-us.html">Contact Us</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Licences</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">Licenses</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Scipion</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Picking tutorial for Tomography with Dynamo in Scipion</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/docs/user/tutorials/tomo/Picking_tutorial_lite/dynamo-tutorial-picking-lite.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="figure align-right">
<a class="reference internal image-reference" href="../../../../../_images/Scipion_tomo.gif"><img alt="scipion tomo logo" src="../../../../../_images/Scipion_tomo.gif" style="width: 100px;" /></a>
</div>
<div class="section" id="picking-tutorial-for-tomography-with-dynamo-in-scipion">
<span id="tutorial-picking"></span><h1><a class="toc-backref" href="#id1">Picking tutorial for Tomography with Dynamo in Scipion</a><a class="headerlink" href="#picking-tutorial-for-tomography-with-dynamo-in-scipion" title="Permalink to this heading"></a></h1>
<p>This page will be focused on the basic usage of the plugin scipion-em-dynamo for particle picking. The tutorial will cover
from the picking step to the extraction of the coordinates selected in the tomogram, including some useful tools to complement
the protocols involved in the picking workflows.</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#picking-tutorial-for-tomography-with-dynamo-in-scipion" id="id1">Picking tutorial for Tomography with Dynamo in Scipion</a></p>
<ul>
<li><p><a class="reference internal" href="#additional-resources" id="id2">Additional resources</a></p></li>
<li><p><a class="reference internal" href="#where-to-find-the-protocols" id="id3">Where to find the protocols?</a></p></li>
<li><p><a class="reference internal" href="#picking-strategies-in-scipion-for-tomography" id="id4">Picking strategies in Scipion for Tomography</a></p></li>
<li><p><a class="reference internal" href="#preliminary-steps" id="id5">Preliminary steps</a></p></li>
<li><p><a class="reference internal" href="#directional-picking-tutorial" id="id6">Directional picking tutorial</a></p>
<ul>
<li><p><a class="reference internal" href="#step-0-importing-the-data-and-denoising-the-data" id="id7">Step 0: Importing the data and denoising the data</a></p></li>
<li><p><a class="reference internal" href="#step-1-defining-a-membrane-geometry-with-dynamo" id="id8">Step 1: Defining a membrane geometry with Dynamo</a></p></li>
<li><p><a class="reference internal" href="#step-2-orienting-particles-in-dynamo-cropping-points" id="id9">Step 2: Orienting particles in Dynamo - Cropping points</a></p></li>
<li><p><a class="reference internal" href="#step-3-checking-3d-coordinates-in-scipion" id="id10">Step 3: Checking 3D coordinates in Scipion</a></p></li>
<li><p><a class="reference internal" href="#step-5-from-coordinates-to-subtomograms" id="id11">Step 5: From coordinates to subtomograms</a></p></li>
<li><p><a class="reference internal" href="#step-6-prealigment-of-subtomograms" id="id12">Step 6: Prealigment of subtomograms</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="additional-resources">
<h2><a class="toc-backref" href="#id2">Additional resources</a><a class="headerlink" href="#additional-resources" title="Permalink to this heading"></a></h2>
<p>Here you can find some valuable resources to complement the contents described in the tutorial:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.google.com/presentation/d/1Dyt9An3FR_qNDugjmB9VEriiASzrZb1GlxLBTVkSY7I/edit?usp=sharing">Slides - Scipion tomography course</a></p></li>
<li><p><a class="reference external" href="https://youtu.be/qbfVo7IVyQY">Video tutorials for Directional picking with Dynamo</a></p></li>
</ul>
</div>
<div class="section" id="where-to-find-the-protocols">
<h2><a class="toc-backref" href="#id3">Where to find the protocols?</a><a class="headerlink" href="#where-to-find-the-protocols" title="Permalink to this heading"></a></h2>
<p>Protocols needed to perform and analyze pickings are available in the following plugins:</p>
<ul class="simple">
<li><p><strong>scipion-em-tomo3d</strong></p></li>
<li><p><strong>scipion-em-dynamo</strong></p></li>
<li><p><strong>scipion-em-tomoviz</strong></p></li>
<li><p><strong>scipion-em-xmipptomo</strong></p></li>
</ul>
<p>It is worth mentioning that all these plugins strongly depend on the <strong>scipion-em-tomo</strong> plugin, which should be installed before any of the earlier mentioned Plugins.</p>
</div>
<div class="section" id="picking-strategies-in-scipion-for-tomography">
<h2><a class="toc-backref" href="#id4">Picking strategies in Scipion for Tomography</a><a class="headerlink" href="#picking-strategies-in-scipion-for-tomography" title="Permalink to this heading"></a></h2>
<p>Currently, we have implemented two different picking strategies that can be applied to your dataset:</p>
<ul class="simple">
<li><p>Directional picking</p></li>
<li><p>Non-directional picking</p></li>
</ul>
<p>The main difference between the two is the information they can extract on the particle’s orientation found in your tomograms.</p>
<p>Non-directional pickings are the direct extension of common SPA pickings to the third dimension. Consequently, the selected coordinates will only include information on the spatial location of a specific particle in a tomogram.</p>
<p>On the other hand, directional pickings will provide both the spatial location of the particle in the tomogram, and the initial orientation of that particle referred to another structure like a membrane. Thanks to this initial alignment, it is possible to simplify further steps in the workflow.</p>
<p>Deciding which strategy suits your data better depends on the conditions of the particles inside the tomogram. In general, suspended particles are better handled by non-directional pickings, while particles close or attached to a vesicle or describing specific geometries are more easily analyzed by directional pickings.</p>
</div>
<div class="section" id="preliminary-steps">
<h2><a class="toc-backref" href="#id5">Preliminary steps</a><a class="headerlink" href="#preliminary-steps" title="Permalink to this heading"></a></h2>
<p>If you are new to Scipion, we strongly suggest that you follow this <a class="reference internal" href="../../../scipion-gui.html#scipion-gui"><span class="std std-ref">Scipion tutorial</span></a> to learn how to navigate and work with the interface of Scipion. In the previous tutorial, you will find how to look for and create new protocols, together with some examples of SPA workflows.</p>
</div>
<div class="section" id="directional-picking-tutorial">
<h2><a class="toc-backref" href="#id6">Directional picking tutorial</a><a class="headerlink" href="#directional-picking-tutorial" title="Permalink to this heading"></a></h2>
<p>The following sections will describe the procedure to pick oriented particles with Dynamo software inside Scipion. The data analyzed during the tutorial is available <a class="reference external" href="http://scipion.cnb.csic.es/downloads/scipion/data/tutorials/tomography/Day2/eman-dynamo/">here</a>.</p>
<div class="section" id="step-0-importing-the-data-and-denoising-the-data">
<h3><a class="toc-backref" href="#id7">Step 0: Importing the data and denoising the data</a><a class="headerlink" href="#step-0-importing-the-data-and-denoising-the-data" title="Permalink to this heading"></a></h3>
<p>Firstly, we need to import our tomograms inside Scipion with any import protocols available. We will use the import protocol implemented inside <strong>scipion-em-tomo</strong> for this tutorial.</p>
<p>The parameters to be filled up in the form of the protocol are the following:</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>Import</strong> section</dt><dd><ul>
<li><p><strong>Files directory</strong>: Path to the directory which contains the tomogram file. If it’s only one file, the whole path including the file can be provided in this field.</p></li>
<li><p><strong>Pattern</strong>: it can be used with wildcards (*) for more complex files location, like multiple directories or files.</p></li>
<li><p><strong>Sampling rate</strong>: sampling rate of the tomograms expressed in A/px. For this tutorial, we can set it to 1.0</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><strong>Origin info</strong> section: By default, Scipion sets the origin of the coordinates for each tomogram on its gravity center. However, this section allows you to select any other location for the origin. For this tutorial, we will use the default value</p></li>
<li><p><strong>Acquisition info</strong> section: Here, you can specify the acquisition conditions that led to the reconstructed tomogram being imported. Apart from the maximum/minimum acquisition angles, step, and principal tilt axis, Dynamo allows selecting a second tilt axis used during some acquisitions. For this tutorial, we will use the default value</p></li>
</ul>
<div class="figure align-center">
<img alt="dynamo import" src="../../../../../_images/Tomo_import_tomo.png" />
</div>
<p>To make the manual picking be easier, we are going to denoise the tomogram. To do that, open the protocol “denoise tomogram” from plugin
scipion-em-tomo3d. Once there, click on the magnifier icon and select, on the pop-up window the pointer to the
imported tomogram. Then, set the threads to 12 to make the execution be faster. Leave the rest of parameters with the
default values and click execute the protocol.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/Tomo3d_tomo_denoising.png"><img alt="tomo3d denoising" src="../../../../../_images/Tomo3d_tomo_denoising.png" style="width: 400px;" /></a>
</div>
<p>If we analyze the results, it can be observed how the contrast has been considerably increased, being the figure on the
left the tomogram before the denoising and the one on the right after the denoising.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/Tomo3d_tomo_denoising_res.png"><img alt="tomo3d denoising result" src="../../../../../_images/Tomo3d_tomo_denoising_res.png" style="width: 1000px;" /></a>
</div>
</div>
<div class="section" id="step-1-defining-a-membrane-geometry-with-dynamo">
<h3><a class="toc-backref" href="#id8">Step 1: Defining a membrane geometry with Dynamo</a><a class="headerlink" href="#step-1-defining-a-membrane-geometry-with-dynamo" title="Permalink to this heading"></a></h3>
<p>We can move now to the picking steps of the particles found in the tomogram we have just imported and binned.</p>
<p>The picking process in the Dynamo plugin is divided into two different protocols:</p>
<ul class="simple">
<li><p><strong>Dynamo - vectorial picking</strong>: This protocol can be used to select particles and define geometries (such as vesicles or membranes) in your tomograms. The picking process is primarily manual, with some semiautomatic steps available for specific geometries.</p></li>
<li><p><strong>Dynamo - model workflow</strong>: This protocol takes a previously defined picking/geometry and generates a series of coordinates that can be afterward extracted.</p></li>
</ul>
<p>Following the Dynamo convention, the first protocol described before can be applied to define the Dynamo “user points.”
These coordinates are not meant to be extracted. Instead, they initialize the definition of geometries that Dynamo will
use to extract actual “cropping points” or extractable coordinates.</p>
<p>The second protocol will take your “user points” to define the geometry and extract equally spaced “cropping points”
from it. In addition, Dynamo can assign orientations to the final “cropping points” based on the geometry that it computes.</p>
<p>Let’s define several “user points” using the <strong>dynamo - vectorial picking</strong> protocol. The parameters to be supplied to
this program are the following:</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>Input</strong> section</dt><dd><ul>
<li><p><strong>Input tomograms</strong>: Scipion <cite>SetOfTomograms</cite> object generated by the previous binning protocol.</p></li>
<li><p><strong>Box Size</strong>: Estimated box size for the future particles. At this point, this parameter is just an estimation, and it can be modified after in the workflow if needed. For this tutorial, we will use a box size of 64.</p></li>
<li><p><strong>Modify previous meshes</strong>: If set to <cite>yes</cite>, you will be able to pass the protocol a previous picking to refine it. For this tutorial, we will leave the default value.</p></li>
<li><p><strong>Model type</strong>: Here, you can determine the type of geometry that will define your coordinates. Again, for this tutorial, we will leave the default value.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>After running the protocol, you will be prompt with a dialog showing the different tomograms available in the imported
set. The dialog also describes the picking status of the tomograms and the number of coordinates associated with each.
To launch the interface of Dynamo for a given tomogram, you can double click on one of the entries inside this dialog.</p>
<p><strong>Note</strong>: depending on the size of your tomograms, the loading time of the interface may be slower.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/Tomo_dialog_todo1.png"><img alt="tomo dialog todo" src="../../../../../_images/Tomo_dialog_todo1.png" style="width: 400px;" /></a>
</div>
<p>Now you should see Dynamo’s <cite>dtmslice</cite> interface for the double-clicked tomogram. This interface includes several
valuable tools that can be used to inspect and select “user points.” However, only a few of these tools are needed to
generate the information expected by Scipion.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/dtmslice_empty1.png"><img alt="dtmslice empty" src="../../../../../_images/dtmslice_empty1.png" style="width: 800px;" /></a>
</div>
<p>The steps to be followed to select your user points are the following:</p>
<ol class="arabic simple">
<li><p>Create a new Dynamo model: <cite>Model Pool</cite> ➤ <cite>Create new model in pool (choose type)</cite>. Inside this menu, you can choose any Dynamo model. However, remember that Scipion will rewrite your <cite>Model</cite> to the type you chose in the form. Thus, we recommend choosing the same type here. For this tutorial, create a General model</p></li>
<li><dl class="simple">
<dt>Basic <cite>dtmslice</cite> controls:</dt><dd><ul class="simple">
<li><p><strong>Mouse wheel</strong> ➤ Change tomogram slice</p></li>
<li><p><strong>X, Y, or Z keys</strong> ➤ Alternate between X, Y, or Z slices in the viewer</p></li>
<li><p><strong>C key</strong> ➤ Pick an “user point” in the current mouse location (<strong>Note</strong>: Sometimes the picked particle might appear displaced with respect to the location of your mouse. This is a known MatLab issue, which is usually solved by minimizing/maximizing the <cite>dtmslice</cite> window)</p></li>
<li><p><strong>Delete key</strong> ➤ Remove last picked coordinate (<strong>Note</strong>: You can delete a specific coordinate by right-clicking on it and selecting <cite>Delete point: X</cite> in the prompted menu)</p></li>
<li><p><strong>Mouse wheel + Ctrl key</strong> ➤ Zoom the view in our out</p></li>
<li><p><strong>Mouse left click + C key</strong> ➤ Rotate the view in any direction</p></li>
<li><p><strong>Mouse left click + Shift key</strong> ➤ Pan the view in any direction</p></li>
<li><p>Other useful actions are available <a class="reference external" href="https://wiki.dynamo.biozentrum.unibas.ch/w/index.php/Dtmslice#:~:text=2%20%2Dc%20myCatalogue-,Viewing%20controls,-Scene%20perspective">here</a>.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>The user points can be selected in the 3D view or in a 2d slices montage. For this tutorial, we will use the second method. Let us create a new montage view to define our membrane. First, you will need to click in Montage ➤ Create Montage of full depicted scene. The other option in the Montage menu will allow you to customize the settings of this view, such as the number of slices displayed.</p></li>
</ol>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/Montage_view1.png"><img alt="montage view" src="../../../../../_images/Montage_view1.png" style="width: 800px;" /></a>
</div>
<p>Inside the montage view, you can still create models as you did in the 3D viewer we used before. Also, you can change
the slice in this view using the buttons at the bottom of the window.</p>
<p>The following steps describe how to pick in the montage view:</p>
<ol class="arabic simple">
<li><p>For a better data visualization, click on the <cite>Contrast filter (gaussian) icon</cite> <a class="reference internal" href="../../../../../_images/Filter_icon.png"><img alt="Alternative text" src="../../../../../_images/Filter_icon.png" style="width: 20px;" /></a></p></li>
<li><p>Use the single arrows <a class="reference internal" href="../../../../../_images/Arrows_icon.png"><img alt="Alternative text" src="../../../../../_images/Arrows_icon.png" style="width: 30px;" /></a> located at the bottom left to go to the slices that provide the best view of the specimen/s desired to be picked.</p></li>
<li><p>It can be observed that when the mouse is located in any of the slices displayed, a set of icons <a class="reference internal" href="../../../../../_images/Slice_actions_icon.png"><img alt="Alternative text" src="../../../../../_images/Slice_actions_icon.png" style="width: 100px;" /></a> appear at the top right of it. They offer actions that can be very useful to perform a better picking, like zooming in and ou, click and drag, etc.</p></li>
<li><p>For each vesicle, we will pick the membrane in different slices, as can be observed in the figure below.</p></li>
<li><p>Click on the <cite>Toggle icon</cite> <img alt="icon" src="../../../../../_images/Toggle_icon1.png" /></p></li>
<li><p>Left click in the desired region of a given slice to place a new “user point”</p></li>
<li><p>To identify the points of another vesicle with a different class, go to menu <cite>Model Pool</cite> ➤ <cite>Create new model in pool (choose type)</cite></p></li>
</ol>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/Montage_with_points.png"><img alt="montage view" src="../../../../../_images/Montage_with_points.png" style="width: 800px;" /></a>
</div>
<p>Selections in this view can be deleted by following the procedure described for the 3D view.</p>
<p><strong>Note</strong>:
Another attractive property of the montage view is the possibility of automatically “tracking” the membrane after
several slices have been picked. To do so, activate the next slice (i.e., click it so that its frame becomes red),
and press the <strong>O key</strong>.</p>
<p>Before exiting the montage view, we need to define an extra point so Dynamo can orient the particles properly.
This new marker will tell Dynamo which side of the membrane is the interior and exterior. You can use the
<strong>Shift key + C key</strong> in the desired region to place this marker. <strong>Note</strong>: Orientations are defined pointing towards
the outer part of the membrane (i.e., the opposite side of the membrane with respect to the area where we place the previous marker).</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="docs/user/tutorials/tomo/Picking_tutorial_lite/Montage_view_picked.png"><img alt="picked montage view" src="docs/user/tutorials/tomo/Picking_tutorial_lite/Montage_view_picked.png" style="width: 400px;" /></a>
</div>
<p>Once you define the membrane on several slices, you can close the montage view window. Then, you will be able to see
your membrane automatically on the 3D view to do any refinement you may consider appropriate.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/dtmslice_picked1.png"><img alt="dtmslice membrane" src="../../../../../_images/dtmslice_picked1.png" style="width: 800px;" /></a>
</div>
<p>If you are happy with your results, you can close the <cite>dtmslice</cite> window, wait until the Scipion tomo dialog is updated
with the information of your picking, and register the output in Scipion.
As a reference, we picked around 166 different locations along different slices in the montage view.</p>
<p>We now have all the information we need to extract your initially picked “user points” based on the orientation
described by the geometry of the membrane we have just defined. To that end, we will combine the output of both
picking protocols with the <strong>dynamo - model workflow</strong> protocol.</p>
</div>
<div class="section" id="step-2-orienting-particles-in-dynamo-cropping-points">
<h3><a class="toc-backref" href="#id9">Step 2: Orienting particles in Dynamo - Cropping points</a><a class="headerlink" href="#step-2-orienting-particles-in-dynamo-cropping-points" title="Permalink to this heading"></a></h3>
<p>At this moment, Scipion has stored separately the two different geometries picked with the Dynamo <cite>dtmslice</cite> tool. The
next step is to use the previous information to generate a directional picking with coordinates extracted posteriorly.</p>
<p>The protocol in charge of imparting orientations to models and generating extractable coordinates (referred to as
“cropping points” in Dynamo) is the <strong>dynamo - model workflow</strong> protocol. The parameters included in the form of this
protocol are described below:</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>Input</strong> section:</dt><dd><ul>
<li><p><strong>Input Meshes</strong>: Output Scipion <cite>SetOfMeshes</cite> object generated by the <strong>dynamo - vectorial picking</strong> protocol. These meshes will be used to generate the extractable coordinates. If the meshes are not coming from a <cite>General</cite> model, they will also impart orientations to themselves. For this tutorial, select the <cite>SetOfMeshes</cite> created during the first picking protocol (<cite>General</cite> model)</p></li>
<li><p><strong>Box Size</strong>: Estimated box size for the future particles. At this point, this parameter is just an estimation, and it can be modified after in the workflow if needed. For this tutorial, we will use a box size of 64.</p></li>
<li><p><strong>Model type</strong>: Model type associated with the <strong>Input Meshes</strong>. It can be either the same model type chosen during the picking step or a different one. However, we recommend selecting the same model type for both protocols. For this tutorial, choose <cite>Ellipsoidal Vesicle</cite></p></li>
<li><p><strong>Mesh parameter</strong>: set it to 2 (explained below).</p></li>
<li><p><strong>Cropping parameter</strong>: set it to 5 (explained below).</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>The remaining parameters are specific to each Dynamo model. Most of them will determine how smooth will be the mesh
generated to give orientations to the particles and extract the “cropping points.” However, the softer the geometry,
the more points will be extracted, which may decrease the performance of future workflow steps.</p>
<p>Below you can find a brief description of the parameters associated with a <cite>General</cite> model. It is worth mentioning that a short description of all these parameters is also available in the protocols.</p>
<ul class="simple">
<li><p><strong>Mesh parameter</strong>: This parameter will determine the initial number of triangles to be used to generate a mesh in Dynamo. The smaller the parameter, the higher the number of triangles. For this tutorial, we will use the default value</p></li>
<li><p><strong>Maximum number of triangles</strong>: This parameter will limit the number of triangles that the Dynamo mesh will have. For this tutorial, we will use the default value</p></li>
<li><p><strong>Cropping parameter</strong>: Number of times the triangles in the mesh will be split into different triangles. This will increase the smoothness of the final geometry. For this tutorial, we will use the default value</p></li>
</ul>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/Model_workflow1.png"><img alt="model workflow" src="../../../../../_images/Model_workflow1.png" style="width: 400px;" /></a>
</div>
<p>Unlike the <strong>dynamo - vectorial picking</strong>, this protocol is not interactive. Therefore, it will automatically register
an oriented <cite>SetOfCoordinates3D</cite> in Scipion that can be extracted afterward.</p>
</div>
<div class="section" id="step-3-checking-3d-coordinates-in-scipion">
<h3><a class="toc-backref" href="#id10">Step 3: Checking 3D coordinates in Scipion</a><a class="headerlink" href="#step-3-checking-3d-coordinates-in-scipion" title="Permalink to this heading"></a></h3>
<p>At this point, you might be interested in checking the coordinates you have already picked and their orientations. To that end, you can use one of the three viewers available in Scipion to check 3D coordinates. The viewers currently available are the following:</p>
<ul class="simple">
<li><p><strong>Tomoviz</strong> viewer (available in <strong>scipion-em-tomoviz</strong> plugin): This viewer offers a 3D view of coordinates, orientations, and tomograms. It is helpful to check the coordinates and directions without losing the context provided by your tomogram. In addition, the viewer offers an interactive mode to remove unwanted coordinates.</p></li>
<li><p><strong>Eman</strong> viewer (available in <strong>scipion-em-emantomo</strong> plugin): This viewer relies on the Eman boxing interface to show a sliced view of the tomograms and their associated coordinates. It also offers a window to see a 2D preview of the subtomograms to be extracted.</p></li>
<li><p><strong>Dynamo</strong> viewer (available in <strong>scipion-em-dynamo</strong> plugin): This viewer relies on the Dynamo <cite>dtmslice</cite> interface described before in this tutorial. Therefore, you can use any of the tools implemented in this tool to modify or check your coordinates</p></li>
</ul>
<p>Since we would like to check the orientation of the coordinates, we recommend using the viewer offered in <strong>scipion-em-tomoviz</strong>. If you have this plugin installed, you can open it by clicking on <img alt="results" src="../../../../../_images/Analyze_results2.png" />.</p>
<p>Suppose you want to choose any other viewer. In that case, you can right-click on any output/input object found in the summary section of the Scipion interface to get a list of the available viewers for that specific Scipion object.</p>
<p>As it happened with the picking protocol, you will be prompted with a tomogram dialog showing the picked tomograms and their associated coordinates. By double-clicking on any of these entries, you will open the viewer for that specific tomogram.</p>
<p>Apart from buttons and menus displayed in the viewer window, the following navigation tools are also available:</p>
<ul class="simple">
<li><p>X, Y, or Z key: Switch the view to see a Z (top), X (front), or Y (side) view of the scene</p></li>
<li><p>Up/Down arrow keys: Change a single slice of the tomogram when the slice view is activated. The Up key moves the slice in the direction of the white arrow shown in the slice view. The Down key moves the slice in the opposite direction of the arrow</p></li>
<li><p>O key: return to the default view when the slice view is activated.</p></li>
</ul>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/Dynamo_tomoviz_vesicles.png"><img alt="tomoviz viewer dynamo" src="../../../../../_images/Dynamo_tomoviz_vesicles.png" style="width: 500px;" /></a>
</div>
</div>
<div class="section" id="step-5-from-coordinates-to-subtomograms">
<h3><a class="toc-backref" href="#id11">Step 5: From coordinates to subtomograms</a><a class="headerlink" href="#step-5-from-coordinates-to-subtomograms" title="Permalink to this heading"></a></h3>
<p>Now that you have generated and checked your oriented <cite>SetOfCoordinates3D</cite>, we can proceed to extract those locations in the tomogram to create a <cite>SetOfSubtomograms</cite>. To that end, we will the extraction implemented in the Dynamo plugin called <strong>dynamo - vectorial extraction</strong>. The parameters to be filled up in the form of the protocol are the following:</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>Input</strong> section</dt><dd><ul>
<li><p><strong>Input coordinates</strong>: Output Scipion <cite>SetOfCoordinates3D</cite> object generated by a picking protocol. For this tutorial, select the output previously generated by the protocol <strong>dynamo - model workflow</strong></p></li>
<li><p><strong>Tomogram source</strong>: Determine if the subtomomgrams will be extracted either from the tomogram used to pick the coordinates or from another tomogram (for example, this option is usually useful to re-extract the coordinates at a different binning). For this tutorial, we will use the <cite>same as picking</cite> option</p></li>
<li><p><strong>Box size</strong>: Final size of the subtomograms. If you click on the <img alt="wizard" src="../../../../../_images/Wizard1.png" /> button, Scipion will automatically set this parameter to match the box size previously set for the coordinates. For this tutorial, we will use a box size of 32</p></li>
<li><p><strong>Downsampling factor</strong>: When this parameter is bigger than 1.0, the final subtomogram size will be reduced by a factor equal to this parameter. We will use the default value of 1.0 (i.e., no downsampling)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Preprocess</strong> section</dt><dd><ul>
<li><p><strong>Invert contrast?</strong>: Determine if you want to invert the contrast of your subtomograms with respect to the contrast of your tomograms. We will use the default value <cite>No</cite> for this tutorial</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Apart from the previously described parameters, you can also specify the number of threads involved in the coordinates extraction to reduce the execution time.</p>
<p>Once the protocol is finished, Scipion will generate a <cite>SetOfSubtomograms</cite> that you can further process in the Subtomogram averaging pipeline. If you want to check how the subtomograms look, click on <img alt="results" src="../../../../../_images/Analyze_results2.png" /> as we did for the coordinates. This will open an interface that will allow you to inspect your subtomograms.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/Dynamo_subtomos1.png"><img alt="dynamo subtomos" src="../../../../../_images/Dynamo_subtomos1.png" style="width: 400px;" /></a>
</div>
<p>Congratulations, you have finished the directional picking tutorial of Scipion with Dynamo! The following section will describe the advantage of having oriented particles vs. non-oriented particles and how these orientations may impact further steps of the workflow. You can also move to the <strong>Non-directional picking</strong> tutorial if you are interested in learning more about this other picking strategy in the Scipion framework.</p>
</div>
<div class="section" id="step-6-prealigment-of-subtomograms">
<h3><a class="toc-backref" href="#id12">Step 6: Prealigment of subtomograms</a><a class="headerlink" href="#step-6-prealigment-of-subtomograms" title="Permalink to this heading"></a></h3>
<p>The main advantage of working with oriented coordinates is that the subtomograms extracted from them will inherit this same orientation. Thus, whenever we go to a refinement protocol, we can use this information as an initial guess of the alignment, making the process more reliable, accurate, and faster.</p>
<p>Another practical possibility is applying this initial alignment to the subtomograms. In this way, we can draw initial conclusions on our data or decide if some refinement of the picking steps is needed.</p>
<p>It is worth mentioning that these alignments will not consider the in-plane rotational alignment of the samples. This implies that, after applying the alignment of the subtomograms, the volumes will be aligned to a common axis (usually the Z-axis). However, rotations associated with this common axis will not be corrected.</p>
<p>To apply the alignment stored in the <cite>SetOfSubtomograms</cite> metadata, we can use the protocol <strong>xmipptomo - apply alignment to subtomo</strong> available in <strong>scipion-em-xmipptomo</strong> plugin.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/Emantomo_average.png"><img alt="xmipptomo apply alignment" src="../../../../../_images/Emantomo_average.png" style="width: 400px;" /></a>
</div>
<p>This protocol has a single input parameter in the form, corresponding to a Scipion <cite>SetOfSubtomograms</cite> object. We will use the subtomograms generated previously by the <strong>dynamo - vectorial extraction</strong> as input.</p>
<p>This protocol will generate two different outputs:</p>
<ul class="simple">
<li><p>Subtomogram average</p></li>
<li><p><cite>SetOfSubtomograms</cite> with the alignment applied</p></li>
</ul>
<p>You can visualize both outputs by clicking on <img alt="results" src="../../../../../_images/Analyze_results2.png" />. Thanks to the average, you can check that there is already some blurry density, which is a good way of checking if the picking protocols worked as expected.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="docs/user/tutorials/tomo/Picking_tutorial_lite/Average.png"><img alt="Average subtomo" src="docs/user/tutorials/tomo/Picking_tutorial_lite/Average.png" style="width: 400px;" /></a>
</div>
<p>Below, you can find an overall view of the Scipion workflow described during the <strong>Directional picking tutorial</strong>.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/Directional_workflow1.png"><img alt="Directional picking workflow" src="../../../../../_images/Directional_workflow1.png" style="width: 400px;" /></a>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Scipion team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>