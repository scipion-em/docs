<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial - Subtomogram averaging with EMAN plugin for Scipion &mdash; Scipion 3.0.0 documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../../index.html" class="icon icon-home"> Scipion
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../scipion-modes/how-to-install.html">Installing Scipion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html#image-processing-resources">Image processing resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../facilities/facilities.html">On-the-fly processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../facilities/customize-report.html">Summary Reports</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/scipion-API.html">Scipion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/plugins-API.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/xmipp-API.html">Xmipp API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc/contact-us.html">Contact Us</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Licences</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">Licenses</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Scipion</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Tutorial - Subtomogram averaging with EMAN plugin for Scipion</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/docs/user/tutorials/tomo/Emantomo_STA/emantomo-sta-workflow.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="figure align-default">
<a class="reference internal image-reference" href="../../../../../_images/scipion_logo.gif"><img alt="scipion logo" src="../../../../../_images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="tutorial-subtomogram-averaging-with-eman-plugin-for-scipion">
<span id="emantomo-sta-workflow"></span><h1><a class="toc-backref" href="#id5">Tutorial - Subtomogram averaging with EMAN plugin for Scipion</a><a class="headerlink" href="#tutorial-subtomogram-averaging-with-eman-plugin-for-scipion" title="Permalink to this heading"></a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tutorial-subtomogram-averaging-with-eman-plugin-for-scipion" id="id5">Tutorial - Subtomogram averaging with EMAN plugin for Scipion</a></p>
<ul>
<li><p><a class="reference internal" href="#list-of-abbreviations" id="id6">List of Abbreviations</a></p></li>
<li><p><a class="reference internal" href="#introduction" id="id7">Introduction</a></p>
<ul>
<li><p><a class="reference internal" href="#the-dataset" id="id8">The dataset</a></p></li>
<li><p><a class="reference internal" href="#associated-resources" id="id9">Associated resources</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#preparing-the-project" id="id10">Preparing the project</a></p></li>
<li><p><a class="reference internal" href="#importing-the-ts" id="id11">Importing the TS</a></p></li>
<li><p><a class="reference internal" href="#importing-the-ctf" id="id12">Importing the CTF</a></p></li>
<li><p><a class="reference internal" href="#ts-alignment-and-tomogram-reconstruction" id="id13">TS alignment and tomogram reconstruction</a></p></li>
<li><p><a class="reference internal" href="#importing-the-3d-coordinates" id="id14">Importing the 3D coordinates</a></p></li>
<li><p><a class="reference internal" href="#particle-extraction-from-the-ts" id="id15">Particle extraction from the TS</a></p></li>
<li><p><a class="reference internal" href="#generate-the-initial-volume" id="id16">Generate the initial volume</a></p></li>
<li><p><a class="reference internal" href="#subtomogram-refinement" id="id17">Subtomogram refinement</a></p></li>
<li><p><a class="reference internal" href="#full-dataset-results" id="id18">Full dataset results</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="list-of-abbreviations">
<h2><a class="toc-backref" href="#id6">List of Abbreviations</a><a class="headerlink" href="#list-of-abbreviations" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>STA: subtomogram averaging.</p></li>
<li><p>PPPT: per-particle per-tilt.</p></li>
<li><p>TS: tilt series.</p></li>
<li><p>CTF: contrast transfer function.</p></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id7">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>This tutorial illustrates how to carry out a subtomogram averaging (STA) with a per-particle per-tilt (PPPT) approach
using <a class="reference external" href="https://blake.bcm.edu/emanwiki/EMAN2">EMAN</a> plugin for Scipion combined with others, listed below for each step:</p>
<ol class="arabic simple">
<li><p>Import the tilt series (TS) - <a class="reference external" href="https://github.com/scipion-em/scipion-em-tomo">scipion-em-tomo</a></p></li>
<li><p>Contrast transfer function (CTF) estimation - <a class="reference external" href="https://github.com/scipion-em/scipion-em-imod">scipion-em-imod</a></p></li>
<li><p>TS alignment and tomogram reconstruction - <a class="reference external" href="https://github.com/scipion-em/scipion-em-emantomo">scipion-em-emantomo</a></p></li>
<li><p>Import the 3D coordinates - <a class="reference external" href="https://github.com/scipion-em/scipion-em-tomo">scipion-em-tomo</a></p></li>
<li><p>Generate the initial model - <a class="reference external" href="https://github.com/scipion-em/scipion-em-emantomo">scipion-em-emantomo</a></p></li>
<li><p>Subtomograms refinement - <a class="reference external" href="https://github.com/scipion-em/scipion-em-emantomo">scipion-em-emantomo</a></p></li>
</ol>
<div class="section" id="the-dataset">
<h3><a class="toc-backref" href="#id8">The dataset</a><a class="headerlink" href="#the-dataset" title="Permalink to this heading"></a></h3>
<p>The dataset used for this tutorial is a subset of <a class="reference external" href="https://www.ebi.ac.uk/empiar/EMPIAR-10064/">EMPIAR-10064</a>, concretely the TS named mixedCTEM_tomo4.mrc (whose
details can be found separately in <a class="reference external" href="https://www.ebi.ac.uk/emdb/EMD-3420?tab=overview">EMD-3420</a>). The dataset also includes:</p>
<ul class="simple">
<li><p>The estimated CTF, carried out with <a class="reference external" href="https://github.com/scipion-em/scipion-em-gctf">scipion-em-gctf</a> and converted with Scipion into <a class="reference external" href="https://bio3d.colorado.edu/imod/">IMOD</a> CTF format to import it using the corresponding protocol from the plugin <a class="reference external" href="https://github.com/scipion-em/scipion-em-imod">scipion-em-imod</a>.</p></li>
<li><p>A subset of 200 particles picked with <a class="reference external" href="https://cryolo.readthedocs.io/en/stable/">crYOLO</a> inside Scipion (protocol from the plugin <a class="reference external" href="https://github.com/scipion-em/scipion-em-sphire">scipion-em-sphire</a>).</p></li>
</ul>
<p>To download the dataset, simply execute in a terminal the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scipion3</span> <span class="n">testdata</span> <span class="o">--</span><span class="n">download</span> <span class="n">emantomo_tutorial_ribo</span>
</pre></div>
</div>
<p>The dataset will be downloaded to SCIPION_HOME/data/tests.</p>
</div>
<div class="section" id="associated-resources">
<h3><a class="toc-backref" href="#id9">Associated resources</a><a class="headerlink" href="#associated-resources" title="Permalink to this heading"></a></h3>
<p>Here you can find resources associated with this content, like videos or presentations used in courses and other
documentation pages:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../scipion-gui.html#scipion-gui"><span class="std std-ref">Scipion tutorial</span></a></p></li>
</ul>
</div>
</div>
<div class="section" id="preparing-the-project">
<h2><a class="toc-backref" href="#id10">Preparing the project</a><a class="headerlink" href="#preparing-the-project" title="Permalink to this heading"></a></h2>
<p>First of all, open a terminal and execute the command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scipion3</span>
</pre></div>
</div>
<p>to run Scipion. After that:</p>
<ol class="arabic simple">
<li><p>Click on button “Create Project”.</p></li>
<li><p>Write a name for it. We’ll name it <em>Day_3_emantomo_sta</em>.</p></li>
<li><p>Click on button “Create”.</p></li>
</ol>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/00_create_project.png"><img alt="Create Project" src="../../../../../_images/00_create_project.png" style="width: 500px;" /></a>
</div>
<p>Note: if starting a project from scratch, the protocols can be located on the left panel of the project interface or
directly search via ctrl + f and typing the keywords that may represent what it is desired to be found, like a plugin
name, a protocol name, an action, etc.</p>
<p>In our case, we are going to use a Scipion template that contains the the workflow that will be followed in this
tutorial customized with the corresponding parameters for each protocol. Nevertheless, the tutorial is described
assuming an approach of type “project from scratch”.</p>
<p>To load the template, clock on the menu named “Others” and then “Import workflow template” on the top left of the
project window. After that, a list of the available templates will be displayed. Locate the one named
“2023_12_emantomo_sta_tutorial_workflow”, double-click on it or select it and click on the button named “Select”.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/19_scipion_template_gui.png"><img alt="Scipion template GUI" src="../../../../../_images/19_scipion_template_gui.png" style="width: 650px;" /></a>
</div>
<p>This will generate another window, that is used to specify some parameters required by the workflow, normally the
file paths. In this case, there is only one, which is the default path of the tutorial dataset downloaded before. Thus,
it is not necessary to edit it.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/19a_Scpion_template_customizer_gui.png"><img alt="Scipion template workflow customizer GUI" src="../../../../../_images/19a_Scpion_template_customizer_gui.png" style="width: 400px;" /></a>
</div>
<p>Click on the button “Accept”, and the project graph will be automatically generated, as can be observed in the figure
below:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/19b_loaded_project_overview.png"><img alt="Loaded project overview" src="../../../../../_images/19b_loaded_project_overview.png" style="width: 650px;" /></a>
</div>
<p>To display the corresponding form of each protocol, simply double-click on it.</p>
</div>
<div class="section" id="importing-the-ts">
<span id="id1"></span><h2><a class="toc-backref" href="#id11">Importing the TS</a><a class="headerlink" href="#importing-the-ts" title="Permalink to this heading"></a></h2>
<p>Let’s begin importing the TS. This is the entry point to Scipion, in which external data files are represented as
Scipion objects, that is a common representation of the data used to make all the different packages speak to each
other. To do that, simply look for a protocol named “tomo - import tilt-series” and click on it. On the tab “Import”,
fill the following parameters with the corresponding values listed below:</p>
<ul class="simple">
<li><p>Files directory: SCIPION_HOME/data/tests/emantomo_tutorial_ribo</p></li>
<li><p>Pattern: {TS}.mrc</p></li>
<li><p>Tilt angles range: from -58 to 58 with a step of 2</p></li>
<li><p>Micorscope voltage (kV): 300</p></li>
<li><p>Pixel size (sampling rate) Å/px: 2.62</p></li>
<li><p>Tilt axis angle (deg.): -3.4</p></li>
<li><p>Dose (electrons/sq.Å) -&gt; Dose per tilt image: 1.7</p></li>
</ul>
<p>Leave the rest of the parameters with the default values and click on “Execute” button.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/01_import_ts.png"><img alt="Import TS form" src="../../../../../_images/01_import_ts.png" style="width: 500px;" /></a>
</div>
<p>The imported data can be now visualized by clinking on button “Analyze Results”, located on the top right corner of the
bottom panel. This will generate an auxiliary window which will list the TS contained in the set imported. In our case,
there is only one TS. To open it with <a class="reference external" href="https://bio3d.colorado.edu/imod/">IMOD</a> viewer 3dmod (integrated as part of plugin <a class="reference external" href="https://github.com/scipion-em/scipion-em-imod">scipion-em-imod</a>), simply
double click on it.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/02_ts_view.png"><img alt="Import TS result" src="../../../../../_images/02_ts_view.png" style="width: 700px;" /></a>
</div>
</div>
<div class="section" id="importing-the-ctf">
<span id="id2"></span><h2><a class="toc-backref" href="#id12">Importing the CTF</a><a class="headerlink" href="#importing-the-ctf" title="Permalink to this heading"></a></h2>
<p>In this step, we are going to use the protocol called “imod - Import tomo CTFs” from plugin <a class="reference external" href="https://github.com/scipion-em/scipion-em-imod">scipion-em-imod</a>. Once the
protocol form is on the screen, fill the following parameters with the values listed below:</p>
<ul class="simple">
<li><p>Files directory: SCIPION_HOME/data/tests/emantomo_tutorial_ribo</p></li>
<li><p>Patterns: <a href="#id3"><span class="problematic" id="id4">*</span></a>.defocus</p></li>
<li><p>Input tilt-series: to get the pointer to the TS previously imported, click on the magnifier icon. This action will open an auxiliary window which will lists the existing objects of the same type as expected.</p></li>
</ul>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/03_import_ctf_form.png"><img alt="Import CTF form" src="../../../../../_images/03_import_ctf_form.png" style="width: 500px;" /></a>
</div>
<p>Again, the results can be displayed by clicking on the “Analyze Results” button. The default viewer in this case is the
CTF estimation viewer contained in plugin <a class="reference external" href="https://github.com/scipion-em/scipion-em-tomo">scipion-em-tomo</a>, that looks like as shown in the figure below:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/04_ctf_view.png"><img alt="Import CTF result" src="../../../../../_images/04_ctf_view.png" style="width: 850px;" /></a>
</div>
</div>
<div class="section" id="ts-alignment-and-tomogram-reconstruction">
<h2><a class="toc-backref" href="#id13">TS alignment and tomogram reconstruction</a><a class="headerlink" href="#ts-alignment-and-tomogram-reconstruction" title="Permalink to this heading"></a></h2>
<p>Let’s open the protocol named “emantomo TS align &amp; tomo rec” from plugin <a class="reference external" href="https://github.com/scipion-em/scipion-em-emantomo">scipion-em-emantomo</a>. Fill it with the
following values:</p>
<ul class="simple">
<li><p>Parallel –&gt; Threads: 12</p></li>
</ul>
<p><em>Tab Input:</em></p>
<ul class="simple">
<li><p>Tilt Series: select the corresponding object using the magnifier icon.</p></li>
</ul>
<p><em>Tab TS alignment:</em></p>
<p>Leave all the parameters with the default values.</p>
<p><em>Tab Tomogram reconstruction:</em></p>
<ul class="simple">
<li><p>Expert level: Advanced</p></li>
<li><p>Thickness (pix.): 96</p></li>
<li><p>Correct rotation: Yes</p></li>
<li><p>Extra pad: Yes</p></li>
</ul>
<p>Leave the rest of the parameters with the default values.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/05_align_ts_tomo_rec_form.png"><img alt="Align TS and tomo rec form" src="../../../../../_images/05_align_ts_tomo_rec_form.png" style="width: 1000px;" /></a>
</div>
<p>Let’s have a look at the tomogram reconstructed. To do that, right-click on the tomograms output listed in the summary
tab located on the lower half of the project main window and select “Open with ImodViewer”.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/06a_imod_open_viewer.png"><img alt="Open IMOD viewer" src="../../../../../_images/06a_imod_open_viewer.png" style="width: 400px;" /></a>
</div>
<p>Then, a new window containing the list of tomograms (only one in this case) will be generated. Double click on it to
launch the selected viewer with that data. It should look like the figure below:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/06b_imod_viewer_tomogram.png"><img alt="Tomogram displayed with IMOD viewer" src="../../../../../_images/06b_imod_viewer_tomogram.png" style="width: 500px;" /></a>
</div>
</div>
<div class="section" id="importing-the-3d-coordinates">
<h2><a class="toc-backref" href="#id14">Importing the 3D coordinates</a><a class="headerlink" href="#importing-the-3d-coordinates" title="Permalink to this heading"></a></h2>
<p>To import the provided coordinates, open the protocol named “tomo - import 3D coords from scipion” from the plugin
<a class="reference external" href="https://github.com/scipion-em/scipion-em-tomo">scipion-em-tomo</a>. Fill the following parameters with these values:</p>
<ul class="simple">
<li><p>Scipion sqlite file: SCIPION_HOME/data/tests/coordinates.sqlite</p></li>
<li><p>Input tomogras: select the corresponding object from the list displayed after having clicked on the magnifier icon.</p></li>
<li><p>Box size [pix]: 36</p></li>
</ul>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/07_import_coords_form.png"><img alt="Import coordinates form" src="../../../../../_images/07_import_coords_form.png" style="width: 500px;" /></a>
</div>
<p>Let’s use tho do that, right-click on the output object listed in the project’s summary panel, and select “Open with
Eman”:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/08_emantomo_open_viewer.png"><img alt="Open EMAN viewer" src="../../../../../_images/08_emantomo_open_viewer.png" style="width: 400px;" /></a>
</div>
<p>On the list displayed, double click on the set of coordinates listed. They should look like this:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/09_eman_viewer_coords.png"><img alt="Coordinates displayed with EMAN viewer" src="../../../../../_images/09_eman_viewer_coords.png" style="width: 1000px;" /></a>
</div>
<p><em>Note:</em></p>
<p>Once the viewer is closed, a new window will appear to ask if you want to save the protocol output. It is because some
viewers, like this one, allow the user to add or remove elements (coordinates in this case). In nothing was changed or
you don’t want to save the changes done from the viewer, simply select “No”.</p>
</div>
<div class="section" id="particle-extraction-from-the-ts">
<h2><a class="toc-backref" href="#id15">Particle extraction from the TS</a><a class="headerlink" href="#particle-extraction-from-the-ts" title="Permalink to this heading"></a></h2>
<p>This protocol uses the CTF estimation, TS alignment and coordinates data to go back to the TS and crop an image for
each particle for each tilt image (PPPT approach) and the uses them to reconstruct a 3d particle. To carry out this
step, let’s open the protocol “emantomo - Extraction from TS” from plugin <a class="reference external" href="https://github.com/scipion-em/scipion-em-emantomo">scipion-em-emantomo</a> and fill the following
parameters with the values listed below:</p>
<ul class="simple">
<li><p>Threads: 12</p></li>
<li><p>Expert Level: Advanced</p></li>
<li><p>Coordinates: select the corresponding object clicking on the magnifier button.</p></li>
<li><p>CTF tomo series: select the corresponding object clicking on the magnifier button.</p></li>
<li><p>Tilt series with alignment, non-interpolated: clicking on the magnifier icon will display a list of two available objects, which correspond to the imported TS and the TS with alignment data from the previous step. This is the one that must be selected, that should appear the first in the list.</p></li>
<li><p>Flip Z axis in tomogram? No</p></li>
<li><p>Box size unbinned (pix.): 144</p></li>
<li><p>Binning factor: 4 (thus, the generated particles box size will be 144 / 4 = 36 pix.).</p></li>
<li><p>Contrast threshold for 2D particle removal: 0.5 (remove gold beads).</p></li>
<li><p>Minimum distance between particles (Å): 150 (as 300Å is the highest ribosome size value from its size ranges).</p></li>
</ul>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/10_extract_particles_from_ts_form.png"><img alt="Extract particles from TS form" src="../../../../../_images/10_extract_particles_from_ts_form.png" style="width: 550px;" /></a>
</div>
<p>The best way to check if the particles were correctly referred to the TS is to display with the <a class="reference external" href="https://bio3d.colorado.edu/imod/">IMOD</a> viewer the
generated result called projected2DCoordinates. It will show the extracted particles over the TS, as can be observed in
the figure below:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/11_tilt_particles_with_imod_viewer.png"><img alt="Tilt particles displayed with IMOD's viewer" src="../../../../../_images/11_tilt_particles_with_imod_viewer.png" style="width: 500px;" /></a>
</div>
<p>Also, the generated subtomograms can also be displayed. Let’s select in this case, the Scipion metadata viewer. It
should look like as shown in the figure below:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/12_subtomograms_displayed_with_scipion.png"><img alt="Subtomograms displayed with Scipion metadata viewer" src="../../../../../_images/12_subtomograms_displayed_with_scipion.png" style="width: 500px;" /></a>
</div>
</div>
<div class="section" id="generate-the-initial-volume">
<h2><a class="toc-backref" href="#id16">Generate the initial volume</a><a class="headerlink" href="#generate-the-initial-volume" title="Permalink to this heading"></a></h2>
<p>Once we have the particles extracted, it’s time to calculate an initial volume with them. To do that, open the protocol
named “emantomo - Initial model pppt” rom plugin <a class="reference external" href="https://github.com/scipion-em/scipion-em-emantomo">scipion-em-emantomo</a> and fill the following as listed below:</p>
<ul class="simple">
<li><p>Threads: 12</p></li>
</ul>
<p><em>Tab Input</em></p>
<ul class="simple">
<li><p>Particles: select the corresponding object by clicking on the magnifier icon.</p></li>
<li><p>Reference volume (opt.): leave this empty.</p></li>
</ul>
<p><em>Tab Optimization</em></p>
<ul class="simple">
<li><p>No. iterations: 30</p></li>
<li><p>Leave the rest of the parameters with the default values.</p></li>
</ul>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/13_initial_volume_form.png"><img alt="Initial volume form" src="../../../../../_images/13_initial_volume_form.png" style="width: 800px;" /></a>
</div>
<p>The generated output will be a set of averages, one for each class specified. In this case there will be only one as
the number of classes introduced in the protocol form was 1. Sometimes it can be very useful to specify more than one
class even if there is only one class, and then select the best one, as sometimes the convergence is not reached and
the result is not good. On the other hand, the higher number of classes introduced, the longer it will take the
protocol to finish. Said that, let’s open our initial model, in this case with <a class="reference external" href="https://www.cgl.ucsf.edu/chimera/">Chimera</a>. It should look like as
in the figure below:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/14_initial_volume_chimerax.png"><img alt="Initial volume displayed with Chimera_" src="../../../../../_images/14_initial_volume_chimerax.png" style="width: 500px;" /></a>
</div>
</div>
<div class="section" id="subtomogram-refinement">
<h2><a class="toc-backref" href="#id17">Subtomogram refinement</a><a class="headerlink" href="#subtomogram-refinement" title="Permalink to this heading"></a></h2>
<p>Finally, let’s use the generated initial model and the extracted subtomograms to generate a refined average. To do that,
let’s open the protocol “emantomo - subtomogram refinement pppt” from the plugin <a class="reference external" href="https://github.com/scipion-em/scipion-em-emantomo">scipion-em-emantomo</a>, and fill the
following parameters with the values specified below:</p>
<ul class="simple">
<li><p>Threads: 12</p></li>
</ul>
<p><em>Tab Input:</em></p>
<ul class="simple">
<li><p>Particles: use the magnifier icon and select the particles extracted from the TS.</p></li>
<li><p>Reference volume (opt.): again, click on the magnifier icon and select the item 1 from the set of averages generated in the previous protocol.</p></li>
</ul>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/15_select_item_from_set.png"><img alt="Select item from set" src="../../../../../_images/15_select_item_from_set.png" style="width: 400px;" /></a>
</div>
<p><em>Tab Refinement:</em></p>
<ul class="simple">
<li><p>3D map filtering: local</p></li>
</ul>
<p>Leave the rest of the parameters with the default values.</p>
<p>Regarding the parameter “Iteration information” in the tab “Refinement”, it admits combinations of four types of
refinements, which are:</p>
<ul class="simple">
<li><p>p: 3d particle translation-rotation.</p></li>
<li><p>t: subtilt translation.</p></li>
<li><p>r: subtilt translation-rotation.</p></li>
<li><p>d: subtilt defocus.</p></li>
</ul>
<p>The default value is p,p,p,t,p,p,t,r,d. It can be compacted using the corresponding character followed by the
desired number of iterations of that type, e. g., p3 = p,p,p.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/16_subtomogram_refinement_form.png"><img alt="Subtomogram refinement form" src="../../../../../_images/16_subtomogram_refinement_form.png" style="width: 800px;" /></a>
</div>
<p>This protocol generates 3 outputs, that are:</p>
<ul class="simple">
<li><p>The refined average.</p></li>
<li><p>The refined subtomograms.</p></li>
<li><p>The FSC curves.</p></li>
</ul>
<p>Let’s display it:</p>
<ul class="simple">
<li><p>The refined average, using <a class="reference external" href="https://www.cgl.ucsf.edu/chimera/">Chimera</a>:</p></li>
</ul>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/16_refined_avg_chimerax.png"><img alt="Refined average displayed with Chimera_" src="../../../../../_images/16_refined_avg_chimerax.png" style="width: 500px;" /></a>
</div>
<ul class="simple">
<li><p>The refined subtomograms, displayed with Scipion metadata vierwer:</p></li>
</ul>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/17_refined_subtomos_scipion_viewer.png"><img alt="Refined subtomograms displayed with Scipion metadata vierwer" src="../../../../../_images/17_refined_subtomos_scipion_viewer.png" style="width: 500px;" /></a>
</div>
<ul class="simple">
<li><p>The FSC curves, displayed with Scipion FSC viewer.</p></li>
</ul>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/18_fsc_curves_scipion.png"><img alt="FSCs" src="../../../../../_images/18_fsc_curves_scipion.png" style="width: 500px;" /></a>
</div>
</div>
<div class="section" id="full-dataset-results">
<h2><a class="toc-backref" href="#id18">Full dataset results</a><a class="headerlink" href="#full-dataset-results" title="Permalink to this heading"></a></h2>
<p>The same workflow was carried out with all the TS (mixedCTEM ones) that compose the dataset <a class="reference external" href="https://www.ebi.ac.uk/empiar/EMPIAR-10064/">EMPIAR-10064</a>. The
corresponding refinement result (displayed with <a class="reference external" href="https://www.cgl.ucsf.edu/chimera/">Chimera</a>) at bin 1, together with the FSC curves are shown below:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/20_refined_avg_chimera_all_dataset.png"><img alt="Refined average displayed with Chimera_ whole dataset" src="../../../../../_images/20_refined_avg_chimera_all_dataset.png" style="width: 500px;" /></a>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/21_fscs_whole_dataset_bin1.png"><img alt="FSCs at bin1 whole dataset" src="../../../../../_images/21_fscs_whole_dataset_bin1.png" style="width: 500px;" /></a>
</div>
<p>The volume obtained was sharpened using the protocol localdeblur sharpening from the plugin <a class="reference external" href="https://github.com/I2PC/scipion-em-xmipp">scipion-em-xmipp</a>.
The resulting volume can be observed in the figure below, displayed again with <a class="reference external" href="https://www.cgl.ucsf.edu/chimera/">Chimera</a>:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/20_sharpened_refined_volume_whole_dataset.png"><img alt="Sharpened refined average displayed with Chimera_ whole dataset" src="../../../../../_images/20_sharpened_refined_volume_whole_dataset.png" style="width: 500px;" /></a>
</div>
<p>Compared to the corresponding EMD dataset (<a class="reference external" href="https://www.ebi.ac.uk/emdb/EMD-3420?tab=overview">EMD-3420</a>), the resolution it can be observed that the resolution achieved
with the workflow proposed is higher that the reported in EMD (8.3Å vs 11.2Å). The figure below shows the superposition
ob both structures (EMD in yellow and the one obtained in blue) displayed with <a class="reference external" href="https://www.cgl.ucsf.edu/chimera/">Chimera</a>. It can be observed that the
correlation between both structures is 93.7% (Thanks to Patricia Losana from BCU CNB-CSIC for the help with
Chimera).</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/20_EMD_and_obtained_structures_superposed.png"><img alt="EMD and obtained structures superposed displayed with Chimera_ whole dataset" src="../../../../../_images/20_EMD_and_obtained_structures_superposed.png" style="width: 900px;" /></a>
</div>
<p>Finally, the local resolution was estimated using the protocol MonoRes from the plugin <a class="reference external" href="https://github.com/I2PC/scipion-em-xmipp">scipion-em-xmipp</a>. The following
figure shows the local resolution map over the sharpened structure displayed with <a class="reference external" href="https://www.cgl.ucsf.edu/chimera/">Chimera</a>.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../../../../_images/20_Obtained_structure_resolution_map_over_sharpened.png"><img alt="Obtained structure MonoRes local resolution map over sharpened" src="../../../../../_images/20_Obtained_structure_resolution_map_over_sharpened.png" style="width: 700px;" /></a>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Scipion team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>