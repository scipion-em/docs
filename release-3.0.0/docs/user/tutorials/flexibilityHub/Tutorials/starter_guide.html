<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flexibility Hub: Starter guide &mdash; Scipion 3.0.0 documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../../index.html" class="icon icon-home"> Scipion
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../scipion-modes/how-to-install.html">Installing Scipion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html#image-processing-resources">Image processing resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../facilities/facilities.html">On-the-fly processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../facilities/customize-report.html">Summary Reports</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/scipion-API.html">Scipion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/plugins-API.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/xmipp-API.html">Xmipp API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc/contact-us.html">Contact Us</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Licences</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">Licenses</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Scipion</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Flexibility Hub: Starter guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/docs/user/tutorials/flexibilityHub/Tutorials/starter_guide.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="flexibility-hub-starter-guide">
<span id="id1"></span><h1>Flexibility Hub: Starter guide<a class="headerlink" href="#flexibility-hub-starter-guide" title="Permalink to this heading"></a></h1>
<p>This tutorial is structured around a workflow defined with synthetic data. The data for this tutorial can be downloaded with <code class="code docutils literal notranslate"><span class="pre">scipion3</span> <span class="pre">testdata</span> <span class="pre">--download</span> <span class="pre">FlexHub_Tutorials</span></code>.</p>
<p>Note that the workflow tutorial focuses mostly on the way flexibility information can be analysed from CryoEM particle data. To that end, the Zernike3D algorithm will be used to exemplify the workflow. Nevertheless, steps that could be analyzed with a different software will be explicitly marked.</p>
<p>Apart from the particle workflow proposed, there exists other possibilities inside the Flexbility Hub to extract information from CryoEM maps and structural models as well. If you are interested on knowing more about all the functionalities in the Flexibility Hub, we propose reading the specific Plugin tutorials provided above.</p>
<div class="section" id="workflow-tutorial">
<h2>Workflow tutorial<a class="headerlink" href="#workflow-tutorial" title="Permalink to this heading"></a></h2>
<div class="section" id="some-comments-on-the-data-to-be-used">
<h3>Some comments on the data to be used<a class="headerlink" href="#some-comments-on-the-data-to-be-used" title="Permalink to this heading"></a></h3>
<p>In this tutorial, we will use a synthetic dataset generated with ContinuousFlex and its Normal Mode Analysis tools. The dataset includes the following items:</p>
<ul class="simple">
<li><p>Synthetic particles: we will work with a total of 500 CTF corrupted synthetic particles with angular information and a box size of 64px. These particles were generated by NMA in order to add some continuous heterogeneity to the dataset.</p></li>
<li><p>Volume data: to be used as input for the Zernike3D programs.</p></li>
<li><p>Structural model: to be used to analyze conformational changes at atomic level.</p></li>
</ul>
<p>In the case of working with particles, angular information and CTF are usually mandatory requirements. Therefore, flexibility analysis usually starts at a late state in a CryoEM workflow, once particles have been already refined, consensuated…</p>
</div>
<div class="section" id="where-to-find-flexibility-hub-protocols">
<h3>Where to find Flexibility Hub protocols?<a class="headerlink" href="#where-to-find-flexibility-hub-protocols" title="Permalink to this heading"></a></h3>
<p>Flexibility Hub related protocols have been grouped in a new <em>View</em> tab in the Scipion GUI called <em>Flexibility Hub</em>. In addition, it is possible to use the key <code class="code docutils literal notranslate"><span class="pre">Ctrl+F</span></code> to open a protocol search dialog.</p>
</div>
<div class="section" id="importing-the-data-in-scipion">
<h3>1. Importing the data in Scipion<a class="headerlink" href="#importing-the-data-in-scipion" title="Permalink to this heading"></a></h3>
<p>The first step in our workflow is to import our particles, volumes, and structural models in Scipion.</p>
<p><a class="reference external" href="/docs/user/importingData.rst">Here</a> we provide a tutorial for importing data inside Scipion. Below it is also provided the filled form to import our particles, which also includes the sampling rate that will be needed to import the map and mask.</p>
<div class="figure align-center">
<img alt="particles import" src="../../../../../_images/Import_particles_form1.png" />
</div>
<p>Once all the data has been imported, we are ready to start the flexibility analysis. Note that in a real project, the input data to the Flexibility Hub (particles, maps, models…) might come from different sources (imports, refinements, consensus…).</p>
</div>
<div class="section" id="zernike3deep-landscape-estimation">
<h3>2. Zernike3Deep landscape estimation<a class="headerlink" href="#zernike3deep-landscape-estimation" title="Permalink to this heading"></a></h3>
<p>Flexutils includes several Zernike3D programs able to estimate conformational landscapes from CryoEM particles. Among them, generally the best possible choice to start any analysis is the Zernike3Deep algorithm.</p>
<p>The Zernike3Deep method is a semi-classical neural network able to learn to produce meaningful Zernike3D coefficients compatible with the mathematical basis description. Therefore, it uses our own knowledge during the learning process, producing a results that is no longer a black box.</p>
<p>The Zernike3Deep pipeline is divided into two different protocols:</p>
<ul class="simple">
<li><p><strong>angular align - Zernike3Deep</strong>: Protocol responsible of training the Zernike3Deep network based on a set of input particles. In addition, it will also infer Zernike3D coefficients for those same particles.</p></li>
<li><p><strong>predict - Zernike3Deep</strong>: Protocol to infer new Zernike3D coefficients from a previously trained Zernike3Deep network and a new set of particles.</p></li>
</ul>
<p>In our workflow, we will exemplify the use of both protocols. Let’s start with the training of the Zernike3Deep network. An example of the form is provided below:</p>
<div class="figure align-center">
<img alt="Zernike3Deep input" src="../../../../../_images/Zernike3Deep_input1.png" />
</div>
<p>The form is subdivided into three different tabs (<em>Input</em>, <em>Network</em>, and <em>Cost function</em>). For this workflow, we provide below the parameters to be filled up:</p>
<ul class="simple">
<li><dl class="simple">
<dt><em>Input</em> section</dt><dd><ul>
<li><p>Input particles: Particles previously imported in the Scipion project</p></li>
<li><p>Reference type: Select <em>Volume</em> for this step</p></li>
<li><p>Input volume: The map previously imported in the Scipion project</p></li>
<li><p>Input mask: The mask previously imported in the Scipion project</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><em>Network</em> section</dt><dd><ul>
<li><p>Number of training epochs: Increase it to 50 since we have a low number of particles</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><em>Cost function</em> section (leave as default)</p></li>
</ul>
<p>Once filled up, you can click on the <code class="code docutils literal notranslate"><span class="pre">Execute</span></code> button to start tranining the Zernike3Deep network. Once it finishes, you should see an output of type <code class="code docutils literal notranslate"><span class="pre">SetOfParticlesFlex</span></code> on the <em>Summary</em> Scipion tab. The output particles will include all the information stored in the input ones, as well as the conformational landscape information estimated by the network.</p>
<p>One way to check the initial shape of our landscape is to use the Flexutils visualization tools. At the current step, we can visualize the estimated landscape by clicking on <img alt="results" src="../../../../../_images/Analyze_results.png" />. You should see a form like this:</p>
<div class="figure align-center">
<img alt="Analyze results landscape" src="../../../../../_images/Analyze_landscape1.png" />
</div>
</div>
<div class="section" id="landscape-dimensionality-reduction">
<h3>3. Landscape dimensionality reduction<a class="headerlink" href="#landscape-dimensionality-reduction" title="Permalink to this heading"></a></h3>
<p>Since the landscape estimated from the Zernike3Deep network have a large number of dimensions, we need to reduce them to a number that we can handle (usually, 2D or 3D). To that end, we can apply the dimensionality reduction protocol from Flexutils to get a meaningful representation base on different methods.</p>
<p>Currently, the methods included are the following:</p>
<ul class="simple">
<li><p><strong>PCA</strong>: Dimensionality reduction based on Principal Components Analysis. This linear method is very popular, but the representation obtained is usually not very informative unless states are well separated.</p></li>
<li><p><strong>UMAP</strong>: Non-linear dimensionality reduction method. UMAP landscapes are usually more informative than PCA, although in some cases it might lead to some artefactual generated regions.</p></li>
<li><p><strong>DeepElastic</strong>: Non-linear dimensionality reduction based on elastic analysis of clusters. it usually gives results in the middle between PCA and UMAP.</p></li>
</ul>
<p>Since the dimensionality reduction is fast, we recommend running the three methods, and use the <img alt="results" src="../../../../../_images/Analyze_results.png" /> button to check which provides a better representation for a given dataset. Note that the <img alt="results" src="../../../../../_images/Analyze_results.png" /> is currenly implemented only for 3D spaces.</p>
<p>We provide below some images of the forms filled to run any of the different dimensionality reduction methods for the tutorial dataset:</p>
<div class="figure align-left">
<img alt="Dimensionality reduction PCA" src="../../../../../_images/Dimred_pca1.png" />
</div>
<div class="figure align-center">
<img alt="Dimensionality reduction UMAP" src="../../../../../_images/Dimred_umap1.png" />
</div>
<div class="figure align-right">
<img alt="Dimensionality reduction DeepElastic" src="../../../../../_images/Dimred_deep_elastic1.png" />
</div>
<p>Since our data comes from synthetic data, we have a well define landscape shape. Ideally, the landscape we are looking for should be an exact straight line. Therefore, PCA should give better results for this case, as the relationship among different states is completely linear (and can be represented exactly by two PCA components).</p>
</div>
<div class="section" id="interactive-landscape-clustering">
<h3>4. Interactive landscape clustering<a class="headerlink" href="#interactive-landscape-clustering" title="Permalink to this heading"></a></h3>
<p>Once the Zernike3D landscape has been reduced, it is possible to use the interactive tools implemented in Flexutils to explore the different states found by the Zernike3Deep algortihm.</p>
<p>Flexutils interactive tools has been developed for both, 2D and 3D spaces, and include two different ways to explore the data:</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>Cluster space</strong> (only for 3D spaces): Interactive clustering of flexibility spaces based on KMeans. The tools provides two visualization windows:</dt><dd><ul>
<li><p>Left panel: 3D visualization of the point cloud representing the conformational landscape of the molecule</p></li>
<li><p>Right panel: Map visualization obtained from a selected cluster</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>The space can be clustered as many times as needed, based on the number of clusters specified in the corresponding field in the right panel. Once clustered, it is possible to click on any of the cluster representatives (white dots) in the left panel to get a real time representation of the map coming from that specific point. In addition, the viewer provides a shortcut to view the map representatives in ChimeraX for advanced visualization of the conformational states.
* <strong>Annotate space</strong> (for 2D and 3D spaces): Provides and interactive way to explore any region from a given conformational landscape. Therefore, it is possible to click anywhere in the landscape view to get in real time the conformational state corresponding to the selected landscape region. Similarly to the previous tool, there exists a shortcut to ChimeraX for advanced visualization.</p>
<p>Video tutorials explaining the usage of the different tools are available <a class="reference external" href="https://www.youtube.com/playlist?list=PLuu0votIJpSxTmPLvKRHV3ijadqlxxHfb">here</a>. We recommend watching these videos at this point before doing your first landscape exploration.</p>
<p>We provide below the filled form of the <strong>Cluster space</strong> protocol as an example:</p>
<div class="figure align-center">
<img alt="Cluster space" src="../../../../../_images/Cluster_space1.png" />
</div>
<p>In this case, the form only requires as input a set of particles coming from a dimensionality reduction protocol. Since <strong>Cluster space</strong> is only implemented for 3D spaces, the protocol will validate before executing whether the reduced space stored in the particle set has the appropriate dimensions.</p>
<p>Both, <strong>Cluster space</strong> and <strong>Annotate space</strong> protocols will register inside Scipion a set of classes (with flexibility information) based on your saved annotation. The set of classes provides a very convenient way to store the information extracted from the lanscape. By clicking on <img alt="results" src="../../../../../_images/Analyze_results.png" /> you will be able to:</p>
<ul class="simple">
<li><p>Inspect the set of classes information (representatives, particles associated with each representative, flexibility information…)</p></li>
<li><p>Create a subset of new classes</p></li>
<li><p>Create a subset of representatives (useful to further analyze states from the flexibility information stored)</p></li>
<li><p>Create a subset of particles associated with a given representative (useful to refine a given state)</p></li>
</ul>
<p>Let’s extract the representatives of the classes using with <img alt="volumes" src="../../../../../_images/Volumes_button.png" /> button. Thanks to this extraction, it will be possible to further analyze the Zernike3D coefficients to extract the conformational states of the representatives and get more information about the motions suffered by the protein.</p>
</div>
<div class="section" id="applying-deformation-fields">
<h3>5. Applying deformation fields<a class="headerlink" href="#applying-deformation-fields" title="Permalink to this heading"></a></h3>
<p>If we try to open any of the representative volumes extracted from the set of classes generated in the previous step, we will see that all the maps are identical to the reference volume we imported at the beginning of the workflow. Instead, the Zernike3D programs (and other programs estimating motions based on deformation fields) provide several tools to continue analyzing  flexibility information, being one of those tools the application of the estimated deformation fields to approximate a new conformational state.</p>
<p>The protocol <em>apply deformation field - Zernike3D</em> is the one responsible for this task. The protocol form will ask for a set of volumes with Zernike3D flexibility information stored. The Zernike3D flexibility information will be used to restore an estimated deformation field to be warped to yield a new state.</p>
<p>In addition, the protocol allows to provide an atomic structure (that should be ideally traced, or at least aligned against the reference map used during the Zernike3D estimations). If provided, it will be possible to get the new state as a structural model instead of as a density map.</p>
<p>By clicking on <img alt="results" src="../../../../../_images/Analyze_results.png" />, it is possible to inspect in different ways the new states (either at map or structural model level). Two of the options provided include seeing a strain or rotation color map computed from the estimated deformation fields. The strain/rotation maps summarize the information about the forces suffered by the protein when transition from the reference state to the new state we have just estimated:</p>
<ul class="simple">
<li><p><strong>Strain map</strong>: Summarizes the compression/stretching forces</p></li>
<li><p><strong>Rotation map</strong>: Summarized the rotational forces</p></li>
</ul>
</div>
<div class="section" id="workflow-summary">
<h3>6. Workflow summary<a class="headerlink" href="#workflow-summary" title="Permalink to this heading"></a></h3>
<p>Here finishes the Flexibility Hub starter guide!</p>
<p>Below we provide an example of the workflow we have defined along the tutorial. The complete template workflow is available inside the scipion-em-flexutils plugin, inside the <em>templates</em> folder (the path to your template in your system should be : <em>path/to/scipion-em-flexutils/flextuils/templates/starter_guide.json</em>). To load the template, you can use the following command: <code class="code docutils literal notranslate"><span class="pre">scipion3</span> <span class="pre">template</span> <span class="pre">path/to/scipion-em-flexutils/flextuils/templates/starter_guide.json</span></code>.</p>
<p>We also recommend moving to the <a class="reference external" href="./advanced_guide.rst">advanced guide</a> to continue learning about the Flexibility Hub strategies when dealing with experimental data.</p>
<div class="figure align-center">
<img alt="Workflow" src="../../../../../_images/Workflow1.png" />
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Scipion team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>