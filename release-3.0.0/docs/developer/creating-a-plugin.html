

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Creating a plugin &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/how-to-install.html">Installing Scipion v3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities.html">On-the-fly processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/customize-report.html">Summary Reports</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/scipion-API.html">Scipion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/plugins-API.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/xmipp-API.html">Xmipp API</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Creating a plugin</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/docs/developer/creating-a-plugin.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="figure">
<a class="reference internal image-reference" href="../../_images/scipion_logo.gif"><img alt="scipion logo" src="../../_images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="creating-a-plugin">
<span id="id1"></span><h1><a class="toc-backref" href="#id5">Creating a plugin</a><a class="headerlink" href="#creating-a-plugin" title="Permalink to this headline">¶</a></h1>
<p>A <strong>Plugin</strong> for Scipion is a Python module that meets some extra requirements.
Each Plugin contains classes for  protocols, viewers, wizards, etc…allowing to use the functionality of a given EM
package within the Scipion framework.</p>
<p>Since release 2.0.0 (“the pluginized version”) we worked hard to make the entire system more de-centralized
and more standard. For that we re-factored the plugins to make them standard Python modules so that their
code can be hosted in independent repositories and therefore, updated in different release cycles.</p>
<p>This document is organized in two main parts:</p>
<ol class="arabic simple">
<li>Explanation of the structure of a plugin as a Python module and the required submodules and functionality for Scipion.</li>
<li>Necessary files structure and the process for distributing a Plugin in the Python de-facto repository PyPI.</li>
</ol>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#creating-a-plugin" id="id5">Creating a plugin</a><ul>
<li><a class="reference internal" href="#where-to-start-scipion-em-template" id="id6">Where to start: scipion-em-template</a></li>
<li><a class="reference internal" href="#naming-conventions" id="id7">Naming Conventions</a></li>
<li><a class="reference internal" href="#plugin-overview" id="id8">Plugin overview</a><ul>
<li><a class="reference internal" href="#file-tree" id="id9">File tree</a></li>
<li><a class="reference internal" href="#standard-submodules" id="id10">Standard submodules</a><ul>
<li><a class="reference internal" href="#required" id="id11">Required</a><ul>
<li><a class="reference internal" href="#init-py" id="id12">__init__.py</a></li>
<li><a class="reference internal" href="#protocols" id="id13">Protocols</a></li>
<li><a class="reference internal" href="#tests" id="id14">Tests</a></li>
<li><a class="reference internal" href="#bibtex-py" id="id15">bibtex.py</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optional-if-necessary" id="id16">Optional / If necessary</a><ul>
<li><a class="reference internal" href="#constants-py" id="id17">constants.py</a></li>
<li><a class="reference internal" href="#convert" id="id18">Convert</a></li>
<li><a class="reference internal" href="#viewers" id="id19">Viewers</a></li>
<li><a class="reference internal" href="#wizards" id="id20">Wizards</a></li>
<li><a class="reference internal" href="#protocols-conf" id="id21">protocols.conf</a></li>
<li><a class="reference internal" href="#logo-png" id="id22">logo.png</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#gitignore-file" id="id23">.gitignore file</a></li>
<li><a class="reference internal" href="#pypi-related-files" id="id24">PyPI-related files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-init-py" id="id25">Creating __init__.py</a><ul>
<li><a class="reference internal" href="#define-the-plugin-class" id="id26">Define the Plugin class</a><ul>
<li><a class="reference internal" href="#homevar" id="id27">_homeVar</a></li>
<li><a class="reference internal" href="#supportedversions" id="id28">_supportedVersions</a></li>
<li><a class="reference internal" href="#definevariables" id="id29">_defineVariables</a></li>
<li><a class="reference internal" href="#getenviron" id="id30">getEnviron</a></li>
<li><a class="reference internal" href="#implement-validateinstallation-optional" id="id31">Implement validateInstallation() (Optional)</a></li>
<li><a class="reference internal" href="#defining-the-plugin-binaries-optional" id="id32">Defining the plugin binaries (Optional)</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#creating-the-protocols" id="id33">Creating the protocols</a></li>
<li><a class="reference internal" href="#publishing-the-plugin-to-pypi" id="id34">Publishing the Plugin to PyPI</a><ul>
<li><a class="reference internal" href="#add-pypi-files" id="id35">Add PyPI files</a><ul>
<li><a class="reference internal" href="#setup-py" id="id36">setup.py</a></li>
<li><a class="reference internal" href="#changes-txt-optional" id="id37">CHANGES.txt (optional)</a></li>
<li><a class="reference internal" href="#manifest-in-optional" id="id38">MANIFEST.in (optional)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installing-via-pip-locally" id="id39">Installing via pip locally</a><ul>
<li><a class="reference internal" href="#remove-previous-installation-from-scipion" id="id40">Remove previous installation from Scipion</a></li>
<li><a class="reference internal" href="#working-in-devel-mode" id="id41">Working in devel mode</a></li>
<li><a class="reference internal" href="#testing-the-plugin" id="id42">Testing the Plugin</a></li>
<li><a class="reference internal" href="#get-plugins-json" id="id43">Get plugins.json</a><ul>
<li><a class="reference internal" href="#download-json-file" id="id44">Download json file</a></li>
<li><a class="reference internal" href="#add-scipion-plugin-json-variable" id="id45">Add SCIPION_PLUGIN_JSON variable</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation-script" id="id46">Installation script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-your-tests" id="id47">Running your tests</a><ul>
<li><a class="reference internal" href="#add-your-own-dataset-if-necessary" id="id48">Add your own DataSet (if necessary)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-and-upload-distribution" id="id49">Create and upload distribution</a></li>
<li><a class="reference internal" href="#install-from-pip" id="id50">Install from pip</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="where-to-start-scipion-em-template">
<h2><a class="toc-backref" href="#id6">Where to start: scipion-em-template</a><a class="headerlink" href="#where-to-start-scipion-em-template" title="Permalink to this headline">¶</a></h2>
<p>This repository contains a <a class="reference external" href="https://github.com/scipion-em/scipion-em-template">Scipion template</a> plugin with “git
tags” describing the steps taken to build it. It is the perfect starting point for a practical following of the next
sections. Although this whole page is referred to
<a class="reference external" href="https://github.com/scipion-em/scipion-em-relion">Relion’s repository</a>, the template has been conceived to offer a
simple practical example that can be easily edited for a better understanding of Scipion Plugin development. Relion is
a real product with the corresponding complexity, so the recommendation is to follow the explanations approached in this
page and observe them in a real product while creating a simple one based on the template to consolidate the knowledge
and make the process more practical.</p>
<p>Thus, the recommendation is to start from the template as a plugin in developer mode, which means that all the changes
made will be observable in Scipion. To do this:</p>
<p>1.- clone the template repository in a desired location:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone  git@github.com:scipion-em/scipion-em-template.git scipion-em-myplugin
</pre></div>
</div>
<p>2.- remove .git folder and start a clean repo</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> scipion-em-myplugin
rm -rf .git
git init
</pre></div>
</div>
<p>3.- Install the plugin</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$SCIPION_HOME</span>/scipion3 installp -p <span class="o">[</span>PATH_WHERE_CLONED<span class="o">]</span>/scipion-em-myplugin --devel
</pre></div>
</div>
<p>Then, open Scipion and create a new project or open an existing one. The template example can be found in the left
panel, with selected Protocols SPA as selected View in section Tools &gt; Greetings. Another quick access to it consists on
pressing ctrl + F and search for the world ‘Hello’.</p>
</div>
<div class="section" id="naming-conventions">
<h2><a class="toc-backref" href="#id7">Naming Conventions</a><a class="headerlink" href="#naming-conventions" title="Permalink to this headline">¶</a></h2>
<p>Similar to style guides, conventions are about consistency. Consistency is crucial for a project such as
Scipion and its distributed nature. Despite the final decision is up to the developer of a package, we STRONGLY
recommend the following conventions:</p>
<ul class="simple">
<li>Repository name: <strong>scipion-em-myplugin</strong></li>
<li>Python package name: <strong>scipion-em-myplugin</strong></li>
<li>Python module with package code: <strong>myplugin</strong></li>
</ul>
<p>This means that it will be a folder named <strong>scipion-em-myplugin</strong> with the structure of a standard Python package
(explained below in the second part) and it will contain a folder <strong>myplugin</strong> that is a Python module
with functions and classes required by Scipion (explained below).</p>
</div>
<div class="section" id="plugin-overview">
<h2><a class="toc-backref" href="#id8">Plugin overview</a><a class="headerlink" href="#plugin-overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="file-tree">
<h3><a class="toc-backref" href="#id9">File tree</a><a class="headerlink" href="#file-tree" title="Permalink to this headline">¶</a></h3>
<p>The file and folder structure follows the convention established for Python modules.
For example, the Relion plugin has the following structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/work/development/scipion-em-plugins/scipion-em-relion
$ tree
.
├── CHANGES.txt
├── LICENSE
├── MANIFEST.in
├── README.rst
├── relion
│   ├── bibtex.py
│   ├── constants.py
│   ├── convert
│   │   ├── __init__.py
│   │   ├── convert30.py
│   │   ├── ...
│   ├── __init__.py
│   ├── objects.py
│   ├── protocols
│   │   ├── __init__.py
│   │   ├── protocol_assign_optic_groups.py
│   │   ├── protocol_autopick_log.py
│   │   ├── protocol_autopick.py
│   │   ├── ...
│   ├── protocols.conf
│   ├── relion_logo.png
│   ├── tests
│   │   ├── __init__.py
│   │   ├── test_convert_relion.py
│   │   ├── test_protocols_relion3.py
│   │   ├── ...
│   ├── viewers
│   │   ├── __init__.py
│   │   ├── viewer_base.py
│   │   ├── ...
│   ├── wizards.py
└── setup.py
</pre></div>
</div>
</div>
<div class="section" id="standard-submodules">
<span id="id2"></span><h3><a class="toc-backref" href="#id10">Standard submodules</a><a class="headerlink" href="#standard-submodules" title="Permalink to this headline">¶</a></h3>
<div class="section" id="required">
<h4><a class="toc-backref" href="#id11">Required</a><a class="headerlink" href="#required" title="Permalink to this headline">¶</a></h4>
<p>Scipion plugins are usually composed by the following submodules:</p>
<div class="section" id="init-py">
<h5><a class="toc-backref" href="#id12">__init__.py</a><a class="headerlink" href="#init-py" title="Permalink to this headline">¶</a></h5>
<p>This file is required in Python modules and it is executed when the module is imported. It is explained in detail below
in section Creating __init__.py_.</p>
</div>
<div class="section" id="protocols">
<h5><a class="toc-backref" href="#id13">Protocols</a><a class="headerlink" href="#protocols" title="Permalink to this headline">¶</a></h5>
<p>In this submodule all the protocols of the plugin should be implemented.
Usually a plugin provides many protocols, so the most common case is to have a
submodule folder with its own <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> and one .py file per each protocol class.</p>
</div>
<div class="section" id="tests">
<h5><a class="toc-backref" href="#id14">Tests</a><a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h5>
<p>We strongly recommend to follow Test-Driven-Development, so this is the place where all plugin tests should go.
It is important to create different test cases from the beginning of the plugin development.</p>
</div>
<div class="section" id="bibtex-py">
<h5><a class="toc-backref" href="#id15">bibtex.py</a><a class="headerlink" href="#bibtex-py" title="Permalink to this headline">¶</a></h5>
<p>This submodule is not supposed to be imported directly, it should contain the bibtex string
literal as the Python doc string. Scipion will take care of parsing the bibtex reference and
incorporate into the plugin module.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">@article{Scheres2012a,</span>
<span class="s2">title = &quot;A Bayesian View on Cryo-EM Structure Determination &quot;,</span>
<span class="s2">journal = &quot;JMB&quot;,</span>
<span class="s2">volume = &quot;415&quot;,</span>
<span class="s2">number = &quot;2&quot;,</span>
<span class="s2">pages = &quot;406 - 418&quot;,</span>
<span class="s2">year = &quot;2012&quot;,</span>
<span class="s2">issn = &quot;0022-2836&quot;,</span>
<span class="s2">doi = &quot;http://dx.doi.org/10.1016/j.jmb.2011.11.010&quot;,</span>
<span class="s2">url = &quot;http://www.sciencedirect.com/science/article/pii/S0022283611012290&quot;,</span>
<span class="s2">author = &quot;Scheres, Sjors H.W.&quot;,</span>
<span class="s2">keywords = &quot;cryo-electron microscopy, three-dimensional reconstruction, maximum a posteriori estimation &quot;</span>
<span class="s2">}</span>

<span class="s2">@article{Scheres2012b,</span>
<span class="s2">title = &quot;RELION: Implementation of a Bayesian approach to cryo-EM structure determination &quot;,</span>
<span class="s2">journal = &quot;JSB&quot;,</span>
<span class="s2">volume = &quot;180&quot;,</span>
<span class="s2">number = &quot;3&quot;,</span>
<span class="s2">pages = &quot;519 - 530&quot;,</span>
<span class="s2">year = &quot;2012&quot;,</span>
<span class="s2">issn = &quot;1047-8477&quot;,</span>
<span class="s2">doi = &quot;http://dx.doi.org/10.1016/j.jsb.2012.09.006&quot;,</span>
<span class="s2">url = &quot;http://www.sciencedirect.com/science/article/pii/S1047847712002481&quot;,</span>
<span class="s2">author = &quot;Scheres, Sjors H.W.&quot;,</span>
<span class="s2">keywords = &quot;Electron microscopy, Single-particle analysis, Maximum likelihood, Image processing, Software development &quot;</span>
<span class="s2">}</span>
<span class="s2">[. . .]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="optional-if-necessary">
<h4><a class="toc-backref" href="#id16">Optional / If necessary</a><a class="headerlink" href="#optional-if-necessary" title="Permalink to this headline">¶</a></h4>
<div class="section" id="constants-py">
<h5><a class="toc-backref" href="#id17">constants.py</a><a class="headerlink" href="#constants-py" title="Permalink to this headline">¶</a></h5>
<p>This submodule should contain all the constants that can be later imported in protocols etc. If there are only few of
them, there is no need for a separate constants.py file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="kn">import</span> <span class="nn">pwem.emlib.metadata</span> <span class="kn">as</span> <span class="nn">md</span>

<span class="c1"># ----------------- Constants values ----------------------</span>

<span class="n">RELION_HOME</span> <span class="o">=</span> <span class="s1">&#39;RELION_HOME&#39;</span>
<span class="n">RELION_CUDA_LIB</span> <span class="o">=</span> <span class="s1">&#39;RELION_CUDA_LIB&#39;</span>

<span class="c1"># Supported versions:</span>
<span class="n">V3_0</span> <span class="o">=</span> <span class="s1">&#39;3.0&#39;</span>
<span class="n">V3_1</span> <span class="o">=</span> <span class="s1">&#39;3.1&#39;</span>

<span class="n">MASK_FILL_ZERO</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">MASK_FILL_NOISE</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="convert">
<h5><a class="toc-backref" href="#id18">Convert</a><a class="headerlink" href="#convert" title="Permalink to this headline">¶</a></h5>
<p>This submodule might contain all functions used for conversion between Scipion objects and metadata files needed
by the programs inside the plugin. In cases when there are only few conversion functions, the
submodule folder can be replaced by a single <code class="docutils literal notranslate"><span class="pre">convert.py</span></code> file.</p>
</div>
<div class="section" id="viewers">
<h5><a class="toc-backref" href="#id19">Viewers</a><a class="headerlink" href="#viewers" title="Permalink to this headline">¶</a></h5>
<p>A plugin can also define viewers for existing objects or new protocols.
Since many built-in viewers are provided by Scipion, plugins do not define many viewers,
so a <code class="docutils literal notranslate"><span class="pre">viewers.py</span></code> will serve as submodule.</p>
</div>
<div class="section" id="wizards">
<h5><a class="toc-backref" href="#id20">Wizards</a><a class="headerlink" href="#wizards" title="Permalink to this headline">¶</a></h5>
<p>Wizards need to be defined for protocols/parameters, but many base classes are already provided.
Here again the <code class="docutils literal notranslate"><span class="pre">wizards.py</span></code> submodule is usually enough.</p>
</div>
<div class="section" id="protocols-conf">
<span id="id3"></span><h5><a class="toc-backref" href="#id21">protocols.conf</a><a class="headerlink" href="#protocols-conf" title="Permalink to this headline">¶</a></h5>
<p>This submodule contains the location of all protocols in the Scipion Protocols Tree View.
This file is optional in Python modules and it is loaded when the module is imported if it exists.
If the file does not exist, the protocols will be loaded in the All view. Scipion will take care of
parsing the file and incorporating its contents into Scipion’s Tree View. For example, the Relion <code class="docutils literal notranslate"><span class="pre">protocol.conf</span></code> has
the following structure:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="k">[PROTOCOLS]</span>
<span class="na">Protocols SPA</span> <span class="o">=</span> <span class="s">[</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;Imports&quot;, &quot;icon&quot;: &quot;bookmark.gif&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtImportMovies&quot;,      &quot;text&quot;: &quot;import movies&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtImportMicrographs&quot;, &quot;text&quot;: &quot;import micrographs&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtImportParticles&quot;,   &quot;text&quot;: &quot;import particles&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtImportVolumes&quot;,     &quot;text&quot;: &quot;import volumes&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;more&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtImportCoordinates&quot;,   &quot;text&quot;: &quot;import coordinates&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtImportCTF&quot;,   &quot;text&quot;: &quot;import ctfs&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtImportPdb&quot;,   &quot;text&quot;: &quot;import atomic structure&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtImportAverages&quot;,    &quot;text&quot;: &quot;import averages&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtImportMask&quot;,        &quot;text&quot;: &quot;import masks&quot;}</span>
<span class="s">    ]}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;Movies&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionMotioncor&quot;, &quot;text&quot;: &quot;default&quot;}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;Micrographs&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;CTF estimation&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;more&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionExportCtf&quot;, &quot;text&quot;: &quot;default&quot;}</span>
<span class="s">    ]}</span>
<span class="s">    ]}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;Particles&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Picking&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelion2Autopick&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">  {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionAutopickLoG&quot;, &quot;text&quot;: &quot;default&quot;}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Extract&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionExtractParticles&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;more&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionExportParticles&quot;, &quot;text&quot;: &quot;default&quot;}</span>
<span class="s">    ]}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Preprocess&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionPreprocessParticles&quot;, &quot;text&quot;: &quot;default&quot;}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Filter&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: []},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Mask&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: []}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;2D&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Align&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionCenterAverages&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;more&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: []}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Classify&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionClassify2D&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;more&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: []}</span>
<span class="s">    ]}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;3D&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Initial volume&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionInitialModel&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;more&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: []}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Preprocess&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionCreateMask3D&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;more&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: []}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Classify&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionClassify3D&quot;, &quot;text&quot;: &quot;default&quot;}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Refine&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionRefine3D&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">  {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionCtfRefinement&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">  {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionBayesianPolishing&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">  {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionMultiBody&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;more&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: []}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Postprocess&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionPostprocess&quot;, &quot;text&quot;: &quot;default&quot;}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Analysis&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;Heterogeneity&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: []},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;Validation&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: []},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;Resolution&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionLocalRes&quot;, &quot;text&quot;: &quot;default&quot;}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;more&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionExpandSymmetry&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">  {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionSubtract&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">  {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionSymmetrizeVolume&quot;, &quot;text&quot;: &quot;default&quot;}</span>
<span class="s">    ]}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Reconstruct&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionReconstruct&quot;, &quot;text&quot;: &quot;default&quot;}</span>
<span class="s">    ]}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;Tools&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol_group&quot;, &quot;text&quot;: &quot;Sets&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtSubSet&quot;,   &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtUnionSet&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtSplitSet&quot;, &quot;text&quot;: &quot;default&quot;}</span>
<span class="s">    ]}</span>
<span class="s">    ]},</span>
<span class="s">    {&quot;tag&quot;: &quot;section&quot;, &quot;text&quot;: &quot;Exports&quot;, &quot;openItem&quot;: &quot;False&quot;, &quot;children&quot;: [</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionExportCtf&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">  {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtRelionExportParticles&quot;, &quot;text&quot;: &quot;default&quot;},</span>
<span class="s">    {&quot;tag&quot;: &quot;protocol&quot;, &quot;value&quot;: &quot;ProtExportDataBases&quot;, &quot;text&quot;: &quot;export to DB&quot;}]</span>
<span class="s">    }]</span>
</pre></div>
</div>
</div>
<div class="section" id="logo-png">
<h5><a class="toc-backref" href="#id22">logo.png</a><a class="headerlink" href="#logo-png" title="Permalink to this headline">¶</a></h5>
<p>PNG image that will be be shown in the GUIs of the plugin protocols within Scipion framework.</p>
</div>
</div>
</div>
<div class="section" id="gitignore-file">
<h3><a class="toc-backref" href="#id23">.gitignore file</a><a class="headerlink" href="#gitignore-file" title="Permalink to this headline">¶</a></h3>
<p>This file is required for Git. Here is an example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#### Eclipse and so on
.project
.cproject
.pydevproject
.classpath
.idea

#### Python
build/
dist/
*.egg-info/
*.egg
*.py[cod]
__pycache__/
*.so
*~
</pre></div>
</div>
</div>
<div class="section" id="pypi-related-files">
<h3><a class="toc-backref" href="#id24">PyPI-related files</a><a class="headerlink" href="#pypi-related-files" title="Permalink to this headline">¶</a></h3>
<p>These files are required for PyPI distribution. More information about this can be found on the
<a class="reference external" href="https://packaging.python.org/tutorials/packaging-projects/#setup-cfg">pip packaging guide</a> .</p>
<ul class="simple">
<li><strong>LICENSE</strong>: license file for plugin code</li>
<li><strong>CHANGES.txt</strong>: version history</li>
<li><strong>README.rst</strong>: long description of your plugin (for PyPI catalog)</li>
<li><strong>MANIFEST.in</strong>: includes links to <code class="docutils literal notranslate"><span class="pre">README</span></code> and <code class="docutils literal notranslate"><span class="pre">LICENSE</span></code> files</li>
<li><strong>setup.py</strong>: this is a build script for PyPI distribution, containing important information about your plugin.</li>
</ul>
<p>Read the <a class="reference internal" href="#publishing-to-pypi"><span class="std std-ref">Publishing the plugin to PyPI</span></a> section below for more details on these files.</p>
</div>
</div>
<div class="section" id="creating-init-py">
<span id="id4"></span><h2><a class="toc-backref" href="#id25">Creating __init__.py</a><a class="headerlink" href="#creating-init-py" title="Permalink to this headline">¶</a></h2>
<p>It is common to add here imports
related with Scipion’s pyworkflow, and to import values from the <code class="docutils literal notranslate"><span class="pre">constants.py</span></code> file. We also define the logo and
plugin-level references:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pyworkflow.utils</span> <span class="kn">as</span> <span class="nn">pwutils</span>
<span class="kn">import</span> <span class="nn">pwem</span>

<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">_logo</span> <span class="o">=</span> <span class="s2">&quot;relion_logo.png&quot;</span>
<span class="n">_references</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Scheres2012a&#39;</span><span class="p">,</span> <span class="s1">&#39;Scheres2012b&#39;</span><span class="p">,</span> <span class="s1">&#39;Kimanius2016&#39;</span><span class="p">,</span> <span class="s1">&#39;Zivanov2018&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="define-the-plugin-class">
<h3><a class="toc-backref" href="#id26">Define the Plugin class</a><a class="headerlink" href="#define-the-plugin-class" title="Permalink to this headline">¶</a></h3>
<p>Additionally, it is necessary to add a Plugin class (subclass from <a class="reference internal" href="../../api/pwem/pwem.html#pwem.Plugin" title="pwem.Plugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">pwem.Plugin</span></code></a>), which contains much of the
logic related with the plugin’s variables, environment, associated binaries and paths.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Plugin</span><span class="p">(</span><span class="n">pwem</span><span class="o">.</span><span class="n">Plugin</span><span class="p">):</span>
    <span class="n">_homeVar</span> <span class="o">=</span> <span class="n">RELION_HOME</span>
    <span class="n">_supportedVersions</span> <span class="o">=</span> <span class="p">[</span><span class="n">V3_0</span><span class="p">,</span> <span class="n">V3_1</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="homevar">
<h4><a class="toc-backref" href="#id27">_homeVar</a><a class="headerlink" href="#homevar" title="Permalink to this headline">¶</a></h4>
<p>In the case of scipion-em-relion, the plugin is associated to some binaries. In <code class="docutils literal notranslate"><span class="pre">_homeVar</span></code>, we point to the variable that
has the path to the binaries. It is a good practice to define this in <code class="docutils literal notranslate"><span class="pre">constants.py</span></code>, as it is done here.
As we will see later, this has a default value, but it can also be overwritten by the user.</p>
</div>
<div class="section" id="supportedversions">
<h4><a class="toc-backref" href="#id28">_supportedVersions</a><a class="headerlink" href="#supportedversions" title="Permalink to this headline">¶</a></h4>
<p>Here we store which versions of the binaries are supported by this plugin.</p>
</div>
<div class="section" id="definevariables">
<h4><a class="toc-backref" href="#id29">_defineVariables</a><a class="headerlink" href="#definevariables" title="Permalink to this headline">¶</a></h4>
<p>Here is where we give the Plugin’s environment variables a default value. In the case of Relion, we only have the
<code class="docutils literal notranslate"><span class="pre">RELION_HOME</span></code>, which points to the binaries of the plugin and by default would be <code class="docutils literal notranslate"><span class="pre">relion-3.1</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">_defineVariables</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">_defineEmVar</span><span class="p">(</span><span class="n">RELION_HOME</span><span class="p">,</span> <span class="s1">&#39;relion-3.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>There are two functions defined in the <span class="xref std std-doc">plugin class</span> that may be useful here:
<code class="docutils literal notranslate"><span class="pre">_defineEmVar</span></code> and <code class="docutils literal notranslate"><span class="pre">_defineVar</span></code>. The first one will add the path to <code class="docutils literal notranslate"><span class="pre">software/em</span></code> to the variable
(which is the default place to install binaries). The second will store the value as is.
We only need <code class="docutils literal notranslate"><span class="pre">defineEmVar</span></code> in Relion, since the binary location is the only variable we’ll declare.</p>
</div>
<div class="section" id="getenviron">
<h4><a class="toc-backref" href="#id30">getEnviron</a><a class="headerlink" href="#getenviron" title="Permalink to this headline">¶</a></h4>
<p>We can also overwrite the function <code class="docutils literal notranslate"><span class="pre">getEnviron</span></code> if there are any modifications we need to do in the environment
variables in order to run the plugin.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">getEnviron</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Setup the environment variables needed to launch Relion. &quot;&quot;&quot;</span>
    <span class="n">environ</span> <span class="o">=</span> <span class="n">pwutils</span><span class="o">.</span><span class="n">Environ</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
    <span class="n">binPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">cls</span><span class="o">.</span><span class="n">getHome</span><span class="p">(</span><span class="s1">&#39;bin&#39;</span><span class="p">),</span>
                               <span class="n">pwem</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">MPI_BINDIR</span><span class="p">])</span>
    <span class="n">libPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">cls</span><span class="o">.</span><span class="n">getHome</span><span class="p">(</span><span class="s1">&#39;lib&#39;</span><span class="p">),</span>
                               <span class="bp">cls</span><span class="o">.</span><span class="n">getHome</span><span class="p">(</span><span class="s1">&#39;lib64&#39;</span><span class="p">),</span>
                               <span class="n">pwem</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">MPI_LIBDIR</span><span class="p">,</span>
                               <span class="p">])</span>

    <span class="k">if</span> <span class="n">binPath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]:</span>
        <span class="n">environ</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;PATH&#39;</span><span class="p">:</span> <span class="n">binPath</span><span class="p">,</span>
                        <span class="s1">&#39;LD_LIBRARY_PATH&#39;</span><span class="p">:</span> <span class="n">libPath</span><span class="p">,</span>
                        <span class="p">},</span> <span class="n">position</span><span class="o">=</span><span class="n">pwutils</span><span class="o">.</span><span class="n">Environ</span><span class="o">.</span><span class="n">BEGIN</span><span class="p">)</span>

    <span class="c1"># Take Scipion CUDA library path</span>
    <span class="n">cudaLib</span> <span class="o">=</span> <span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">RELION_CUDA_LIB</span><span class="p">,</span> <span class="n">pwem</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">CUDA_LIB</span><span class="p">)</span>
    <span class="n">environ</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span><span class="n">cudaLib</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;RELION_MPI_LIB&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">environ</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;RELION_MPI_LIB&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="s1">&#39;RELION_MPI_BIN&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">environ</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;PATH&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;RELION_MPI_BIN&#39;</span><span class="p">],</span>
                    <span class="n">position</span><span class="o">=</span><span class="n">pwutils</span><span class="o">.</span><span class="n">Environ</span><span class="o">.</span><span class="n">BEGIN</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">environ</span>
</pre></div>
</div>
</div>
<div class="section" id="implement-validateinstallation-optional">
<h4><a class="toc-backref" href="#id31">Implement validateInstallation() (Optional)</a><a class="headerlink" href="#implement-validateinstallation-optional" title="Permalink to this headline">¶</a></h4>
<p>In the plugin class, we can overwrite the validateInstallation function. In the case of Relion this is not overwritten,
so this plugin will use Scipion’s default validate installation. You can check the current implementation in
<code class="docutils literal notranslate"><span class="pre">scipion-pyworkflow/pyworkflow/plugin.py</span></code>.</p>
</div>
<div class="section" id="defining-the-plugin-binaries-optional">
<h4><a class="toc-backref" href="#id32">Defining the plugin binaries (Optional)</a><a class="headerlink" href="#defining-the-plugin-binaries-optional" title="Permalink to this headline">¶</a></h4>
<p>The next step is to add the code responsible for the installation of the binaries.
We redefine <code class="docutils literal notranslate"><span class="pre">defineBinaries</span></code> in our <code class="docutils literal notranslate"><span class="pre">RelionPlugin</span></code> class in the <strong>`__init__.py`</strong>.
Please note how we have added <code class="docutils literal notranslate"><span class="pre">default=True</span></code> to the latest relion binaries. - this means that
this binary will be installed automatically when we get this plugin (unless specified otherwise).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># this goes inside class RelionPlugin(Plugin):</span>
<span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">defineBinaries</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
    <span class="c1"># Define FFTW3 path variables</span>
    <span class="n">relion_vars</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;FFTW_LIB&#39;</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">getLibFolder</span><span class="p">(),</span>
                   <span class="s1">&#39;FFTW_INCLUDE&#39;</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">getIncludeFolder</span><span class="p">()}</span>

    <span class="n">relion_commands</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;cmake -DGUI=OFF -DCMAKE_INSTALL_PREFIX=./ .&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                       <span class="p">(</span><span class="s1">&#39;make -j </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">getProcessors</span><span class="p">(),</span>
                        <span class="p">[</span><span class="s1">&#39;bin/relion_refine&#39;</span><span class="p">])]</span>

    <span class="n">env</span><span class="o">.</span><span class="n">addPackage</span><span class="p">(</span><span class="s1">&#39;relion&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;3.0&#39;</span><span class="p">,</span>
                   <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://github.com/3dem/relion/archive/3.0.tar.gz&#39;</span><span class="p">,</span>
                   <span class="n">commands</span><span class="o">=</span><span class="n">relion_commands</span><span class="p">,</span>
                   <span class="n">updateCuda</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                   <span class="nb">vars</span><span class="o">=</span><span class="n">relion_vars</span><span class="p">)</span>

    <span class="n">env</span><span class="o">.</span><span class="n">addPackage</span><span class="p">(</span><span class="s1">&#39;relion&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;3.1&#39;</span><span class="p">,</span>
                   <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;relion-3.1.tgz&#39;</span><span class="p">,</span>
                   <span class="n">commands</span><span class="o">=</span><span class="n">relion_commands</span><span class="p">,</span>
                   <span class="n">updateCuda</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                   <span class="nb">vars</span><span class="o">=</span><span class="n">relion_vars</span><span class="p">,</span>
                   <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>You can find more information about how to add a packages or a module <a class="reference external" href="scipion-installation-system">[here]</a>.</p>
</div>
</div>
</div>
<div class="section" id="creating-the-protocols">
<h2><a class="toc-backref" href="#id33">Creating the protocols</a><a class="headerlink" href="#creating-the-protocols" title="Permalink to this headline">¶</a></h2>
<p>You can read more detailed information on the <a class="reference internal" href="creating-a-protocol.html"><span class="doc">implementation of protocol</span></a>.</p>
</div>
<div class="section" id="publishing-the-plugin-to-pypi">
<span id="publishing-to-pypi"></span><h2><a class="toc-backref" href="#id34">Publishing the Plugin to PyPI</a><a class="headerlink" href="#publishing-the-plugin-to-pypi" title="Permalink to this headline">¶</a></h2>
<p>We’ll explain below the steps followed to convert the package into a pip module that we can
upload to pypi. Most of these steps are not scipion-specific, so it is recommended to check an external source if you
have doubts about pip packaging (like <a class="reference external" href="https://python-packaging.readthedocs.io/en/latest/index.html">https://python-packaging.readthedocs.io/en/latest/index.html</a> or
<a class="reference external" href="https://packaging.python.org/tutorials/distributing-packages">https://packaging.python.org/tutorials/distributing-packages</a> ).</p>
<div class="section" id="add-pypi-files">
<h3><a class="toc-backref" href="#id35">Add PyPI files</a><a class="headerlink" href="#add-pypi-files" title="Permalink to this headline">¶</a></h3>
<p>First we’ll add four files to the folder <code class="docutils literal notranslate"><span class="pre">scipion-em-relion</span></code>: <code class="docutils literal notranslate"><span class="pre">CHANGES.txt</span></code>, <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>, <code class="docutils literal notranslate"><span class="pre">MANIFEST.in</span></code>,
<code class="docutils literal notranslate"><span class="pre">README.rst</span></code>.</p>
<div class="section" id="setup-py">
<h4><a class="toc-backref" href="#id36">setup.py</a><a class="headerlink" href="#setup-py" title="Permalink to this headline">¶</a></h4>
<p>This is the most important one. It needs to call the setup function with, at least, the required arguments.
Here we present a synthesized version:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>
<span class="kn">from</span> <span class="nn">codecs</span> <span class="kn">import</span> <span class="nb">open</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>

<span class="n">here</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

<span class="c1"># Get the long description from the README file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s1">&#39;README.rst&#39;</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">long_description</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;scipion-em-relion&#39;</span><span class="p">,</span>  <span class="c1"># Required</span>
    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;3.0.0&#39;</span><span class="p">,</span>  <span class="c1"># Required</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;A python wrapper to use relion within Scipion&#39;</span><span class="p">,</span>  <span class="c1"># Required</span>
    <span class="n">long_description</span><span class="o">=</span><span class="n">long_description</span><span class="p">,</span>  <span class="c1"># Optional</span>
    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://github.com/scipion-em/scipion-em-relion&#39;</span><span class="p">,</span>  <span class="c1"># Optional, but very important</span>
    <span class="n">author</span><span class="o">=</span><span class="s1">&#39;Relion authors&#39;</span><span class="p">,</span>  <span class="c1"># Optional</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s1">&#39;some@human.com&#39;</span><span class="p">,</span>  <span class="c1"># Optional</span>
    <span class="n">keywords</span><span class="o">=</span><span class="s1">&#39;scipion cryoem imageprocessing scipion-3.0&#39;</span><span class="p">,</span>  <span class="c1"># Optional</span>
    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(),</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;scipion-em&#39;</span><span class="p">],</span>
    <span class="n">package_data</span><span class="o">=</span><span class="p">{</span>  <span class="c1">#!!!!!! Required if we have a logo!!!!!</span>
       <span class="s1">&#39;relion&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;logo.png&#39;</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>  <span class="c1"># Required for plugin discovery</span>
    <span class="s1">&#39;pyworkflow.plugin&#39;</span><span class="p">:</span> <span class="s1">&#39;relion = relion&#39;</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Pay special attention to entry_points, that is the mechanism to tell scipion that this is a scipion plugin.</p>
</div>
<div class="section" id="changes-txt-optional">
<h4><a class="toc-backref" href="#id37">CHANGES.txt (optional)</a><a class="headerlink" href="#changes-txt-optional" title="Permalink to this headline">¶</a></h4>
<p>This file records a short description of the modifications made with each release of the pip package.
.. code-block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">v1</span><span class="o">.</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">23</span><span class="o">/</span><span class="mi">04</span><span class="o">/</span><span class="mi">2018</span> <span class="o">--</span> <span class="n">First</span> <span class="n">commit</span>
</pre></div>
</div>
</div>
<div class="section" id="manifest-in-optional">
<h4><a class="toc-backref" href="#id38">MANIFEST.in (optional)</a><a class="headerlink" href="#manifest-in-optional" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">MANIFEST.in</span></code> is needed so that our <code class="docutils literal notranslate"><span class="pre">.txt</span></code> file is included when we do the distribution
(or many other non <code class="docutils literal notranslate"><span class="pre">*.py</span></code> extensions, please check these
<a class="reference external" href="https://python-packaging.readthedocs.io/en/latest/non-code-files.html">docs on non-code-files</a>
if you need to include such files).</p>
<p><strong>IMPORTANT</strong>: if you have non-python files like images (except the logo), docs, scripts, you have to specify them here,
otherwise they will be excluded from PyPi distribution! An example below recursively includes all files in
spider/scripts folder.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>include *.txt
recursive-include spider/scripts *
</pre></div>
</div>
<p>Also, you will need to add/uncomment the following line into <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>:
<code class="docutils literal notranslate"><span class="pre">include_package_data=True</span></code></p>
</div>
</div>
<div class="section" id="installing-via-pip-locally">
<h3><a class="toc-backref" href="#id39">Installing via pip locally</a><a class="headerlink" href="#installing-via-pip-locally" title="Permalink to this headline">¶</a></h3>
<div class="section" id="remove-previous-installation-from-scipion">
<h4><a class="toc-backref" href="#id40">Remove previous installation from Scipion</a><a class="headerlink" href="#remove-previous-installation-from-scipion" title="Permalink to this headline">¶</a></h4>
<p>Remove binaries - if it applies. If you didn’t have a prior binary installation (i.e. you’re building this plugin new
from scratch), go to next step.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm -rf <span class="nv">$SCIPION_HOME</span>/software/em/relion*
</pre></div>
</div>
</div>
<div class="section" id="working-in-devel-mode">
<span id="devel-mode"></span><h4><a class="toc-backref" href="#id41">Working in devel mode</a><a class="headerlink" href="#working-in-devel-mode" title="Permalink to this headline">¶</a></h4>
<p>If you want to use the sources of a plugin in a “live” way (meaning that changes in the plugin code will be reflected),
you can use the <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> as described above. Additionally, if you want to test the whole plugin as a pip package
(not only a python module) you can alternatively follow these two steps:</p>
<ol class="arabic simple">
<li>git clone the plugin repository to any local folder, in case of a third party plugin</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone git@github.com:scipion-em/scipion-em-myplugin.git /home/me/myplugin
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Install it in “devel” mode:</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$SCIPION_HOME</span>/scipion3 installp -p /home/me/myplugin --devel
</pre></div>
</div>
</div>
<div class="section" id="testing-the-plugin">
<h4><a class="toc-backref" href="#id42">Testing the Plugin</a><a class="headerlink" href="#testing-the-plugin" title="Permalink to this headline">¶</a></h4>
<p>Once you think your <a class="reference internal" href="#standard-submodules"><span class="std std-ref">standard submodules</span></a> have some basic functionality, and the plugin ins installed
you’re ready to test how your code behaves within Scipion. It has to have a pip package structure.</p>
<p>Once installed you are ready to troubleshoot your plugin structure with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scipion3 inspect relion
</pre></div>
</div>
<ul class="simple">
<li>List your tests and copy the one you want to run:</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scipion3 <span class="nb">test</span> --grep relion
</pre></div>
</div>
</div>
<div class="section" id="get-plugins-json">
<h4><a class="toc-backref" href="#id43">Get plugins.json</a><a class="headerlink" href="#get-plugins-json" title="Permalink to this headline">¶</a></h4>
<p>Scipion requests a json list of available plugins from <a class="reference external" href="http://scipion.i2pc.es/getplugins">http://scipion.i2pc.es/getplugins</a> and uses metadata from
pypi to filter which packages are available for the current Scipion version. Since we want to test our pip
plugin before we upload it to pypi, we will read locally a file like the one provided in the website,
with our plugin added.</p>
<div class="section" id="download-json-file">
<h5><a class="toc-backref" href="#id44">Download json file</a><a class="headerlink" href="#download-json-file" title="Permalink to this headline">¶</a></h5>
<p>In a directory of your choice, add a <code class="docutils literal notranslate"><span class="pre">plugins.json</span></code> file with the appropriate info for your plugin - you can save
<a class="reference external" href="http://scipion.i2pc.es/getplugins">Scipion’s plugins.json</a> and add your plugin’s data.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;scipion-em-relion&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;relion&quot;</span><span class="p">,</span>
        <span class="nt">&quot;pipName&quot;</span><span class="p">:</span> <span class="s2">&quot;scipion-em-relion&quot;</span><span class="p">,</span>
        <span class="nt">&quot;pluginSourceUrl&quot;</span><span class="p">:</span><span class="s2">&quot;/path/to/your/scipion-em-relion&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that when you add the key <code class="docutils literal notranslate"><span class="pre">pluginSourceUrl</span></code>, Scipion will use pip to install the plugin from that directory
(i.e. pip will copy the <code class="docutils literal notranslate"><span class="pre">relion</span></code> folder to python’s <code class="docutils literal notranslate"><span class="pre">site-packages</span></code> folder). If this key is missing, Scipion will
try to install from <a class="reference external" href="https://pypi.org/">https://pypi.org/</a>. Once you do this installation, changes made in your development folder
will <strong>NOT</strong> be present in the copy used by Scipion. You would have to uninstall and go back to development mode
using the variable <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> or installing with the <code class="docutils literal notranslate"><span class="pre">--devel</span></code> flag as stated in the
<a class="reference internal" href="#devel-mode"><span class="std std-ref">working in devel mode section</span></a>.</p>
</div>
<div class="section" id="add-scipion-plugin-json-variable">
<h5><a class="toc-backref" href="#id45">Add SCIPION_PLUGIN_JSON variable</a><a class="headerlink" href="#add-scipion-plugin-json-variable" title="Permalink to this headline">¶</a></h5>
<p>In the <code class="docutils literal notranslate"><span class="pre">VARIABLES</span></code> section of your <code class="docutils literal notranslate"><span class="pre">~/.config/scipion/scipion.conf</span></code>, add variable <code class="docutils literal notranslate"><span class="pre">SCIPION_PLUGIN_JSON</span></code>. If
you don’t add this variable, Scipion will read the json from <a class="reference external" href="http://scipion.i2pc.es/getplugins">http://scipion.i2pc.es/getplugins</a> instead of reading
your local json copy. If you use PyCharm to run Scipion, you can also add it as environment variable in your run
configuration. Remember to replace the example provided with the right path:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[VARIABLES]</span>
<span class="na">SCIPION_NOTES_PROGRAM</span> <span class="o">=</span>
<span class="na">SCIPION_NOTES_ARGS</span> <span class="o">=</span>
<span class="na">SCIPION_NOTES_FILE</span> <span class="o">=</span> <span class="s">notes.txt</span>
<span class="na">SCIPION_NOTIFY</span> <span class="o">=</span> <span class="s">False</span>
<span class="na">SCIPION_PLUGIN_JSON</span><span class="o">=</span><span class="s">/home/desktop/yaiza/plugins.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="installation-script">
<h4><a class="toc-backref" href="#id46">Installation script</a><a class="headerlink" href="#installation-script" title="Permalink to this headline">¶</a></h4>
<p>Scipion has a script to handle plugin installation / uninstallation. We have a few (un)installation
choices:</p>
<ul class="simple">
<li>Installing plugin and default binaries:</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$SCIPION_HOME</span>/scipion3 installp -p scipion-em-relion
</pre></div>
</div>
<p>This command does two things:
1. Gets the package from pypi
2. Installs the default binaries (those that had <code class="docutils literal notranslate"><span class="pre">default=True</span></code> in the <code class="docutils literal notranslate"><span class="pre">registerPluginBinaries</span></code> function).</p>
<p>If no errors happen, we get an output similar to this one:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scipion3 installp -p scipion-em-relion

Scipion v3.0 <span class="o">()</span> devel

Building scipion-em-relion ...
/home/azazello/.conda/envs/.scipion3env/bin/python -m pip install scipion-em-relion<span class="o">==</span><span class="m">3</span>.0.0
Collecting scipion-em-relion<span class="o">==</span><span class="m">3</span>.0.0
Downloading scipion-em-relion-3.0.0.tar.gz <span class="o">(</span><span class="m">21</span> kB<span class="o">)</span>
Requirement already satisfied: scipion-em in ./scipion-em <span class="o">(</span>from scipion-em-relion<span class="o">==</span><span class="m">3</span>.0.0<span class="o">)</span> <span class="o">(</span><span class="m">1</span>.0.2<span class="o">)</span>
...
Successfully built scipion-em-relion
Installing collected packages: scipion-em-relion
Successfully installed scipion-em-relion-3.0.0
Done <span class="o">(</span><span class="m">1</span>.94 seconds<span class="o">)</span>
Building relion-3.1
...
Done <span class="o">(</span><span class="m">132</span>.00 seconds<span class="o">)</span>
</pre></div>
</div>
<ul class="simple">
<li>Uninstalling plugin and all binaries installed</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$SCIPION_HOME</span>/scipion3 uninstallp -p scipion-em-relion
</pre></div>
</div>
<ul class="simple">
<li>We can use the flag –noBin to both install and uninstall without binaries:</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$SCIPION_HOME</span>/scipion3 installp -p scipion-em-relion --noBin
</pre></div>
</div>
<ul class="simple">
<li>Install specific plugin binaries (only works if we have done <code class="docutils literal notranslate"><span class="pre">installp</span></code> first).</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$SCIPION_HOME</span>/scipion3 installb relion-3.1
</pre></div>
</div>
<ul class="simple">
<li>Uninstall specific plugin binaries</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$SCIPION_HOME</span>/scipion3 uninstallb relion-3.0
</pre></div>
</div>
</div>
</div>
<div class="section" id="running-your-tests">
<h3><a class="toc-backref" href="#id47">Running your tests</a><a class="headerlink" href="#running-your-tests" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">With your plugin and binaries installed, it is recommended to run some of your plugin’s tests to check
everything is in order:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scipion3 <span class="nb">test</span> relion.tests.test_***
</pre></div>
</div>
</li>
<li><p class="first">Open the test project:</p>
</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scipion3 last
</pre></div>
</div>
<p>First, inspect the protocol output to make sure there’s nothing weird; then, open the
protocol box to see if our logo and references are there. It’s important to do this step because
if we don’t open the GUI we won’t be able to detect logo related issues.</p>
<div class="section" id="add-your-own-dataset-if-necessary">
<h4><a class="toc-backref" href="#id48">Add your own DataSet (if necessary)</a><a class="headerlink" href="#add-your-own-dataset-if-necessary" title="Permalink to this headline">¶</a></h4>
<p>If you need an additional dataset you can do this and host it where ever you want/can.
Let’s assume you need a new dataset…</p>
<ul class="simple">
<li>usually you work first locally until you are happy with your data set.</li>
<li>Decide where to host it and upload it. For that scipion3 will:</li>
<li>Generate a <code class="docutils literal notranslate"><span class="pre">MANIFEST</span></code> file</li>
<li>rsync it to your server, you will need to provide a login info (like <a class="reference external" href="mailto:user&#37;&#52;&#48;server&#46;com">user<span>&#64;</span>server<span>&#46;</span>com</a>, and a remote folder location.</li>
<li>type something like:</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scipion3 testdata --upload myplugin123_testdata -l user@server.com -rf /path/at/the/server/for/your/datasets
</pre></div>
</div>
<p>Please note that the dataset name must be unique, so better prefix it with the plugin name. <code class="docutils literal notranslate"><span class="pre">-l</span></code> is the login for your
server and <code class="docutils literal notranslate"><span class="pre">-rf</span></code> is the remote folder where to rsync your files.</p>
<blockquote>
<div><ul class="simple">
<li>Refer to it in your tests, at you tests <code class="docutils literal notranslate"><span class="pre">folder/__init__.py</span></code>:</li>
</ul>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DataSet</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;myplugin123_testdata&#39;</span><span class="p">,</span>
        <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;myplugin123_testdata&#39;</span><span class="p">,</span>
        <span class="n">files</span><span class="o">=</span><span class="p">{</span>
               <span class="s1">&#39;file1&#39;</span><span class="p">:</span> <span class="s1">&#39;file1.txt&#39;</span>
               <span class="o">...</span><span class="p">},</span>
        <span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://wwww.server.com/datasets&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>NOTE: url parameter should be a valid url where your dataset is being published.
TIP: I haven’t tried, but doing the upload yourself, to generate the MANIFEST and then adding your datasets + MANIFEST
to github might also work if you later point to the gitraw url?? (disclaimer…has not been tested.)</p>
</div>
</div>
<div class="section" id="create-and-upload-distribution">
<h3><a class="toc-backref" href="#id49">Create and upload distribution</a><a class="headerlink" href="#create-and-upload-distribution" title="Permalink to this headline">¶</a></h3>
<p>To upload your distribution to pypi, you’ll need to <a class="reference external" href="https://packaging.python.org/tutorials/distributing-packages/#create-an-account">create an account</a>.</p>
<ul class="simple">
<li>Install twine if you don’t have it (latest stable compatible with Python 3.8 is version 3.1.1)</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install <span class="nv">twine</span><span class="o">==</span><span class="m">3</span>.1.1
</pre></div>
</div>
<ul class="simple">
<li>Create the source distribution (at least! You can also create a Built distribution. Read more in the official
<a class="reference external" href="https://packaging.python.org/tutorials/packaging-projects/#generating-distribution-archives">packaging guide</a>)</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$PLUGIN_HOME</span>
rm -rf dist/*    <span class="c1"># To clean the already uploaded modules</span>
scipion3 python setup.py sdist
</pre></div>
</div>
<p>It is convenient to check your <code class="docutils literal notranslate"><span class="pre">*egg-info/SOURCES.TXT</span></code> and see if you miss any file (pay special attention to
non-python files that you might have forgot to include in <code class="docutils literal notranslate"><span class="pre">MANIFEST.in</span></code> or in your <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>, like the logo).</p>
<ul class="simple">
<li>Upload the distribution <strong>WITH EARLIEST COMPATIBLE SCIPION VERSION IN THE COMMENTS</strong>.</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$PLUGIN_HOME</span> <span class="o">&amp;&amp;</span> twine upload dist/* -c <span class="s2">&quot;scipion-3.0&quot;</span>
</pre></div>
</div>
<p>This means that this release we’re uploading will be available for Scipion version 3.0 or higher.
The scipion version must follow the pattern used above (scipion-X.Y(.Z))
Now our plugin is on <a class="reference external" href="https://pypi.org/project/scipion-em-relion">PyPI</a>.</p>
</div>
<div class="section" id="install-from-pip">
<h3><a class="toc-backref" href="#id50">Install from pip</a><a class="headerlink" href="#install-from-pip" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Uninstall plugin:</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$SCIPION_HOME</span>/scipion3 uninstallp -p scipion-em-relion
</pre></div>
</div>
<ul class="simple">
<li>Remove <code class="docutils literal notranslate"><span class="pre">SCIPION_PLUGIN_JSON</span></code> from <code class="docutils literal notranslate"><span class="pre">~/.config/scipion/scipion.conf</span></code>  IF YOUR PLUGIN IS IN ALREADY IN
<a class="reference external" href="http://scipion.i2pc.es/getplugins">http://scipion.i2pc.es/getplugins</a>. IF NOT DON’T DO THIS. Just remove <code class="docutils literal notranslate"><span class="pre">pluginSourceUrl</span></code> from your plugin’s dict.</li>
<li>Install</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$SCIPION_HOME</span>/scipion3 installp -p scipion-em-relion
</pre></div>
</div>
<ul>
<li><p class="first">Test again (yes, again)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scipion3 <span class="nb">test</span> relion.tests.test_***
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: release-3.0.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../gh-pages/docs/developer/creating-a-plugin.html">gh-pages</a></dd>
            <dd><a href="../../../release-2.0.0/docs/developer/creating-a-plugin.html">release-2.0.0</a></dd>
            <dd><a href="creating-a-plugin.html">release-3.0.0</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>