<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ScipionCloud on Amazon Web Services EC2 &mdash; Scipion 3.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Scipion
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/how-to-install.html">Installing Scipion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities.html">On-the-fly processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/customize-report.html">Summary Reports</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers Page</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/scipion-API.html">Scipion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/plugins-API.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/xmipp-API.html">Xmipp API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/contact-us.html">Contact Us</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Licences</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/license.html">Licenses</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>ScipionCloud on Amazon Web Services EC2</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/docs/developer/scipionCloud-on-amazon-web-services-ec2.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/scipion_logo.gif"><img alt="scipion logo" src="../../_images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="scipioncloud-on-amazon-web-services-ec2">
<span id="id1"></span><h1>ScipionCloud on Amazon Web Services EC2<a class="headerlink" href="#scipioncloud-on-amazon-web-services-ec2" title="Permalink to this heading"></a></h1>
<div class="section" id="creating-an-instance-virtual-machine">
<h2>Creating an instance (virtual machine)<a class="headerlink" href="#creating-an-instance-virtual-machine" title="Permalink to this heading"></a></h2>
<p>Depending on your computing needs, you can start ScipionCloud on a single node
(“instance”, in Amazon terminology).</p>
<p>Amazon EC2 offers a wide range of instance types, that can be check
on <a class="reference external" href="https://aws.amazon.com/ec2/instance-types/">AWS instance types</a>.</p>
<ul class="simple">
<li><p>Connect to <a class="reference external" href="https://aws.amazon.com/">AWS console</a></p></li>
<li><p>Open the EC2 dashboard</p></li>
<li><p>Launch a ScipionCloud instance: Enter “Instances” panel, then click “Launch instance”. Follow the wizard filling in the required information:</p>
<ul>
<li><p>Choose the ScipionCloud AMI: in <em>“Community AMIs”</em> section, search for “scipion” and find the latest release. The ScipionCloud AMI is currently available only in Ireland region but if you would like to use it in a different region contact us and we will make a copy there.</p></li>
<li><p>Choose the instance type, according to how much resources (CPU, RAM, GPU, disk) you want to use. This AMI has been tested on g4dn types, other GPUs instances types might not work straight away. Contact us if you need advise on this.</p></li>
<li><p>Regarding disk, you can use an integrated SSD disk, or attach an EBS Volume. Press “Next: Configure instance details”.</p></li>
<li><p>Configure instance: leave everything as default unless you know what you are doing.</p></li>
<li><p>Add storage: specify the disk size of the system disk (that you can use also for data). Here you can also create a new volume of arbitrary size.</p></li>
<li><p>Tag instance: Add tag ‘Name’ and give a descriptive name.</p></li>
<li><p>Configure security group: To use the remote desktop (web based), you need to open ports 80 (HTTP) and 22 (SSH):</p></li>
<li><p>Click “Review and Launch”, then “Launch”</p></li>
</ul>
</li>
<li><p>In the “Select an existing key pair or create a new key pair” panel, select “Create new key pair” (unless you have your own), type the key pair name and click “Download” key pair. Finally, click “Launch instances” and then “View instances”</p></li>
</ul>
<p>Select your instance within the list of instances, and copy its public IP address. You will need this address to connect to the instance, whether via ssh or Remote Desktop (VNC).</p>
<p>Wait until the instance is initialized.</p>
</div>
<div class="section" id="accessing-an-instance">
<h2>Accessing an instance<a class="headerlink" href="#accessing-an-instance" title="Permalink to this heading"></a></h2>
<p>First, connect with SSH to your instance:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>chmod <span class="m">600</span> path/to/key.pem
ssh -i path/to/key.pem ubuntu@12.34.56.78 <span class="c1">#(use your IP)</span>
</pre></div>
</div>
<p>Instances created from AMIs need some time to ‘warm up’ so performance might be poor at the begining (explanation <a class="reference external" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-initialize.html">[here]</a>). If you want to avoid it you could follow instructions there.</p>
<p>Access the remote desktop from a browser with the URL and password provided in the console.</p>
<p>This is how the remote desktop will look like:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/noVNC-desktop.png"><img alt="noVNC-desktop" src="../../_images/noVNC-desktop.png" style="width: 800px;" /></a>
</div>
<p>To disconnect from the session click on the little arrow that appears on the left (see menu below) and click on the last option:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/noVNC-menu.png"><img alt="noVNC-menu" src="../../_images/noVNC-menu.png" style="width: 250px;" /></a>
</div>
<p>IMPORTANT!! Do not disconnect from the top right corner, as in a physical machine. If you do so the machine will need to be reboot</p>
<p>There is a shortcut for Scipion on the desktop.</p>
<p>The following software is installed on the machine:</p>
<ul class="simple">
<li><p>Ubuntu 20.04</p></li>
<li><p>Scipion on /usr/local/scipion3 (alias scipion3): git installation branch release-3.0 with the following EM plugins:</p>
<ul>
<li><p>Gctf 1.18</p></li>
<li><p>Gautomatch 0.56</p></li>
<li><p>Eman 2.91</p></li>
<li><p>Motioncor2 1.4.2</p></li>
<li><p>Relion 3.1.2</p></li>
<li><p>Spider 26.06</p></li>
<li><p>Xmipp 3.21.06.1</p></li>
<li><p>chimeraX 1.2.5</p></li>
<li><p>cryolo 1.7.6</p></li>
<li><p>cryosparc2 3.2.0</p></li>
</ul>
</li>
<li><p>Nvidia driver version 460</p></li>
<li><p>CUDA 10.1</p></li>
<li><p>TurboVNC 2.2.6 on</p></li>
<li><p>anaconda3</p></li>
<li><p>noVNC</p></li>
</ul>
</div>
<div class="section" id="managing-instances">
<h2>Managing instances<a class="headerlink" href="#managing-instances" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Login to <a class="reference external" href="https://aws.amazon.com/">AWS console</a></p></li>
<li><p>Go to EC2 services</p></li>
<li><p>Select Instances on the left side menu</p></li>
<li><p>Select the instance, click on ‘Instance state’ and the action required.</p>
<ul>
<li><p>Stop: the instance is turned off, but everything related to it is kept (IP address change unless you use Elastic IPs). You can power it on again with the Start command. While an instance is off, you are only charged for disk use.</p></li>
<li><p>Terminate: the instance is deleted, and all non-permanent storage disappear. You should make sure all your data is safe before terminating an instance.</p></li>
<li><p>Change instance type: This can be useful when running EM workflows since one could start with a small machine for the preprocessing steps, or even with a GPU machine if needed, and then switch to a more powerful machine with higher memory for the classification and refinement steps. In order to change the type the VM needs to be stopped first, then click on “Actions” and select “Instance settings / Change instance type”.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="using-external-ebs-volumes">
<h2>Using external EBS volumes<a class="headerlink" href="#using-external-ebs-volumes" title="Permalink to this heading"></a></h2>
<p>Latest ScipionCloud image has a default disk of 75 Gb, which is clearly insufficient for storing real processing EM data.
When creating a Virtual Machine through the EC2 console, it is possible to specify a bigger disk for the VM, but you have to take into account that this disk cannot be resized and will disappear when the VM is terminated.
To avoid this problem it is a good practise to work with external EBS volumes attached to the VM, which can be used to store data and/or Scipion projects.</p>
<p>For a single instance of Scipion you can attach an EBS volume when creating the Virtual Machine from the EC2 console as explained on the section above.</p>
<p>Then log in the machine and follow these instructions:</p>
<ul class="simple">
<li><p>If the EBS volume has not been formatted run (assuming your EBS volume is attached on /dev/sdf device):</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo mkfs -t ext4 /dev/xvdf<span class="sb">`</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Mount the EBS disk</p></li>
</ul>
<p>Create the folder where you would like to mount the disk (for instance /data).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo mount /dev/xvdf /data<span class="sb">`</span>
</pre></div>
</div>
<p>You could also create the EBS volume once the VM is up and running and attach it.
Go to the EC2 console and click on Elastic Block Store / Volumes, select Create Volume and choose size and the same Availability region where the VM is running.
Once the volume is created select it and choose Attach Volume action. Select the VM to which the volume will be attached and device (for instance /dev/sdf).</p>
<p>Then we can proceed with the same instructions as explained above.</p>
</div>
<div class="section" id="costs-on-aws">
<h2>Costs on AWS<a class="headerlink" href="#costs-on-aws" title="Permalink to this heading"></a></h2>
<p>Using ScipionCloud on AWS will have the following costs:</p>
<div class="section" id="computing-instances">
<h3>Computing (instances)<a class="headerlink" href="#computing-instances" title="Permalink to this heading"></a></h3>
<p>AWS instance types prices can be found <a class="reference external" href="https://aws.amazon.com/ec2/pricing/on-demand/">here</a>. This is charged by minute only when the instance is running.</p>
</div>
<div class="section" id="storage">
<h3>Storage<a class="headerlink" href="#storage" title="Permalink to this heading"></a></h3>
<p>As described above on the <cite>Using external EBS volumes</cite> section, it is recommended
to attach an EBS volume big enough to store raw data and project.</p>
<p>EBS storage costs 0.11$ per GB (2021) which makes around 113$ per TB per month.</p>
<p>If the amount of movies to be processed require many TBs there are some
strategies to reduce the bill:</p>
<ul class="simple">
<li><p>Process movies locally and transfer only micrographs to the cloud.</p></li>
<li><p>Transfer movies to a big EBS but as soon as they are aligned use a smaller EBS disk to continue processing (you could even have two disks, one for raw data and one for project and discard the first one when movies are aligned). You then should be certain that movies will not be required afterwards or you will have to transfer them again (it could compensate anyway if they are needed only at the end of processing). Another possibility will be to move movies from EBS to S3 or Glacier (another cheaper storage on AWS) while you do not need them and retrieve them if needed again.</p></li>
<li><p>Process on streaming: use Scipion streaming mode to process movies as they are transferred. You should take care of removing movies from disk as they are processed since Scipion will not do it.</p></li>
</ul>
</div>
<div class="section" id="transfer-data">
<h3>Transfer data<a class="headerlink" href="#transfer-data" title="Permalink to this heading"></a></h3>
<p>AWS does not charge for uploading data into the cloud but it does for downloading
data from it.
First GB per month is free but then it costs 0.09$ per GB (up to 10 TB,
then price slowly decrease). (2021)</p>
<p>For a more detailed evaluation of costs and performance you could have a look at
paper <a class="reference external" href="https://doi.org/10.1016/j.jsb.2017.06.004">ScipionCloud: An integrative and interactive gateway for large scale
cryo electron microscopy image processing on commercial and academic clouds</a>.</p>
<p>Also, AWS has the following <a class="reference external" href="https://calculator.s3.amazonaws.com/index.html">tool</a> to estimate your costs beforehand.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Scipion team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>