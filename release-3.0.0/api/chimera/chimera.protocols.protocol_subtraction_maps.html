

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>chimera.protocols.protocol_subtraction_maps module &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="chimera.viewers package" href="chimera.viewers.html" />
    <link rel="prev" title="chimera.protocols.protocol_restore module" href="chimera.protocols.protocol_restore.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/scipion-modes/how-to-install.html">Installing Scipion v3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/facilities/facilities.html">Streaming Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/facilities/acquisition-simulation.html">Tutorial for Facilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../appion/appion.html">appion package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../atomstructutils/atomstructutils.html">atomstructutils package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../atsas/atsas.html">atsas package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bamfordlab/bamfordlab.html">bamfordlab package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bsoft/bsoft.html">bsoft package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ccp4/ccp4.html">ccp4 package</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="chimera.html">chimera package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="chimera.protocols.html">chimera.protocols package</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="chimera.protocols.protocol_base.html">chimera.protocols.protocol_base module</a></li>
<li class="toctree-l3"><a class="reference internal" href="chimera.protocols.protocol_contacts.html">chimera.protocols.protocol_contacts module</a></li>
<li class="toctree-l3"><a class="reference internal" href="chimera.protocols.protocol_fit.html">chimera.protocols.protocol_fit module</a></li>
<li class="toctree-l3"><a class="reference internal" href="chimera.protocols.protocol_modeller_search.html">chimera.protocols.protocol_modeller_search module</a></li>
<li class="toctree-l3"><a class="reference internal" href="chimera.protocols.protocol_operate.html">chimera.protocols.protocol_operate module</a></li>
<li class="toctree-l3"><a class="reference internal" href="chimera.protocols.protocol_restore.html">chimera.protocols.protocol_restore module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">chimera.protocols.protocol_subtraction_maps module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="chimera.viewers.html">chimera.viewers package</a></li>
<li class="toctree-l2"><a class="reference internal" href="chimera.bibtex.html">chimera.bibtex module</a></li>
<li class="toctree-l2"><a class="reference internal" href="chimera.constants.html">chimera.constants module</a></li>
<li class="toctree-l2"><a class="reference internal" href="chimera.convert.html">chimera.convert module</a></li>
<li class="toctree-l2"><a class="reference internal" href="chimera.editList.html">chimera.editList module</a></li>
<li class="toctree-l2"><a class="reference internal" href="chimera.getchimera.html">chimera.getchimera module</a></li>
<li class="toctree-l2"><a class="reference internal" href="chimera.parser_h1.html">chimera.parser_h1 module</a></li>
<li class="toctree-l2"><a class="reference internal" href="chimera.wizards.html">chimera.wizards module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cistem/cistem.html">cistem package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryoef/cryoef.html">cryoef package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryosparc2/cryosparc2.html">cryosparc2 package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deepfinder/deepfinder.html">deepfinder package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dynamo/dynamo.html">dynamo package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eman2/eman2.html">eman2 package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../emxlib/emxlib.html">emxlib package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fsc3d/fsc3d.html">fsc3d package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gautomatch/gautomatch.html">gautomatch package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gctf/gctf.html">gctf package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../imod/imod.html">imod package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../localrec/localrec.html">localrec package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locscale/locscale.html">locscale package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../motioncorr/motioncorr.html">motioncorr package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../novactf/novactf.html">novactf package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../phenix/phenix.html">phenix package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyworkflow/pyworkflow.html">pyworkflow package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pwem/pwem.html">pwem package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../relion/relion.html">relion package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resmap/resmap.html">resmap package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion/scipion.html">scipion package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sphire/sphire.html">sphire package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spider/spider.html">spider package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tomo/tomo.html">tomo package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tomoj/tomoj.html">tomoj package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topaz/topaz.html">topaz package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xmipp2/xmipp2.html">xmipp2 package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xmipp3/xmipp3.html">xmipp3 package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xmipptomo/xmipptomo.html">xmipptomo package</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="chimera.html">chimera package</a> &raquo;</li>
        
          <li><a href="chimera.protocols.html">chimera.protocols package</a> &raquo;</li>
        
      <li>chimera.protocols.protocol_subtraction_maps module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/api/chimera/chimera.protocols.protocol_subtraction_maps.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-chimera.protocols.protocol_subtraction_maps">
<span id="chimera-protocols-protocol-subtraction-maps-module"></span><h1>chimera.protocols.protocol_subtraction_maps module<a class="headerlink" href="#module-chimera.protocols.protocol_subtraction_maps" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps">
<em class="property">class </em><code class="descclassname">chimera.protocols.protocol_subtraction_maps.</code><code class="descname">ChimeraSubtractionMaps</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/chimera/protocols/protocol_subtraction_maps.html#ChimeraSubtractionMaps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="../pwem/pwem.protocols.protocol.html#pwem.protocols.protocol.EMProtocol" title="pwem.protocols.protocol.EMProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">pwem.protocols.protocol.EMProtocol</span></code></a></p>
<p>Protocol to subtract two volumes.
One of these volumes can be derived from an atomic structure.
Execute command <em>scipionwrite model #n [refmodel #p] [prefix stringAddedToFilename]</em>
from command line in order to transfer the generated maps and models to scipion.
In addition to maps and models that the protocol saves by default,
the user can generate and save some others</p>
<dl class="attribute">
<dt id="chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.CHIMERA_FILTERS">
<code class="descname">CHIMERA_FILTERS</code><em class="property"> = ['Gaussian', 'Fourier Transform']</em><a class="headerlink" href="#chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.CHIMERA_FILTERS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.MAP_OPTIONS">
<code class="descname">MAP_OPTIONS</code><em class="property"> = ['3D map', 'atomic structure']</em><a class="headerlink" href="#chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.MAP_OPTIONS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.PROTOCOL_OPTIONS">
<code class="descname">PROTOCOL_OPTIONS</code><em class="property"> = ['Subtraction', 'Mask']</em><a class="headerlink" href="#chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.PROTOCOL_OPTIONS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.createOutput">
<code class="descname">createOutput</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/chimera/protocols/protocol_subtraction_maps.html#ChimeraSubtractionMaps.createOutput"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.createOutput" title="Permalink to this definition">¶</a></dt>
<dd><p>Register outputs.</p>
</dd></dl>

<dl class="method">
<dt id="chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.prerequisitesStep">
<code class="descname">prerequisitesStep</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/chimera/protocols/protocol_subtraction_maps.html#ChimeraSubtractionMaps.prerequisitesStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.prerequisitesStep" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.runChimeraStep">
<code class="descname">runChimeraStep</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/chimera/protocols/protocol_subtraction_maps.html#ChimeraSubtractionMaps.runChimeraStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.runChimeraStep" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.subtractionString">
<code class="descname">subtractionString</code><em class="property"> = '\nfrom VolumeStatistics import mean_sd_rms\nfrom chimera import openModels\nfrom chimera import replyobj\n\nfrom VolumeData import Array_Grid_Data\nfrom VolumeViewer.volume import volume_from_grid_data\nimport numpy\nfrom numpy import greater_equal, multiply, dot as inner_product\nfrom numpy import array, ravel\n# get volume from model id\ndef subtraction(minuendId, subtrahendId, outModelId=-1, subtractOrMask=0):\n    \'\'\' subtract or mask two volumes after adjust their respective ranges.\n    \n        The mask part is close to the chimera command\n        vop zone invert. \n        If subtractOrMask=1 the program function uses vop subtract (chimera) \n        Else:\n        1) A mask is computed using the volume with modelid=subtrahendId \n           and the countour level value.\n        2) All voxels in minuendId are set to 0 for those\n           voxels inside the mask.\n        3) Result is shown in chimera\n        4) Volumes are assume to have the same sampling rate and dimensions\n        Usage Example:\n        from chimera import runCommand\n        runCommand(\'open /home/roberto/Downloads/Vols/emd_21375_crop_ref.mrc\')\n        runCommand(\'open /home/roberto/Downloads/Vols/i2pc_Level0_226_crop_ref.mrc\')\n        subtraction(0, 1, outModelId=6, subtractOrMask=0)\n        \n        Note this function is milar to chimera\'s vop zone invert\n        but can be used not only with PDBs but with 3D maps as subtrahend\n    \'\'\'\n    if subtractOrMask==0:\n        command = &quot;vop subtract #%d #%d modelId #%d minRMS true onGrid #%d&quot; % (minuendId, subtrahendId, outModelId, minuendId)\n        runCommand(command)\n        return\n    \n    # get models from Ids\n    minuendModel = openModels.list(id=minuendId)[0]  #submodel if needed\n    subtrahendModel = openModels.list(id=subtrahendId)[0]  #submodel if needed\n    \n    # Get contour level from model\n    contourLevel = subtrahendModel.surface_levels[0]\n        \n    # get  matrix with voxel values\n    minuendMatrix = minuendModel.full_matrix()\n    subtrahendMatrix = subtrahendModel.full_matrix()\n    \n    # check if sampling and size is the same\n    compatible1 = abs (minuendModel.data.step[0] - minuendModel.data.step[0]) &lt; 0.01\n    s1 = minuendMatrix.shape\n    s2 = subtrahendMatrix.shape\n    compatible2 = (s1[0]==s2[0]) &amp; (s1[1]==s2[1]) &amp; (s1[1]==s2[1])\n\n    if not (compatible1 &amp; compatible2):\n        replyobj.status(&quot;Both volumes have incompatible size or sampling, using vop subtract&quot;)\n        command = &quot;vop subtract #%d #%d modelId #%d minRMS true onGrid #%d&quot; % (minuendId, subtrahendId, outModelId, minuendId)\n        runCommand(command)\n        return\n\n    # test data, comment next two lines to operate\n    # with chimera volumes\n    # minuendMatrix = array([[1., 2., 3.], [4., 5., 6.]])\n    # subtrahendMatrix = minuendMatrix * 2 +1\n    # contourLevel=6\n    \n    \n    # create mask\n    # keep only values above threshold contourLevel\n    mask = subtrahendMatrix &gt; contourLevel  # matrix with true and false\n                                            # values less than counter\n                                            # are set to true\n    # set values to half the contourLevel                                           \n    minuendMatrix[mask] = 0.\n    \n    #innerProduct = inner_product(shifted_matrix_subtrahend[mask],    shifted_matrix_minuend[mask])\n    #normalization =inner_product(shifted_matrix_subtrahend[mask], shifted_matrix_subtrahend[mask])\n    #if normalization == 0:\n    #   f = 1\n    #else:\n    #   f = innerProduct/normalization\n    #new_matrix_subtrahend =  minuendMatrix - (shifted_matrix_subtrahend * f + minuendMean )\n    # attach matrix to grid\n    \n    g0 = Array_Grid_Data(minuendMatrix, minuendModel.data.origin, \n                         minuendModel.data.step, minuendModel.data.cell_angles)\n    # create new volume\n    if outModelId == -1:\n        differenceVolume = volume_from_grid_data(g0)\n    else:\n        differenceVolume = volume_from_grid_data(g0, model_id=outModelId)\n'</em><a class="headerlink" href="#chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.subtractionString" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.symMethod">
<code class="descname">symMethod</code><span class="sig-paren">(</span><em>f</em>, <em>modelId</em>, <em>sym</em>, <em>order=None</em>, <em>range=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/chimera/protocols/protocol_subtraction_maps.html#ChimeraSubtractionMaps.symMethod"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#chimera.protocols.protocol_subtraction_maps.ChimeraSubtractionMaps.symMethod" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="chimera.viewers.html" class="btn btn-neutral float-right" title="chimera.viewers package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="chimera.protocols.protocol_restore.html" class="btn btn-neutral float-left" title="chimera.protocols.protocol_restore module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: release-3.0.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../dm_facilitiesUpdate/index.html">dm_facilitiesUpdate</a></dd>
            <dd><a href="../../../gh-pages/index.html">gh-pages</a></dd>
            <dd><a href="../../../release-2.0.0/index.html">release-2.0.0</a></dd>
            <dd><a href="chimera.protocols.protocol_subtraction_maps.html">release-3.0.0</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>