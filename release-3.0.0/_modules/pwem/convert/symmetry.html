<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pwem.convert.symmetry &mdash; Scipion 3.0.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> Scipion
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/how-to-install.html">Installing Scipion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html#image-processing-resources">Image processing resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html#processing-how-to-s">Processing How Toâ€™s</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/facilities.html">On-the-fly processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/customize-report.html">Summary Reports</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/api/scipion-API.html">Scipion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/api/plugins-API.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/api/xmipp-API.html">Xmipp API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/misc/contact-us.html">Contact Us</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Licences</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/license.html">Licenses</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Scipion</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
          <li><a href="../../pwem.html">pwem</a> &raquo;</li>
      <li>pwem.convert.symmetry</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pwem.convert.symmetry</h1><div class="highlight"><pre>
<span></span><span class="c1"># **************************************************************************</span>
<span class="c1"># *</span>
<span class="c1"># * Authors:     Roberto Marabini</span>
<span class="c1"># *</span>
<span class="c1"># * Unidad de  Bioinformatica of Centro Nacional de Biotecnologia , CSIC</span>
<span class="c1"># *</span>
<span class="c1"># * This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># * it under the terms of the GNU General Public License as published by</span>
<span class="c1"># * the Free Software Foundation; either version 3 of the License, or</span>
<span class="c1"># * (at your option) any later version.</span>
<span class="c1"># *</span>
<span class="c1"># * This program is distributed in the hope that it will be useful,</span>
<span class="c1"># * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># * GNU General Public License for more details.</span>
<span class="c1"># *</span>
<span class="c1"># * You should have received a copy of the GNU General Public License</span>
<span class="c1"># * along with this program; if not, write to the Free Software</span>
<span class="c1"># * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA</span>
<span class="c1"># * 02111-1307  USA</span>
<span class="c1"># *</span>
<span class="c1"># *  All comments concerning this program package may be sent to the</span>
<span class="c1"># *  e-mail address &#39;scipion@cnb.csic.es&#39;</span>
<span class="c1"># *</span>
<span class="c1"># **************************************************************************</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module returns the matrices related with the different</span>
<span class="sd">point symmetries. Code based on chimera file sym.py</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">acos</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">asin</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">inv</span> <span class="k">as</span> <span class="n">matrix_inverse</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">dot</span> <span class="k">as</span> <span class="n">matrix_multiply</span>
<span class="kn">import</span> <span class="nn">operator</span>

<span class="kn">import</span> <span class="nn">pwem.constants</span> <span class="k">as</span> <span class="nn">cts</span>

<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># set to True for debuging</span>
<span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pwem.viewers.viewer_chimera</span> <span class="kn">import</span> <span class="n">Chimera</span>
    <span class="c1"># expansion factor is use to create chimera bild files</span>
    <span class="c1"># this is the factor to multiply the coordinates</span>
    <span class="n">expansionFactor</span> <span class="o">=</span> <span class="mi">100</span>


<span class="k">def</span> <span class="nf">_column</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns column i of matrix as a list.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">matrix</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_applyMatrix</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:multiply point by a matrice list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">matrix_multiply</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">tf</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]))</span>
    <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">tf</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">r</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span>


<span class="k">def</span> <span class="nf">__length</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the length of a vector.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">e</span><span class="o">*</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">d</span>


<span class="k">def</span> <span class="nf">_normalizeVector</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a unit vector in the same direction as v.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">__length</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">e</span><span class="o">/</span><span class="n">d</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">v</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">_reflectMatrix</span><span class="p">(</span><span class="n">axis</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a matrix that reflects points in the plane</span>
<span class="sd">    perpendicular to axis.&quot;&quot;&quot;</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_rotationTransform</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot; returns matrix that rotates &quot;angle&quot; angles arround vector axis</span>
<span class="sd">        angle is in degrees</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

    <span class="n">arad</span> <span class="o">=</span> <span class="n">angle</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span>
    <span class="n">sa</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">arad</span><span class="p">)</span>
    <span class="n">ca</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">arad</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">center</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">ca</span><span class="p">,</span> <span class="o">-</span><span class="n">sa</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ca</span>
    <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">az</span> <span class="o">=</span> <span class="n">axis</span>
    <span class="n">tf</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">ax</span><span class="o">*</span><span class="n">ax</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="n">az</span><span class="o">*</span><span class="n">sa</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">ax</span><span class="o">*</span><span class="n">ay</span><span class="p">,</span> <span class="n">ay</span><span class="o">*</span><span class="n">sa</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">ax</span><span class="o">*</span><span class="n">az</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
          <span class="p">(</span><span class="n">az</span><span class="o">*</span><span class="n">sa</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">ax</span><span class="o">*</span><span class="n">ay</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">ay</span><span class="o">*</span><span class="n">ay</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="n">ax</span><span class="o">*</span><span class="n">sa</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">ay</span><span class="o">*</span><span class="n">az</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
          <span class="p">(</span><span class="o">-</span><span class="n">ay</span><span class="o">*</span><span class="n">sa</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">ax</span><span class="o">*</span><span class="n">az</span><span class="p">,</span> <span class="n">ax</span><span class="o">*</span><span class="n">sa</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">ay</span><span class="o">*</span><span class="n">az</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">az</span><span class="o">*</span><span class="n">az</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">center</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tf</span>

    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cz</span> <span class="o">=</span> <span class="n">center</span>
    <span class="n">c_tf</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cx</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cy</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cz</span><span class="p">))</span>
    <span class="n">inv_c_tf</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">cx</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">cy</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">cz</span><span class="p">))</span>
    <span class="n">rtf</span> <span class="o">=</span> <span class="n">_multiplyMatrices</span><span class="p">(</span><span class="n">c_tf</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">inv_c_tf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rtf</span>


<span class="k">def</span> <span class="nf">_translationMatrix</span><span class="p">(</span><span class="n">shift</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns matriz that shift point by vector shift&quot;&quot;&quot;</span>
    <span class="n">tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shift</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                   <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shift</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                   <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">shift</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
    <span class="k">return</span> <span class="n">tf</span>


<span class="k">def</span> <span class="nf">_identityMatrix</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; returns identity matrix&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_invertMatrix</span><span class="p">(</span><span class="n">tf</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns inverse 3x3 matrix&quot;&quot;&quot;</span>
    <span class="n">tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">tf</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">tf</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">tfinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="n">rinv</span> <span class="o">=</span> <span class="n">tfinv</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">tinv</span> <span class="o">=</span> <span class="n">tfinv</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">rinv</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">matrix_inverse</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">tinv</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">matrix_multiply</span><span class="p">(</span><span class="n">rinv</span><span class="p">,</span> <span class="o">-</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tfinv</span>


<span class="k">def</span> <span class="nf">_multiplyMatrices</span><span class="p">(</span><span class="o">*</span><span class="n">mlist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns matrix product of matrices in mlist&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">mlist</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">p</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">m1</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">m2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">+</span>\
                          <span class="n">m1</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">m2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">+</span>\
                          <span class="n">m1</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">m2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">c</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="n">m1</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">_multiplyMatrices</span><span class="p">(</span><span class="o">*</span><span class="n">mlist</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">_multiplyMatrices</span><span class="p">(</span><span class="n">mlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span>


<span class="k">def</span> <span class="nf">_matrixProducts</span><span class="p">(</span><span class="n">mlist1</span><span class="p">,</span> <span class="n">mlist2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns list of matrix products of matrices in mlist1 and mlist2&quot;&quot;&quot;</span>
    <span class="n">plist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m1</span> <span class="ow">in</span> <span class="n">mlist1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">m2</span> <span class="ow">in</span> <span class="n">mlist2</span><span class="p">:</span>
            <span class="n">m1xm2</span> <span class="o">=</span> <span class="n">_multiplyMatrices</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span>
            <span class="n">plist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m1xm2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plist</span>


<span class="k">def</span> <span class="nf">_coordinateTransformList</span><span class="p">(</span><span class="n">tflist</span><span class="p">,</span> <span class="n">ctf</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns list of coordinate transforms of tflist by ctf&quot;&quot;&quot;</span>
    <span class="n">ctfinv</span> <span class="o">=</span> <span class="n">_invertMatrix</span><span class="p">(</span><span class="n">ctf</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">_multiplyMatrices</span><span class="p">(</span><span class="n">ctfinv</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">ctf</span><span class="p">)</span> <span class="k">for</span> <span class="n">tf</span> <span class="ow">in</span> <span class="n">tflist</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_recenterSymmetries</span><span class="p">(</span><span class="n">tflist</span><span class="p">,</span> <span class="n">center</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">center</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tflist</span>
    <span class="n">ctf</span> <span class="o">=</span> <span class="n">_translationMatrix</span><span class="p">([</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">center</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">_coordinateTransformList</span><span class="p">(</span><span class="n">tflist</span><span class="p">,</span> <span class="n">ctf</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_transposeMatrix</span><span class="p">(</span><span class="n">tf</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns transpose of 3x3 matrix&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">tf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">tf</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">tf</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">tf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]),</span>
            <span class="p">(</span><span class="n">tf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">tf</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">tf</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">tf</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]),</span>
            <span class="p">(</span><span class="n">tf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">tf</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">tf</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">tf</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>

<span class="c1"># ==================== End of utility functions ====================</span>


<div class="viewcode-block" id="moveParticlesInsideUnitCell"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.moveParticlesInsideUnitCell">[docs]</a><span class="k">def</span> <span class="nf">moveParticlesInsideUnitCell</span><span class="p">(</span><span class="n">setIN</span><span class="p">,</span> <span class="n">setOUT</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="n">cts</span><span class="o">.</span><span class="n">SYM_CYCLIC</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Move particles projection direction inside the unit cell associated</span>
<span class="sd">    to symmetry sym.</span>
<span class="sd">    This function (1) gets the symmetry matrices and (2) applies them to</span>
<span class="sd">         each proejction direction until is inside the unit cell.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matrixSet</span> <span class="o">=</span> <span class="n">getSymmetryMatrices</span><span class="p">(</span><span class="n">sym</span><span class="o">=</span><span class="n">sym</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="c1"># get unit cell vectors</span>
    <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="n">getUnitCell</span><span class="p">(</span><span class="n">sym</span><span class="o">=</span><span class="n">sym</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">generalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># counter for the number of particles</span>
    <span class="n">totalNumberOfParticles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">setIN</span><span class="p">)</span>
    <span class="n">totalNumberOFMatrices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrixSet</span><span class="p">)</span>
    <span class="c1"># for each particle in set</span>
    <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">setIN</span><span class="p">:</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">counter</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># print something to keep the user engaged</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">totalNumberOfParticles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># get projection direction</span>
        <span class="n">colunm</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">getTransform</span><span class="p">()</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">colunm</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">colunm</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">colunm</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">pass</span>  <span class="c1"># particle is inside unit cell so nothing needs to be done</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># loop over symmetry matrices</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">matrixSet</span><span class="p">):</span>
                <span class="n">matrix3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
                <span class="n">matrix3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">matrix3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">columPrime</span> <span class="o">=</span> <span class="n">matrix3</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">colunm</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">columPrime</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> \
                   <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">columPrime</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> \
                   <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">columPrime</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">getTransform</span><span class="p">()</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">())</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">getTransform</span><span class="p">()</span>
                    <span class="n">t</span><span class="o">.</span><span class="n">setMatrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
                    <span class="n">par</span><span class="o">.</span><span class="n">setTransform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                    <span class="n">setOUT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">totalNumberOFMatrices</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: something went wrong in &quot;</span>
                          <span class="s2">&quot;moveParticlesInsideUnitCell&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;       no matrix move particle direction &quot;</span>
                          <span class="s2">&quot;inside the unit cell&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;       particle id: &quot;</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">getObjId</span><span class="p">())</span></div>


<div class="viewcode-block" id="getSymmetryMatrices"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.getSymmetryMatrices">[docs]</a><span class="k">def</span> <span class="nf">getSymmetryMatrices</span><span class="p">(</span><span class="n">sym</span><span class="o">=</span><span class="n">cts</span><span class="o">.</span><span class="n">SYM_CYCLIC</span><span class="p">,</span>
                        <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">circumscribed_radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                        <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; interface between scipion and chimera code</span>
<span class="sd">        chimera code uses tuples of tuples as matrices</span>
<span class="sd">        but scipion uses np.arrays (lists of lists)</span>
<span class="sd">        so let us convert them here.</span>
<span class="sd">        Direct use of the classes return 3x3 arrays</span>
<span class="sd">        which may be OK in many cases, but not in all</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_CYCLIC</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Cyclic</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                   <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
                   <span class="n">circumscribed_radius</span><span class="o">=</span><span class="n">circumscribed_radius</span><span class="p">,</span>
                   <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">matrices</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">symmetryMatrices</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_DIHEDRAL_X</span> <span class="ow">or</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_DIHEDRAL_Y</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">Dihedral</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                     <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
                     <span class="n">circumscribed_radius</span><span class="o">=</span><span class="n">circumscribed_radius</span><span class="p">,</span>
                     <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="n">sym</span><span class="p">)</span>
        <span class="n">matrices</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">symmetryMatrices</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_OCTAHEDRAL</span><span class="p">:</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">Octahedral</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
                       <span class="n">circumscribed_radius</span><span class="o">=</span><span class="n">circumscribed_radius</span><span class="p">,</span>
                       <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">matrices</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">symmetryMatrices</span><span class="p">()</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_222</span> <span class="ow">or</span>
          <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3</span> <span class="ow">or</span>
          <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3R</span><span class="p">):</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">Tetrahedral</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
                        <span class="n">circumscribed_radius</span><span class="o">=</span><span class="n">circumscribed_radius</span><span class="p">,</span>
                        <span class="n">sym</span><span class="o">=</span><span class="n">sym</span><span class="p">)</span>
        <span class="n">matrices</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">symmetryMatrices</span><span class="p">()</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I222</span> <span class="ow">or</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I222r</span> <span class="ow">or</span>
          <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_In25</span> <span class="ow">or</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_In25r</span> <span class="ow">or</span>
          <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n3</span> <span class="ow">or</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n3r</span> <span class="ow">or</span>
          <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n5</span> <span class="ow">or</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n5r</span><span class="p">):</span>
        <span class="n">matrices</span> <span class="o">=</span> <span class="n">__icosahedralSymmetryMatrices</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">center</span><span class="p">)</span>

        <span class="c1"># &#39;222&#39;         2-fold symmetry along x, y, and z axes.</span>
        <span class="c1"># &#39;222r&#39;        &#39;222&#39; with 90 degree rotation around z.</span>
        <span class="c1"># &#39;2n5&#39;         2-fold symmetry along x and 5-fold along z.</span>
        <span class="c1"># &#39;2n5r&#39;        &#39;2n5&#39; with 180 degree rotation about y.</span>
        <span class="c1"># &#39;n25&#39;         2-fold symmetry along y and 5-fold along z.</span>
        <span class="c1"># &#39;n25r&#39;        &#39;n25&#39; with 180 degree rotation about x.</span>
        <span class="c1"># &#39;2n3&#39;         2-fold symmetry along x and 3-fold along z.</span>
        <span class="c1"># &#39;2n3r&#39;        &#39;2n3&#39; with 180 degree rotation about y.</span>

    <span class="c1"># convert from 4x3 to 4x4 matrix, Scipion standard</span>
    <span class="n">extraRow</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">matrices</span><span class="p">)):</span>
        <span class="n">matrices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">extraRow</span><span class="p">,)</span>
    <span class="c1"># convert from sets to lists Scipion standard</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">matrices</span><span class="p">)</span></div>


<div class="viewcode-block" id="getUnitCell"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.getUnitCell">[docs]</a><span class="k">def</span> <span class="nf">getUnitCell</span><span class="p">(</span><span class="n">sym</span><span class="o">=</span><span class="n">cts</span><span class="o">.</span><span class="n">SYM_CYCLIC</span><span class="p">,</span>
                <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">circumscribed_radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">generalize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; return vectors normal to the unit cell faces</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_CYCLIC</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Cyclic</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                   <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
                   <span class="n">circumscribed_radius</span><span class="o">=</span><span class="n">circumscribed_radius</span><span class="p">,</span>
                   <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">vectorsEdge</span><span class="p">,</span> <span class="n">vectorsPlane</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">unitCellPlanes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="n">bildFileName</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/tmp/C</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">.bild&#39;</span>
            <span class="n">vLabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">,</span> <span class="s1">&#39;v2&#39;</span><span class="p">,</span> <span class="s1">&#39;v3&#39;</span><span class="p">]</span>
            <span class="n">pLabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">,</span> <span class="s1">&#39;p2&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_DIHEDRAL_X</span> <span class="ow">or</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_DIHEDRAL_Y</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;getUnitCell:&quot;</span><span class="p">,</span> <span class="n">cts</span><span class="o">.</span><span class="n">SCIPION_SYM_NAME</span><span class="p">[</span><span class="n">sym</span><span class="p">])</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">Dihedral</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                     <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
                     <span class="n">circumscribed_radius</span><span class="o">=</span><span class="n">circumscribed_radius</span><span class="p">,</span>
                     <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="n">sym</span><span class="p">)</span>
        <span class="n">vectorsEdge</span><span class="p">,</span> <span class="n">vectorsPlane</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">unitCellPlanes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="n">vLabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">,</span> <span class="s1">&#39;v2&#39;</span><span class="p">,</span> <span class="s1">&#39;eigenvector&#39;</span><span class="p">]</span>
            <span class="n">pLabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">,</span> <span class="s1">&#39;p2&#39;</span><span class="p">,</span> <span class="s1">&#39;p3&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_OCTAHEDRAL</span><span class="p">:</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">Octahedral</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
                       <span class="n">circumscribed_radius</span><span class="o">=</span><span class="n">circumscribed_radius</span><span class="p">)</span>
        <span class="n">vectorsEdge</span><span class="p">,</span> <span class="n">vectorsPlane</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">unitCellPlanes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="n">vLabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">,</span> <span class="s1">&#39;v2&#39;</span><span class="p">,</span> <span class="s1">&#39;v3&#39;</span><span class="p">]</span>
            <span class="n">pLabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">,</span> <span class="s1">&#39;p2&#39;</span><span class="p">,</span> <span class="s1">&#39;p3&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3</span> <span class="ow">or</span>
          <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL</span> <span class="ow">or</span>
          <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3R</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Tetrahedral</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
                        <span class="n">circumscribed_radius</span><span class="o">=</span><span class="n">circumscribed_radius</span><span class="p">,</span>
                        <span class="n">sym</span><span class="o">=</span><span class="n">sym</span><span class="p">)</span>
        <span class="n">vectorsEdge</span><span class="p">,</span> <span class="n">vectorsPlane</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">unitCellPlanes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="n">vLabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">,</span> <span class="s1">&#39;v2&#39;</span><span class="p">,</span> <span class="s1">&#39;v3&#39;</span><span class="p">]</span>
            <span class="n">pLabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">,</span> <span class="s1">&#39;p2&#39;</span><span class="p">,</span> <span class="s1">&#39;p3&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I222</span> <span class="ow">or</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I222r</span> <span class="ow">or</span>
          <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_In25</span> <span class="ow">or</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_In25r</span> <span class="ow">or</span>
          <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n3</span> <span class="ow">or</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n3r</span> <span class="ow">or</span>
          <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n5</span> <span class="ow">or</span> <span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n5r</span><span class="p">):</span>
        <span class="n">i_sym</span> <span class="o">=</span> <span class="n">cts</span><span class="o">.</span><span class="n">SCIPION_SYM_NAME</span><span class="p">[</span><span class="n">sym</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">Icosahedron</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
                        <span class="n">circumscribed_radius</span><span class="o">=</span><span class="n">circumscribed_radius</span><span class="p">,</span>
                        <span class="n">orientation</span><span class="o">=</span><span class="n">i_sym</span><span class="p">)</span>
        <span class="n">vectorsEdge</span><span class="p">,</span> <span class="n">vectorsPlane</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">unitCellPlanes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="n">vLabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">,</span> <span class="s1">&#39;v2&#39;</span><span class="p">,</span> <span class="s1">&#39;v3&#39;</span><span class="p">]</span>
            <span class="n">pLabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">,</span> <span class="s1">&#39;p2&#39;</span><span class="p">,</span> <span class="s1">&#39;p3&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
        <span class="n">bildFileName</span> <span class="o">=</span> <span class="n">cts</span><span class="o">.</span><span class="n">SCIPION_SYM_NAME</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.bild&#39;</span>
        <span class="n">Chimera</span><span class="o">.</span><span class="n">createCoordinateAxisFile</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="n">expansionFactor</span><span class="p">,</span>
                                         <span class="n">bildFileName</span><span class="o">=</span><span class="n">bildFileName</span><span class="p">,</span>
                                         <span class="n">sampling</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="s1">&#39;navyÂ blue&#39;</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bildFileName</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vector</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vectorsEdge</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.comment </span><span class="si">{</span><span class="n">vLabels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.color </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">expansionFactor</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">expansionFactor</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">expansionFactor</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.arrow 0 0 0  </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s1"> 0.20 0.40 0.75</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vector</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vectorsPlane</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.comment </span><span class="si">{</span><span class="n">pLabels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.color </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">expansionFactor</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.cone 0 0 0  </span><span class="si">{</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="n">expansionFactor</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                                       </span><span class="si">{</span><span class="n">y</span><span class="o">/</span><span class="p">(</span><span class="n">expansionFactor</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                                       </span><span class="si">{</span><span class="n">z</span><span class="o">/</span><span class="p">(</span><span class="n">expansionFactor</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.arrow 0 0 0  </span><span class="si">{</span><span class="n">x</span><span class="o">*</span><span class="n">expansionFactor</span><span class="si">}</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                                        </span><span class="si">{</span><span class="n">y</span><span class="o">*</span><span class="n">expansionFactor</span><span class="si">}</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                                        </span><span class="si">{</span><span class="n">z</span><span class="o">*</span><span class="n">expansionFactor</span><span class="si">}</span><span class="s1"> 0.20 0.40 0.75</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">generalize</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vectorsEdge</span><span class="p">):</span>
            <span class="n">vectorsEdge</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vectorsPlane</span><span class="p">):</span>
            <span class="n">vectorsPlane</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vectorsEdge</span><span class="p">,</span> <span class="n">vectorsPlane</span></div>


<span class="k">def</span> <span class="nf">__icosahedralSymmetryMatrices</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">cts</span><span class="o">.</span><span class="n">SYM_I222</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I222</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;222&#39;</span>
    <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I222r</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;222r&#39;</span>
    <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_In25</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;n25&#39;</span>
    <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_In25r</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;n25r&#39;</span>
    <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n5</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;2n5&#39;</span>
    <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n5r</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;2n5r&#39;</span>
    <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n3</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;2n3&#39;</span>
    <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n3r</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;2n3r&#39;</span>

    <span class="n">i</span> <span class="o">=</span> <span class="n">Icosahedron</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">sym</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">icosahedralSymmetryMatrices</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">__icosahedralUnitCellPlanes</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">cts</span><span class="o">.</span><span class="n">SYM_I222</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I222</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;222&#39;</span>
    <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I222r</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;222r&#39;</span>
    <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_In25</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;n25&#39;</span>
    <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_In25r</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;n25r&#39;</span>
    <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n5</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;2n5&#39;</span>
    <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n5r</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;2n5r&#39;</span>
    <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n3</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;2n3&#39;</span>
    <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_I2n3r</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;2n3r&#39;</span>

    <span class="n">i</span> <span class="o">=</span> <span class="n">Icosahedron</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">sym</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">unitCellPlanes</span><span class="p">())</span>


<div class="viewcode-block" id="Cyclic"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Cyclic">[docs]</a><span class="k">class</span> <span class="nc">Cyclic</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;cyclic class.</span>
<span class="sd">        Allow to compute symmetry matrices, vertices,</span>
<span class="sd">        symmetry axis and unit cell planes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">circumscribed_radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :Parameters:</span>
<span class="sd">            n: int order of symmetry</span>
<span class="sd">            circumscribed_radius: float radius of the circumscribed sphere</span>
<span class="sd">            center: tuple of 3 floats, center of the circumscribed sphere</span>
<span class="sd">            offset: float, angle in degrees to rotate the symmetry axis</span>
<span class="sd">                    it modifies the unit cell but not the symmetry matrices</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span> <span class="o">=</span> <span class="n">circumscribed_radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matrices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>

<div class="viewcode-block" id="Cyclic.symmetryMatrices"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Cyclic.symmetryMatrices">[docs]</a>    <span class="k">def</span> <span class="nf">symmetryMatrices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get Matrices for cyclic symmetry of order n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matrices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">tf</span> <span class="o">=</span> <span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                  <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matrices</span> <span class="o">=</span> <span class="n">_recenterSymmetries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matrices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrices</span></div>

<div class="viewcode-block" id="Cyclic.unitCellPlanes"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Cyclic.unitCellPlanes">[docs]</a>    <span class="k">def</span> <span class="nf">unitCellPlanes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get planes that define a unit cell for cyclic symmetry of order n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetryMatrices</span><span class="p">()</span>
        <span class="c1"># these three vectors are enges of the unit cell</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c1</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c2</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
        <span class="n">v3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>  <span class="c1"># keep this dim 3 instead of dim 4</span>

        <span class="c1"># cross product of v1/v2 with eigenvetor</span>
        <span class="c1"># these two vectors are normal to the planes that define the unit cell</span>
        <span class="n">plane1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v3</span><span class="p">)</span>
        <span class="n">plane2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v2&quot;</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v3&quot;</span><span class="p">,</span> <span class="n">v3</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plane1&quot;</span><span class="p">,</span> <span class="n">plane1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plane2&quot;</span><span class="p">,</span> <span class="n">plane2</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">v1</span><span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="n">v2</span><span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="n">v3</span><span class="o">*</span><span class="n">c</span><span class="p">],</span> <span class="p">[</span><span class="n">plane1</span><span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="n">plane2</span><span class="o">*</span><span class="n">c</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="Dihedral"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Dihedral">[docs]</a><span class="k">class</span> <span class="nc">Dihedral</span><span class="p">(</span><span class="n">Cyclic</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;dihedral class.</span>
<span class="sd">        Allow to compute symmetry matrices,  vertices,</span>
<span class="sd">        symmetry axis and unit cell planes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">circumscribed_radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="n">cts</span><span class="o">.</span><span class="n">SYM_DIHEDRAL_X</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :Parameters:</span>
<span class="sd">            n: int order of symmetry</span>
<span class="sd">            circumscribed_radius: float radius of the circumscribed sphere</span>
<span class="sd">            center: tuple of 3 floats, center of the circumscribed sphere</span>
<span class="sd">            offset: float, angle in degrees to rotate the symmetry axis</span>
<span class="sd">                    it modifies the unit cell but not the symmetry matrices</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                         <span class="n">circumscribed_radius</span><span class="o">=</span><span class="n">circumscribed_radius</span><span class="p">,</span>
                         <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
                         <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sym</span> <span class="o">=</span> <span class="n">sym</span>

<div class="viewcode-block" id="Dihedral.symmetryMatrices"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Dihedral.symmetryMatrices">[docs]</a>    <span class="k">def</span> <span class="nf">symmetryMatrices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">clist</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">symmetryMatrices</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_DIHEDRAL_X</span><span class="p">:</span>
            <span class="c1"># matrix that reflect in the x axis</span>
            <span class="n">reflect</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Be carefull untested code&quot;</span><span class="p">)</span>
            <span class="c1"># matrix that reflect in the y axis</span>
            <span class="n">reflect</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="n">tflist</span> <span class="o">=</span> <span class="n">_matrixProducts</span><span class="p">([</span><span class="n">_identityMatrix</span><span class="p">(),</span> <span class="n">reflect</span><span class="p">],</span> <span class="n">clist</span><span class="p">)</span>
        <span class="n">tflist</span> <span class="o">=</span> <span class="n">_recenterSymmetries</span><span class="p">(</span><span class="n">tflist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tflist</span></div>

<div class="viewcode-block" id="Dihedral.unitCellPlanes"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Dihedral.unitCellPlanes">[docs]</a>    <span class="k">def</span> <span class="nf">unitCellPlanes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get planes that define a unit cell for dihedral symmetry of order n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">vectorsEdge</span><span class="p">,</span> <span class="n">vectorsPlane</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">unitCellPlanes</span><span class="p">()</span>
        <span class="n">vectorsPlane</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="n">vectorsEdge</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v2&quot;</span><span class="p">,</span> <span class="n">vectorsEdge</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;eigenvector&quot;</span><span class="p">,</span> <span class="n">vectorsEdge</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plane1&quot;</span><span class="p">,</span> <span class="n">vectorsPlane</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plane2&quot;</span><span class="p">,</span> <span class="n">vectorsPlane</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plane3&quot;</span><span class="p">,</span> <span class="n">vectorsPlane</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">vectorsEdge</span><span class="p">,</span> <span class="n">vectorsPlane</span></div>

<div class="viewcode-block" id="Dihedral.coordinateSystemTransform"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Dihedral.coordinateSystemTransform">[docs]</a>    <span class="k">def</span> <span class="nf">coordinateSystemTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origSym</span><span class="p">,</span> <span class="n">targetSym</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;========================&quot;</span><span class="p">,</span>
              <span class="n">cts</span><span class="o">.</span><span class="n">SCIPION_SYM_NAME</span><span class="p">[</span><span class="n">origSym</span><span class="p">],</span>
              <span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span>
              <span class="n">cts</span><span class="o">.</span><span class="n">SCIPION_SYM_NAME</span><span class="p">[</span><span class="n">targetSym</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">origSym</span> <span class="o">==</span> <span class="n">targetSym</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">origSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_DIHEDRAL_X</span> <span class="ow">and</span> <span class="n">targetSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_DIHEDRAL_Y</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">((</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">origSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_DIHEDRAL_Y</span> <span class="ow">and</span> <span class="n">targetSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_DIHEDRAL_X</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">((</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;unknown dihedral symmetry pair: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">cts</span><span class="o">.</span><span class="n">SCIPION_SYM_NAME</span><span class="p">[</span><span class="n">origSym</span><span class="p">],</span>
                <span class="n">cts</span><span class="o">.</span><span class="n">SCIPION_SYM_NAME</span><span class="p">[</span><span class="n">targetSym</span><span class="p">]))</span></div></div>


<div class="viewcode-block" id="Tetrahedral"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Tetrahedral">[docs]</a><span class="k">class</span> <span class="nc">Tetrahedral</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tetrahedral class.</span>
<span class="sd">        Allow to compute symmetry matrices,  vertices,</span>
<span class="sd">        symmetry axis and unit cell planes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">circumscribed_radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">sym</span><span class="o">=</span><span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :Parameters:</span>
<span class="sd">            n: int order of symmetry</span>
<span class="sd">            circumscribed_radius: float radius of the circumscribed sphere</span>
<span class="sd">            center: tuple of 3 floats, center of the circumscribed sphere</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span> <span class="o">=</span> <span class="n">circumscribed_radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matrices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sym</span> <span class="o">=</span> <span class="n">sym</span>

<div class="viewcode-block" id="Tetrahedral.symmetryMatrices"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Tetrahedral.symmetryMatrices">[docs]</a>    <span class="k">def</span> <span class="nf">symmetryMatrices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        identity</span>
<span class="sd">        4 * rotation by 120 clockwise (seen from a vertex):</span>
<span class="sd">                            (234), (143), (412), (321)</span>
<span class="sd">        4 * rotation by 120 counterclockwise (ditto)</span>
<span class="sd">        3 * rotation by 180</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="c1"># simmetries are rotations around theses axis by these angles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aa</span> <span class="o">=</span> <span class="p">(((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">180</span><span class="p">),</span>  <span class="c1"># 0 1</span>
                   <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">180</span><span class="p">),</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">180</span><span class="p">),</span>  <span class="c1"># 2 3</span>
                   <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">120</span><span class="p">),</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">240</span><span class="p">),</span>  <span class="c1"># 4 5</span>
                   <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">120</span><span class="p">),</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">240</span><span class="p">),</span>  <span class="c1"># 6 7</span>
                   <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">120</span><span class="p">),</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">240</span><span class="p">),</span>  <span class="c1"># 8 9</span>
                   <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">120</span><span class="p">),</span>  <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">240</span><span class="p">))</span>  <span class="c1"># 10 11</span>

        <span class="n">syms</span> <span class="o">=</span> <span class="p">[</span><span class="n">_rotationTransform</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span> <span class="k">for</span> <span class="n">axis</span><span class="p">,</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aa</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3R</span><span class="p">:</span>
            <span class="c1"># convention, 3-fold on z, 3-fold in yz plane sign(y) = sign(z)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tf</span> <span class="o">=</span> <span class="n">_multiplyMatrices</span><span class="p">(</span>
                     <span class="n">_rotationTransform</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mf">45.0</span><span class="p">),</span>
                     <span class="n">_rotationTransform</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                        <span class="o">-</span><span class="n">acos</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">pi</span><span class="p">))</span>
            <span class="n">syms</span> <span class="o">=</span> <span class="n">_coordinateTransformList</span><span class="p">(</span><span class="n">syms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tf</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3</span><span class="p">:</span>
            <span class="c1"># convention, 3-fold on z, 3-fold in yz plane sign(y) != sign(z)</span>
            <span class="n">tfaux</span> <span class="o">=</span> <span class="n">_multiplyMatrices</span><span class="p">(</span>
                     <span class="n">_rotationTransform</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mf">45.0</span><span class="p">),</span>
                     <span class="n">_rotationTransform</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                        <span class="o">-</span><span class="n">acos</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">pi</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tf</span> <span class="o">=</span> <span class="n">_multiplyMatrices</span><span class="p">(</span>
                     <span class="n">tfaux</span><span class="p">,</span>
                     <span class="n">_reflectMatrix</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">syms</span> <span class="o">=</span> <span class="n">_coordinateTransformList</span><span class="p">(</span><span class="n">syms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tf</span><span class="p">)</span>

        <span class="n">syms</span> <span class="o">=</span> <span class="n">_recenterSymmetries</span><span class="p">(</span><span class="n">syms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">syms</span></div>

<div class="viewcode-block" id="Tetrahedral.unitCellPlanes"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Tetrahedral.unitCellPlanes">[docs]</a>    <span class="k">def</span> <span class="nf">unitCellPlanes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get planes that define a unit cell for tetrahedral symmetry of</span>
<span class="sd">            order n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unit cell sym&quot;</span><span class="p">,</span> <span class="n">cts</span><span class="o">.</span><span class="n">SCIPION_SYM_NAME</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sym</span><span class="p">])</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetryMatrices</span><span class="p">()</span>
        <span class="c1"># four corners tetahedron</span>
        <span class="n">v0</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aa</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="o">*</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aa</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="o">*</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aa</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="o">*</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span>
        <span class="n">v3</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aa</span><span class="p">[</span><span class="mi">10</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="o">*</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3</span> <span class="ow">or</span>\
           <span class="bp">self</span><span class="o">.</span><span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3R</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tf</span> <span class="o">=</span> <span class="n">_invertMatrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tf</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3</span><span class="p">:</span>
                <span class="n">_3fold_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">_3fold_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">_3fold_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_3fold_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">_3fold_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">_3fold_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_3fold_1</span> <span class="o">=</span> <span class="n">v1</span>
            <span class="n">_3fold_2</span> <span class="o">=</span> <span class="n">v0</span>
            <span class="n">_3fold_3</span> <span class="o">=</span> <span class="n">v2</span>

        <span class="c1"># colors = [&#39;cyan&#39;, &#39;green&#39;, &#39;magenta&#39;, &#39;navyÂ blue&#39;]</span>
        <span class="n">vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">_3fold_1</span><span class="p">,</span> <span class="n">_3fold_2</span><span class="p">)</span>
        <span class="n">vp</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vp</span><span class="p">,</span> <span class="n">_3fold_3</span><span class="p">))</span>

        <span class="n">plane1</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">_3fold_1</span><span class="p">,</span> <span class="n">_3fold_2</span><span class="p">))</span>  <span class="c1"># cyan</span>
        <span class="n">plane2</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">_3fold_2</span><span class="p">,</span> <span class="n">vp</span><span class="p">))</span>  <span class="c1"># green</span>
        <span class="n">plane3</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vp</span><span class="p">,</span> <span class="n">_3fold_1</span><span class="p">))</span>  <span class="c1"># magenta</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v0&quot;</span><span class="p">,</span> <span class="n">_3fold_1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="n">_3fold_2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v2&quot;</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plane1&quot;</span><span class="p">,</span> <span class="n">plane1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plane2&quot;</span><span class="p">,</span> <span class="n">plane2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plane3&quot;</span><span class="p">,</span> <span class="n">plane3</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_3fold_1</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">_3fold_2</span><span class="p">],</span> <span class="p">[</span><span class="n">plane1</span><span class="p">,</span> <span class="n">plane2</span><span class="p">,</span> <span class="n">plane3</span><span class="p">]</span></div>

<div class="viewcode-block" id="Tetrahedral.coordinateSystemTransform"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Tetrahedral.coordinateSystemTransform">[docs]</a>    <span class="k">def</span> <span class="nf">coordinateSystemTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origSym</span><span class="p">,</span> <span class="n">targetSym</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">origSym</span> <span class="o">==</span> <span class="n">targetSym</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">origSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_222</span> <span class="ow">and</span>
              <span class="n">targetSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3</span> <span class="ow">or</span>
              <span class="n">origSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_222</span> <span class="ow">and</span>
              <span class="n">targetSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3R</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;========================222 -&gt; &quot;</span><span class="p">)</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="n">_multiplyMatrices</span><span class="p">(</span>
                     <span class="n">_rotationTransform</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                        <span class="o">-</span><span class="n">acos</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">pi</span><span class="p">),</span>
                     <span class="n">_rotationTransform</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="mf">45.0</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># matrix = _multiplyMatrices(</span>
            <span class="c1">#          matrix,</span>
            <span class="c1">#          _reflectMatrix((0, 0, 1))</span>
            <span class="c1"># )</span>
            <span class="c1"># matrix = _invertMatrix(matrix)</span>
            <span class="k">if</span> <span class="n">targetSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">matrix</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">matrix2</span> <span class="o">=</span> <span class="n">_reflectMatrix</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">_multiplyMatrices</span><span class="p">(</span><span class="n">matrix2</span><span class="p">,</span> <span class="n">matrix</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">origSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3R</span> <span class="ow">and</span>
              <span class="n">targetSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3</span><span class="p">)</span> <span class="ow">or</span>\
             <span class="p">(</span><span class="n">origSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3</span> <span class="ow">and</span>
              <span class="n">targetSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3R</span><span class="p">):</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="n">_reflectMatrix</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">matrix</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">origSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3</span> <span class="ow">and</span>
              <span class="n">targetSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_222</span><span class="p">)</span> <span class="ow">or</span>\
             <span class="p">(</span><span class="n">origSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_Z3R</span> <span class="ow">and</span>
              <span class="n">targetSym</span> <span class="o">==</span> <span class="n">cts</span><span class="o">.</span><span class="n">SYM_TETRAHEDRAL_222</span><span class="p">):</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinateSystemTransform</span><span class="p">(</span><span class="n">targetSym</span><span class="p">,</span> <span class="n">origSym</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_invertMatrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;unknown Tetrahedral symmetry pair: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">cts</span><span class="o">.</span><span class="n">SCIPION_SYM_NAME</span><span class="p">[</span><span class="n">origSym</span><span class="p">],</span>
                <span class="n">cts</span><span class="o">.</span><span class="n">SCIPION_SYM_NAME</span><span class="p">[</span><span class="n">targetSym</span><span class="p">]))</span></div></div>


<div class="viewcode-block" id="Octahedral"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Octahedral">[docs]</a><span class="k">class</span> <span class="nc">Octahedral</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Octahedral class.</span>
<span class="sd">        Allow to compute symmetry matrices,</span>
<span class="sd">        symmetry axis and unit cell planes of an octahedral symmetry.</span>
<span class="sd">        4-folds along x, y, z axes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">circumscribed_radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :Parameters:</span>
<span class="sd">            circumscribed_radius: float radius of the circumscribed sphere</span>
<span class="sd">            center: tuple of 3 floats, center of the circumscribed sphere</span>
<span class="sd">            offset: float, angle in degrees to rotate the symmetry axis</span>
<span class="sd">                    it modifies the unit cell but not the symmetry matrices</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span> <span class="o">=</span> <span class="n">circumscribed_radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matrices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>

<div class="viewcode-block" id="Octahedral.symmetryMatrices"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Octahedral.symmetryMatrices">[docs]</a>    <span class="k">def</span> <span class="nf">symmetryMatrices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get Matrices for cyclic symmetry of order n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c4</span> <span class="o">=</span> <span class="p">(((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
                   <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">90</span><span class="p">),</span>
                   <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">180</span><span class="p">),</span>
                   <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">270</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cube</span> <span class="o">=</span> <span class="p">(((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
                     <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">90</span><span class="p">),</span>
                     <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">180</span><span class="p">),</span>
                     <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">270</span><span class="p">),</span>
                     <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">90</span><span class="p">),</span>
                     <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">270</span><span class="p">))</span>
        <span class="n">c4syms</span> <span class="o">=</span> <span class="p">[</span><span class="n">_rotationTransform</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">axis</span><span class="p">,</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">c4</span><span class="p">]</span>
        <span class="n">cubesyms</span> <span class="o">=</span> <span class="p">[</span><span class="n">_rotationTransform</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">axis</span><span class="p">,</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cube</span><span class="p">]</span>
        <span class="n">syms</span> <span class="o">=</span> <span class="n">_matrixProducts</span><span class="p">(</span><span class="n">cubesyms</span><span class="p">,</span> <span class="n">c4syms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matrices</span> <span class="o">=</span> <span class="n">_recenterSymmetries</span><span class="p">(</span><span class="n">syms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrices</span></div>

<div class="viewcode-block" id="Octahedral.unitCellPlanes"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Octahedral.unitCellPlanes">[docs]</a>    <span class="k">def</span> <span class="nf">unitCellPlanes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get planes that define a unit cell for an octahedral symmetry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetryMatrices</span><span class="p">()</span>
        <span class="c1"># four corners tetahedron</span>
        <span class="n">_4fold_1</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span>
        <span class="n">_3fold_1</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span>
        <span class="n">_3fold_2</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span>

        <span class="n">plane1</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">_3fold_2</span><span class="p">,</span> <span class="n">_4fold_1</span><span class="p">))</span>  <span class="c1"># cyan</span>
        <span class="n">plane2</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">_3fold_1</span><span class="p">,</span> <span class="n">_3fold_2</span><span class="p">))</span>  <span class="c1"># green</span>
        <span class="n">plane3</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">_4fold_1</span><span class="p">,</span> <span class="n">_3fold_1</span><span class="p">))</span>  <span class="c1"># magenta</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v0&quot;</span><span class="p">,</span> <span class="n">_4fold_1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="n">_3fold_2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v2&quot;</span><span class="p">,</span> <span class="n">_3fold_1</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plane1&quot;</span><span class="p">,</span> <span class="n">plane1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plane2&quot;</span><span class="p">,</span> <span class="n">plane2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plane3&quot;</span><span class="p">,</span> <span class="n">plane3</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_4fold_1</span><span class="p">,</span> <span class="n">_3fold_2</span><span class="p">,</span> <span class="n">_3fold_1</span><span class="p">],</span> <span class="p">[</span><span class="n">plane1</span><span class="p">,</span> <span class="n">plane2</span><span class="p">,</span> <span class="n">plane3</span><span class="p">]</span></div></div>


<span class="c1"># TODO: Why is this a global variable instead of</span>
<span class="c1"># a class variable?</span>
<span class="n">icos_matrices</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Maps orientation name to 60 matrices.</span>


<div class="viewcode-block" id="Icosahedron"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Icosahedron">[docs]</a><span class="k">class</span> <span class="nc">Icosahedron</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Icosahedron class.</span>
<span class="sd">        Allow to compute symmetry matrices, icosahedron vertices,</span>
<span class="sd">         symmetry axis and unit cell planes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">circumscribed_radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;222&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;point = np.array([0, 1, PHI]&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span> <span class="o">=</span> <span class="n">circumscribed_radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">orientation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>
        <span class="c1"># Triangle edge length of unit icosahedron.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># icosahedron vertices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">triangles</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># icosahedron faces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_3foldAxis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_2foldAxis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># icosahedron edges</span>
        <span class="c1"># ---------------------------------------------------------------------------------------------</span>
        <span class="c1"># Coordinates systems.</span>
        <span class="c1"># &#39;222&#39;         2-fold symmetry along x, y, and z axes.</span>
        <span class="c1"># &#39;222r&#39;        &#39;222&#39; with 90 degree rotation around z.</span>
        <span class="c1"># &#39;2n5&#39;         2-fold symmetry along x and 5-fold along z.</span>
        <span class="c1"># &#39;2n5r&#39;        &#39;2n5&#39; with 180 degree rotation about y.</span>
        <span class="c1"># &#39;n25&#39;         2-fold symmetry along y and 5-fold along z.</span>
        <span class="c1"># &#39;n25r&#39;        &#39;n25&#39; with 180 degree rotation about x.</span>
        <span class="c1"># &#39;2n3&#39;         2-fold symmetry along x and 3-fold along z.</span>
        <span class="c1"># &#39;2n3r&#39;        &#39;2n3&#39; with 180 degree rotation about y.</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;222&#39;</span><span class="p">,</span> <span class="s1">&#39;222r&#39;</span><span class="p">,</span> <span class="s1">&#39;2n5&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;2n5r&#39;</span><span class="p">,</span> <span class="s1">&#39;n25&#39;</span><span class="p">,</span> <span class="s1">&#39;n25r&#39;</span><span class="p">,</span> <span class="s1">&#39;2n3&#39;</span><span class="p">,</span> <span class="s1">&#39;2n3r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icosahedronEdgeLength</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">icosahedronEdgeLength</span><span class="p">(</span><span class="n">circumscribed_radius</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle23</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle25</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle35</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">icosahedronAngles</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icosahedronGeometry</span><span class="p">()</span>

    <span class="c1"># ---------------------------------------------------------------------------------------------</span>
    <span class="c1"># 60 icosahedral symmetry matrices.</span>
    <span class="c1">#</span>
<div class="viewcode-block" id="Icosahedron.icosahedralSymmetryMatrices"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Icosahedron.icosahedralSymmetryMatrices">[docs]</a>    <span class="k">def</span> <span class="nf">icosahedralSymmetryMatrices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">icosahedralMatrixTable</span><span class="p">()</span>
        <span class="n">tflist</span> <span class="o">=</span> <span class="n">_recenterSymmetries</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tflist</span></div>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Edge length of icosahedron with a certain radio of the circumscribed</span>
    <span class="c1"># sphere:</span>
    <span class="c1"># According to Radio of the circumscribed sphere = 1 (vertices),</span>
    <span class="c1">#  the icosahedronEdgeLength should be 1.0515</span>

<div class="viewcode-block" id="Icosahedron.icosahedronEdgeLength"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Icosahedron.icosahedronEdgeLength">[docs]</a>    <span class="k">def</span> <span class="nf">icosahedronEdgeLength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">circumscribed_radius</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">circumscribed_radius</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span></div>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Matrices for mapping between different icosahedron coordinate frames.</span>
    <span class="c1">#</span>
<div class="viewcode-block" id="Icosahedron.coordinateSystemTransform"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Icosahedron.coordinateSystemTransform">[docs]</a>    <span class="k">def</span> <span class="nf">coordinateSystemTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_cs</span><span class="p">,</span> <span class="n">to_cs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cst</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cst</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cst</span><span class="p">[(</span><span class="n">from_cs</span><span class="p">,</span> <span class="n">to_cs</span><span class="p">)]</span>

        <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cst</span>

        <span class="n">s25</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># Sin/Cos for angle between 2-fold and 5-fold axis</span>
        <span class="n">c25</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s25</span> <span class="o">*</span> <span class="n">s25</span><span class="p">)</span>
        <span class="c1"># Sin/Cos for angle between 3-fold and 5-fold axis</span>
        <span class="n">s35</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">c35</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s35</span> <span class="o">*</span> <span class="n">s35</span><span class="p">)</span>

        <span class="n">transform</span><span class="p">[(</span><span class="s1">&#39;2n5&#39;</span><span class="p">,</span> <span class="s1">&#39;222&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c25</span><span class="p">,</span> <span class="o">-</span><span class="n">s25</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s25</span><span class="p">,</span> <span class="n">c25</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">transform</span><span class="p">[(</span><span class="s1">&#39;2n5&#39;</span><span class="p">,</span> <span class="s1">&#39;2n3&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c35</span><span class="p">,</span> <span class="n">s35</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">s35</span><span class="p">,</span> <span class="n">c35</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1"># Axes permutations.</span>
        <span class="c1"># 90 degree rotation about z</span>
        <span class="n">transform</span><span class="p">[(</span><span class="s1">&#39;222&#39;</span><span class="p">,</span> <span class="s1">&#39;222r&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                      <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                      <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># 180 degree rotation about y</span>
        <span class="n">transform</span><span class="p">[(</span><span class="s1">&#39;2n3&#39;</span><span class="p">,</span> <span class="s1">&#39;2n3r&#39;</span><span class="p">)]</span> <span class="o">=</span> \
            <span class="n">transform</span><span class="p">[(</span><span class="s1">&#39;2n5&#39;</span><span class="p">,</span> <span class="s1">&#39;2n5r&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                          <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                          <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># 180 degree rotation about x</span>
        <span class="n">transform</span><span class="p">[(</span><span class="s1">&#39;n25&#39;</span><span class="p">,</span> <span class="s1">&#39;n25r&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                      <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                      <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># x &lt;-&gt; y and z -&gt; -z</span>
        <span class="n">transform</span><span class="p">[(</span><span class="s1">&#39;n25&#39;</span><span class="p">,</span> <span class="s1">&#39;2n5&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1"># Extend to all pairs of transforms.</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tlist</span><span class="p">):</span>

            <span class="n">tlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">transform</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="c1"># Add inverse transforms</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="n">transform</span><span class="p">:</span>
                    <span class="n">transform</span><span class="p">[(</span><span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">)]</span> <span class="o">=</span> <span class="n">_transposeMatrix</span><span class="p">(</span><span class="n">transform</span><span class="p">[(</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">)])</span>

            <span class="c1"># Use transitivity</span>
            <span class="k">for</span> <span class="n">key1</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
                <span class="n">f1</span> <span class="o">=</span> <span class="n">key1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">t1</span> <span class="o">=</span> <span class="n">key1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">:</span>
                    <span class="n">f2</span> <span class="o">=</span> <span class="n">key2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">t2</span> <span class="o">=</span> <span class="n">key2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">f2</span> <span class="o">==</span> <span class="n">t1</span> <span class="ow">and</span> <span class="n">f1</span> <span class="o">!=</span> <span class="n">t2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">transform</span><span class="p">:</span>
                        <span class="n">transform</span><span class="p">[(</span><span class="n">f1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">_multiplyMatrices</span><span class="p">(</span><span class="n">transform</span><span class="p">[(</span>
                            <span class="n">f2</span><span class="p">,</span> <span class="n">t2</span><span class="p">)],</span> <span class="n">transform</span><span class="p">[(</span><span class="n">f1</span><span class="p">,</span> <span class="n">t1</span><span class="p">)])</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">_identityMatrix</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system_names</span><span class="p">:</span>
            <span class="n">transform</span><span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>

        <span class="k">return</span> <span class="n">transform</span><span class="p">[(</span><span class="n">from_cs</span><span class="p">,</span> <span class="n">to_cs</span><span class="p">)]</span></div>

    <span class="c1"># ---------------------------------------------------------------------------------------</span>
    <span class="c1"># Compute icosahedral transformation matrices for different</span>
    <span class="c1"># coordinate systems.</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="Icosahedron.icosahedralMatrixTable"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Icosahedron.icosahedralMatrixTable">[docs]</a>    <span class="k">def</span> <span class="nf">icosahedralMatrixTable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">icos_matrices</span>
        <span class="k">if</span> <span class="n">icos_matrices</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">icos_matrices</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># .309016994</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># -.809016994</span>

        <span class="n">icos_matrices</span><span class="p">[</span><span class="s1">&#39;222&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>

            <span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

            <span class="p">((</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>

        <span class="p">)</span>

        <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cs</span> <span class="o">!=</span> <span class="s1">&#39;222&#39;</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinateSystemTransform</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="s1">&#39;222&#39;</span><span class="p">)</span>
                <span class="n">tinv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinateSystemTransform</span><span class="p">(</span><span class="s1">&#39;222&#39;</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
                <span class="n">icos_matrices</span><span class="p">[</span><span class="n">cs</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">_multiplyMatrices</span><span class="p">(</span><span class="n">tinv</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                                     <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">icos_matrices</span><span class="p">[</span><span class="s1">&#39;222&#39;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">icos_matrices</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Icosahedron.icosahedronAngles"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Icosahedron.icosahedronAngles">[docs]</a>    <span class="k">def</span> <span class="nf">icosahedronAngles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Angles between 2-fold, 3-fold and 5-fold</span>
        <span class="c1"># symmetry axes of an icosahedron.</span>
        <span class="n">angle25</span> <span class="o">=</span> <span class="n">asin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">angle35</span> <span class="o">=</span> <span class="n">asin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">angle23</span> <span class="o">=</span> <span class="n">asin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">angle23</span><span class="p">,</span> <span class="n">angle25</span><span class="p">,</span> <span class="n">angle35</span></div>

<div class="viewcode-block" id="Icosahedron.icosahedronGeometry"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Icosahedron.icosahedronGeometry">[docs]</a>    <span class="k">def</span> <span class="nf">icosahedronGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle25</span>  <span class="c1"># Angle spanned by edge from center</span>
        <span class="c1"># 5-fold symmetry axis along z</span>
        <span class="n">c5</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">s5</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">tf5</span> <span class="o">=</span> <span class="p">((</span><span class="n">c5</span><span class="p">,</span> <span class="o">-</span><span class="n">s5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
               <span class="p">(</span><span class="n">s5</span><span class="p">,</span> <span class="n">c5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1"># 2-fold symmetry axis along x</span>
        <span class="n">tf2</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="n">p</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span>
                      <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span><span class="p">)))</span>
        <span class="n">p50</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span>
                        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">circumscribed_radius</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">))))</span>
        <span class="n">p51</span> <span class="o">=</span> <span class="n">_applyMatrix</span><span class="p">(</span><span class="n">tf5</span><span class="p">,</span> <span class="n">p50</span><span class="p">)</span>
        <span class="n">p52</span> <span class="o">=</span> <span class="n">_applyMatrix</span><span class="p">(</span><span class="n">tf5</span><span class="p">,</span> <span class="n">p51</span><span class="p">)</span>
        <span class="n">p53</span> <span class="o">=</span> <span class="n">_applyMatrix</span><span class="p">(</span><span class="n">tf5</span><span class="p">,</span> <span class="n">p52</span><span class="p">)</span>
        <span class="n">p54</span> <span class="o">=</span> <span class="n">_applyMatrix</span><span class="p">(</span><span class="n">tf5</span><span class="p">,</span> <span class="n">p53</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">p50</span><span class="p">,</span> <span class="n">p51</span><span class="p">,</span> <span class="n">p52</span><span class="p">,</span> <span class="n">p53</span><span class="p">,</span> <span class="n">p54</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_applyMatrix</span><span class="p">(</span><span class="n">tf2</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">!=</span> <span class="s1">&#39;2n5&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinateSystemTransform</span><span class="p">(</span><span class="s1">&#39;2n5&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="p">[</span><span class="n">_applyMatrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tf</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">]</span>

            <span class="c1">#</span>
            <span class="c1"># Vertex numbering</span>
            <span class="c1">#</span>
            <span class="c1">#  Top   1          Bottom</span>
            <span class="c1">#      2   5        9   10</span>
            <span class="c1">#        0            6</span>
            <span class="c1">#      3   4        8   11</span>
            <span class="c1">#                     7</span>
        <span class="c1"># 20 triangles composing icosahedron.</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">triangles</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">triangle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_3foldAxis</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="n">item1</span> <span class="o">+</span> <span class="n">item2</span> <span class="o">+</span> <span class="n">item3</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.</span>
                                    <span class="k">for</span> <span class="n">item1</span><span class="p">,</span>  <span class="n">item2</span><span class="p">,</span>  <span class="n">item3</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">triangle</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">triangle</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">triangle</span><span class="p">[</span><span class="mi">2</span><span class="p">]])])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                      <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                      <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
                      <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                      <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                      <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_2foldAxis</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="n">item1</span> <span class="o">+</span> <span class="n">item2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
                                    <span class="k">for</span> <span class="n">item1</span><span class="p">,</span> <span class="n">item2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                                    <span class="p">])</span></div>

<div class="viewcode-block" id="Icosahedron.getVertices"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Icosahedron.getVertices">[docs]</a>    <span class="k">def</span> <span class="nf">getVertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span></div>

<div class="viewcode-block" id="Icosahedron.getTriangles"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Icosahedron.getTriangles">[docs]</a>    <span class="k">def</span> <span class="nf">getTriangles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangles</span></div>

<div class="viewcode-block" id="Icosahedron.getEdges"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Icosahedron.getEdges">[docs]</a>    <span class="k">def</span> <span class="nf">getEdges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span></div>

<div class="viewcode-block" id="Icosahedron.get3foldAxis"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Icosahedron.get3foldAxis">[docs]</a>    <span class="k">def</span> <span class="nf">get3foldAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_3foldAxis</span></div>

<div class="viewcode-block" id="Icosahedron.get2foldAxis"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Icosahedron.get2foldAxis">[docs]</a>    <span class="k">def</span> <span class="nf">get2foldAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_2foldAxis</span></div>

<div class="viewcode-block" id="Icosahedron.unitCellPlanes"><a class="viewcode-back" href="../../../api/pwem/pwem.convert.symmetry.html#pwem.convert.symmetry.Icosahedron.unitCellPlanes">[docs]</a>    <span class="k">def</span> <span class="nf">unitCellPlanes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get planes that define a unit cell for an octahedral symmetry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;222&#39;</span><span class="p">:</span>
            <span class="c1"># Unit cell in triangle 11 -&gt; (2,8,9)</span>
            <span class="n">_3f</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span> <span class="n">_5f1</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">_5f2</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># noqa</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;222r&#39;</span><span class="p">:</span>
            <span class="c1"># Unit cell in triangle 0 -&gt; (0,1,2)</span>
            <span class="n">_3f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">_5f1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">_5f2</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># noqa</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;n25&#39;</span><span class="p">:</span>
            <span class="c1"># Unit cell in triangle 9 -&gt; (6,11,7)</span>
            <span class="n">_3f</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span> <span class="n">_5f1</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="n">_5f2</span> <span class="o">=</span> <span class="mi">7</span>  <span class="c1"># noqa</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;n25r&#39;</span><span class="p">:</span>
            <span class="c1"># Unit cell in triangle 14 -&gt; (3,7,4)</span>
            <span class="n">_3f</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span> <span class="n">_5f1</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">_5f2</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># noqa</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;2n3&#39;</span><span class="p">:</span>  <span class="c1"># TODO: Untested</span>
            <span class="n">_3f</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span> <span class="n">_5f1</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span> <span class="n">_5f2</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># noqa</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;2n3r&#39;</span><span class="p">:</span>  <span class="c1"># TODO: Untested</span>
            <span class="n">_3f</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span> <span class="n">_5f1</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">_5f2</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># noqa</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;2n5&#39;</span><span class="p">:</span>  <span class="c1"># TODO: Untested</span>
            <span class="n">_3f</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span> <span class="n">_5f1</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span> <span class="n">_5f2</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># noqa</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;2n5r&#39;</span><span class="p">:</span>  <span class="c1"># TODO: Untested</span>
            <span class="n">_3f</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span> <span class="n">_5f1</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">_5f2</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># noqa</span>
        <span class="n">_3fold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_3foldAxis</span><span class="p">[</span><span class="n">_3f</span><span class="p">]</span>
        <span class="n">_5fold_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVertices</span><span class="p">()[</span><span class="n">_5f1</span><span class="p">]</span>
        <span class="n">_5fold_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVertices</span><span class="p">()[</span><span class="n">_5f2</span><span class="p">]</span>

        <span class="n">plane1</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">_5fold_1</span><span class="p">,</span> <span class="n">_3fold</span><span class="p">))</span>  <span class="c1"># cyan</span>
        <span class="n">plane2</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">_3fold</span><span class="p">,</span> <span class="n">_5fold_2</span><span class="p">))</span>  <span class="c1"># magenta</span>
        <span class="n">plane3</span> <span class="o">=</span> <span class="n">_normalizeVector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">_5fold_2</span><span class="p">,</span> <span class="n">_5fold_1</span><span class="p">))</span>  <span class="c1"># green</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v0&quot;</span><span class="p">,</span> <span class="n">_3fold</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="n">_5fold_1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;v2&quot;</span><span class="p">,</span> <span class="n">_5fold_2</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plane1&quot;</span><span class="p">,</span> <span class="n">plane1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plane2&quot;</span><span class="p">,</span> <span class="n">plane2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plane3&quot;</span><span class="p">,</span> <span class="n">plane3</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_3fold</span><span class="p">,</span> <span class="n">_5fold_1</span><span class="p">,</span> <span class="n">_5fold_2</span><span class="p">],</span> <span class="p">[</span><span class="n">plane1</span><span class="p">,</span> <span class="n">plane2</span><span class="p">,</span> <span class="n">plane3</span><span class="p">]</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Scipion team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>