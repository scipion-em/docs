

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pkpd.objects &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/scipion-modes/how-to-install.html">Installing Scipion v3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/user-documentation.html#processing-how-to-s">Processing How Toâ€™s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/facilities/facilities.html">On-the-fly processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/facilities/customize-report.html">Summary Reports</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/api/scipion-API.html">Scipion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/api/plugins-API.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/api/xmipp-API.html">Xmipp API</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/misc/contact-us.html">Contact Us</a></li>
</ul>
<p class="caption"><span class="caption-text">Licences</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/user/license.html">Licenses</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../pkpd.html">pkpd</a> &raquo;</li>
        
      <li>pkpd.objects</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pkpd.objects</h1><div class="highlight"><pre>
<span></span><span class="c1"># **************************************************************************</span>
<span class="c1"># *</span>
<span class="c1"># * Authors:     Carlos Oscar Sorzano (info@kinestat.com)</span>
<span class="c1"># *</span>
<span class="c1"># * Kinestat Pharma</span>
<span class="c1"># *</span>
<span class="c1"># * This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># * it under the terms of the GNU General Public License as published by</span>
<span class="c1"># * the Free Software Foundation; either version 2 of the License, or</span>
<span class="c1"># * (at your option) any later version.</span>
<span class="c1"># *</span>
<span class="c1"># * This program is distributed in the hope that it will be useful,</span>
<span class="c1"># * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># * GNU General Public License for more details.</span>
<span class="c1"># *</span>
<span class="c1"># * You should have received a copy of the GNU General Public License</span>
<span class="c1"># * along with this program; if not, write to the Free Software</span>
<span class="c1"># * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA</span>
<span class="c1"># * 02111-1307  USA</span>
<span class="c1"># *</span>
<span class="c1"># *  All comments concerning this program package may be sent to the</span>
<span class="c1"># *  e-mail address &#39;info@kinestat.com&#39;</span>
<span class="c1"># *</span>
<span class="c1"># **************************************************************************</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">scipion.install.plugin_funcs</span> <span class="k">import</span> <span class="n">PluginInfo</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">izip</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">izip</span> <span class="o">=</span> <span class="nb">zip</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span>

<span class="kn">import</span> <span class="nn">openpyxl</span>
<span class="c1"># from pyworkflow.plugin import PluginInfo</span>
<span class="c1">#</span>
<span class="c1"># from .pkpd_units import (PKPDUnit, convertUnits, changeRateToMinutes,</span>
<span class="c1">#                         changeRateToWeight)</span>
<span class="kn">from</span> <span class="nn">.pkpd_units</span> <span class="k">import</span> <span class="n">PKPDUnit</span><span class="p">,</span> <span class="n">convertUnits</span><span class="p">,</span> <span class="n">changeRateTo</span><span class="p">,</span> <span class="n">changeRateToWeight</span>
<span class="kn">import</span> <span class="nn">pyworkflow</span> <span class="k">as</span> <span class="nn">pw</span>
<span class="kn">import</span> <span class="nn">pyworkflow.utils</span> <span class="k">as</span> <span class="nn">pwutils</span>
<span class="kn">from</span> <span class="nn">pwem.objects</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="p">(</span><span class="n">writeMD5</span><span class="p">,</span> <span class="n">verifyMD5</span><span class="p">,</span> <span class="n">excelWriteRow</span><span class="p">,</span> <span class="n">excelFillCells</span><span class="p">,</span>
                    <span class="n">excelAdjustColumnWidths</span><span class="p">,</span> <span class="n">computeXYmean</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.biopharmaceutics</span> <span class="k">import</span> <span class="p">(</span><span class="n">PKPDDose</span><span class="p">,</span> <span class="n">PKPDVia</span><span class="p">,</span> <span class="n">DrugSource</span><span class="p">,</span> <span class="n">createDeltaDose</span><span class="p">,</span>
                               <span class="n">createVia</span><span class="p">)</span>


<div class="viewcode-block" id="PKPDVariable"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDVariable">[docs]</a><span class="k">class</span> <span class="nc">PKPDVariable</span><span class="p">:</span>
    <span class="n">TYPE_NUMERIC</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">TYPE_TEXT</span> <span class="o">=</span> <span class="mi">1001</span>
    <span class="n">TYPE_NAMES</span> <span class="o">=</span> <span class="p">{</span><span class="n">TYPE_NUMERIC</span><span class="p">:</span> <span class="s1">&#39;numeric&#39;</span><span class="p">,</span>
                  <span class="n">TYPE_TEXT</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">}</span>

    <span class="n">ROLE_TIME</span> <span class="o">=</span> <span class="mi">1010</span>
    <span class="n">ROLE_MEASUREMENT</span> <span class="o">=</span> <span class="mi">1011</span>
    <span class="n">ROLE_LABEL</span> <span class="o">=</span> <span class="mi">1012</span>
    <span class="n">ROLE_NAMES</span> <span class="o">=</span> <span class="p">{</span><span class="n">ROLE_TIME</span><span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span>
                  <span class="n">ROLE_MEASUREMENT</span><span class="p">:</span> <span class="s1">&#39;measurement&#39;</span><span class="p">,</span>
                  <span class="n">ROLE_LABEL</span><span class="p">:</span> <span class="s1">&#39;label&#39;</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varName</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varType</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displayString</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="PKPDVariable.parseTokens"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDVariable.parseTokens">[docs]</a>    <span class="k">def</span> <span class="nf">parseTokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">):</span>
        <span class="c1"># t ; h ; numeric[%f] ; time ;</span>

        <span class="n">strippedTokens</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="n">strippedTokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="n">tokens</span><span class="o">=</span><span class="n">strippedTokens</span>

        <span class="c1"># Get name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varName</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># Get units</span>
        <span class="n">unitString</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">PKPDUnit</span><span class="p">(</span><span class="n">unitString</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">unit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unrecognized unit: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">unitString</span><span class="p">)</span>

        <span class="c1"># Get type and display</span>
        <span class="n">typeString</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displayString</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">leftBracket</span><span class="o">=</span><span class="n">typeString</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>
        <span class="n">rightBracket</span><span class="o">=</span><span class="n">typeString</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">leftBracket</span><span class="o">!=-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">rightBracket</span><span class="o">!=-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">displayString</span> <span class="o">=</span> <span class="n">typeString</span><span class="p">[</span><span class="n">leftBracket</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">rightBracket</span><span class="p">]</span>
            <span class="n">typeString</span> <span class="o">=</span> <span class="n">typeString</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">leftBracket</span><span class="p">]</span>
        <span class="n">typeString</span> <span class="o">=</span> <span class="n">typeString</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">typeString</span><span class="o">==</span><span class="s2">&quot;numeric&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">varType</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">TYPE_NUMERIC</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">displayString</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">displayString</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">typeString</span><span class="o">==</span><span class="s2">&quot;text&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">varType</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">TYPE_TEXT</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">displayString</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">displayString</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unrecognized type: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">typeString</span><span class="p">)</span>

        <span class="c1"># Get role</span>
        <span class="n">roleString</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">roleString</span><span class="o">==</span><span class="s2">&quot;time&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">ROLE_TIME</span>
        <span class="k">elif</span> <span class="n">roleString</span><span class="o">==</span><span class="s2">&quot;measurement&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">ROLE_MEASUREMENT</span>
        <span class="k">elif</span> <span class="n">roleString</span><span class="o">==</span><span class="s2">&quot;label&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">ROLE_LABEL</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unrecognized role: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">roleString</span><span class="p">)</span>

        <span class="c1"># Get comment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_printToStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fh</span><span class="p">):</span>
        <span class="n">displayString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">displayString</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%%</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%%%%</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">displayString</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">varType</span> <span class="o">==</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">TYPE_NUMERIC</span><span class="p">:</span>
                <span class="n">displayString</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">varType</span> <span class="o">==</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">TYPE_TEXT</span><span class="p">:</span>
                <span class="n">displayString</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> ; </span><span class="si">%s</span><span class="s2"> ; </span><span class="si">%s</span><span class="s2">[</span><span class="si">%s</span><span class="s2">] ; </span><span class="si">%s</span><span class="s2"> ; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varName</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">getUnitsString</span><span class="p">(),</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">getTypeString</span><span class="p">(),</span>
                                                   <span class="n">displayString</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">getRoleString</span><span class="p">(),</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_printToExcel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">displayString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">displayString</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%%</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%%%%</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">displayString</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">varType</span> <span class="o">==</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">TYPE_NUMERIC</span><span class="p">:</span>
                <span class="n">displayString</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">varType</span> <span class="o">==</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">TYPE_TEXT</span><span class="p">:</span>
                <span class="n">displayString</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span>
        <span class="n">excelWriteRow</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">varName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUnitsString</span><span class="p">(),</span>
                       <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">[</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTypeString</span><span class="p">(),</span><span class="n">displayString</span><span class="p">),</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">getRoleString</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">],</span> <span class="n">wb</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">row</span><span class="o">+</span><span class="mi">1</span>

<div class="viewcode-block" id="PKPDVariable.getTypeString"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDVariable.getTypeString">[docs]</a>    <span class="k">def</span> <span class="nf">getTypeString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_NAMES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varType</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDVariable.getRoleString"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDVariable.getRoleString">[docs]</a>    <span class="k">def</span> <span class="nf">getRoleString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROLE_NAMES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDVariable.getUnitsString"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDVariable.getUnitsString">[docs]</a>    <span class="k">def</span> <span class="nf">getUnitsString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">_toString</span><span class="p">()</span></div>

<div class="viewcode-block" id="PKPDVariable.isNumeric"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDVariable.isNumeric">[docs]</a>    <span class="k">def</span> <span class="nf">isNumeric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">varType</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_NUMERIC</span></div>

<div class="viewcode-block" id="PKPDVariable.isLabel"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDVariable.isLabel">[docs]</a>    <span class="k">def</span> <span class="nf">isLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROLE_LABEL</span></div>

<div class="viewcode-block" id="PKPDVariable.isMeasurement"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDVariable.isMeasurement">[docs]</a>    <span class="k">def</span> <span class="nf">isMeasurement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROLE_MEASUREMENT</span></div>

<div class="viewcode-block" id="PKPDVariable.isTime"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDVariable.isTime">[docs]</a>    <span class="k">def</span> <span class="nf">isTime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROLE_TIME</span></div>

<div class="viewcode-block" id="PKPDVariable.getLabel"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDVariable.getLabel">[docs]</a>    <span class="k">def</span> <span class="nf">getLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUnitsString</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="PKPDSample"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample">[docs]</a><span class="k">class</span> <span class="nc">PKPDSample</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variableDictPtr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doseDictPtr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doseList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="PKPDSample.parseTokens"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.parseTokens">[docs]</a>    <span class="k">def</span> <span class="nf">parseTokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tokens</span><span class="p">,</span><span class="n">variableDict</span><span class="p">,</span><span class="n">doseDict</span><span class="p">,</span><span class="n">groupDict</span><span class="p">):</span>
        <span class="c1"># FemaleRat1; dose=Dose1[,Dose2]; weight=207; [group=Group1,Group2]</span>

        <span class="c1"># Keep a pointer to variableDict and doseDict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variableDictPtr</span> <span class="o">=</span> <span class="n">variableDict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doseDictPtr</span> <span class="o">=</span> <span class="n">doseDict</span>

        <span class="c1"># Get name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Get rest of variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)):</span>
                <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
                    <span class="n">varTokens</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                    <span class="n">varName</span>  <span class="o">=</span> <span class="n">varTokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">varValue</span> <span class="o">=</span> <span class="n">varTokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">varName</span><span class="o">==</span><span class="s2">&quot;dose&quot;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">doseName</span> <span class="ow">in</span> <span class="n">varValue</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                            <span class="n">doseName</span><span class="o">=</span><span class="n">doseName</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">doseName</span> <span class="ow">in</span> <span class="n">doseDict</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">doseList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doseName</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unrecognized dose </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">doseName</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">varName</span><span class="o">==</span><span class="s2">&quot;group&quot;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">groupName</span> <span class="ow">in</span> <span class="n">varValue</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                            <span class="n">groupName</span><span class="o">=</span><span class="n">groupName</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">groupName</span> <span class="ow">in</span> <span class="n">groupDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">groupList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">groupName</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unrecognized group </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">groupName</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">varName</span> <span class="ow">in</span> <span class="n">variableDict</span><span class="p">:</span>
                            <span class="n">varPtr</span> <span class="o">=</span> <span class="n">variableDict</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">varPtr</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">ROLE_LABEL</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Samples can only use role variables&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span> <span class="o">=</span> <span class="n">varValue</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="PKPDSample.getSampleName"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.getSampleName">[docs]</a>    <span class="k">def</span> <span class="nf">getSampleName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span></div>

<div class="viewcode-block" id="PKPDSample.getTimeVariable"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.getTimeVariable">[docs]</a>    <span class="k">def</span> <span class="nf">getTimeVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">varName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variableDictPtr</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variableDictPtr</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">.</span><span class="n">isTime</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">varName</span></div>

<div class="viewcode-block" id="PKPDSample.getTimeUnits"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.getTimeUnits">[docs]</a>    <span class="k">def</span> <span class="nf">getTimeUnits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">timeName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTimeVariable</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variableDictPtr</span><span class="p">[</span><span class="n">timeName</span><span class="p">]</span><span class="o">.</span><span class="n">units</span></div>


<div class="viewcode-block" id="PKPDSample.interpretDose"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.interpretDose">[docs]</a>    <span class="k">def</span> <span class="nf">interpretDose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parsedDoseList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">firstUnit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">doseName</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doseList</span><span class="p">):</span>
            <span class="n">dose</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doseDictPtr</span><span class="p">[</span><span class="n">doseName</span><span class="p">])</span>
            <span class="n">dose</span><span class="o">.</span><span class="n">doseAmount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluateExpression</span><span class="p">(</span><span class="n">dose</span><span class="o">.</span><span class="n">doseAmount</span><span class="p">)</span>
            <span class="n">dose</span><span class="o">.</span><span class="n">changeTimeUnitsTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeUnits</span><span class="p">()</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="n">dose</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">dose</span><span class="o">.</span><span class="n">doseType</span> <span class="o">==</span> <span class="n">PKPDDose</span><span class="o">.</span><span class="n">TYPE_INFUSION</span><span class="p">:</span>
                <span class="n">dose</span><span class="o">.</span><span class="n">doseAmount</span><span class="p">,</span> <span class="n">dose</span><span class="o">.</span><span class="n">dunits</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">changeRateTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTimeUnits</span><span class="p">()</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">dose</span><span class="o">.</span><span class="n">doseAmount</span><span class="p">,</span> <span class="n">dose</span><span class="o">.</span><span class="n">dunits</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">firstUnit</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">firstUnit</span> <span class="o">=</span> <span class="n">dose</span><span class="o">.</span><span class="n">dunits</span><span class="o">.</span><span class="n">unit</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dose</span><span class="o">.</span><span class="n">doseAmount</span> <span class="o">=</span> <span class="n">convertUnits</span><span class="p">(</span><span class="n">dose</span><span class="o">.</span><span class="n">doseAmount</span><span class="p">,</span> <span class="n">dose</span><span class="o">.</span><span class="n">dunits</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">firstUnit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parsedDoseList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dose</span><span class="p">)</span></div>
        <span class="c1"># if len(self.parsedDoseList)==0:</span>
        <span class="c1">#     raise Exception(&quot;Cannot find any useful dose&quot;)</span>

<div class="viewcode-block" id="PKPDSample.isDoseABolus"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.isDoseABolus">[docs]</a>    <span class="k">def</span> <span class="nf">isDoseABolus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parsedDoseList</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsedDoseList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isDoseABolus</span><span class="p">()</span></div>

<div class="viewcode-block" id="PKPDSample.getDoseAt"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.getDoseAt">[docs]</a>    <span class="k">def</span> <span class="nf">getDoseAt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t0</span><span class="p">,</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="n">doseAmount</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">dose</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsedDoseList</span><span class="p">:</span>
            <span class="n">doseAmount</span> <span class="o">+=</span> <span class="n">dose</span><span class="o">.</span><span class="n">getDoseAt</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">doseAmount</span></div>

<div class="viewcode-block" id="PKPDSample.getCumulatedDose"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.getCumulatedDose">[docs]</a>    <span class="k">def</span> <span class="nf">getCumulatedDose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t0</span><span class="p">,</span><span class="n">tF</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDoseAt</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">tF</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDSample.getDoseUnits"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.getDoseUnits">[docs]</a>    <span class="k">def</span> <span class="nf">getDoseUnits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parsedDoseList</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsedDoseList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">doseType</span><span class="o">==</span><span class="n">PKPDDose</span><span class="o">.</span><span class="n">TYPE_INFUSION</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">changeRateToWeight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parsedDoseList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dunits</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsedDoseList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dunits</span><span class="o">.</span><span class="n">unit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PKPDUnit</span><span class="o">.</span><span class="n">UNIT_NONE</span></div>

<div class="viewcode-block" id="PKPDSample.addMeasurementPattern"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.addMeasurementPattern">[docs]</a>    <span class="k">def</span> <span class="nf">addMeasurementPattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tokens</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)):</span>
            <span class="n">varName</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">varName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variableDictPtr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varName</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;measurement_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">varName</span><span class="p">,[])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unrecognized variable </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">varName</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDSample.addMeasurement"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.addMeasurement">[docs]</a>    <span class="k">def</span> <span class="nf">addMeasurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">line</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not enough values to fill measurement pattern&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)):</span>
            <span class="n">ok</span><span class="o">=</span><span class="kc">True</span>
            <span class="n">varName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">tokens</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;NA&quot;</span> <span class="ow">or</span> <span class="n">tokens</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;ULOQ&quot;</span> <span class="ow">or</span> <span class="n">tokens</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;LLOQ&quot;</span> <span class="ow">or</span> <span class="s2">&quot;LLOQ&quot;</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
                <span class="n">ok</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variableDictPtr</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">ROLE_TIME</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                <span class="n">exec</span><span class="p">(</span><span class="s2">&quot;self.measurement_</span><span class="si">%s</span><span class="s2">.append(&#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span><span class="n">tokens</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Time measurements cannot be NA&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDSample.addMeasurementColumn"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.addMeasurementColumn">[docs]</a>    <span class="k">def</span> <span class="nf">addMeasurementColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">varName</span><span class="p">,</span><span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">varName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varName</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;measurement_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">varName</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="n">exec</span><span class="p">(</span><span class="s2">&quot;self.measurement_</span><span class="si">%s</span><span class="s2">.append(&#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
                <span class="n">exec</span><span class="p">(</span><span class="s2">&quot;self.measurement_</span><span class="si">%s</span><span class="s2">.append(&#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]))))</span></div>

<div class="viewcode-block" id="PKPDSample.getNumberOfVariables"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.getNumberOfVariables">[docs]</a>    <span class="k">def</span> <span class="nf">getNumberOfVariables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDSample.getNumberOfMeasurements"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.getNumberOfMeasurements">[docs]</a>    <span class="k">def</span> <span class="nf">getNumberOfMeasurements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;measurement_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

    <span class="k">def</span> <span class="nf">_printToStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fh</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doseList</span><span class="p">:</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;; dose=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doseList</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupList</span><span class="p">:</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;; group=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupList</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">:</span>
            <span class="n">descriptorString</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">descriptorString</span> <span class="o">+=</span><span class="s2">&quot;; </span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">descriptorString</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_printToExcel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">toPrint</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doseList</span><span class="p">:</span>
            <span class="n">toPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;dose=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doseList</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupList</span><span class="p">:</span>
            <span class="n">toPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;group=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupList</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">toPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
        <span class="n">excelWriteRow</span><span class="p">(</span><span class="n">toPrint</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">row</span><span class="o">+</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_printMeasurements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fh</span><span class="p">):</span>
        <span class="n">patternString</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">)):</span>
            <span class="n">patternString</span> <span class="o">+=</span> <span class="s2">&quot;; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span><span class="p">,</span><span class="n">patternString</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">aux</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;measurement_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">getNumberOfMeasurements</span><span class="p">()):</span>
                <span class="n">lineString</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">)):</span>
                    <span class="n">aux</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;measurement_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                    <span class="n">lineString</span> <span class="o">+=</span> <span class="n">aux</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; &quot;</span>
                <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">lineString</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_printMeasurementsToExcel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">row</span><span class="p">):</span>
        <span class="n">toPrint</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">)):</span>
            <span class="n">toPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="n">excelWriteRow</span><span class="p">(</span><span class="n">toPrint</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">row</span><span class="p">);</span> <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">aux</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;measurement_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">getNumberOfMeasurements</span><span class="p">()):</span>
                <span class="n">toPrint</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">)):</span>
                    <span class="n">aux</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;measurement_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">toPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                            <span class="n">toPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">toPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">excelWriteRow</span><span class="p">(</span><span class="n">toPrint</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">row</span><span class="p">);</span> <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">row</span><span class="o">+</span><span class="mi">1</span>

<div class="viewcode-block" id="PKPDSample.getRange"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.getRange">[docs]</a>    <span class="k">def</span> <span class="nf">getRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varName</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">varName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aux</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;measurement_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">varName</span><span class="p">)</span>
            <span class="n">aux</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">aux</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">&quot;LLOQ&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="o">!=</span><span class="s2">&quot;ULOQ&quot;</span> <span class="ow">and</span> <span class="n">x</span><span class="o">!=</span><span class="s2">&quot;None&quot;</span> <span class="ow">and</span> <span class="n">x</span><span class="o">!=</span><span class="s2">&quot;MS&quot;</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span></div>

<div class="viewcode-block" id="PKPDSample.getValues"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.getValues">[docs]</a>    <span class="k">def</span> <span class="nf">getValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varName</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">varName</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
            <span class="n">retval</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">vName</span> <span class="ow">in</span> <span class="n">varName</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">vName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">:</span>
                    <span class="n">retval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">retval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;measurement_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">vName</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">retval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">varName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;measurement_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">varName</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDSample.setValues"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.setValues">[docs]</a>    <span class="k">def</span> <span class="nf">setValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varName</span><span class="p">,</span> <span class="n">varValues</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;measurement_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">varName</span><span class="p">,</span><span class="n">varValues</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDSample.getXYValues"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.getXYValues">[docs]</a>    <span class="k">def</span> <span class="nf">getXYValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">varNameX</span><span class="p">,</span><span class="n">varNameY</span><span class="p">):</span>
        <span class="n">xl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getValues</span><span class="p">(</span><span class="n">varNameX</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">varNameY</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getValues</span><span class="p">(</span><span class="n">varNameY</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ysi</span> <span class="ow">in</span> <span class="n">ys</span><span class="p">:</span>
                <span class="n">xPartial</span> <span class="o">=</span><span class="p">[]</span>
                <span class="n">yPartial</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ysi</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="s2">&quot;LLOQ&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">y</span><span class="o">!=</span><span class="s2">&quot;ULOQ&quot;</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;LLOQ&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">y</span><span class="p">)</span> <span class="ow">and</span> <span class="n">y</span><span class="o">!=</span><span class="s2">&quot;ULOQ&quot;</span><span class="p">:</span>
                        <span class="n">xPartial</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                        <span class="n">yPartial</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
                <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xPartial</span><span class="p">))</span>
                <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yPartial</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getValues</span><span class="p">(</span><span class="n">varNameY</span><span class="p">)</span>
            <span class="n">xPartial</span> <span class="o">=</span><span class="p">[]</span>
            <span class="n">yPartial</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">and</span> <span class="n">x</span><span class="o">!=</span><span class="s2">&quot;LLOQ&quot;</span> <span class="ow">and</span> <span class="n">y</span><span class="o">!=</span><span class="s2">&quot;ULOQ&quot;</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">!=</span> <span class="s2">&quot;NA&quot;</span> <span class="ow">and</span> <span class="n">y</span><span class="o">!=</span> <span class="s2">&quot;LLOQ&quot;</span> <span class="ow">and</span> <span class="n">y</span><span class="o">!=</span><span class="s2">&quot;ULOQ&quot;</span> <span class="ow">and</span> \
                   <span class="n">x</span><span class="o">!=</span> <span class="s2">&quot;None&quot;</span> <span class="ow">and</span> <span class="n">x</span><span class="o">!=</span><span class="s2">&quot;MS&quot;</span> <span class="ow">and</span> <span class="n">y</span><span class="o">!=</span><span class="s2">&quot;None&quot;</span> <span class="ow">and</span> <span class="n">x</span><span class="o">!=</span><span class="s2">&quot;NS&quot;</span> <span class="ow">and</span> <span class="n">y</span><span class="o">!=</span><span class="s2">&quot;NS&quot;</span> <span class="ow">and</span> \
                   <span class="p">(</span><span class="ow">not</span> <span class="s2">&quot;LLOQ&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="s2">&quot;LLOQ&quot;</span> <span class="ow">in</span> <span class="n">y</span><span class="p">)</span> <span class="ow">and</span> <span class="n">y</span><span class="o">!=</span><span class="s2">&quot;MS&quot;</span> <span class="ow">and</span> <span class="n">y</span><span class="o">!=</span><span class="s2">&quot;NRE&quot;</span> <span class="ow">and</span> <span class="n">y</span><span class="o">!=</span><span class="s2">&quot;NR&quot;</span><span class="p">:</span>
                    <span class="n">xPartial</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                    <span class="k">if</span> <span class="s2">&quot;[&quot;</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">yPartial</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xPartial</span><span class="p">))</span>
            <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yPartial</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span></div>

<div class="viewcode-block" id="PKPDSample.getSampleMeasurements"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.getSampleMeasurements">[docs]</a>    <span class="k">def</span> <span class="nf">getSampleMeasurements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">PKPDSampleMeasurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">getNumberOfMeasurements</span><span class="p">())]</span></div>

<div class="viewcode-block" id="PKPDSample.substituteValuesInExpression"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.substituteValuesInExpression">[docs]</a>    <span class="k">def</span> <span class="nf">substituteValuesInExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">expressionPython</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variableDictPtr</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">value</span><span class="o">==</span><span class="s2">&quot;NA&quot;</span> <span class="ow">or</span> <span class="n">value</span><span class="o">==</span><span class="s2">&quot;LLOQ&quot;</span> <span class="ow">or</span> <span class="n">value</span><span class="o">==</span><span class="s2">&quot;ULOQ&quot;</span><span class="p">:</span>
                        <span class="n">expressionPython</span><span class="o">=</span><span class="s2">&quot;None&quot;</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">varType</span> <span class="o">==</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">TYPE_NUMERIC</span><span class="p">:</span>
                            <span class="n">expressionPython</span> <span class="o">=</span> <span class="n">expressionPython</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;$</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="n">key</span><span class="p">),</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">expressionPython</span> <span class="o">=</span> <span class="n">expressionPython</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;$</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span><span class="n">key</span><span class="p">),</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">expressionPython</span></div>

<div class="viewcode-block" id="PKPDSample.evaluateExpression"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.evaluateExpression">[docs]</a>    <span class="k">def</span> <span class="nf">evaluateExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">expressionPython</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">substituteValuesInExpression</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">expressionPython</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;__builtins__&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;True&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span> <span class="p">},</span> <span class="p">{})</span></div>

<div class="viewcode-block" id="PKPDSample.evaluateParsedExpression"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.evaluateParsedExpression">[docs]</a>    <span class="k">def</span> <span class="nf">evaluateParsedExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parsedOperation</span><span class="p">,</span> <span class="n">varList</span><span class="p">):</span>
        <span class="n">ldict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">varName</span> <span class="ow">in</span> <span class="n">varList</span><span class="p">:</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variableDictPtr</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">isLabel</span><span class="p">():</span>
                <span class="n">exec</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=self.getDescriptorValue(&#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">varName</span><span class="p">),</span> <span class="nb">locals</span><span class="p">(),</span> <span class="n">ldict</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">isNumeric</span><span class="p">():</span>
                    <span class="n">exec</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=float(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">varName</span><span class="p">),</span> <span class="nb">locals</span><span class="p">(),</span> <span class="n">ldict</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Measurement or time</span>
                <span class="n">exec</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=np.asarray(self.getValues(&#39;</span><span class="si">%s</span><span class="s2">&#39;),dtype=np.float)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">varName</span><span class="p">),</span>
                      <span class="nb">dict</span><span class="p">(</span><span class="nb">locals</span><span class="p">(),</span> <span class="o">**</span><span class="nb">globals</span><span class="p">()),</span> <span class="n">ldict</span><span class="p">)</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">exec</span> <span class="p">(</span><span class="s2">&quot;aux=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">parsedOperation</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">locals</span><span class="p">(),</span> <span class="o">**</span><span class="nb">globals</span><span class="p">()),</span> <span class="n">ldict</span><span class="p">)</span>
        <span class="n">aux</span><span class="o">=</span><span class="n">ldict</span><span class="p">[</span><span class="s1">&#39;aux&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">aux</span></div>

<div class="viewcode-block" id="PKPDSample.getVariableValues"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.getVariableValues">[docs]</a>    <span class="k">def</span> <span class="nf">getVariableValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varList</span><span class="p">):</span>
        <span class="n">varDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">varName</span> <span class="ow">in</span> <span class="n">varList</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variableDictPtr</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">isLabel</span><span class="p">():</span>
                <span class="n">varDict</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">var</span><span class="o">.</span><span class="n">isMeasurement</span><span class="p">():</span>
                <span class="n">varDict</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;measurement_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">varName</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">varDict</span></div>

<div class="viewcode-block" id="PKPDSample.getDescriptorValue"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.getDescriptorValue">[docs]</a>    <span class="k">def</span> <span class="nf">getDescriptorValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">descriptorName</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">descriptorName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">descriptorName</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="PKPDSample.setDescriptorValue"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSample.setDescriptorValue">[docs]</a>    <span class="k">def</span> <span class="nf">setDescriptorValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">descriptorName</span><span class="p">,</span> <span class="n">descriptorValue</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">descriptorName</span><span class="p">]</span> <span class="o">=</span> <span class="n">descriptorValue</span></div></div>


<div class="viewcode-block" id="PKPDSampleMeasurement"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleMeasurement">[docs]</a><span class="k">class</span> <span class="nc">PKPDSampleMeasurement</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>

<div class="viewcode-block" id="PKPDSampleMeasurement.getValues"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleMeasurement.getValues">[docs]</a>    <span class="k">def</span> <span class="nf">getValues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">getNumberOfVariables</span><span class="p">()):</span>
            <span class="n">aux</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">,</span><span class="s2">&quot;measurement_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">measurementPattern</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">values</span></div></div>


<div class="viewcode-block" id="PKPDGroup"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDGroup">[docs]</a><span class="k">class</span> <span class="nc">PKPDGroup</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupName</span> <span class="o">=</span> <span class="n">groupName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampleList</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="PKPDGroup.getSamplesString"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDGroup.getSamplesString">[docs]</a>    <span class="k">def</span> <span class="nf">getSamplesString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampleList</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PKPDExperiment"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment">[docs]</a><span class="k">class</span> <span class="nc">PKPDExperiment</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="n">READING_GENERAL</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">READING_VARIABLES</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">READING_VIAS</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">READING_DOSES</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">READING_GROUPS</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">READING_SAMPLES</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">READING_MEASUREMENTS</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">READING_A_MEASUREMENT</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnPKPD</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infoStr</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">general</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doses</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vias</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">infoStr</span><span class="o">.</span><span class="n">hasValue</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fullRead</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">infoStr</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;variables: </span><span class="si">%d</span><span class="s2">, samples: </span><span class="si">%d</span><span class="s2">&quot;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">infoStr</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

<div class="viewcode-block" id="PKPDExperiment.load"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnExperiment</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">verifyIntegrity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fullRead</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fnExperiment</span><span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fnPKPD</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">fnExperiment</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verifyIntegrity</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">verifyMD5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnPKPD</span><span class="o">.</span><span class="n">get</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> has been modified since its creation&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">fnPKPD</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnPKPD</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnPKPD</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fh</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot open the file &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">fnPKPD</span><span class="p">)</span>

        <span class="n">state</span><span class="o">=</span><span class="kc">None</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_A_MEASUREMENT</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_MEASUREMENTS</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;[&#39;</span><span class="p">:</span>
                <span class="n">section</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[experiment]&quot;</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_GENERAL</span>
                <span class="k">elif</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[variables]&quot;</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_VARIABLES</span>
                <span class="k">elif</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[vias]&quot;</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_VIAS</span>
                <span class="k">elif</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[doses]&quot;</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_DOSES</span>
                <span class="k">elif</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[groups]&quot;</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_GROUPS</span>
                <span class="k">elif</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[samples]&quot;</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_SAMPLES</span>
                <span class="k">elif</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[measurements]&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fullRead</span><span class="p">:</span>
                        <span class="n">state</span><span class="o">=</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_MEASUREMENTS</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping: &quot;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_GENERAL</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">lhs</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">rhs</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">general</span><span class="p">[</span><span class="n">lhs</span><span class="p">]</span><span class="o">=</span><span class="n">rhs</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_VARIABLES</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span><span class="o">!=</span><span class="mi">5</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping variable: &quot;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">varname</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">parseTokens</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_VIAS</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping via: &quot;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="n">vianame</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vias</span><span class="p">[</span><span class="n">vianame</span><span class="p">]</span> <span class="o">=</span> <span class="n">PKPDVia</span><span class="p">(</span><span class="n">ptrExperiment</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vias</span><span class="p">[</span><span class="n">vianame</span><span class="p">]</span><span class="o">.</span><span class="n">parseTokens</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_DOSES</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span><span class="o">!=</span><span class="mi">5</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping dose: &quot;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="n">dosename</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="p">[</span><span class="n">dosename</span><span class="p">]</span> <span class="o">=</span> <span class="n">PKPDDose</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="p">[</span><span class="n">dosename</span><span class="p">]</span><span class="o">.</span><span class="n">parseTokens</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">vias</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_GROUPS</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">groupName</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">groupName</span><span class="p">]</span> <span class="o">=</span> <span class="n">PKPDGroup</span><span class="p">(</span><span class="n">groupName</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_SAMPLES</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                    <span class="n">samplename</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">newSample</span> <span class="o">=</span> <span class="n">PKPDSample</span><span class="p">()</span>
                    <span class="n">newSample</span><span class="o">.</span><span class="n">parseTokens</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">newSample</span><span class="o">.</span><span class="n">groupList</span><span class="p">:</span> <span class="c1"># If there is no group, create one for this sample</span>
                        <span class="n">groupName</span> <span class="o">=</span> <span class="s2">&quot;__&quot;</span><span class="o">+</span><span class="n">newSample</span><span class="o">.</span><span class="n">sampleName</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">groupName</span><span class="p">]</span><span class="o">=</span><span class="n">PKPDGroup</span><span class="p">(</span><span class="n">groupName</span><span class="p">)</span>
                        <span class="n">newSample</span><span class="o">.</span><span class="n">groupList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">groupName</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">groupName</span> <span class="ow">in</span> <span class="n">newSample</span><span class="o">.</span><span class="n">groupList</span><span class="p">:</span> <span class="c1"># A sample may belong to several groups</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">groupName</span><span class="p">]</span><span class="o">.</span><span class="n">sampleList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newSample</span><span class="o">.</span><span class="n">sampleName</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">samplename</span><span class="p">]</span> <span class="o">=</span> <span class="n">newSample</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_MEASUREMENTS</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping measurement: &quot;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">samplename</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">samplename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">samplename</span><span class="p">]</span><span class="o">.</span><span class="n">addMeasurementPattern</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_A_MEASUREMENT</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping measurement: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDExperiment</span><span class="o">.</span><span class="n">READING_A_MEASUREMENT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">samplename</span><span class="p">]</span><span class="o">.</span><span class="n">addMeasurement</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="PKPDExperiment.write"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnExperiment</span><span class="p">,</span> <span class="n">writeToExcel</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fnExperiment</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnPKPD</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">fnExperiment</span><span class="p">)</span>
        <span class="n">writeMD5</span><span class="p">(</span><span class="n">fnExperiment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infoStr</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;variables: </span><span class="si">%d</span><span class="s2">, samples: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">writeToExcel</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writeToExcel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fnExperiment</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.xlsx&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_printToStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fh</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[EXPERIMENT] ===========================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[VARIABLES] ============================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[VIAS] ================================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vias</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vias</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[DOSES] ================================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[GROUPS] ================================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">groupName</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">groupName</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[SAMPLES] ================================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[MEASUREMENTS] ===========================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">_printMeasurements</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="PKPDExperiment.writeToExcel"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.writeToExcel">[docs]</a>    <span class="k">def</span> <span class="nf">writeToExcel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnXls</span><span class="p">):</span>
        <span class="n">wb</span> <span class="o">=</span> <span class="n">openpyxl</span><span class="o">.</span><span class="n">Workbook</span><span class="p">()</span>
        <span class="n">wb</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Experiment&quot;</span>

        <span class="n">currentRow</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">excelWriteRow</span><span class="p">(</span><span class="s2">&quot;EXPERIMENT&quot;</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">,</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">excelFillCells</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">excelWriteRow</span><span class="p">([</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">],</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>

        <span class="n">excelWriteRow</span><span class="p">(</span><span class="s2">&quot;VARIABLES&quot;</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">,</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">excelFillCells</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">currentRow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">_printToExcel</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">)</span>
        <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>

        <span class="n">excelWriteRow</span><span class="p">(</span><span class="s2">&quot;VIAS&quot;</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">,</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">excelFillCells</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vias</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">currentRow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vias</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">_printToExcel</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">)</span>
        <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>

        <span class="n">excelWriteRow</span><span class="p">(</span><span class="s2">&quot;DOSES&quot;</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">,</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">excelFillCells</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">currentRow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">_printToExcel</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">)</span>
        <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>

        <span class="n">excelWriteRow</span><span class="p">(</span><span class="s2">&quot;GROUPS&quot;</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">,</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">excelFillCells</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">groupName</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">excelWriteRow</span><span class="p">(</span><span class="n">groupName</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span> <span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>

        <span class="n">excelWriteRow</span><span class="p">(</span><span class="s2">&quot;SAMPLES&quot;</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">,</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">excelFillCells</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">currentRow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">_printToExcel</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">)</span>
        <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>

        <span class="n">excelWriteRow</span><span class="p">(</span><span class="s2">&quot;MEASUREMENTS&quot;</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">,</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">excelFillCells</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">currentRow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">_printMeasurementsToExcel</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">)</span>
        <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>

        <span class="n">excelAdjustColumnWidths</span><span class="p">(</span><span class="n">wb</span><span class="p">)</span>
        <span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fnXls</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDExperiment.getRange"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.getRange">[docs]</a>    <span class="k">def</span> <span class="nf">getRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">varName</span><span class="p">):</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">vmini</span><span class="p">,</span> <span class="n">vmaxi</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">getRange</span><span class="p">(</span><span class="n">varName</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vmin</span><span class="o">==</span><span class="kc">None</span> <span class="ow">or</span> <span class="n">vmini</span><span class="o">&lt;</span><span class="n">vmin</span><span class="p">:</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmini</span>
            <span class="k">if</span> <span class="n">vmax</span><span class="o">==</span><span class="kc">None</span> <span class="ow">or</span> <span class="n">vmaxi</span><span class="o">&gt;</span><span class="n">vmax</span><span class="p">:</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmaxi</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">]</span></div>

<div class="viewcode-block" id="PKPDExperiment.sampleSummary"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.sampleSummary">[docs]</a>    <span class="k">def</span> <span class="nf">sampleSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">summary</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">varName</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">ROLE_LABEL</span><span class="p">:</span>
                <span class="n">toAdd</span> <span class="o">=</span> <span class="n">varName</span><span class="o">+</span><span class="s2">&quot;: &quot;</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">varType</span><span class="o">==</span><span class="n">PKPDVariable</span><span class="o">.</span><span class="n">TYPE_NUMERIC</span><span class="p">:</span>
                    <span class="n">listOfValues</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">listOfValues</span><span class="o">=</span><span class="p">{}</span>
                <span class="k">for</span> <span class="n">sampleName</span><span class="p">,</span> <span class="n">sample</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">varType</span><span class="o">==</span><span class="n">PKPDVariable</span><span class="o">.</span><span class="n">TYPE_NUMERIC</span><span class="p">:</span>
                        <span class="n">listOfValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">listOfValues</span><span class="p">:</span>
                            <span class="n">listOfValues</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">listOfValues</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">varType</span><span class="o">==</span><span class="n">PKPDVariable</span><span class="o">.</span><span class="n">TYPE_NUMERIC</span><span class="p">:</span>
                    <span class="n">listOfValuesNp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">listOfValues</span><span class="p">)</span>
                    <span class="n">toAdd</span> <span class="o">+=</span> <span class="s2">&quot; mean=</span><span class="si">%f</span><span class="s2"> std=</span><span class="si">%f</span><span class="s2"> 5</span><span class="si">%%</span><span class="s2">=</span><span class="si">%f</span><span class="s2"> 25</span><span class="si">%%</span><span class="s2">=</span><span class="si">%f</span><span class="s2"> 50</span><span class="si">%%</span><span class="s2">=</span><span class="si">%f</span><span class="s2"> 75</span><span class="si">%%</span><span class="s2">=</span><span class="si">%f</span><span class="s2"> 95</span><span class="si">%%</span><span class="s2">=</span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span>\
                             <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">listOfValuesNp</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">listOfValuesNp</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">listOfValuesNp</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>\
                              <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">listOfValuesNp</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">listOfValuesNp</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span>\
                              <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">listOfValuesNp</span><span class="p">,</span><span class="mi">75</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">listOfValuesNp</span><span class="p">,</span><span class="mi">95</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">listOfValues</span><span class="p">:</span>
                        <span class="n">toAdd</span> <span class="o">+=</span> <span class="n">value</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">listOfValues</span><span class="p">[</span><span class="n">value</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;) &quot;</span>
                <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toAdd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">summary</span></div>

<div class="viewcode-block" id="PKPDExperiment.getXYMeanValues"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.getXYMeanValues">[docs]</a>    <span class="k">def</span> <span class="nf">getXYMeanValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">varNameX</span><span class="p">,</span><span class="n">varNameY</span><span class="p">):</span>
        <span class="n">XYlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sampleName</span><span class="p">,</span> <span class="n">sample</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">xValues</span><span class="p">,</span> <span class="n">yValues</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">getXYValues</span><span class="p">(</span><span class="n">varNameX</span><span class="p">,</span><span class="n">varNameY</span><span class="p">)</span>
            <span class="n">XYlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">xValues</span><span class="p">,</span><span class="n">yValues</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">computeXYmean</span><span class="p">(</span><span class="n">XYlist</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDExperiment.getVarUnits"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.getVarUnits">[docs]</a>    <span class="k">def</span> <span class="nf">getVarUnits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">varName</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">varName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">unit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PKPDUnit</span><span class="o">.</span><span class="n">UNIT_NONE</span></div>

<div class="viewcode-block" id="PKPDExperiment.getDoseUnits"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.getDoseUnits">[docs]</a>    <span class="k">def</span> <span class="nf">getDoseUnits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PKPDUnit</span><span class="o">.</span><span class="n">UNIT_NONE</span>
        <span class="n">listOfSamples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">listOfSamples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">interpretDose</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">listOfSamples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getDoseUnits</span><span class="p">()</span></div>

<div class="viewcode-block" id="PKPDExperiment.addParameterToSample"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.addParameterToSample">[docs]</a>    <span class="k">def</span> <span class="nf">addParameterToSample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampleName</span><span class="p">,</span> <span class="n">varName</span><span class="p">,</span> <span class="n">varUnits</span><span class="p">,</span> <span class="n">varDescr</span><span class="p">,</span> <span class="n">varValue</span><span class="p">,</span> <span class="n">rewrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">varName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="n">varX</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="p">()</span>
            <span class="n">varX</span><span class="o">.</span><span class="n">varName</span> <span class="o">=</span> <span class="n">varName</span>
            <span class="n">varX</span><span class="o">.</span><span class="n">varType</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">TYPE_NUMERIC</span>
            <span class="n">varX</span><span class="o">.</span><span class="n">displayString</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span>
            <span class="n">varX</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">ROLE_LABEL</span>
            <span class="n">varX</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">varDescr</span>
            <span class="n">varX</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">PKPDUnit</span><span class="p">()</span>
            <span class="n">varX</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">varUnits</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span> <span class="o">=</span> <span class="n">varX</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">varPresent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">varPresent</span><span class="o">.</span><span class="n">role</span><span class="o">!=</span><span class="n">PKPDVariable</span><span class="o">.</span><span class="n">ROLE_LABEL</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only labels can be reused (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="n">varName</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">rewrite</span><span class="p">:</span>
                <span class="n">varPresent</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">varDescr</span>
                <span class="n">varPresent</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">varUnits</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">varPresent</span><span class="o">.</span><span class="n">comment</span><span class="o">!=</span><span class="n">varDescr</span> <span class="ow">or</span> <span class="n">varPresent</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">unit</span><span class="o">!=</span><span class="n">varUnits</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is already a variable in the experiment with a different purpose&quot;</span><span class="o">%</span><span class="n">varName</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sampleName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">:</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">sampleName</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sample</span><span class="o">.</span><span class="n">descriptors</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">sample</span><span class="o">.</span><span class="n">descriptors</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">sample</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span> <span class="o">=</span> <span class="n">varValue</span></div>

<div class="viewcode-block" id="PKPDExperiment.addLabelToSample"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.addLabelToSample">[docs]</a>    <span class="k">def</span> <span class="nf">addLabelToSample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampleName</span><span class="p">,</span> <span class="n">varName</span><span class="p">,</span> <span class="n">varDescr</span><span class="p">,</span> <span class="n">varValue</span><span class="p">,</span> <span class="n">rewrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">varName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="n">varX</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="p">()</span>
            <span class="n">varX</span><span class="o">.</span><span class="n">varName</span> <span class="o">=</span> <span class="n">varName</span>
            <span class="n">varX</span><span class="o">.</span><span class="n">varType</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">TYPE_TEXT</span>
            <span class="n">varX</span><span class="o">.</span><span class="n">displayString</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="n">varX</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="o">.</span><span class="n">ROLE_LABEL</span>
            <span class="n">varX</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">varDescr</span>
            <span class="n">varX</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">PKPDUnit</span><span class="p">()</span>
            <span class="n">varX</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">PKPDUnit</span><span class="o">.</span><span class="n">UNIT_NONE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span> <span class="o">=</span> <span class="n">varX</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">varPresent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">varPresent</span><span class="o">.</span><span class="n">role</span><span class="o">!=</span><span class="n">PKPDVariable</span><span class="o">.</span><span class="n">ROLE_LABEL</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only labels can be reused (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="n">varName</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">rewrite</span><span class="p">:</span>
                <span class="n">varPresent</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">varDescr</span>
                <span class="n">varPresent</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">PKPDUnit</span><span class="o">.</span><span class="n">UNIT_NONE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">varPresent</span><span class="o">.</span><span class="n">comment</span><span class="o">!=</span><span class="n">varDescr</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is already a variable in the experiment with a different purpose&quot;</span><span class="o">%</span><span class="n">varName</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sampleName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">:</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">sampleName</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sample</span><span class="o">.</span><span class="n">descriptors</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">sample</span><span class="o">.</span><span class="n">descriptors</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">sample</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span> <span class="o">=</span> <span class="n">varValue</span></div>

<div class="viewcode-block" id="PKPDExperiment.getSubGroup"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.getSubGroup">[docs]</a>    <span class="k">def</span> <span class="nf">getSubGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">condition</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">condition</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span>
        <span class="n">samplesSubGroup</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">sampleName</span><span class="p">,</span> <span class="n">sample</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">sample</span><span class="o">.</span><span class="n">evaluateExpression</span><span class="p">(</span><span class="n">condition</span><span class="p">):</span>
                <span class="n">samplesSubGroup</span><span class="p">[</span><span class="n">sampleName</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="k">return</span> <span class="n">samplesSubGroup</span></div>

<div class="viewcode-block" id="PKPDExperiment.getSubGroupLabels"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.getSubGroupLabels">[docs]</a>    <span class="k">def</span> <span class="nf">getSubGroupLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">condition</span><span class="p">,</span><span class="n">labelName</span><span class="p">):</span>
        <span class="n">subgroupLabels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sampleName</span><span class="p">,</span> <span class="n">sample</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">condition</span><span class="o">!=</span><span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">sample</span><span class="o">.</span><span class="n">evaluateExpression</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="ow">or</span> <span class="n">condition</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">subgroupLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">labelName</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">subgroupLabels</span></div>

<div class="viewcode-block" id="PKPDExperiment.getNonBolusDoses"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.getNonBolusDoses">[docs]</a>    <span class="k">def</span> <span class="nf">getNonBolusDoses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nonBolusList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sampleName</span><span class="p">,</span> <span class="n">sample</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">sample</span><span class="o">.</span><span class="n">interpretDose</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sample</span><span class="o">.</span><span class="n">isDoseABolus</span><span class="p">():</span>
                <span class="n">nonBolusList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sampleName</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nonBolusList</span></div>

<div class="viewcode-block" id="PKPDExperiment.addSampleToGroup"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.addSampleToGroup">[docs]</a>    <span class="k">def</span> <span class="nf">addSampleToGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">groupName</span><span class="p">,</span><span class="n">sample</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">groupName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">groupName</span><span class="p">]</span> <span class="o">=</span> <span class="n">PKPDGroup</span><span class="p">(</span><span class="n">groupName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">groupName</span><span class="p">]</span><span class="o">.</span><span class="n">sampleList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">sampleName</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDExperiment.addSample"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.addSample">[docs]</a>    <span class="k">def</span> <span class="nf">addSample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sample</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">sample</span><span class="o">.</span><span class="n">sampleName</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="k">for</span> <span class="n">groupName</span> <span class="ow">in</span> <span class="n">sample</span><span class="o">.</span><span class="n">groupList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addSampleToGroup</span><span class="p">(</span><span class="n">groupName</span><span class="p">,</span><span class="n">sample</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDExperiment.getTimeVariable"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.getTimeVariable">[docs]</a>    <span class="k">def</span> <span class="nf">getTimeVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">varName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">.</span><span class="n">isTime</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">varName</span></div>

<div class="viewcode-block" id="PKPDExperiment.getTimeUnits"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.getTimeUnits">[docs]</a>    <span class="k">def</span> <span class="nf">getTimeUnits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">timeName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTimeVariable</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">timeName</span><span class="p">]</span><span class="o">.</span><span class="n">units</span></div>

<div class="viewcode-block" id="PKPDExperiment.getMeasurementVariables"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.getMeasurementVariables">[docs]</a>    <span class="k">def</span> <span class="nf">getMeasurementVariables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retval</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">varName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">.</span><span class="n">isMeasurement</span><span class="p">():</span>
                <span class="n">retval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varName</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retval</span></div>

<div class="viewcode-block" id="PKPDExperiment.subset"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.subset">[docs]</a>    <span class="k">def</span> <span class="nf">subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">listOfSampleNames</span><span class="p">):</span>
        <span class="n">newExperiment</span> <span class="o">=</span> <span class="n">PKPDExperiment</span><span class="p">()</span>

        <span class="c1"># General</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">newExperiment</span><span class="o">.</span><span class="n">general</span><span class="p">):</span>
                <span class="n">newExperiment</span><span class="o">.</span><span class="n">general</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Variables</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">newExperiment</span><span class="o">.</span><span class="n">variables</span><span class="p">):</span>
                <span class="n">newExperiment</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Doses</span>
        <span class="n">viasSubset</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dose</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">newExperiment</span><span class="o">.</span><span class="n">doses</span><span class="p">[</span><span class="n">dose</span><span class="o">.</span><span class="n">doseName</span><span class="p">]</span> <span class="o">=</span> <span class="n">dose</span>
            <span class="n">viasSubset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dose</span><span class="o">.</span><span class="n">via</span><span class="o">.</span><span class="n">viaName</span><span class="p">)</span>

        <span class="c1"># Vias</span>
        <span class="k">for</span> <span class="n">via</span> <span class="ow">in</span> <span class="n">viasSubset</span><span class="p">:</span>
            <span class="n">newExperiment</span><span class="o">.</span><span class="n">vias</span><span class="p">[</span><span class="n">via</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vias</span><span class="p">[</span><span class="n">via</span><span class="p">]</span>

        <span class="c1"># Samples and groups</span>
        <span class="n">newExperiment</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">sampleName</span> <span class="ow">in</span> <span class="n">listOfSampleNames</span><span class="p">:</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">sampleName</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">groupName</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">sampleName</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">sampleList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">groupName</span> <span class="ow">in</span> <span class="n">newExperiment</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">newExperiment</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">groupName</span><span class="p">]</span><span class="o">=</span><span class="n">PKPDGroup</span><span class="p">(</span><span class="n">groupName</span><span class="p">)</span>
                    <span class="n">newExperiment</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">groupName</span><span class="p">]</span><span class="o">.</span><span class="n">sampleList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sampleName</span><span class="p">)</span>
            <span class="n">newExperiment</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">sample</span><span class="o">.</span><span class="n">sampleName</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="k">return</span> <span class="n">newExperiment</span></div>

<div class="viewcode-block" id="PKPDExperiment.gather"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDExperiment.gather">[docs]</a>    <span class="k">def</span> <span class="nf">gather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">otherExperiment</span><span class="p">):</span>
        <span class="c1"># General</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">otherExperiment</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">general</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">general</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Variables</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">otherExperiment</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Doses</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">otherExperiment</span><span class="o">.</span><span class="n">doses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Vias</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">otherExperiment</span><span class="o">.</span><span class="n">vias</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vias</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vias</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Samples</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">otherExperiment</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addSample</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="PKPDModelBase"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase">[docs]</a><span class="k">class</span> <span class="nc">PKPDModelBase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnExperiment</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameterUnits</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xName</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yName</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="PKPDModelBase.setExperiment"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase.setExperiment">[docs]</a>    <span class="k">def</span> <span class="nf">setExperiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment</span> <span class="o">=</span> <span class="n">experiment</span>
        <span class="k">if</span> <span class="n">experiment</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fnExperiment</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">fnPKPD</span></div>

<div class="viewcode-block" id="PKPDModelBase.setXVar"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase.setXVar">[docs]</a>    <span class="k">def</span> <span class="nf">setXVar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot find </span><span class="si">%s</span><span class="s2"> as a variable in the experiment&quot;</span><span class="o">%</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xName</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xRange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">getRange</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDModelBase.setYVar"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase.setYVar">[docs]</a>    <span class="k">def</span> <span class="nf">setYVar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yName</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yRange</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">yi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot find </span><span class="si">%s</span><span class="s2"> as a variable in the experiment&quot;</span><span class="o">%</span><span class="n">yi</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yName</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yRange</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">getRange</span><span class="p">(</span><span class="n">yi</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot find </span><span class="si">%s</span><span class="s2"> as a variable in the experiment&quot;</span><span class="o">%</span><span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yName</span> <span class="o">=</span> <span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yRange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">getRange</span><span class="p">(</span><span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDModelBase.setXYValues"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase.setXYValues">[docs]</a>    <span class="k">def</span> <span class="nf">setXYValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
            <span class="n">xidx</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">yidx</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xidx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yidx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">yidxi</span><span class="p">)</span> <span class="k">if</span> <span class="n">yidxi</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">yidxi</span> <span class="ow">in</span> <span class="n">yidx</span><span class="p">]))</span></div>

<div class="viewcode-block" id="PKPDModelBase.getNumberOfParameters"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase.getNumberOfParameters">[docs]</a>    <span class="k">def</span> <span class="nf">getNumberOfParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getParameterNames</span><span class="p">())</span></div>

<div class="viewcode-block" id="PKPDModelBase.getDescription"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase.getDescription">[docs]</a>    <span class="k">def</span> <span class="nf">getDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="PKPDModelBase.getParameterNames"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase.getParameterNames">[docs]</a>    <span class="k">def</span> <span class="nf">getParameterNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="PKPDModelBase.getParameterDescriptions"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase.getParameterDescriptions">[docs]</a>    <span class="k">def</span> <span class="nf">getParameterDescriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;Automatically fitted model of the form </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">getModelEquation</span><span class="p">()]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getNumberOfParameters</span><span class="p">()</span></div>

<div class="viewcode-block" id="PKPDModelBase.calculateParameterUnits"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase.calculateParameterUnits">[docs]</a>    <span class="k">def</span> <span class="nf">calculateParameterUnits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sample</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="PKPDModelBase.rearrange"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase.rearrange">[docs]</a>    <span class="k">def</span> <span class="nf">rearrange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameters</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">parameters</span></div>

<div class="viewcode-block" id="PKPDModelBase.setParameters"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase.setParameters">[docs]</a>    <span class="k">def</span> <span class="nf">setParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rearrange</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PKPDModelBase2"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase2">[docs]</a><span class="k">class</span> <span class="nc">PKPDModelBase2</span><span class="p">(</span><span class="n">PKPDModelBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">PKPDModelBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="PKPDModelBase2.forwardModel"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase2.forwardModel">[docs]</a>    <span class="k">def</span> <span class="nf">forwardModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="PKPDModelBase2.printSetup"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase2.printSetup">[docs]</a>    <span class="k">def</span> <span class="nf">printSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">getModelEquation</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variables: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getParameterNames</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bounds: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getBounds</span><span class="p">()))</span></div>

<div class="viewcode-block" id="PKPDModelBase2.setSample"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase2.setSample">[docs]</a>    <span class="k">def</span> <span class="nf">setSample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Dunits</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">getDoseUnits</span><span class="p">()</span></div>

<div class="viewcode-block" id="PKPDModelBase2.getEquation"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase2.getEquation">[docs]</a>    <span class="k">def</span> <span class="nf">getEquation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="PKPDModelBase2.getModelEquation"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase2.getModelEquation">[docs]</a>    <span class="k">def</span> <span class="nf">getModelEquation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="PKPDModelBase2.getParameterDescriptions"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase2.getParameterDescriptions">[docs]</a>    <span class="k">def</span> <span class="nf">getParameterDescriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;Automatically fitted model of the form </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">getModelEquation</span><span class="p">()]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getNumberOfParameters</span><span class="p">()</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="PKPDModelBase2.areParametersSignificant"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase2.areParametersSignificant">[docs]</a>    <span class="k">def</span> <span class="nf">areParametersSignificant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lowerBound</span><span class="p">,</span> <span class="n">upperBound</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param lowerBound and upperBound: a numpy array of parameters</span>
<span class="sd">        :return: a list of string with &quot;True&quot;, &quot;False&quot;, &quot;NA&quot;, &quot;Suspicious&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="PKPDModelBase2.areParametersValid"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase2.areParametersValid">[docs]</a>    <span class="k">def</span> <span class="nf">areParametersValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="PKPDModelBase2.setBounds"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase2.setBounds">[docs]</a>    <span class="k">def</span> <span class="nf">setBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundsString</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">boundsString</span><span class="o">!=</span><span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">boundsString</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">tokens</span><span class="o">=</span><span class="n">boundsString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">getNumberOfParameters</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The number of bound intervals (</span><span class="si">%d</span><span class="s2">) does not match the number of parameters (</span><span class="si">%d</span><span class="s2">)&quot;</span><span class="o">%</span>\
                                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">getNumberOfParameters</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]),</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span></div>

<div class="viewcode-block" id="PKPDModelBase2.getBounds"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase2.getBounds">[docs]</a>    <span class="k">def</span> <span class="nf">getBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span></div>

<div class="viewcode-block" id="PKPDModelBase2.setConfidenceInterval"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase2.setConfidenceInterval">[docs]</a>    <span class="k">def</span> <span class="nf">setConfidenceInterval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lowerBound</span><span class="p">,</span><span class="n">upperBound</span><span class="p">):</span>
        <span class="n">yPredictedBackup</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yPredicted</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yPredictedLower</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yPredictedUpper</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yPredicted</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yPredictedLower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yPredicted</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yPredictedUpper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yPredicted</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">getNumberOfParameters</span><span class="p">()))):</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;{0:0</span><span class="si">%d</span><span class="s2">b}&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNumberOfParameters</span><span class="p">()))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span><span class="o">==</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="n">upperBound</span><span class="p">,</span><span class="n">lowerBound</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">areParametersValid</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forwardModel</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
                <span class="n">yj</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yj</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">yj</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">&lt;</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yPredictedLower</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">n</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">yj</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">yPredictedLower</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yPredictedLower</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">n</span><span class="p">])</span><span class="o">=</span><span class="n">yj</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">yj</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yPredictedUpper</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">n</span><span class="p">]):</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yPredictedUpper</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">n</span><span class="p">])</span><span class="o">=</span><span class="n">yj</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yPredicted</span> <span class="o">=</span> <span class="n">yPredictedBackup</span></div>

<div class="viewcode-block" id="PKPDModelBase2.setConfidenceIntervalNA"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModelBase2.setConfidenceIntervalNA">[docs]</a>    <span class="k">def</span> <span class="nf">setConfidenceIntervalNA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yPredictedUpper</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yPredictedLower</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPredicted</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yPredictedUpper</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;NA&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yPredictedLower</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;NA&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="PKPDModel"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModel">[docs]</a><span class="k">class</span> <span class="nc">PKPDModel</span><span class="p">(</span><span class="n">PKPDModelBase2</span><span class="p">):</span>
<div class="viewcode-block" id="PKPDModel.prepare"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDModel.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="PKPDODEModel"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDODEModel">[docs]</a><span class="k">class</span> <span class="nc">PKPDODEModel</span><span class="p">(</span><span class="n">PKPDModelBase2</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">PKPDModelBase2</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t0</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># (min)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tF</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># (min)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="c1"># (min)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drugSource</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drugSourceImpulse</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tFImpulse</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thImpulse</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># self.show = False</span>

<div class="viewcode-block" id="PKPDODEModel.setXYValues"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDODEModel.setXYValues">[docs]</a>    <span class="k">def</span> <span class="nf">setXYValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">!=</span><span class="nb">list</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getResponseDimension</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">!=</span><span class="nb">list</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getResponseDimension</span><span class="p">()):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
            <span class="n">xidx</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">yidx</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xidx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yidx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ylog</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">yidxi</span><span class="p">)</span> <span class="k">if</span> <span class="n">yidxi</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">yidxi</span> <span class="ow">in</span> <span class="n">yidx</span><span class="p">]))</span></div>

<div class="viewcode-block" id="PKPDODEModel.F"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDODEModel.F">[docs]</a>    <span class="k">def</span> <span class="nf">F</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="PKPDODEModel.G"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDODEModel.G">[docs]</a>    <span class="k">def</span> <span class="nf">G</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dD</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="PKPDODEModel.imposeConstraints"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDODEModel.imposeConstraints">[docs]</a>    <span class="k">def</span> <span class="nf">imposeConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yt</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">yt</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">yt</span><span class="p">[</span><span class="n">yt</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">yt</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">yt</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">yt</span><span class="o">=</span><span class="mi">0</span></div>

<div class="viewcode-block" id="PKPDODEModel.H"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDODEModel.H">[docs]</a>    <span class="k">def</span> <span class="nf">H</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="PKPDODEModel.getResponseDimension"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDODEModel.getResponseDimension">[docs]</a>    <span class="k">def</span> <span class="nf">getResponseDimension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="PKPDODEModel.getStateDimension"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDODEModel.getStateDimension">[docs]</a>    <span class="k">def</span> <span class="nf">getStateDimension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="PKPDODEModel.forwardModel"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDODEModel.forwardModel">[docs]</a>    <span class="k">def</span> <span class="nf">forwardModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drugSource</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">if</span> <span class="n">drugSource</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">drugSource</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">drugSource</span>

        <span class="c1"># Simulate the system response</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span>
        <span class="n">Nsamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">tF</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStateDimension</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getStateDimension</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
            <span class="n">Yt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nsamples</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">getStateDimension</span><span class="p">()),</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">Yt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nsamples</span><span class="p">)</span>
        <span class="n">Xt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Yt</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">delta_2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span>
        <span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span><span class="o">/</span><span class="mi">3</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nsamples</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span> <span class="c1"># More accurate than t+= self.deltaT</span>
            <span class="n">Xt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">t</span>

            <span class="c1"># Internal evolution</span>
            <span class="c1"># Runge Kutta&#39;s 4th order (http://lpsa.swarthmore.edu/NumInt/NumIntFourth.html)</span>
            <span class="n">k1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">yt</span><span class="p">)</span>
            <span class="n">dD1</span> <span class="o">=</span> <span class="n">drugSource</span><span class="o">.</span><span class="n">getAmountReleasedAt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">delta_2</span><span class="p">)</span>
            <span class="n">dyD1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dD1</span><span class="p">)</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">yt</span><span class="o">+</span><span class="n">k1</span><span class="o">*</span><span class="n">delta_2</span><span class="o">+</span><span class="n">dyD1</span>
            <span class="c1"># print(&quot;t=&quot;,t,&quot; y0=&quot;,yt,&quot; k1=&quot;,k1,&quot; dD1=&quot;,dD1,&quot; dyD1=&quot;,dyD1,&quot; y1=&quot;,y1)</span>

            <span class="n">t_delta_2</span><span class="o">=</span><span class="n">t</span><span class="o">+</span><span class="n">delta_2</span>
            <span class="n">k2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="p">(</span><span class="n">t_delta_2</span><span class="p">,</span><span class="n">y1</span><span class="p">)</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">yt</span><span class="o">+</span><span class="n">k2</span><span class="o">*</span><span class="n">delta_2</span><span class="o">+</span><span class="n">dyD1</span>
            <span class="c1"># print(&quot;k2=&quot;,k2,&quot; y2=&quot;,y2)</span>

            <span class="n">dD</span> <span class="o">=</span> <span class="n">drugSource</span><span class="o">.</span><span class="n">getAmountReleasedAt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span><span class="p">)</span>
            <span class="n">dyD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dD</span><span class="p">)</span>
            <span class="n">k3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="p">(</span><span class="n">t_delta_2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
            <span class="n">y3</span> <span class="o">=</span> <span class="n">yt</span><span class="o">+</span><span class="n">k3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span><span class="o">+</span><span class="n">dyD</span>
            <span class="c1"># print(&quot;k3=&quot;,k3,&quot; dD=&quot;,dD,&quot; dyD=&quot;,dyD,&quot; y3=&quot;,y3)</span>

            <span class="n">k4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span><span class="p">,</span><span class="n">y3</span><span class="p">)</span>
            <span class="c1"># y4 = yt+k4*self.deltaT+dyD</span>
            <span class="c1"># print(&quot;k4=&quot;,k4,&quot; y4=&quot;,y4)</span>

            <span class="c1"># Update state</span>
            <span class="n">yt</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="n">k4</span><span class="p">)</span><span class="o">+</span><span class="n">k2</span><span class="o">+</span><span class="n">k3</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="o">+</span><span class="n">dyD</span>
            <span class="c1"># print(&quot;yt=&quot;,yt)</span>
            <span class="c1"># print(&quot; &quot;)</span>

            <span class="c1"># Make sure it makes sense</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imposeConstraints</span><span class="p">(</span><span class="n">yt</span><span class="p">)</span>

            <span class="c1"># Apply measurement transformation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">yt</span><span class="p">)</span>

            <span class="c1"># if self.show:</span>
            <span class="c1">#     print(&quot;t=%f dD=%s dyD=%s dy=%s&quot;%(t,str(dD),str(dyD),str((0.5*(k1+k4)+k2+k3)*K)))</span>

            <span class="c1"># Keep this result and go to next iteration</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStateDimension</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">Yt</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">=</span><span class="n">yt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Yt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">yt</span>

        <span class="c1"># Get the values at x</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">yPredicted</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">getResponseDimension</span><span class="p">()):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStateDimension</span><span class="p">()</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yPredicted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">Xt</span><span class="p">,</span><span class="n">Yt</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yPredicted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">Xt</span><span class="p">,</span><span class="n">Yt</span><span class="p">[:,</span><span class="n">j</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPredicted</span></div>

<div class="viewcode-block" id="PKPDODEModel.getImpulseResponse"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDODEModel.getImpulseResponse">[docs]</a>    <span class="k">def</span> <span class="nf">getImpulseResponse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">tImpulse</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tFImpulse</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tFImpulse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tF</span>

        <span class="c1"># Create unit dose</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drugSourceImpulse</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drugSourceImpulse</span> <span class="o">=</span> <span class="n">DrugSource</span><span class="p">()</span>
            <span class="n">dose</span> <span class="o">=</span> <span class="n">createDeltaDose</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">via</span><span class="o">=</span><span class="n">createVia</span><span class="p">(</span><span class="s2">&quot;Intravenous; iv&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment</span><span class="p">),</span>
                                   <span class="n">dunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">drugSource</span><span class="o">.</span><span class="n">getDoseUnits</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drugSourceImpulse</span><span class="o">.</span><span class="n">setDoses</span><span class="p">([</span><span class="n">dose</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tFImpulse</span><span class="p">)</span>
        <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">forwardModel</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="p">[</span><span class="n">tImpulse</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">drugSourceImpulse</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="PKPDODEModel.forwardModelByConvolution"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDODEModel.forwardModelByConvolution">[docs]</a>    <span class="k">def</span> <span class="nf">forwardModelByConvolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>

        <span class="c1"># Simulate the system response</span>
        <span class="n">Nsamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tF</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">Xt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nsamples</span><span class="p">)</span>

        <span class="c1"># Get the drug input</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">Xt</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nsamples</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span> <span class="c1"># More accurate than t+= self.deltaT</span>
            <span class="n">Xt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">t</span>
            <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">drugSource</span><span class="o">.</span><span class="n">getAmountReleasedAt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span><span class="p">)</span>

        <span class="c1"># Get the model impulse response</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thImpulse</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Nsamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tFImpulse</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thImpulse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nsamples</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nsamples</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">thImpulse</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span> <span class="c1"># More accurate than t+= self.deltaT</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImpulseResponse</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thImpulse</span><span class="p">)</span>
        <span class="n">Yt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="s1">&#39;full&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)]</span>

        <span class="c1"># Get the values at x</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">yPredicted</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">getResponseDimension</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yPredicted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">Xt</span><span class="p">,</span><span class="n">Yt</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPredicted</span></div>

<div class="viewcode-block" id="PKPDODEModel.printOtherParameterization"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDODEModel.printOtherParameterization">[docs]</a>    <span class="k">def</span> <span class="nf">printOtherParameterization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="PKPDOptimizer"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDOptimizer">[docs]</a><span class="k">class</span> <span class="nc">PKPDOptimizer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">fitType</span><span class="p">,</span><span class="n">goalFunction</span><span class="o">=</span><span class="s2">&quot;RMSE&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitType</span> <span class="o">=</span> <span class="n">fitType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nevaluations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bestRmse</span><span class="o">=</span><span class="mf">1e38</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">yTarget</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yTargetLogs</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span> <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">yTarget</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">fitType</span><span class="o">==</span><span class="s2">&quot;linear&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">takeYLogs</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">takeRelative</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">fitType</span><span class="o">==</span><span class="s2">&quot;log&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yTarget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yTargetLogs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">takeYLogs</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">takeRelative</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">fitType</span><span class="o">==</span><span class="s2">&quot;relative&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">takeYLogs</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">takeRelative</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">getBounds</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">goalFunction</span><span class="o">==</span><span class="s2">&quot;RMSE&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">goalFunction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goalRMSE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown goal function&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="PKPDOptimizer.inBounds"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDOptimizer.inBounds">[docs]</a>    <span class="k">def</span> <span class="nf">inBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="o">==</span><span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">parameters</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PKPDOptimizer.hugeError"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDOptimizer.hugeError">[docs]</a>    <span class="k">def</span> <span class="nf">hugeError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">allDiffs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">yTarget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">yTarget</span><span class="p">:</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="mf">1e38</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">yTarget</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">allDiffs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">allDiffs</span> <span class="o">=</span> <span class="n">diff</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">allDiffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">allDiffs</span><span class="p">,</span> <span class="n">diff</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">allDiffs</span></div>

<div class="viewcode-block" id="PKPDOptimizer.getResiduals"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDOptimizer.getResiduals">[docs]</a>    <span class="k">def</span> <span class="nf">getResiduals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">inBounds</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hugeError</span><span class="p">()</span>
        <span class="n">yPredicted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">forwardModel</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

        <span class="n">allDiffs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">y</span><span class="p">,</span> <span class="n">yTarget</span><span class="p">,</span> <span class="n">yTargetLog</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">yPredicted</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">yTarget</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">yTargetLogs</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">takeYLogs</span><span class="p">:</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">yTarget</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="n">y</span><span class="o">&gt;=</span><span class="mf">1e-20</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.8</span><span class="o">*</span><span class="n">diff</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hugeError</span><span class="p">()</span>
                <span class="n">diff</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">yTargetLog</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">yTarget</span> <span class="o">-</span> <span class="n">y</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">takeRelative</span><span class="p">:</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">diff</span><span class="o">/</span><span class="n">yTarget</span>

            <span class="k">if</span> <span class="n">allDiffs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">allDiffs</span> <span class="o">=</span> <span class="n">diff</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">allDiffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">allDiffs</span><span class="p">,</span> <span class="n">diff</span><span class="p">])</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">allDiffs</span><span class="p">))</span>
        <span class="n">allDiffs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">allDiffs</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">size</span><span class="o">&lt;</span><span class="n">parameters</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hugeError</span><span class="p">()</span>

        <span class="n">rmse</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">rmse</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">bestRmse</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Best rmse so far=</span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">rmse</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      at x=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      e=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(&quot;      yTarget=%s&quot;%str(yTarget))</span>
            <span class="c1"># print(&quot;      yTargetLog=%s&quot;%str(yTargetLog))</span>
            <span class="c1"># print(&quot;      y=%s&quot;%str(y))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bestRmse</span><span class="o">=</span><span class="n">rmse</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nevaluations</span><span class="o">%</span><span class="mi">100</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Neval=</span><span class="si">%d</span><span class="s2"> RMSE=</span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nevaluations</span><span class="p">,</span><span class="n">rmse</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nevaluations</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">e</span></div>

<div class="viewcode-block" id="PKPDOptimizer.goalRMSE"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDOptimizer.goalRMSE">[docs]</a>    <span class="k">def</span> <span class="nf">goalRMSE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameters</span><span class="p">):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getResiduals</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">rmse</span></div>

    <span class="k">def</span> <span class="nf">_evaluateQuality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yp</span><span class="p">):</span>
        <span class="c1"># Spiess and Neumeyer, BMC Pharmacology 2010, 10:6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">yToUse</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">yi</span><span class="p">,</span> <span class="n">ypi</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">yp</span><span class="p">):</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">yii</span><span class="p">,</span> <span class="n">ypii</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span><span class="n">ypi</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">yii</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ypii</span><span class="p">):</span>
                    <span class="n">diff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yii</span><span class="o">-</span><span class="n">ypii</span><span class="p">)</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">diff</span>
                <span class="n">yToUse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="n">diff</span><span class="p">])</span>
                <span class="n">yToUse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">yToUse</span><span class="p">,</span> <span class="n">yi</span><span class="p">])</span>


        <span class="n">yToUse</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">yToUse</span><span class="p">))]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c1"># Remove infinites</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nanvar</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">nanvar</span><span class="p">(</span><span class="n">yToUse</span><span class="p">))</span>
        <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="c1"># Number of samples</span>
        <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getNumberOfParameters</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">R2</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">R2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">d2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span><span class="n">diff</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">d2</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">logL</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d2</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logL</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AIC</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">logL</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AICc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AIC</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AICc</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BIC</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">logL</span>

    <span class="k">def</span> <span class="nf">_printFitting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yp</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluateQuality</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yp</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Series </span><span class="si">%d</span><span class="s2"> ---------&quot;</span><span class="o">%</span><span class="n">j</span><span class="p">)</span>
            <span class="n">xj</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">yj</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">ypj</span><span class="o">=</span><span class="n">yp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">xj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">xj</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">yj</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">ypj</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">yj</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">-</span><span class="n">ypj</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean error = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Std error = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R2 = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">R2</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R2adj = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AIC = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">AIC</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AICc(Recommended) = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">AICc</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BIC = </span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">BIC</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="PKPDOptimizer.evaluateQuality"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDOptimizer.evaluateQuality">[docs]</a>    <span class="k">def</span> <span class="nf">evaluateQuality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">yPredicted</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">forwardModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitType</span><span class="o">==</span><span class="s2">&quot;linear&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitType</span><span class="o">==</span><span class="s2">&quot;relative&quot;</span><span class="p">:</span>
            <span class="n">yp</span> <span class="o">=</span> <span class="n">yPredicted</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitType</span><span class="o">==</span><span class="s2">&quot;log&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">yPredicted</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">yPredicted</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="n">yPredicted</span><span class="o">=</span><span class="n">yPredicted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ylog</span> <span class="o">=</span> <span class="n">smartLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                <span class="n">yplog</span> <span class="o">=</span> <span class="n">smartLog</span><span class="p">(</span><span class="n">yPredicted</span><span class="p">)</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ylog</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">yplog</span><span class="p">))))</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">xToUse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">x</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
                    <span class="n">xToUse</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xToUse</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ylog</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
                    <span class="n">ylog</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ylog</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">yplog</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
                    <span class="n">yplog</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">yplog</span><span class="p">)</span>
                <span class="n">x</span><span class="o">=</span> <span class="n">xToUse</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">y</span><span class="o">=</span> <span class="n">ylog</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">yp</span><span class="o">=</span><span class="n">yplog</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">smartLog</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span> <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
                <span class="n">yp</span> <span class="o">=</span> <span class="p">[</span><span class="n">smartLog</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span> <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="n">yPredicted</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_evaluateQuality</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yp</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDOptimizer.printFitting"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDOptimizer.printFitting">[docs]</a>    <span class="k">def</span> <span class="nf">printFitting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">yPredicted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">forwardModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==========================================&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X     Y    Ypredicted  Error=Y-Ypredicted &quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==========================================&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_printFitting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">yPredicted</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==================================================================&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X    log10(Y)  log10(Ypredicted)  Error=log10(Y)-log10(Ypredicted)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==================================================================&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">yPredicted</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">yPredicted</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">yPredicted</span><span class="o">=</span><span class="n">yPredicted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ylog</span> <span class="o">=</span> <span class="n">smartLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">yplog</span> <span class="o">=</span> <span class="n">smartLog</span><span class="p">(</span><span class="n">yPredicted</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ylog</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">yplog</span><span class="p">))))</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">xToUse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">x</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
                <span class="n">xToUse</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xToUse</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ylog</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
                <span class="n">ylog</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ylog</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">yplog</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
                <span class="n">yplog</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">yplog</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_printFitting</span><span class="p">(</span><span class="n">xToUse</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">ylog</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yplog</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logY</span> <span class="o">=</span> <span class="p">[</span><span class="n">smartLog</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
            <span class="n">logYp</span> <span class="o">=</span> <span class="p">[</span><span class="n">smartLog</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yPredicted</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_printFitting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">logY</span><span class="p">,</span> <span class="n">logYp</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PKPDDEOptimizer"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDDEOptimizer">[docs]</a><span class="k">class</span> <span class="nc">PKPDDEOptimizer</span><span class="p">(</span><span class="n">PKPDOptimizer</span><span class="p">):</span>
<div class="viewcode-block" id="PKPDDEOptimizer.optimize"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDDEOptimizer.optimize">[docs]</a>    <span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">differential_evolution</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimizing with Differential Evolution (DE), a global optimizer&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimum</span> <span class="o">=</span> <span class="n">differential_evolution</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goalFunction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getBounds</span><span class="p">(),</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best DE function value: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="o">.</span><span class="n">fun</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best DE parameters: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getEquation</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printFitting</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum</span></div></div>


<div class="viewcode-block" id="PKPDLSOptimizer"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDLSOptimizer">[docs]</a><span class="k">class</span> <span class="nc">PKPDLSOptimizer</span><span class="p">(</span><span class="n">PKPDOptimizer</span><span class="p">):</span>
<div class="viewcode-block" id="PKPDLSOptimizer.optimize"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDLSOptimizer.optimize">[docs]</a>    <span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">1.49012e-8</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1.49012e-8</span><span class="p">):</span> <span class="c1"># Same values as in minpack.py</span>
        <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">leastsq</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimizing with Least Squares (LS), a local optimizer&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initial parameters: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">mesg</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getResiduals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                      <span class="n">ftol</span><span class="o">=</span><span class="n">ftol</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="n">xtol</span><span class="p">)</span>
            <span class="c1"># J is the jacobian C=MSE*inv(J&#39;*J)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best LS function value: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goalFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best LS parameters: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Covariance matrix:&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">J</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getResiduals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="p">)</span>
                <span class="n">JtJ</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">J</span><span class="p">),</span><span class="n">J</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">JtJ</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-6</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cov_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">JtJ</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov_x</span><span class="p">,</span><span class="n">max_line_width</span><span class="o">=</span><span class="mi">120</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cov_x</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Singular Jacobian, we cannot estimate the covariance&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cov_x</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Singular Jacobian, we cannot estimate the covariance&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getEquation</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printFitting</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum</span></div>

<div class="viewcode-block" id="PKPDLSOptimizer.setConfidenceInterval"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDLSOptimizer.setConfidenceInterval">[docs]</a>    <span class="k">def</span> <span class="nf">setConfidenceInterval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">confidenceInterval</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">norm</span>
            <span class="n">nstd</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">confidenceInterval</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">perr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov_x</span><span class="p">),</span><span class="mf">0.0</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lowerBound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="o">-</span><span class="n">nstd</span><span class="o">*</span><span class="n">perr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">upperBound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="o">+</span><span class="n">nstd</span><span class="o">*</span><span class="n">perr</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">significance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">areParametersSignificant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">upperBound</span><span class="p">)</span>
            <span class="n">parameterNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getParameterNames</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confidence intervals </span><span class="si">%f%%</span><span class="s2"> --------------------------&quot;</span><span class="o">%</span><span class="n">confidenceInterval</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ParameterName ParameterValue   ParameterConfidenceInterval  IsStatisticallySignificant&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="p">)):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> [</span><span class="si">%f</span><span class="s2">,</span><span class="si">%f</span><span class="s2">] </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">parameterNames</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">upperBound</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">significance</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setConfidenceInterval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">upperBound</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lowerBound</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">upperBound</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">significance</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setConfidenceIntervalNA</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="PKPDSampleFit"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleFit">[docs]</a><span class="k">class</span> <span class="nc">PKPDSampleFit</span><span class="p">:</span>
    <span class="n">READING_SAMPLEFITTINGS_NAME</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">READING_SAMPLEFITTINGS_MODELEQ</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">READING_SAMPLEFITTINGS_R2</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">READING_SAMPLEFITTINGS_R2ADJ</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">READING_SAMPLEFITTINGS_AIC</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">READING_SAMPLEFITTINGS_AICc</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">READING_SAMPLEFITTINGS_BIC</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">READING_SAMPLEFITTINGS_PARAMETER_BOUNDS</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">READING_SAMPLEFITTINGS_SAMPLE_VALUES</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Lists with the sample fits values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yu</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">modelEquation</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AIC</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AICc</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BIC</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lowerBound</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upperBound</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">significance</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">multiOutputSeries</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="PKPDSampleFit.printForPopulation"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleFit.printForPopulation">[docs]</a>    <span class="k">def</span> <span class="nf">printForPopulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fh</span><span class="p">,</span><span class="n">observations</span><span class="p">):</span>
        <span class="n">outputStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="n">outputStr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">parameter</span>
        <span class="n">observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">observations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
        <span class="n">outputStr</span> <span class="o">+=</span> <span class="s2">&quot; # </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">AIC</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">AICc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">BIC</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outputStr</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">observations</span></div>

<div class="viewcode-block" id="PKPDSampleFit.printForPopulationExcel"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleFit.printForPopulationExcel">[docs]</a>    <span class="k">def</span> <span class="nf">printForPopulationExcel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">observations</span><span class="p">):</span>
        <span class="n">toPrint</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="n">toPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">parameter</span><span class="p">)</span>
        <span class="n">observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">observations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
        <span class="n">excelWriteRow</span><span class="p">(</span><span class="n">toPrint</span><span class="o">+</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">R2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">AIC</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">AICc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">BIC</span><span class="p">],</span> <span class="n">wb</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">observations</span><span class="p">,</span> <span class="n">row</span><span class="o">+</span><span class="mi">1</span></div>

<div class="viewcode-block" id="PKPDSampleFit.getBasicInfo"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleFit.getBasicInfo">[docs]</a>    <span class="k">def</span> <span class="nf">getBasicInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a string with some basic information of the fitting. &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">info</span> <span class="o">+=</span> <span class="s2">&quot;Sample name: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span>
        <span class="n">info</span> <span class="o">+=</span> <span class="s2">&quot;Model: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelEquation</span>
        <span class="n">info</span> <span class="o">+=</span> <span class="s2">&quot;R2: </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">R2</span>
        <span class="n">info</span> <span class="o">+=</span> <span class="s2">&quot;R2adj: </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span>
        <span class="n">info</span> <span class="o">+=</span> <span class="s2">&quot;AIC: </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">AIC</span>
        <span class="n">info</span> <span class="o">+=</span> <span class="s2">&quot;AICc(Recommended): </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">AICc</span>
        <span class="n">info</span> <span class="o">+=</span> <span class="s2">&quot;BIC: </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">BIC</span>

        <span class="k">return</span> <span class="n">info</span></div>

    <span class="k">def</span> <span class="nf">_printToStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fh</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">significance</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">significance</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Undetermined&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getBasicInfo</span><span class="p">())</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Parameter lowerBound upperBound IsStatisticallySignificant -------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">significance</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">upperBound</span><span class="p">,</span>\
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">significance</span><span class="p">):</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">] </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">lower</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">upper</span><span class="p">),</span><span class="n">significance</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;X   Y   Ypredicted [Ylower,Yupper] -------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)):</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Series </span><span class="si">%d</span><span class="s2"> -----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">j</span><span class="p">)</span>
            <span class="n">xj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">yj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">ypj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">ylj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yl</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">yuj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yu</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yp</span><span class="p">,</span><span class="n">yl</span><span class="p">,</span><span class="n">yu</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">xj</span><span class="p">,</span><span class="n">yj</span><span class="p">,</span><span class="n">ypj</span><span class="p">,</span><span class="n">ylj</span><span class="p">,</span><span class="n">yuj</span><span class="p">):</span>
                <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">yp</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">yl</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">yu</span><span class="p">)))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_printToExcel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">parameterNames</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">significance</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">significance</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Undetermined&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="n">basicInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getBasicInfo</span><span class="p">()</span>
        <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">basicInfo</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">excelWriteRow</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">),</span> <span class="n">wb</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">excelFillCells</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">excelWriteRow</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">),</span> <span class="n">wb</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">excelWriteRow</span><span class="p">([</span><span class="s2">&quot;Parameter&quot;</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span><span class="s2">&quot;lowerBound&quot;</span><span class="p">,</span><span class="s2">&quot;upperBound&quot;</span><span class="p">,</span><span class="s2">&quot;IsStatisticallySignificant&quot;</span><span class="p">],</span><span class="n">wb</span><span class="p">,</span><span class="n">row</span><span class="p">);</span> <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">parameterName</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">significance</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">parameterNames</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">upperBound</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">significance</span><span class="p">):</span>
            <span class="n">excelWriteRow</span><span class="p">([</span><span class="n">parameterName</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">lower</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">upper</span><span class="p">),</span><span class="n">significance</span><span class="p">],</span> <span class="n">wb</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span> <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">excelWriteRow</span><span class="p">([</span><span class="s2">&quot;X&quot;</span><span class="p">,</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span><span class="s2">&quot;Ypredicted&quot;</span><span class="p">,</span> <span class="s2">&quot;[Ylower&quot;</span><span class="p">,</span><span class="s2">&quot;Yupper]&quot;</span><span class="p">],</span><span class="n">wb</span><span class="p">,</span><span class="n">row</span><span class="p">);</span> <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)):</span>
            <span class="n">excelWriteRow</span><span class="p">(</span><span class="s2">&quot;Series </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">j</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span> <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">xj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">yj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">ypj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">ylj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yl</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">yuj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yu</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yp</span><span class="p">,</span><span class="n">yl</span><span class="p">,</span><span class="n">yu</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="n">xj</span><span class="p">,</span><span class="n">yj</span><span class="p">,</span><span class="n">ypj</span><span class="p">,</span><span class="n">ylj</span><span class="p">,</span><span class="n">yuj</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ypToPrint</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">yp</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">ypToPrint</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">yp</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ylToPrint</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">yl</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">ylToPrint</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">yl</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">yuToPrint</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">yu</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">yuToPrint</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">yu</span><span class="p">)</span>
                <span class="n">excelWriteRow</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">ypToPrint</span><span class="p">,</span> <span class="n">ylToPrint</span><span class="p">,</span> <span class="n">yuToPrint</span><span class="p">],</span> <span class="n">wb</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span> <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">row</span><span class="o">+</span><span class="mi">1</span>

<div class="viewcode-block" id="PKPDSampleFit.restartReadingState"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleFit.restartReadingState">[docs]</a>    <span class="k">def</span> <span class="nf">restartReadingState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_NAME</span></div>

<div class="viewcode-block" id="PKPDSampleFit.readFromLine"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleFit.readFromLine">[docs]</a>    <span class="k">def</span> <span class="nf">readFromLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">==</span><span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_NAME</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_MODELEQ</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">==</span><span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_MODELEQ</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modelEquation</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_R2</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">==</span><span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_R2</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">R2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_R2ADJ</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">==</span><span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_R2ADJ</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_AIC</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">==</span><span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_AIC</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AIC</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_AICc</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">==</span><span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_AICc</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AICc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_BIC</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">==</span><span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_BIC</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BIC</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_PARAMETER_BOUNDS</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">==</span><span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_PARAMETER_BOUNDS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Parameter lowerBound upperBound&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lowerBound</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">upperBound</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">significance</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;X   Y   Ypredicted&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">=</span><span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_SAMPLE_VALUES</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yp</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yl</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yu</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tokens</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">significance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">tokens</span><span class="o">=</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lowerBound</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">upperBound</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">==</span><span class="n">PKPDSampleFit</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_SAMPLE_VALUES</span><span class="p">:</span>
            <span class="n">tokens</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;Series&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yp</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yu</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiOutputSeries</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiOutputSeries</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="n">tokens</span><span class="o">=</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">])[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yu</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="n">tokens</span><span class="o">=</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">])[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="PKPDSampleFit.copyFromOptimizer"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleFit.copyFromOptimizer">[docs]</a>    <span class="k">def</span> <span class="nf">copyFromOptimizer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">optimizer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R2</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">R2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">R2adj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AIC</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">AIC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AICc</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">AICc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BIC</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">BIC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">significance</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">significance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lowerBound</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">lowerBound</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upperBound</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">upperBound</span></div></div>


<div class="viewcode-block" id="PKPDSampleFitBootstrap"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleFitBootstrap">[docs]</a><span class="k">class</span> <span class="nc">PKPDSampleFitBootstrap</span><span class="p">:</span>
    <span class="n">READING_SAMPLEFITTINGS_NAME</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">READING_SAMPLEFITTINGS_XB</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">READING_SAMPLEFITTINGS_YB</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">READING_SAMPLEFITTINGS_PARAMETERS</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AIC</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AICc</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BIC</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xB</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yB</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_printSample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fh</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">n0</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">outputStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">: &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">n0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">n</span><span class="p">,:]:</span>
            <span class="n">outputStr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">parameter</span>
        <span class="n">outputStr</span> <span class="o">+=</span> <span class="s2">&quot; # </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R2</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">AIC</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">AICc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">BIC</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outputStr</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_printSampleExcel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">n0</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">toPrint</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Sample </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">n0</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">n</span><span class="p">,:]:</span>
            <span class="n">toPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
        <span class="n">excelWriteRow</span><span class="p">(</span><span class="n">toPrint</span><span class="o">+</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">R2</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">AIC</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">AICc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">BIC</span><span class="p">[</span><span class="n">n</span><span class="p">]],</span><span class="n">wb</span><span class="p">,</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">row</span><span class="o">+</span><span class="mi">1</span>

<div class="viewcode-block" id="PKPDSampleFitBootstrap.printForPopulation"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleFitBootstrap.printForPopulation">[docs]</a>    <span class="k">def</span> <span class="nf">printForPopulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fh</span><span class="p">,</span><span class="n">observations</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_printSample</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">observations</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">observations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">observations</span></div>

<div class="viewcode-block" id="PKPDSampleFitBootstrap.printForPopulationExcel"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleFitBootstrap.printForPopulationExcel">[docs]</a>    <span class="k">def</span> <span class="nf">printForPopulationExcel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">observations</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">row</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_printSampleExcel</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">observations</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">observations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">observations</span><span class="p">,</span><span class="n">row</span><span class="o">+</span><span class="mi">1</span></div>

    <span class="k">def</span> <span class="nf">_printToStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fh</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Sample name: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;xB: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">xB</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;yB: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">yB</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

            <span class="n">outputStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">n</span><span class="p">,:]:</span>
                <span class="n">outputStr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">parameter</span>
            <span class="n">outputStr</span> <span class="o">+=</span> <span class="s2">&quot; # </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R2</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">AIC</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">AICc</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">BIC</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outputStr</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_printToExcel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">parameterNames</span><span class="p">):</span>
        <span class="n">excelWriteRow</span><span class="p">([</span><span class="s2">&quot;Sample name:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span><span class="p">],</span><span class="n">wb</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">excelWriteRow</span><span class="p">(</span><span class="s2">&quot;Sample </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">n</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span> <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">excelWriteRow</span><span class="p">([</span><span class="s2">&quot;xB:&quot;</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xB</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">wb</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span> <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">excelWriteRow</span><span class="p">([</span><span class="s2">&quot;yB:&quot;</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">yB</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">wb</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span> <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">row</span><span class="o">+</span><span class="mi">1</span>

<div class="viewcode-block" id="PKPDSampleFitBootstrap.restartReadingState"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleFitBootstrap.restartReadingState">[docs]</a>    <span class="k">def</span> <span class="nf">restartReadingState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSampleFitBootstrap</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_NAME</span></div>

<div class="viewcode-block" id="PKPDSampleFitBootstrap.readFromLine"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleFitBootstrap.readFromLine">[docs]</a>    <span class="k">def</span> <span class="nf">readFromLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">==</span><span class="n">PKPDSampleFitBootstrap</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_NAME</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">strRead</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSampleFitBootstrap</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_XB</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">==</span><span class="n">PKPDSampleFitBootstrap</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_XB</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">strRead</span> <span class="o">+=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">strRead</span> <span class="o">+=</span> <span class="n">line</span>
            <span class="k">if</span> <span class="s2">&quot;]&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">strRead</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strRead</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">strRead</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSampleFitBootstrap</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_YB</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">==</span><span class="n">PKPDSampleFitBootstrap</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_YB</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">strRead</span> <span class="o">+=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">strRead</span> <span class="o">+=</span> <span class="n">line</span>
            <span class="k">if</span> <span class="s2">&quot;]&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">strRead</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strRead</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">strRead</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSampleFitBootstrap</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_PARAMETERS</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">==</span><span class="n">PKPDSampleFitBootstrap</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_PARAMETERS</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
            <span class="n">tokensParameters</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">tokensQuality</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tokensParameters</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">prm</span><span class="p">)</span> <span class="k">for</span> <span class="n">prm</span> <span class="ow">in</span> <span class="n">tokensParameters</span><span class="p">]])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">R2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tokensQuality</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tokensQuality</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AIC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tokensQuality</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AICc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tokensQuality</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BIC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tokensQuality</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSampleFitBootstrap</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_XB</span></div>

<div class="viewcode-block" id="PKPDSampleFitBootstrap.copyFromOptimizer"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleFitBootstrap.copyFromOptimizer">[docs]</a>    <span class="k">def</span> <span class="nf">copyFromOptimizer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">optimizer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimizer</span><span class="o">.</span><span class="n">R2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R2adj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimizer</span><span class="o">.</span><span class="n">R2adj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AIC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimizer</span><span class="o">.</span><span class="n">AIC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AICc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimizer</span><span class="o">.</span><span class="n">AICc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BIC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimizer</span><span class="o">.</span><span class="n">BIC</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PKPDFitting"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDFitting">[docs]</a><span class="k">class</span> <span class="nc">PKPDFitting</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="n">READING_FITTING_EXPERIMENT</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">READING_FITTING_PREDICTOR</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">READING_FITTING_PREDICTED</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">READING_FITTING_PREDICTED_LIST</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">READING_FITTING_MODEL</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">READING_POPULATION_HEADER</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">READING_POPULATION</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">READING_SAMPLEFITTINGS_BEGIN</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">READING_SAMPLEFITTINGS_CONTINUE</span> <span class="o">=</span> <span class="mi">9</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnFitting</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnExperiment</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelDescription</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelParameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelParameterUnits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampleFits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampleFittingClass</span> <span class="o">=</span> <span class="s2">&quot;PKPDSampleFit&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampleFittingClass</span> <span class="o">=</span> <span class="bp">cls</span>

<div class="viewcode-block" id="PKPDFitting.isPopulation"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDFitting.isPopulation">[docs]</a>    <span class="k">def</span> <span class="nf">isPopulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnFitting</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnFitting</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;bootstrapPopulation.pkpd&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDFitting.write"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDFitting.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnFitting</span><span class="p">,</span> <span class="n">writeToExcel</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fnFitting</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnFitting</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">fnFitting</span><span class="p">)</span>
        <span class="n">writeMD5</span><span class="p">(</span><span class="n">fnFitting</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">writeToExcel</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writeToExcel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fnFitting</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.xlsx&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDFitting.getAllParameters"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDFitting.getAllParameters">[docs]</a>    <span class="k">def</span> <span class="nf">getAllParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">allParameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelParameters</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sampleFitting</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampleFits</span><span class="p">:</span>
            <span class="n">allParameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">allParameters</span><span class="p">,</span> <span class="n">sampleFitting</span><span class="o">.</span><span class="n">parameters</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">allParameters</span></div>

<div class="viewcode-block" id="PKPDFitting.getStats"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDFitting.getStats">[docs]</a>    <span class="k">def</span> <span class="nf">getStats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">observations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">observations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllParameters</span><span class="p">()</span>
        <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">C</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">observations</span><span class="p">))</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">C</span><span class="p">))</span>
        <span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">observations</span><span class="p">))</span>
        <span class="n">percentiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">observations</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">percentiles</span></div>

    <span class="k">def</span> <span class="nf">_printToStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fh</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[FITTING] ===========================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Experiment: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">fnExperiment</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Predictor (X): &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Predicted (Y): &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Predicted list=</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="p">:</span>
                <span class="n">y</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Model: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">modelDescription</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[POPULATION PARAMETERS] =============</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">auxUnit</span> <span class="o">=</span> <span class="n">PKPDUnit</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">paramName</span><span class="p">,</span> <span class="n">paramUnits</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelParameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelParameterUnits</span><span class="p">):</span>
            <span class="n">auxUnit</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">paramUnits</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">] &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">paramName</span><span class="p">,</span><span class="n">auxUnit</span><span class="o">.</span><span class="n">_toString</span><span class="p">()))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; # R2 R2adj AIC AICc BIC</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelParameters</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sampleFitting</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampleFits</span><span class="p">:</span>
            <span class="n">observations</span> <span class="o">=</span> <span class="n">sampleFitting</span><span class="o">.</span><span class="n">printForPopulation</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span><span class="n">observations</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">observations</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">C</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">observations</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">1.0</span><span class="p">])</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="n">C</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">observations</span><span class="p">))</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">C</span><span class="p">))</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Mean   parameters  = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Median parameters  = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">observations</span><span class="p">,[</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">97.5</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Lower bound (2.5</span><span class="si">%%</span><span class="s2">) = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Upper bound (97.5</span><span class="si">%%</span><span class="s2">) = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Covariance matrix  =</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">max_line_width</span><span class="o">=</span><span class="mi">120</span><span class="p">))</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Correlation matrix  =</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">max_line_width</span><span class="o">=</span><span class="mi">120</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[SAMPLE FITTINGS] ===================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sampleFitting</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampleFits</span><span class="p">:</span>
            <span class="n">sampleFitting</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>

<div class="viewcode-block" id="PKPDFitting.writeToExcel"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDFitting.writeToExcel">[docs]</a>    <span class="k">def</span> <span class="nf">writeToExcel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fnXls</span><span class="p">):</span>
        <span class="n">wb</span> <span class="o">=</span> <span class="n">openpyxl</span><span class="o">.</span><span class="n">Workbook</span><span class="p">()</span>
        <span class="n">wb</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Experiment&quot;</span>

        <span class="n">currentRow</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">excelWriteRow</span><span class="p">(</span><span class="s2">&quot;FITTING&quot;</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">,</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">excelFillCells</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">excelWriteRow</span><span class="p">([</span><span class="s2">&quot;Experiment:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fnExperiment</span><span class="o">.</span><span class="n">get</span><span class="p">()],</span> <span class="n">wb</span><span class="p">,</span> <span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">excelWriteRow</span><span class="p">(</span><span class="s2">&quot;Predictor (X): &quot;</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">currentRow</span><span class="p">);</span>
        <span class="n">currentRow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predictor</span><span class="o">.</span><span class="n">_printToExcel</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">toPrint</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Predicted (Y): &quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
            <span class="n">excelWriteRow</span><span class="p">(</span><span class="n">toPrint</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;Predicted list=</span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="p">)],</span> <span class="n">wb</span><span class="p">,</span> <span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="p">:</span>
                <span class="n">currentRow</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">_printToExcel</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">excelWriteRow</span><span class="p">(</span><span class="n">toPrint</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">currentRow</span><span class="p">)</span>
            <span class="n">currentRow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="o">.</span><span class="n">_printToExcel</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">excelWriteRow</span><span class="p">([</span><span class="s2">&quot;Model:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">modelDescription</span><span class="p">],</span> <span class="n">wb</span><span class="p">,</span> <span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>

        <span class="n">excelWriteRow</span><span class="p">(</span><span class="s2">&quot;POPULATION PARAMETERS&quot;</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">,</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">excelFillCells</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">auxUnit</span> <span class="o">=</span> <span class="n">PKPDUnit</span><span class="p">()</span>
        <span class="n">toPrint</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">paramName</span><span class="p">,</span> <span class="n">paramUnits</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelParameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelParameterUnits</span><span class="p">):</span>
            <span class="n">auxUnit</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">paramUnits</span>
            <span class="n">toPrint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">] &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">paramName</span><span class="p">,</span><span class="n">auxUnit</span><span class="o">.</span><span class="n">_toString</span><span class="p">()))</span>
        <span class="n">excelWriteRow</span><span class="p">(</span><span class="n">toPrint</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;R2&quot;</span><span class="p">,</span><span class="s2">&quot;R2adj&quot;</span><span class="p">,</span><span class="s2">&quot;AIC&quot;</span><span class="p">,</span><span class="s2">&quot;AICc&quot;</span><span class="p">,</span><span class="s2">&quot;BIC&quot;</span><span class="p">],</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelParameters</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sampleFitting</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampleFits</span><span class="p">:</span>
            <span class="n">observations</span><span class="p">,</span> <span class="n">currentRow</span> <span class="o">=</span> <span class="n">sampleFitting</span><span class="o">.</span><span class="n">printForPopulationExcel</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">,</span><span class="n">observations</span><span class="p">)</span>
        <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>

        <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">observations</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">excelWriteRow</span><span class="p">([</span><span class="s2">&quot;Mean   parameters  =&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">mu</span><span class="p">)],</span> <span class="n">wb</span><span class="p">,</span> <span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">excelWriteRow</span><span class="p">([</span><span class="s2">&quot;Median parameters  =&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))],</span> <span class="n">wb</span><span class="p">,</span> <span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">observations</span><span class="p">,[</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">97.5</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">excelWriteRow</span><span class="p">([</span><span class="s2">&quot;Lower bound (2.5</span><span class="si">%%</span><span class="s2">) =&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> <span class="n">wb</span><span class="p">,</span> <span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">excelWriteRow</span><span class="p">([</span><span class="s2">&quot;Upper bound (97.5</span><span class="si">%%</span><span class="s2">) =&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span> <span class="n">wb</span><span class="p">,</span> <span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>

        <span class="n">excelWriteRow</span><span class="p">(</span><span class="s2">&quot;SAMPLE FITTINGS&quot;</span><span class="p">,</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">,</span><span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">excelFillCells</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">);</span> <span class="n">currentRow</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">sampleFitting</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampleFits</span><span class="p">:</span>
            <span class="n">currentRow</span><span class="o">=</span><span class="n">sampleFitting</span><span class="o">.</span><span class="n">_printToExcel</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="n">currentRow</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">modelParameters</span><span class="p">)</span>

        <span class="n">excelAdjustColumnWidths</span><span class="p">(</span><span class="n">wb</span><span class="p">)</span>
        <span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fnXls</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDFitting.load"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDFitting.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnFitting</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">fnFitting</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fnFitting</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnFitting</span><span class="p">)</span>
        <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fnFitting</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fh</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot open </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fnFitting</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verifyMD5</span><span class="p">(</span><span class="n">fnFitting</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> has been modified since its creation&quot;</span> <span class="o">%</span> <span class="n">fnFitting</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnFitting</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">fnFitting</span><span class="p">)</span>

        <span class="n">auxUnit</span> <span class="o">=</span> <span class="n">PKPDUnit</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_CONTINUE</span><span class="p">:</span>
                     <span class="n">state</span><span class="o">=</span><span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_BEGIN</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">):</span>
                <span class="n">section</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[fitting]&quot;</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_FITTING_EXPERIMENT</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[population parameters]&quot;</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_POPULATION_HEADER</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[sample fittings]&quot;</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_BEGIN</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping: &quot;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_FITTING_EXPERIMENT</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fnExperiment</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_FITTING_PREDICTOR</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_FITTING_PREDICTOR</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span><span class="o">.</span><span class="n">parseTokens</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_FITTING_PREDICTED</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_FITTING_PREDICTED</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Predicted list&quot;</span><span class="p">)):</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_FITTING_PREDICTED_LIST</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remainingPredicted</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="o">.</span><span class="n">parseTokens</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_FITTING_MODEL</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_FITTING_PREDICTED_LIST</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">newVar</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="p">()</span>
                    <span class="n">newVar</span><span class="o">.</span><span class="n">parseTokens</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newVar</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remainingPredicted</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remainingPredicted</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_FITTING_MODEL</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_FITTING_MODEL</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">modelDescription</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_POPULATION</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_POPULATION_HEADER</span><span class="p">:</span>
                <span class="n">lineParts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">lineParts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">modelParameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">modelParameterUnits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auxUnit</span><span class="o">.</span><span class="n">_fromString</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_POPULATION</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_POPULATION</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_BEGIN</span><span class="p">:</span>
                <span class="n">newSampleFit</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">()&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">sampleFittingClass</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sampleFits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newSampleFit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sampleFits</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">restartReadingState</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sampleFits</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">readFromLine</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_CONTINUE</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDFitting</span><span class="o">.</span><span class="n">READING_SAMPLEFITTINGS_CONTINUE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sampleFits</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">readFromLine</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="PKPDFitting.getSampleFit"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDFitting.getSampleFit">[docs]</a>    <span class="k">def</span> <span class="nf">getSampleFit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampleName</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sampleFit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampleFits</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sampleFit</span><span class="o">.</span><span class="n">sampleName</span> <span class="o">==</span> <span class="n">sampleName</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sampleFit</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="PKPDFitting.loadExperiment"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDFitting.loadExperiment">[docs]</a>    <span class="k">def</span> <span class="nf">loadExperiment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">experiment</span> <span class="o">=</span> <span class="n">PKPDExperiment</span><span class="p">()</span>
        <span class="n">experiment</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnExperiment</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">experiment</span></div>

<div class="viewcode-block" id="PKPDFitting.getTimeUnits"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDFitting.getTimeUnits">[docs]</a>    <span class="k">def</span> <span class="nf">getTimeUnits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadExperiment</span><span class="p">()</span><span class="o">.</span><span class="n">getTimeUnits</span><span class="p">()</span></div>

<div class="viewcode-block" id="PKPDFitting.gather"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDFitting.gather">[docs]</a>    <span class="k">def</span> <span class="nf">gather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">otherFitting</span><span class="p">,</span> <span class="n">experiment</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">otherFitting</span><span class="o">.</span><span class="n">predictor</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">otherFitting</span><span class="o">.</span><span class="n">predicted</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelDescription</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modelDescription</span> <span class="o">=</span> <span class="n">otherFitting</span><span class="o">.</span><span class="n">modelDescription</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelParameters</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modelParameters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">otherFitting</span><span class="o">.</span><span class="n">modelParameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelParameterUnits</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modelParameterUnits</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">otherFitting</span><span class="o">.</span><span class="n">modelParameterUnits</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">fit</span> <span class="ow">in</span> <span class="n">otherFitting</span><span class="o">.</span><span class="n">sampleFits</span><span class="p">:</span>
            <span class="n">add</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">experiment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fit</span><span class="o">.</span><span class="n">sampleName</span> <span class="ow">in</span> <span class="n">experiment</span><span class="o">.</span><span class="n">samples</span><span class="p">:</span>
                    <span class="n">add</span><span class="o">=</span><span class="kc">False</span>
            <span class="k">if</span> <span class="n">add</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sampleFits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">fit</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="PKPDSampleSignalAnalysis"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSampleSignalAnalysis">[docs]</a><span class="k">class</span> <span class="nc">PKPDSampleSignalAnalysis</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisVariables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lowerBound</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upperBound</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">significance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_printToStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fh</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">significance</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">significance</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Undetermined&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Sample name: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">sampleName</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">varName</span><span class="p">,</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">izip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisVariables</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">):</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span><span class="n">parameter</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PKPDSignalAnalysis"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSignalAnalysis">[docs]</a><span class="k">class</span> <span class="nc">PKPDSignalAnalysis</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="n">READING_EXPERIMENT</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">READING_PREDICTOR</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">READING_PREDICTED</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">READING_MODEL</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">READING_ANALYSIS_VARIABLES</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">READING_POPULATION_HEADER</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">READING_POPULATION</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">READING_SAMPLEANALYSIS_NAME</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">READING_SAMPLEANALYSIS_PARAMETERS</span> <span class="o">=</span> <span class="mi">9</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnAnalysis</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnExperiment</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisDescription</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisParameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampleAnalyses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="PKPDSignalAnalysis.write"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSignalAnalysis.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnAnalysis</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fnAnalysis</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnAnalysis</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">fnAnalysis</span><span class="p">)</span>
        <span class="n">writeMD5</span><span class="p">(</span><span class="n">fnAnalysis</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_printToStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fh</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[SIGNAL ANALYSIS] ===========================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Experiment: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">fnExperiment</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Predictor (X): &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Predicted (Y): &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Analysis: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisDescription</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[POPULATION PARAMETERS] =============</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisParameters</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">sampleAnalysis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampleAnalyses</span><span class="p">:</span>
            <span class="n">outputStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">j</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">sampleAnalysis</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="n">outputStr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">parameter</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sampleAnalyses</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">sampleAnalysis</span><span class="o">.</span><span class="n">parameters</span><span class="p">)])</span>
                <span class="n">observations</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">parameter</span>
                <span class="n">j</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outputStr</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">C</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">observations</span><span class="p">))</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">C</span><span class="p">))</span>
        <span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">observations</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Mean   parameters  = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Median parameters  = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Lower bound (95</span><span class="si">%%</span><span class="s2">, independent Gaussians) = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">mu</span><span class="o">-</span><span class="mf">1.96</span><span class="o">*</span><span class="n">sigma</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Upper bound (95</span><span class="si">%%</span><span class="s2">, independent Gaussians) = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">mu</span><span class="o">+</span><span class="mf">1.96</span><span class="o">*</span><span class="n">sigma</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Covariance matrix  =</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">max_line_width</span><span class="o">=</span><span class="mi">120</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Correlation matrix  =</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">max_line_width</span><span class="o">=</span><span class="mi">120</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[SAMPLE ANALYSES] ===================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sampleAnalysis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampleAnalyses</span><span class="p">:</span>
            <span class="n">sampleAnalysis</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>

<div class="viewcode-block" id="PKPDSignalAnalysis.load"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSignalAnalysis.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fnAnalysis</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fnAnalysis</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fh</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot open </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">fnAnalysis</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verifyMD5</span><span class="p">(</span><span class="n">fnAnalysis</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> has been modified since its creation&quot;</span><span class="o">%</span><span class="n">fnAnalysis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnAnalysis</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">fnAnalysis</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_SAMPLEANALYSIS_PARAMETERS</span><span class="p">:</span>
                     <span class="n">state</span><span class="o">=</span><span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_SAMPLEANALYSIS_NAME</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">):</span>
                <span class="n">section</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[signal analysis]&quot;</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_EXPERIMENT</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[population parameters]&quot;</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_POPULATION_HEADER</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[sample analyses]&quot;</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_SAMPLEANALYSIS_NAME</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping: &quot;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_EXPERIMENT</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fnExperiment</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_PREDICTOR</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_PREDICTOR</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span><span class="o">.</span><span class="n">parseTokens</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_PREDICTED</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_PREDICTED</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span> <span class="o">=</span> <span class="n">PKPDVariable</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predicted</span><span class="o">.</span><span class="n">parseTokens</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_MODEL</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_MODEL</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analysisDescription</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_POPULATION</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_POPULATION_HEADER</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analysisParameters</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_POPULATION</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_POPULATION</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">summaryLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_SAMPLEANALYSIS_NAME</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sampleAnalyses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PKPDSampleSignalAnalysis</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sampleAnalyses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sampleName</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sampleAnalyses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_SAMPLEANALYSIS_PARAMETERS</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDSignalAnalysis</span><span class="o">.</span><span class="n">READING_SAMPLEANALYSIS_PARAMETERS</span><span class="p">:</span>
                <span class="n">tokens</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sampleAnalyses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">analysisVariables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sampleAnalyses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="PKPDSignalAnalysis.getSampleAnalysis"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDSignalAnalysis.getSampleAnalysis">[docs]</a>    <span class="k">def</span> <span class="nf">getSampleAnalysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sampleName</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sampleAnalysis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampleAnalyses</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sampleAnalysis</span><span class="o">.</span><span class="n">sampleName</span> <span class="o">==</span> <span class="n">sampleName</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sampleAnalysis</span>
        <span class="k">return</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="PKPDAllometricScale"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDAllometricScale">[docs]</a><span class="k">class</span> <span class="nc">PKPDAllometricScale</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="n">READING_PREDICTOR</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">READING_MODELS</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">READING_X</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">READING_Y</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnScale</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictorUnits</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaled_vars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">averaged_vars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qualifiers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="PKPDAllometricScale.write"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDAllometricScale.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnScale</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fnScale</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_printToStream</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnScale</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">fnScale</span><span class="p">)</span>
        <span class="n">writeMD5</span><span class="p">(</span><span class="n">fnScale</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_printToStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fh</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[ALLOMETRIC SCALING] ===========================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Predictor (X): </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictor</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">predictorUnits</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">varName</span><span class="p">,</span> <span class="n">varUnits</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_vars</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span>
            <span class="n">qualifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span>
            <span class="c1"># fh.write(&quot;Scale model: %s=(%f)*%s^(%f) %f%% Confidence interval=[%f,%f]&quot;%\</span>
            <span class="c1">#          (varName,model[0],model[1],self.confidence,qualifiers[0],qualifiers[1]))</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Scale model: </span><span class="si">%s</span><span class="s2">=(</span><span class="si">%f</span><span class="s2">)*</span><span class="si">%s</span><span class="s2">^(</span><span class="si">%f</span><span class="s2">); R2=</span><span class="si">%f</span><span class="s2">; </span><span class="si">%f%%</span><span class="s2"> Confidence intervals (y=k*x^a) k=[</span><span class="si">%f</span><span class="s2">,</span><span class="si">%f</span><span class="s2">] a=[</span><span class="si">%f</span><span class="s2">,</span><span class="si">%f</span><span class="s2">]; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> \
                     <span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span><span class="p">,</span> <span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">qualifiers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">confidence</span><span class="p">,</span>
                      <span class="n">qualifiers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">qualifiers</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">qualifiers</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">qualifiers</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">varUnits</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">varName</span><span class="p">,</span> <span class="n">varUnits</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">averaged_vars</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span>
            <span class="n">qualifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Average model: </span><span class="si">%s</span><span class="s2">=</span><span class="si">%f</span><span class="s2"> Std=</span><span class="si">%f</span><span class="s2">; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">qualifiers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">varUnits</span><span class="p">))</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[DATA] =========================================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">= </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictor</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">varName</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">= </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>

<div class="viewcode-block" id="PKPDAllometricScale.load"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDAllometricScale.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fnScale</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fnScale</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fh</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot open </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">fnScale</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verifyMD5</span><span class="p">(</span><span class="n">fnScale</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> has been modified since its creation&quot;</span><span class="o">%</span><span class="n">fnScale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnScale</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">fnScale</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">):</span>
                <span class="n">section</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[allometric scaling]&quot;</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDAllometricScale</span><span class="o">.</span><span class="n">READING_PREDICTOR</span>
                <span class="k">elif</span> <span class="n">section</span><span class="o">==</span><span class="s2">&quot;[data]&quot;</span><span class="p">:</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">PKPDAllometricScale</span><span class="o">.</span><span class="n">READING_X</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping: &quot;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDAllometricScale</span><span class="o">.</span><span class="n">READING_PREDICTOR</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predictor</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predictorUnits</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDAllometricScale</span><span class="o">.</span><span class="n">READING_MODELS</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDAllometricScale</span><span class="o">.</span><span class="n">READING_MODELS</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;Scale model&quot;</span><span class="p">:</span>
                    <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                    <span class="c1"># &quot;%s=(%f)*%s^(%f); R2=%f; %f%% Confidence intervals (y=k*x^a) k=[%f,%f] a=[%f,%f]&quot;</span>
                    <span class="n">idxL</span><span class="o">=</span><span class="mi">0</span>
                    <span class="n">idxR</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                    <span class="n">varName</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idxL</span><span class="p">:</span><span class="n">idxR</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">idxL</span><span class="o">=</span><span class="n">idxR</span><span class="o">+</span><span class="mi">2</span>
                    <span class="n">idxR</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="n">idxL</span><span class="p">)</span>
                    <span class="n">k</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idxL</span><span class="p">:</span><span class="n">idxR</span><span class="p">])</span>
                    <span class="n">idxL</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="n">idxR</span><span class="p">)</span>
                    <span class="n">idxR</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="n">idxL</span><span class="p">)</span>
                    <span class="n">a</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idxL</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">idxR</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span>

                    <span class="n">idxL</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                    <span class="n">R2</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">idxL</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>

                    <span class="n">idxR</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">confidence</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="n">idxR</span><span class="p">])</span>

                    <span class="n">idxL</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span><span class="n">idxR</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">idxR</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">idxL</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">kl</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">idxL</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">idxR</span><span class="p">])</span>
                    <span class="n">idxL</span><span class="o">=</span><span class="n">idxR</span>
                    <span class="n">idxR</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="n">idxL</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">ku</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">idxL</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">idxR</span><span class="p">])</span>

                    <span class="n">idxL</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span><span class="n">idxR</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">idxR</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">idxL</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">al</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">idxL</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">idxR</span><span class="p">])</span>
                    <span class="n">idxL</span><span class="o">=</span><span class="n">idxR</span>
                    <span class="n">idxR</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="n">idxL</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">au</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">idxL</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">idxR</span><span class="p">])</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">R2</span><span class="p">,</span><span class="n">kl</span><span class="p">,</span><span class="n">ku</span><span class="p">,</span><span class="n">al</span><span class="p">,</span><span class="n">au</span><span class="p">]</span>

                    <span class="n">varUnits</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scaled_vars</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">varName</span><span class="p">,</span><span class="n">varUnits</span><span class="p">))</span>

                <span class="k">elif</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;Average model&quot;</span><span class="p">:</span>
                    <span class="c1"># Average model: %s=%f Std=%f</span>
                    <span class="n">idxR</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                    <span class="n">varName</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="n">idxR</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">idxL</span><span class="o">=</span><span class="n">idxR</span>
                    <span class="n">idxR</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="n">idxL</span><span class="p">)</span>
                    <span class="n">mean</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">idxL</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">idxR</span><span class="p">])</span>
                    <span class="n">idxL</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">idxR</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">idxR</span><span class="o">=</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="n">idxL</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">std</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">idxL</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">idxR</span><span class="p">])</span>
                    <span class="n">varUnits</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">idxR</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">mean</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">std</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">averaged_vars</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">varName</span><span class="p">,</span><span class="n">varUnits</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping: &quot;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDAllometricScale</span><span class="o">.</span><span class="n">READING_X</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">PKPDAllometricScale</span><span class="o">.</span><span class="n">READING_Y</span>

            <span class="k">elif</span> <span class="n">state</span><span class="o">==</span><span class="n">PKPDAllometricScale</span><span class="o">.</span><span class="n">READING_Y</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">varName</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="PKPDDoseResponse"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDDoseResponse">[docs]</a><span class="k">class</span> <span class="nc">PKPDDoseResponse</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nresponses</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Npatients</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="o">=</span><span class="p">[]</span>

<div class="viewcode-block" id="PKPDDoseResponse.read"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDDoseResponse.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">inputStr</span><span class="p">,</span><span class="n">isFn</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">isFn</span><span class="p">:</span>
            <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">inputStr</span><span class="p">)</span>
            <span class="n">inputStr</span><span class="o">=</span><span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputStr</span><span class="o">=</span><span class="n">inputStr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">inputStr</span><span class="p">:</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">tokens</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                <span class="n">dose</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dose</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                <span class="n">k</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                    <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;1&quot;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Nresponses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Npatients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDDoseResponse.write"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDDoseResponse.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fnOut</span><span class="p">):</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fnOut</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="p">)):</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="PKPDDoseResponse.findDose"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDDoseResponse.findDose">[docs]</a>    <span class="k">def</span> <span class="nf">findDose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dose</span><span class="p">):</span>
        <span class="c1"># for n in range(len(self.doses)):</span>
        <span class="c1">#     if abs(self.doses[n]-dose)&lt;1e-6:</span>
        <span class="c1">#         return n</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">dose</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-6</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="PKPDDoseResponse.appendResponse"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDDoseResponse.appendResponse">[docs]</a>    <span class="k">def</span> <span class="nf">appendResponse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dose</span><span class="p">,</span><span class="n">response</span><span class="p">):</span>
        <span class="c1"># response must be Boolean</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findDose</span><span class="p">(</span><span class="n">dose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nresponses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Npatients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">responseStr</span><span class="o">=</span><span class="s2">&quot; 1&quot;</span> <span class="k">if</span> <span class="n">response</span> <span class="k">else</span> <span class="s2">&quot; 0&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">responses</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">+</span><span class="n">responseStr</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Npatients</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nresponses</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span></div></div>


<div class="viewcode-block" id="flattenArray"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.flattenArray">[docs]</a><span class="k">def</span> <span class="nf">flattenArray</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">y</span></div>

<div class="viewcode-block" id="smartLog"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.smartLog">[docs]</a><span class="k">def</span> <span class="nf">smartLog</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span> <span class="ow">and</span> <span class="n">yi</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="n">y</span><span class="p">])</span></div>


<div class="viewcode-block" id="PKPDDataSet"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDDataSet">[docs]</a><span class="k">class</span> <span class="nc">PKPDDataSet</span><span class="p">:</span>
    <span class="n">_datasetDict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># store all created datasets</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Params:</span>

<span class="sd">        #filesDict is dict with key, value pairs for each file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datasetDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">folder</span>
        <span class="kn">import</span> <span class="nn">pkg_resources</span>
        <span class="n">package</span> <span class="o">=</span> <span class="n">PluginInfo</span><span class="p">(</span><span class="s1">&#39;scipion-pkpd&#39;</span><span class="p">,</span> <span class="s1">&#39;scipion-pkpd&#39;</span><span class="p">,</span>
                             <span class="n">remote</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">pipName</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">get_distribution</span><span class="p">(</span><span class="n">package</span><span class="p">)</span><span class="o">.</span><span class="n">location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="s1">&#39;pkpd&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filesDict</span> <span class="o">=</span> <span class="n">files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>

<div class="viewcode-block" id="PKPDDataSet.getFile"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDDataSet.getFile">[docs]</a>    <span class="k">def</span> <span class="nf">getFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesDict</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesDict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="PKPDDataSet.getPath"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDDataSet.getPath">[docs]</a>    <span class="k">def</span> <span class="nf">getPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span></div>

<div class="viewcode-block" id="PKPDDataSet.getDataSet"><a class="viewcode-back" href="../../api/pkpd/pkpd.objects.html#pkpd.objects.PKPDDataSet.getDataSet">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getDataSet</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is called every time the dataset want to be retrieved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_datasetDict</span><span class="p">,</span> <span class="s2">&quot;Dataset: </span><span class="si">%s</span><span class="s2"> dataset doesn&#39;t exist.&quot;</span> <span class="o">%</span> <span class="n">name</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_datasetDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39; -u &#39;</span> <span class="o">+</span> <span class="n">ds</span><span class="o">.</span><span class="n">url</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">pwutils</span><span class="o">.</span><span class="n">envVarOn</span><span class="p">(</span><span class="s1">&#39;SCIPION_TEST_NOSYNC&#39;</span><span class="p">):</span>
            <span class="n">command</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> testdata --download </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span>
                       <span class="o">%</span> <span class="p">(</span><span class="n">pw</span><span class="o">.</span><span class="n">PYTHON</span><span class="p">,</span> <span class="n">pw</span><span class="o">.</span><span class="n">getSyncDataScript</span><span class="p">(),</span> <span class="n">folder</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&gt;&gt; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">command</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_datasetDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: release-3.0.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../dependabot_pip_jinja2-2.10.1/index.html">dependabot/pip/jinja2-2.10.1</a></dd>
            <dd><a href="../../../gh-pages/index.html">gh-pages</a></dd>
            <dd><a href="../../../release-2.0.0/index.html">release-2.0.0</a></dd>
            <dd><a href="objects.html">release-3.0.0</a></dd>
            <dd><a href="../../../rsanchezgarc-patch-1/index.html">rsanchezgarc-patch-1</a></dd>
            <dd><a href="../../../vtune/index.html">vtune</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>