

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Debugging Scipion with PyCharm &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scipion-modes/how-to-install.html">Installing Scipion v3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../facilities/facilities.html">On-the-fly processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../facilities/customize-report.html">Summary Reports</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/scipion-API.html">Scipion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/plugins-API.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/xmipp-API.html">Xmipp API</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
      <li>Debugging Scipion with PyCharm</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/docs/developer/tutorials/debugging-scipion.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="figure">
<a class="reference internal image-reference" href="../../../_images/scipion_logo.gif"><img alt="scipion logo" src="../../../_images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="debugging-scipion-with-pycharm">
<span id="debugging-scipion"></span><h1>Debugging Scipion with PyCharm<a class="headerlink" href="#debugging-scipion-with-pycharm" title="Permalink to this headline">¶</a></h1>
<div class="section" id="associated-resources">
<h2>Associated resources<a class="headerlink" href="#associated-resources" title="Permalink to this headline">¶</a></h2>
<p>Here you can find resources associated with this content, like videos or presentations used in courses:</p>
<p><a class="reference external" href="https://docs.google.com/presentation/d/1gUhKki2Oz-isd6-ZtrjMmA1rk21EoWMGaK-7gWVNvAY/present?usp=sharing">Course presentation</a></p>
<p><a class="reference external" href="../pycharm">Configuring PyCharm</a></p>
</div>
<div class="section" id="practice">
<h2>Practice<a class="headerlink" href="#practice" title="Permalink to this headline">¶</a></h2>
<p>We assume you have Scipion3 installed and <a class="reference external" href="../pycharm">PyCharm configured</a></p>
<p>We will learn how to add run configurations to skip scipion3 launcher and to be able to use
PyCharm “debug” button straight away with many of the Scipion modes (tests, project, config, …)
We will also learn how to attach to a “protocol process” to debug its steps.</p>
</div>
<div class="section" id="cloning-and-installing-scipion-em-template">
<h2>Cloning and installing scipion-em-template<a class="headerlink" href="#cloning-and-installing-scipion-em-template" title="Permalink to this headline">¶</a></h2>
<p>If you are following a course you might already have done this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> desired/location
git clone https://github.com/scipion-em/scipion-em-template.git
<span class="nb">cd</span> scipion3/location
./scipion3 installp -p scipion-em-template/location --devel
</pre></div>
</div>
</div>
<div class="section" id="checking-out-the-empiar-download-branch">
<h2>Checking out the empiar_download branch<a class="headerlink" href="#checking-out-the-empiar-download-branch" title="Permalink to this headline">¶</a></h2>
<p>Check out the empiar_download branch</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git checkout empiar_download
</pre></div>
</div>
</div>
<div class="section" id="creating-the-debugging-project">
<h2>Creating the debugging project<a class="headerlink" href="#creating-the-debugging-project" title="Permalink to this headline">¶</a></h2>
<p>Open Scipion and create a new project called “debugging”.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The name is not relevant but we’ll be referring to the project or folders associated
using that name from now on.</p>
</div>
<p>Find (Ctrl+F) the “myplugin - empiar downloader” protocol and save it. No need to execute it for now. You can close Scipion.</p>
</div>
<div class="section" id="skipping-the-scipion3-launcher-in-pycharm-configurations">
<h2>Skipping the scipion3 launcher in PyCharm configurations<a class="headerlink" href="#skipping-the-scipion3-launcher-in-pycharm-configurations" title="Permalink to this headline">¶</a></h2>
<p>Add a new PyCharm configuration: it can be used to easily execute commands in one click. To create a new configuration, click on <strong>Add Configuration</strong> &gt; <strong>+</strong> &gt; <strong>python</strong>:</p>
<blockquote>
<div><div class="figure">
<img alt="pycharm create configuration" src="../../../_images/pycharm_create_configuration.png" />
</div>
</div></blockquote>
<p>Set the values according to the image below</p>
<blockquote>
<div><div class="figure">
<img alt="pycharm create direct configuration" src="../../../_images/pycharm_config_direct.png" />
</div>
</div></blockquote>
<ol class="arabic simple">
<li><em>Name</em>: scipion3 last.</li>
<li><em>Module name</em>: Choose module name in the dropdown list instead of the script and then choose “scipion”</li>
<li><em>Parameters</em>: enter “last”. This will open directly the last modified project.</li>
<li><em>Environment variables</em>: You need to set 2 of them</li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li>SCIPION_HOME=/path/where/scipion/is/installed</li>
<li>LD_LIBRARY_PATH=/path/where/scipion/is/installed/software/lib</li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><em>Python interpreter</em>: /path/to/.scipion3env/bin/python</li>
<li><em>Working directory</em>: same as SCIPION_HOME</li>
</ol>
<p>“Apply” and you’ll have now a “direct” run/debug PyCharm configuration.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Duplicating this configuration  and changing the “Parameters” field and “Name” will provide you more direct run
configurations for other scipion modes like “tests”, “config”, … Type <cite>scipion3 help</cite> to discover them.</p>
</div>
</div>
<div class="section" id="testing-the-direct-configuration">
<h2>Testing the direct configuration<a class="headerlink" href="#testing-the-direct-configuration" title="Permalink to this headline">¶</a></h2>
<p>Set a breakpoint at <code class="docutils literal notranslate"><span class="pre">scipion-app/scipion/__main__.py</span></code> in the first import line by
clicking in the empty space between the line number and the import line. A red dot should appear</p>
<p>Click on the “Green bug” icon, or on Run&gt;&gt;Debug</p>
<p>PyCharm should stop execution at that breakpoint line.</p>
<p>Checkout this <a class="reference external" href="https://www.jetbrains.com/help/pycharm/2020.2/debugging-code.html?utm_source=product&amp;utm_medium=link&amp;utm_campaign=PY&amp;utm_content=2020.2#debug">page</a>
to learn more about debugging in PyCharm.</p>
</div>
<div class="section" id="debugging-the-click-on-execute-button">
<h2>Debugging the click on “Execute” button<a class="headerlink" href="#debugging-the-click-on-execute-button" title="Permalink to this headline">¶</a></h2>
<p>Let’s debug what happens when you click on the “Execute” button in the protocol form.
Set a breakpoint in <strong>scipion-pyworkflow/pyworkflow/gui/form.py</strong> at <code class="docutils literal notranslate"><span class="pre">FormWindow.execute</span></code>
Don’t worry if you don’t understand all the code here.
Click on the debug icon. The last project should open (<em>debugging project</em>). Edit the saved protocol and click on the “Execute” button.</p>
<blockquote>
<div><div class="figure">
<img alt="Ready to debug the click on Execute button" src="../../../_images/streaming-execute.png" />
</div>
</div></blockquote>
<p>Try to understand:</p>
<ol class="arabic simple">
<li>How the protocol validation happens?</li>
</ol>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you find hard to reach the <em>protocol._validate</em> method from the <em>execute</em>,
set a breakpoint in the <strong>myplugin/protocols/protocol_empiar_download</strong> at <code class="docutils literal notranslate"><span class="pre">EmpiarDownloader._validate</span></code>
and wait there.</p>
</div>
<ol class="arabic simple" start="2">
<li>Try to reach the point where the new process for the protocol is created (at <code class="docutils literal notranslate"><span class="pre">pyworkflow.protocol.launch._launchLocal</span></code>)</li>
</ol>
</div>
<div class="section" id="debugging-the-protocol-execution">
<h2>Debugging the protocol execution<a class="headerlink" href="#debugging-the-protocol-execution" title="Permalink to this headline">¶</a></h2>
<p>Protocol execution happens in a new process. There is no way to reach it using the “IDE debugging” configuration.
For this you need to be able to attach to the protocol’s process. It is very likely that the executing code will be faster
than you, clicking on the IDE menus to attach to the process. Thus, you need to “delay” the execution using <em>sleep(10)</em>.</p>
<div class="section" id="delaying-temporarily-the-protocol-process">
<h3>Delaying “TEMPORARILY” the protocol process<a class="headerlink" href="#delaying-temporarily-the-protocol-process" title="Permalink to this headline">¶</a></h3>
<p>Go to <em>pyworkflow.apps.py_protocol_run.py</em> and add the TEMPORARY delay after the “if __main__” check:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This will give you some time.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Do not forget to remove the <code class="docutils literal notranslate"><span class="pre">time.sleep(10)</span></code> when done or you’ll be delaying execution by 10 seconds</p>
</div>
<p>Now, edit the “empiar-downloader” protocol and execute it.
Go back to PyCharm and click on <strong>Run</strong> &gt; <strong>Attach to process</strong> (a window should pop up with a list of python processes)
Look for the one like <code class="docutils literal notranslate"><span class="pre">/path/to/pyworkflow/apps/pw_protocol_run.py</span> <span class="pre">/path/to/project/Runs/000353_EmpiarDownloader/logs/run.db</span> <span class="pre">353</span></code></p>
<img alt="PyCharm attach to process window" src="../../../_images/pycharm_attach.png" />
<p>Other frequent debugging points to add the <code class="docutils literal notranslate"><span class="pre">sleep</span></code> to are <code class="docutils literal notranslate"><span class="pre">_insertAllSteps</span></code>, or a specific step method.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: dependabot/pip/jinja2-2.10.1
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="debugging-scipion.html">dependabot/pip/jinja2-2.10.1</a></dd>
            <dd><a href="../../../../gh-pages/index.html">gh-pages</a></dd>
            <dd><a href="../../../../release-2.0.0/index.html">release-2.0.0</a></dd>
            <dd><a href="../../../../release-3.0.0/docs/developer/tutorials/debugging-scipion.html">release-3.0.0</a></dd>
            <dd><a href="../../../../rsanchezgarc-patch-1/docs/developer/tutorials/debugging-scipion.html">rsanchezgarc-patch-1</a></dd>
            <dd><a href="../../../../vtune/docs/developer/tutorials/debugging-scipion.html">vtune</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>