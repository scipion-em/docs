

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Building Scipion docs &mdash; Scipion 2.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../static/documentation_options.js"></script>
        <script type="text/javascript" src="../../static/jquery.js"></script>
        <script type="text/javascript" src="../../static/underscore.js"></script>
        <script type="text/javascript" src="../../static/doctools.js"></script>
        <script type="text/javascript" src="../../static/language_data.js"></script>
    
    <script type="text/javascript" src="../../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/how-to-install.html">How to install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/host-configuration.html">Host configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#graphical-interface-manuals">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities.html">Streaming Processing</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/pyworkflow.html">pyworkflow package</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Building Scipion docs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../sources/docs/developer/building-scipion-docs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="figure">
<a class="reference internal image-reference" href="../../images/scipion_logo.gif"><img alt="scipion logo" src="../../images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="building-scipion-docs">
<span id="id1"></span><h1>Building Scipion docs<a class="headerlink" href="#building-scipion-docs" title="Permalink to this headline">¶</a></h1>
<p>Scipion’s documentation is built using <a class="reference external" href="http://www.sphinx-doc.org">Sphinx</a> and hosted on
<a class="reference external" href="https://pages.github.com/">GitHub pages</a>. Sphinx uses certain files like <code class="docutils literal notranslate"><span class="pre">*.rst</span></code> files and Sphinx’s config
<code class="docutils literal notranslate"><span class="pre">conf.py</span></code> to build the docs on HTML, which we can later copy to some server. In our case, we the different versions
of our docs on the <a class="reference external" href="https://github.com/scipion-em/docs">docs GitHub repository</a> . At the time of this writing we have
only one version, the branch <code class="docutils literal notranslate"><span class="pre">release-2.0.0</span></code>, but we’ll have more versions in the future.
The branch <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> contains the <strong>built</strong>
documentation for all versions (i.e. HTML files). When new commits are pushed to this branch,
<a class="reference external" href="https://scipion-em.github.io/docs/">https://scipion-em.github.io/docs/</a> will update and reflect them automatically.</p>
<p>On a high level, the docs have two main parts:</p>
<ul class="simple">
<li>The API docs, which are automatically generated from the code’s docstrings using <a class="reference external" href="https://www.sphinx-doc.org/en/master/man/sphinx-apidoc.html">sphinx-apidoc</a>.
To build these, we need a working <a class="reference internal" href="../scipion-modes/install-from-sources.html"><span class="doc">installation of Scipion</span></a> in our machine.</li>
<li>The general docs, which are manually generated content (e.g. guides, tutorials, etc).</li>
</ul>
<div class="section" id="sphinx-virtualenv">
<h2>Sphinx virtualenv<a class="headerlink" href="#sphinx-virtualenv" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Clone the <a class="reference external" href="https://github.com/scipion-em/docs">Scipion docs repository</a>. We’ll clone to a folder
called scipion-docs.</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git clone git@github.com:scipion-em/docs.git scipion-docs
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Create a virtual environment in the directory of your choice (better not inside the repo dir) and activate it.</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ virtualenv sphinx-env
$ <span class="nb">source</span> sphinx-env/bin/activate
<span class="o">(</span>sphinx-env<span class="o">)</span> $
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Go to the repo dir (with your virtual environment activated) and install the pip requirements. Please note that
<code class="docutils literal notranslate"><span class="pre">sphinxcontrib-versioning</span></code> is installed from a git fork, not from pypi - the current version available in pypi does NOT work.</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>sphinx-env<span class="o">)</span> $ <span class="nb">cd</span> scipion-docs
<span class="o">(</span>sphinx-env<span class="o">)</span> $ pip install -r requirements.txt
</pre></div>
</div>
<p>NOTE: we could skip the environment creation and install the requirements in Scipion’s python.
However the installation of requirements will mess with some of the versions currently
available in Scipion’s site-packages, so we recommend not messing with this and installing sphinx packages in a
separate virtualenv.</p>
</div>
<div class="section" id="generate-api-docs">
<h2>Generate API docs<a class="headerlink" href="#generate-api-docs" title="Permalink to this headline">¶</a></h2>
<p>The api docs are contained in the folder <code class="docutils literal notranslate"><span class="pre">api</span></code> of the scipion docs repository. To update them, we need to run
<code class="docutils literal notranslate"><span class="pre">sphinx-apidoc</span></code>. Please note that this step is not necessary if you’re just adding your own written <code class="docutils literal notranslate"><span class="pre">.rst</span></code> file.</p>
<p>We can set this up as a run configuration in PyCharm (Recommended):</p>
<img alt="Sphinx apidoc in pycharm" src="../../images/pycharm_apidoc_runconfig.png" />
<p>Or alternatively, run this in the command line inside <code class="docutils literal notranslate"><span class="pre">scipion-docs</span></code> repo dir:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>sphinx-env<span class="o">)</span> $ sphinx-apidoc -f -e -o api/ ~/git/scipion/pyworkflow ~/git/scipion/pyworkflow/tests/*
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-f</span></code> forces to overwrite existing files</li>
<li><code class="docutils literal notranslate"><span class="pre">-e</span></code> generates one rst file per module</li>
<li><code class="docutils literal notranslate"><span class="pre">api/</span></code> put output files here</li>
<li><code class="docutils literal notranslate"><span class="pre">~/git/scipion/pyworkflow</span></code> is the source python code we want to generate docs for</li>
<li><code class="docutils literal notranslate"><span class="pre">~/git/scipion/pyworkflow/tests/*</span></code> avoid generating docs for files matching this pattern.</li>
</ul>
</div>
<div class="section" id="make-html">
<h2>Make html<a class="headerlink" href="#make-html" title="Permalink to this headline">¶</a></h2>
<p>This step is only used for testing purposes. It is recommended to do it if you need to test some
local changes that you don’t wish to commit just yet (which is good to avoid pushing tiny commits when you’re
writing docs content).
To test if we can generate the html files, run this inside <code class="docutils literal notranslate"><span class="pre">scipion-docs</span></code>.
At the time of this writing, there are multiple errors and warnings. Sphinx will just generate whatever it can.
It is a good idea to work on reducing these errors and warnings :)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(sphinx-env) $ scipion run make html
</pre></div>
</div>
<p>After this, we can open <code class="docutils literal notranslate"><span class="pre">_build/html/index.html</span></code> on a browser and see the built docs. At this point we won’t have the
version support on the bottom left corner.</p>
<img alt="pycharm make html config" src="../../images/pycharm-make-html.png" />
</div>
<div class="section" id="make-clean">
<h2>Make clean<a class="headerlink" href="#make-clean" title="Permalink to this headline">¶</a></h2>
<p>This step isn’t strictly necessary, but sometimes when we perform <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> over and over, pages get funky and
some of them don’t have the right things when we navigate (I’ve observed this a lot with the side bars). With this
command we will remove everything under the <code class="docutils literal notranslate"><span class="pre">_build</span></code> folder, so that next time we run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code> we do it
fresh.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(sphinx-env) $ make clean
</pre></div>
</div>
<img alt="pycharm make clean config" src="../../images/pycharm-make-clean.png" />
</div>
<div class="section" id="build-with-sphinx-versioning">
<h2>Build with sphinx-versioning<a class="headerlink" href="#build-with-sphinx-versioning" title="Permalink to this headline">¶</a></h2>
<p>For this step all changes must be pushed to the remote repository, since sphinx-versioning doesn’t take into account
local changes. The command used for this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>sphinx-env<span class="o">)</span> $ scipion run /home/yaiza/sphinx-env/bin/sphinx-versioning build -r release-2.0.0 /home/yaiza/git/scipion-docs /home/yaiza/git/scipion_gh_pages
</pre></div>
</div>
<p>After executing this we should be able see the docs with version support by opening
<code class="docutils literal notranslate"><span class="pre">/home/yaiza/git/scipion_gh_pages/index.html</span></code> with our browser.</p>
<p>We can also trigger this command with the following run configuration in PyCharm:</p>
<ul class="simple">
<li><strong>Script path</strong>: <code class="docutils literal notranslate"><span class="pre">/home/yaiza/git/scipion/scipion</span></code></li>
<li><strong>Parameters</strong>: <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">/home/yaiza/sphinx-env/bin/sphinx-versioning</span> <span class="pre">build</span> <span class="pre">-r</span> <span class="pre">release-2.0.0</span> <span class="pre">/home/yaiza/git/scipion-docs</span> <span class="pre">/home/yaiza/git/scipion_gh_pages</span></code></li>
<li><strong>Python interpreter</strong>: The one from our <code class="docutils literal notranslate"><span class="pre">sphinx-env</span></code></li>
<li><strong>Working directory</strong>: Our <code class="docutils literal notranslate"><span class="pre">scipion-docs</span></code> repo dir</li>
</ul>
<img alt="PyCharm run config for sphinx-version build" src="../../images/pycharm_sphinxversion_build.png" />
<div class="section" id="important-note-on-branches-versions">
<h3>Important note on branches/versions<a class="headerlink" href="#important-note-on-branches-versions" title="Permalink to this headline">¶</a></h3>
<p>At the moment we don’t really have a way of auto-syncing Scipion branches with docs branches. Please be very mindful
that your current Scipion branch matches the Docs branch when you push doc changes!!</p>
</div>
</div>
<div class="section" id="push-with-sphinx-versioning">
<h2>Push with sphinx-versioning<a class="headerlink" href="#push-with-sphinx-versioning" title="Permalink to this headline">¶</a></h2>
<p>Once we are happy with the build, we can push our docs. For this we must run this command within our scipion-docs dir:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>sphinx-env<span class="o">)</span> $ scipion run /home/yaiza/sphinx-env/bin/sphinx-versioning push -r release-2.0.0 /home/yaiza/git/scipion-docs gh-pages .
</pre></div>
</div>
<p>The PyCharm run configuration is the same as before except for the parameters:</p>
<ul class="simple">
<li><strong>Parameters</strong> : <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">/home/yaiza/sphinx-env/bin/sphinx-versioning</span> <span class="pre">push</span> <span class="pre">-r</span> <span class="pre">release-2.0.0</span> <span class="pre">/home/yaiza/git/scipion-docs</span> <span class="pre">gh-pages</span></code></li>
</ul>
<img alt="PyCharm run config for sphinx-version push" src="../../images/pycharm_sphinxversion_push.png" />
<p>For more info on the params of sphinx-versioning you can run <code class="docutils literal notranslate"><span class="pre">sphinx-versioning</span> <span class="pre">--help</span></code> or check <a class="reference external" href="https://robpol86.github.io/sphinxcontrib-versioning/v2.2.1/tutorial.html">sphinx-versioning docs</a>.</p>
</div>
<div class="section" id="resources-and-tips">
<h2>Resources and tips<a class="headerlink" href="#resources-and-tips" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>You can reference python objects!! E.g. <a class="reference internal" href="../../api/pyworkflow.plugin.html#pyworkflow.plugin.Plugin" title="pyworkflow.plugin.Plugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">The</span> <span class="pre">plugin</span> <span class="pre">class</span></code></a>. For more info check
the sphinx guide on  <a class="reference external" href="http://www.sphinx-doc.org/en/master/usage/restructuredtext/domains.html#the-python-domain">how to reference python objects</a></li>
<li>You can install and use <a href="#id2"><span class="problematic" id="id3">`pandoc&lt;https://pandoc.org/&gt;`_</span></a> to convert from Markdown (.md) to .rst</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: release-2.0.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="building-scipion-docs.html">release-2.0.0</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>