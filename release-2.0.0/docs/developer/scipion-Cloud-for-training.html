

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Scipion Cloud for training &mdash; Scipion 2.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../static/documentation_options.js"></script>
        <script type="text/javascript" src="../../static/jquery.js"></script>
        <script type="text/javascript" src="../../static/underscore.js"></script>
        <script type="text/javascript" src="../../static/doctools.js"></script>
        <script type="text/javascript" src="../../static/language_data.js"></script>
    
    <script type="text/javascript" src="../../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/install-from-sources.html">Installing Scipion v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities.html">Streaming Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/acquisition-simulation.html">Tutorial for Facilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/pyworkflow.html">pyworkflow package</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Scipion Cloud for training</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../sources/docs/developer/scipion-Cloud-for-training.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="figure">
<a class="reference internal image-reference" href="../../images/scipion_logo.gif"><img alt="scipion logo" src="../../images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="scipion-cloud-for-training">
<span id="id1"></span><h1>Scipion Cloud for training<a class="headerlink" href="#scipion-cloud-for-training" title="Permalink to this headline">¶</a></h1>
<div class="section" id="aws-for-scipion-training-only-for-the-i2pc-group">
<h2>AWS for Scipion training (only for the i2pc group)<a class="headerlink" href="#aws-for-scipion-training-only-for-the-i2pc-group" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-aws-instances-for-training">
<h3>Creating AWS instances for training<a class="headerlink" href="#creating-aws-instances-for-training" title="Permalink to this headline">¶</a></h3>
<p>Only AWS admin user can do that, but these are the steps.</p>
<ul class="simple">
<li>Login to <a class="reference external" href="https://aws.amazon.com/">[AWS console]</a></li>
<li>Go to EC2 services</li>
<li>Select AMIs on the left side menu</li>
<li>Select i2pc-cloud-training and click on <code class="docutils literal notranslate"><span class="pre">Launch</span></code></li>
</ul>
<div class="figure">
<img alt="AWS console - AMIs" src="docs/images/cloud/AWS%20console%20-%20AMIs.png" />
</div>
<ul class="simple">
<li>Choose the instance type appropriate for the training. For the usual Workflow (ExtendedBetagal) we normally use p2.xlarge (GPU).</li>
<li>Click ‘Next: Configure instance details’ and select the number of instances to be created.</li>
<li>Click ‘Next: Add Storage’ and specify the disk size (30 GB by default).</li>
<li>Click ‘Next: Add tags’ and specify the following tags:</li>
</ul>
<div class="figure">
<img alt="AWS console - Add tags" src="docs/images/cloud/AWS%20console%20-%20Add%20Tags.png" />
</div>
<p>(UserName must be i2pc-training but Name can be chosen, although it must contain the word training).</p>
<ul class="simple">
<li>Click ‘Next: Configure Security group’ and select the one named ‘i2pc-training-sg’.</li>
</ul>
<div class="figure">
<img alt="AWS console - Security Groups" src="../../images/aws-i2pc-training-sg.png" />
</div>
<p>ssh is by default restricted to CNB IP range but it could be changed if neccessary.</p>
<ul class="simple">
<li>Click on ‘Review and launch’ and press ‘Launch’.
A pop-up window will appear to select a security key pair. You can either select key i2pc-training or create a new one.</li>
</ul>
<div class="figure">
<img alt="AWS console - Key pairs" src="docs/images/cloud/AWS%20console%20-%20Key%20pairs.png" />
</div>
<ul class="simple">
<li>Click on ‘Launch Instances’ and go to ‘View Instances’ and wait until instances has been initialized (Status Checks)</li>
</ul>
<p>Instances are by default created with a dynamic IP address. This means that when the instance is restarted the IP changes. AWS allows to create ‘Elastic IPs’ that are fix IPs that can be assigned to an instance. This way even if the instance is restarted the IP is kept, which which might interesting for a multi-day course. The steps to do this are:</p>
<ul class="simple">
<li>Go to the Left side menu ‘Network and Security’/Elastic IPs</li>
<li>Click on ‘Allocate new address’</li>
<li>Once the new IP address appears on the list select it and click on ‘Actions/Associate address’.</li>
</ul>
<p>By default AWS have a limit of 5 Elastic IPs but this limit can be changed through the AWS support service.</p>
</div>
</div>
<div class="section" id="managing-training-instances">
<h2>Managing training instances<a class="headerlink" href="#managing-training-instances" title="Permalink to this headline">¶</a></h2>
<p>There is a user called i2pc-training that can only manage training instances (start, stop and reboot). The steps are:</p>
<ul class="simple">
<li>Login to <a class="reference external" href="https://aws.amazon.com/">AWS console</a></li>
<li>Go to EC2 services</li>
<li>Select Instances on the left side menu</li>
<li>Select the instance and either click on ‘Actions’ or Right-click on the instance and select Instance State and the action required.</li>
</ul>
<div class="figure">
<img alt="AWS console - manage training instances" src="docs/images/cloud/AWS%20console%20-%20manage%20training%20instances.png" />
</div>
</div>
<div class="section" id="accessing-training-instances">
<h2>Accessing training instances<a class="headerlink" href="#accessing-training-instances" title="Permalink to this headline">¶</a></h2>
<p>Once instances are up and running they can be accessed either through ssh or guacamole.</p>
<ul class="simple">
<li>Ssh: user ubuntu with pubkey i2pc-training</li>
<li>VNC with password on the following URL <a class="reference external" href="https://PUB_IP/vnc.html">https://PUB_IP/vnc.html</a></li>
</ul>
<p>The first time you will be warned that connection is not secure and will have to add a security exception).</p>
<p>This is how Desktop on the new machine will look like:</p>
<div class="figure">
<img alt="noVNC - desktop" src="../../images/noVNC-desktop.png" />
</div>
<p>To resize screen clicks on the Settings icon and set <code class="docutils literal notranslate"><span class="pre">Scaling</span> <span class="pre">Mode</span></code> to <code class="docutils literal notranslate"><span class="pre">Remote</span> <span class="pre">Resizing</span></code>:</p>
<div class="figure">
<img alt="noVNC - resize" src="../../images/noVNC-resize.png" />
</div>
<p>To disconnect from the session click on the little arrow that appears on the left (see menu below) and click on the last option:</p>
<div class="figure">
<img alt="noVNC - disconnect" src="../../images/noVNC-menu.png" />
</div>
<p>IMPORTANT!! Do not disconnect from the top right corner, as in a physical machine. If you do so the machine will need to be reboot.</p>
<p>There is a shortcut for Scipion on the desktop.</p>
<p>The following software is installed on the machine:</p>
<ul class="simple">
<li>Ubuntu 16</li>
<li>Scipion on /usr/local/scipion (alias scipion): git installation branch release-1.1.facilities-devel with the following EM Packages:<ul>
<li>Ctffind4 4.1.8</li>
<li>Gctf 1.06</li>
<li>Gautomatch 0.53</li>
<li>Eman 2.12</li>
<li>Frealing 9.07</li>
<li>Motioncor2 1.0.2</li>
<li>Motioncorr 2.1</li>
<li>Relion 2.0</li>
<li>resmap   1.1.5s2</li>
<li>Spider 21.13</li>
<li>chimera 1.10.1</li>
</ul>
</li>
<li>Scipion devel on /usr/local/scipion_devel (alias scipion_devel): git installation branch model_04_chimerafit</li>
<li>Nvidia driver version 384</li>
<li>CUDA 7.5 and 8.0 (default cuda links to 7.5).</li>
<li>TurboVNC 2.1.1 on</li>
<li>VirtualGL 2.5.2</li>
<li>noVNC</li>
</ul>
<p>The FEICourse finished project can be found under Scipion projects while project raw data is located at /data/relion13_tutorial.</p>
</div>
<div class="section" id="prices-on-aws-for-scipion-training">
<h2>Prices on AWS for Scipion training<a class="headerlink" href="#prices-on-aws-for-scipion-training" title="Permalink to this headline">¶</a></h2>
<p>On AWS you pay for time you consume resources. In this case we have to pay for the time that instances are up running plus the disk space they occupy even when they are stopped. Also, we should pay for downloading data.
Typical GPU instance type used for the course is p2.xlarge and it costs 1.09$/hour in AWS Ireland region.
EBS volume costs 0.133$/GB/month. Downloads costs 0.11$/GB (prices January 2018).</p>
<p>So, for instance, for a typical two days course in Europe (AWS Ireland region) one p2.xlarge instance with a 30 GB disk assuming that machine is up for 16 hours but it exists during 48 hours will have the following cost:</p>
<ul class="simple">
<li>Instance: 16*1.09$ = 17.44$</li>
<li>EBS volume: 30*0.133*48/720 = 0.266$</li>
<li>The cost of downloading final results (maps) which are in order of MB are irrelevant.</li>
</ul>
<p>Total cost per machine for a 2 days course is around 18$ (tax included).</p>
<p>If Elastic IPs were specified they might imply extra costs. Elastic IPs are free while they are allocated to a running instance, but if the instance is stopped or terminated the IP costs 0.006$/hour, which for a 2 days course might be considered irrelevant.</p>
</div>
<div class="section" id="egi-federated-cloud-for-training">
<h2>EGI Federated Cloud for training<a class="headerlink" href="#egi-federated-cloud-for-training" title="Permalink to this headline">¶</a></h2>
<p>The Federated Cloud has a training infrastructure <a class="reference external" href="https://wiki.egi.eu/wiki/Training_infrastructure">service</a> that could be used by registered users (EGI checking previous registration needed).</p>
<p>We could also use the FedCloud for training with the following considerations:</p>
<ul class="simple">
<li>We normally operate through Virtual Organization enmr.eu (Westlife project) but we could also use VO training.egi.eu</li>
<li>The agreement to use the latest for GPU instances (IISAS) is:<ul>
<li>2 VMs with 6 CPU cores, 1 GPU and 12GB of RAM (in normal condition)</li>
<li>4 VMs with 6 CPU cores, 1 GPU and 12GB of RAM (require reservation)</li>
</ul>
</li>
<li>Non GPU instances are not that restricted using different providers (CESNET, IISAS)</li>
<li>They have a FedCloud Client UI (Ubuntu 16.04.02) already configured with 40 different training accounts. Every 6h, a cron job updates the proxy for each user with the PUSP generated from the robot. They can create an account for us on that UI. This is useful if we want students to start their own VMs but this is not the normal case.</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>VMs management can be done through VM management dashboard (<a class="reference external" href="https://dashboard.appdb.egi.eu">https://dashboard.appdb.egi.eu</a>), which offers a Web interface for both trainers and students to deploy and manage VMIs from the Marketplace on the training infrastructure.</li>
</ul>
</div></blockquote>
<div class="section" id="fedcloud-scipion-instance-for-training">
<h3>FedCloud Scipion instance for training<a class="headerlink" href="#fedcloud-scipion-instance-for-training" title="Permalink to this headline">¶</a></h3>
<p>Currently there is not a proper image for Scipion training in the FedCloud, hoewever an instance could be launched using the ScipionCloud images on the AppDB and customized for the training.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: release-2.0.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../dependabot_pip_jinja2-2.11.3/docs/developer/scipion-Cloud-for-training.html">dependabot/pip/jinja2-2.11.3</a></dd>
            <dd><a href="../../../dependabot_pip_pygments-2.7.4/docs/developer/scipion-Cloud-for-training.html">dependabot/pip/pygments-2.7.4</a></dd>
            <dd><a href="../../../gh-pages/docs/developer/scipion-Cloud-for-training.html">gh-pages</a></dd>
            <dd><a href="scipion-Cloud-for-training.html">release-2.0.0</a></dd>
            <dd><a href="../../../release-3.0.0/docs/developer/scipion-Cloud-for-training.html">release-3.0.0</a></dd>
            <dd><a href="../../../rsanchezgarc-patch-1/docs/developer/scipion-Cloud-for-training.html">rsanchezgarc-patch-1</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>