

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Scipion Java &mdash; Scipion 2.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../static/documentation_options.js"></script>
        <script type="text/javascript" src="../../static/jquery.js"></script>
        <script type="text/javascript" src="../../static/underscore.js"></script>
        <script type="text/javascript" src="../../static/doctools.js"></script>
        <script type="text/javascript" src="../../static/language_data.js"></script>
    
    <script type="text/javascript" src="../../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/install-from-sources.html">Installing Scipion v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities.html">Streaming Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/acquisition-simulation.html">Tutorial for Facilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/pyworkflow.html">pyworkflow package</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Scipion Java</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../sources/docs/developer/scipion-java.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="figure">
<a class="reference internal image-reference" href="../../images/scipion_logo.gif"><img alt="scipion logo" src="../../images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="scipion-java">
<span id="id1"></span><h1>Scipion Java<a class="headerlink" href="#scipion-java" title="Permalink to this headline">¶</a></h1>
<p>As you may know <a class="reference external" href="https://scipion-em.github.io/docs/docs/user/user-documentation.html#showj">ShowJ</a> is our default viewer for most of Scipion
objects and <a class="reference external" href="https://scipion-em.github.io/docs/docs/user/user-documentation.html#particle-picker">Particle Picker</a> allows us to visualize coordinates or
pick particles either manually or automatically. Scipion source packages related
to ShowJ and Particle Picking include:</p>
<ul class="simple">
<li>xmipp.ij.commmons : Contains ImageJ-related classes (In ShowJ we use and
extend ImageJ to display and process images), such as Xmipp canvas with
customized events, Xmipp image window with our menu and imageplus loader.</li>
<li>xmipp.jni : Contains Java bindings with Xmipp C++ code</li>
<li>xmipp.viewer.models : Contains the different table models used to display data
in ShowJ</li>
<li>xmipp.viewer.windows : Contains ShowJ main frame and associated dialogs:
columns editor, plotter, CTF Profile, etc.</li>
<li>xmipp.viewer.scipion : Contains Scipion extensions of Metadata, GalleryData
and GalleryJFrame classes</li>
<li>xmipp.viewer.particlepicker: Contains base classes for particle picking:
frame, canvas, micrograph, particle dialog, etc.</li>
<li>xmipp.viewer.particlepicker.training: Contains supervised picker implementation</li>
<li>xmipp.viewer.particlepicker.tiltpair: Contains tilt pair picker implementation</li>
</ul>
<p>xmipp.jni package contains java versions of Xmipp core classes for image
processing, such as MetaData or ImageGeneric. A Metadata represents a star file
and it is used to read and store information in Xmipp. ImageGeneric represents
an image in memory. It is used to load and write image files, such as .stk,
.mrc, .vol, etc.</p>
<p>xmipp.viewer.particlepicker.training and xmipp.viewer.particlepicker.tiltpair
packages in turn contain model and GUI packages with data model and windows
respectively.</p>
<p>In the following class diagram, we display ShowJ main classes and its relations:</p>
<a class="reference internal image-reference" href="../../images/showj-class-diagram.gif"><img alt="showj-class-diagram" src="../../images/showj-class-diagram.gif" style="height: 400px;" /></a>
<p>GalleryJFrame and table models are used for data visualization, while
GalleryData is in charge of data manipulation and business logic.
To visualize most data objects in Scipion, DataViews are used. DataViews can
display data in desktop and web using ShowJ or ShowJ Web. These classes are
defined in pyworkflow/em/viewer.py. The developer can specify column visibility,
order, type of viewer (gallery or table), etc. In turn, this configuration is
given as input to ShowJ from the command line.</p>
<p>In the following class diagram, we display particle picker main classes and its
relations:</p>
<a class="reference internal image-reference" href="../../images/picker-class-diagram.gif"><img alt="Picker Class Diagram" src="../../images/picker-class-diagram.gif" style="height: 400px;" /></a>
<p>Base classes ParticlePicker, ParticlePickerJFrame, ParticlePickerCanvas, etc.,
are extended to implement supervised and tilt pair picker. Images are loaded
using ImagePlusLoader and displayed using XmippImageWindow, as in ShowJ.
While ParticlePickerJFrame and ParticlePickerCanvas are used to visualize and
edit coordinates, ParticlePicker contains all the business logic related to the
picking process.</p>
<p>ShowJ and Particle Picker use sockets to communicate with Scipion. The port used
for communication is specified  as an input parameter from the command line.
There are a number of operations that require this functionality:</p>
<ul class="simple">
<li>creating subsets: We can create subsets of classes, of particles from classes,
of representatives, of images, of volumes, etc. These subsets are created
through Scipion buttons added in ScipionGalleryJFrame at the bottom of the
window. They invoke the creation of the corresponding ProtUserSubset output
implemented in the protocol_batch module.</li>
<li>registering coordinates: This socket is implemented in pyworkflow/em/showj.py
to register picker coordinates. It invokes picker protocol method
“registerCoords” in order to convert its coordinates into the Scipion format.</li>
<li>executing object commands: In ShowJ the developer can specify a set of
commmands to be linked with the object menu (popup menu displayed when the user
does right click). Eg: Display CTF Fitting, Plot Distance Profile
(Normal Modes), etc.  Python code related to these actions is executed using
sockets. The socket handler and the functions related to these actions are
implemented in pyworkflow/gui/project/project.py</li>
</ul>
<p>Particle Picker has also been extended to use a generic classifier if provided
with a configuration file specifying classifier autopick and convert commands
and input parameters. This allows us to use it as a wizard to configure
automatic pickers such as Relion autopick, Appion dogpicker or gaussian picker.
A classifier configuration should look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="n">diameter</span><span class="p">,</span><span class="n">threshold</span>
<span class="n">diameter</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">diameter</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">Diameter</span>
<span class="n">diameter</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="n">some</span> <span class="n">help</span>
<span class="n">threshold</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span>  <span class="mf">0.5</span>
<span class="n">threshold</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">Threshold</span>
<span class="n">threshold</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="n">some</span> <span class="n">help</span>
<span class="n">autopickCommand</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">scipion</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">em</span><span class="o">/</span><span class="n">dogpicker</span><span class="o">/</span><span class="n">ApDogPicker</span><span class="o">.</span><span class="n">py</span>  <span class="o">--</span><span class="n">thresh</span><span class="o">=%</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="o">--</span><span class="n">diam</span><span class="o">=%</span><span class="p">(</span><span class="n">diameter</span><span class="p">)</span> <span class="o">--</span><span class="n">apix</span><span class="o">=</span><span class="mf">3.54</span>  <span class="o">--</span><span class="n">image</span><span class="o">=%</span><span class="p">(</span><span class="n">micrograph</span><span class="p">)</span> <span class="o">--</span><span class="n">outfile</span><span class="o">=</span><span class="n">Tmp</span><span class="o">/</span><span class="mf">348.</span><span class="n">outputMicrographs04</span><span class="o">/%</span><span class="p">(</span><span class="n">micrographName</span><span class="p">)</span><span class="o">.</span><span class="n">txt</span>
<span class="n">convertCommand</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">scipion</span><span class="o">/</span><span class="n">pyworkflow</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">pw_convert</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">coordinates</span> <span class="o">--</span><span class="kn">from</span> <span class="nn">dogpicker</span> <span class="o">--</span><span class="n">to</span> <span class="n">xmipp</span> <span class="o">--</span><span class="nb">input</span>  <span class="n">Runs</span><span class="o">/</span><span class="mo">00034</span><span class="mi">8</span><span class="n">_ProtSplitSet</span><span class="o">/</span><span class="n">micrographs4</span><span class="o">.</span><span class="n">sqlite</span> <span class="o">--</span><span class="n">output</span> <span class="n">Tmp</span><span class="o">/</span><span class="mf">348.</span><span class="n">outputMicrographs04</span>
</pre></div>
</div>
<p>Autopick protocols implement wizards that generate this file and launch the
particle picker to adjust parameters (considering the results in several
micrographs) before running an automatic picking for the whole set of
micrographs.</p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: release-2.0.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../gh-pages/docs/developer/scipion-java.html">gh-pages</a></dd>
            <dd><a href="scipion-java.html">release-2.0.0</a></dd>
            <dd><a href="../../../release-3.0.0/docs/developer/scipion-java.html">release-3.0.0</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>