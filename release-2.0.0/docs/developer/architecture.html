

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Architecture &mdash; Scipion 2.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../static/documentation_options.js"></script>
        <script type="text/javascript" src="../../static/jquery.js"></script>
        <script type="text/javascript" src="../../static/underscore.js"></script>
        <script type="text/javascript" src="../../static/doctools.js"></script>
        <script type="text/javascript" src="../../static/language_data.js"></script>
    
    <script type="text/javascript" src="../../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/install-from-sources.html">Installing Scipion v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities.html">Streaming Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/acquisition-simulation.html">Tutorial for Facilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/pyworkflow.html">pyworkflow package</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Architecture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../sources/docs/developer/architecture.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="figure">
<a class="reference internal image-reference" href="../../images/scipion_logo.gif"><img alt="scipion logo" src="../../images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="architecture">
<span id="id1"></span><h1>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Scipion is an image processing framework for obtaining 3D models of
macromolecular complexes using Electron Microscopy(3DEM) . It is
designed to integrate several software packages in the field and present
an unified interface for both biologists and developers. Scipion executes
workflows that combine different software tools, while taking
care of formats and conversions. Additionally, all steps are tracked and
can be reproduced later on. The following diagram illustrates an overview
of the Scipion framework.</p>
<a class="reference internal image-reference" href="../../images/scipion-overview.png"><img alt="Scipion overview" class="align-center" src="../../images/scipion-overview.png" style="height: 400px;" /></a>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="main-goals">
<h3>Main Goals<a class="headerlink" href="#main-goals" title="Permalink to this headline">¶</a></h3>
<p>Scipion’s design and implementation is driven by its main goals:</p>
<ul class="simple">
<li><strong>Integration</strong>: Scipion should provide a common framework where
different EM software packages can be used in the same project. The
needed conversions (to move from one package to another) will run behind
the scenes without bothering users.</li>
<li><strong>Reproducibility</strong>: It is very important to enable the reproducibility and validation of
published results. To meet this need, Scipion will track all image
processing, storing all parameters used and the workflow executed. In that
way, it will be possible to repeat a previous processing project
starting from the original input data.</li>
<li><strong>High Throughput</strong>: With the development of new devices, some steps are becoming more automated,
such as data acquisition. Scipion should be able to execute workflows in an automated manner that
will allow a better integration with acquisition systems.</li>
<li><strong>Ease of use</strong>: Changing to a new system always requires effort from users – that’s one reason
they tend to stick with packages they already know. Scipion should not be more
complex to use than existing software packages, but it should provide extra functionality.
We use graphical interfaces in order to improve the user experience.</li>
<li><strong>Extensibility</strong>: Scipion should also be a framework for developers where they can find
tools that facilitate the integration of new protocols. In order to succeed, we must engage
developers from other groups to collaborate with us. We have tried to ease the learning curve
to add new protocols, even for people without a computer science background.</li>
</ul>
</div>
<div class="section" id="other-features">
<h3>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h3>
<p>We aim to:</p>
<ul class="simple">
<li>Use existing file <strong>formats</strong>: No new image format should be
introduced. The framework should use existing formats and ensure
that the input for each operation is in the proper format. The input
should be converted if needed.</li>
<li>Use a clear <strong>workflow</strong>: Each operation, or protocol, should have a set of
well-defined inputs and outputs. This will allow the user to create a pipeline of
logical operations following each other.</li>
<li>Share data and back <strong>up</strong>: Multiple users should be able to work on the same
project and share results with collaborators. The system should also
provide capabilities to perform intelligent incremental backups, only
writing the files that differ from the previous backed-up state.</li>
<li>Make maintenance <strong>simple</strong>: The framework should be written in a modular way,
divided into functional components. Each component should have a clear
definition of its function and the how will interact with other
components. The design should allow the user replace some particular component
without affecting the whole system.</li>
</ul>
</div>
</div>
<div class="section" id="components">
<h2>Components<a class="headerlink" href="#components" title="Permalink to this headline">¶</a></h2>
<p>The following diagram represents the main components that constitute
Scipion. In the next subsections, we will explain each component
separately.</p>
<a class="reference internal image-reference" href="../../images/scipion-architecture.png"><img alt="Scipin architecture" class="align-center" src="../../images/scipion-architecture.png" style="height: 400px;" /></a>
</div>
<div class="section" id="object-model-and-mapper-layer">
<h2>Object Model and Mapper Layer<a class="headerlink" href="#object-model-and-mapper-layer" title="Permalink to this headline">¶</a></h2>
<p>All the Scipion framework is based on a basic object model
that wraps Python types. This model is defined in <a class="reference internal" href="../../api/pyworkflow.object.html#module-pyworkflow.object" title="pyworkflow.object"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyworkflow.object</span></code></a>.
<code class="docutils literal notranslate"><span class="pre">Object</span></code> is the base class of all objects used in the model. The are two main types of
objects: <code class="docutils literal notranslate"><span class="pre">Scalars</span></code> and <code class="docutils literal notranslate"><span class="pre">Compounds</span></code>. The first type is for those objects that
hold a single value (such as <code class="docutils literal notranslate"><span class="pre">String</span></code>, <code class="docutils literal notranslate"><span class="pre">Integer</span></code>, <code class="docutils literal notranslate"><span class="pre">Float</span></code>, <code class="docutils literal notranslate"><span class="pre">Boolean</span></code>, and so on).
The compound objects are those that contain other objects. This base is used to model
the objects in the EM Domain. Read more more details about the <a class="reference internal" href="object-model.html#object-model"><span class="std std-ref">Object Model</span></a>.</p>
<p>We have used this basic model wrapping basic Python types to facilitate the
development of the <code class="docutils literal notranslate"><span class="pre">Mapper</span></code> layer to automatically store any type of object
(derived from Object).</p>
<p>There are 2 types of Mappers which main responsibility is to persist (store),
and retrieve <strong>any</strong> Object derived from Object . Currently, both mappers in
use are SQLite mappers and date ends up in SQLite databases.</p>
<p>The 2 mappers are:</p>
<ul class="simple">
<li><a class="reference internal" href="sqlite-mapper.html#sqlite-mapper"><span class="std std-ref">Sqlite-mapper</span></a>: Used to store any complex object like a project
or a protocol. In general heterogeneous and complex objects. It’s a key value storage
approach where the key is an attribute of an object, and the value is it’s value.
It’s very flexible but not optimal for large sets like particles, averages, classes</li>
<li><a class="reference internal" href="sqlite-flat-mapper.html#sqlite-flat-mapper"><span class="std std-ref">Sqlite-Flat-Mapper</span></a>: This is another approach to persist sets,
in a more optimal way.</li>
</ul>
</div>
<div class="section" id="protocol-and-execution-engine">
<h2>Protocol and Execution Engine<a class="headerlink" href="#protocol-and-execution-engine" title="Permalink to this headline">¶</a></h2>
<div class="section" id="em-model">
<h3>EM Model<a class="headerlink" href="#em-model" title="Permalink to this headline">¶</a></h3>
<div class="section" id="data">
<h4>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h4>
<p>On top of this base, the objects related to EM were developed. Again, we
have two main types of objects: Data and Protocols. Data objects are the
inputs/outputs of the operations and they contain the underlying files and
formats used by each EM package. Examples of Data objects are: <a class="reference internal" href="../../api/pyworkflow.em.data.html#pyworkflow.em.data.Image" title="pyworkflow.em.data.Image"><code class="xref py py-class docutils literal notranslate"><span class="pre">Image</span></code></a>,
<a class="reference internal" href="../../api/pyworkflow.em.data.html#pyworkflow.em.data.Micrograph" title="pyworkflow.em.data.Micrograph"><code class="xref py py-class docutils literal notranslate"><span class="pre">Micrograph</span></code></a>, <a class="reference internal" href="../../api/pyworkflow.em.data.html#pyworkflow.em.data.Volume" title="pyworkflow.em.data.Volume"><code class="xref py py-class docutils literal notranslate"><span class="pre">Volume</span></code></a>,
<a class="reference internal" href="../../api/pyworkflow.em.data.html#pyworkflow.em.data.CTFModel" title="pyworkflow.em.data.CTFModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">CTF</span></code></a>, <a class="reference internal" href="../../api/pyworkflow.em.data.html#pyworkflow.em.data.SetOfImages" title="pyworkflow.em.data.SetOfImages"><code class="xref py py-class docutils literal notranslate"><span class="pre">SetOfImages</span></code></a>,
<a class="reference internal" href="../../api/pyworkflow.em.data.html#pyworkflow.em.data.SetOfMicrographs" title="pyworkflow.em.data.SetOfMicrographs"><code class="xref py py-class docutils literal notranslate"><span class="pre">SetOfMicrographs</span></code></a> ..etc. Protocols
are the wrappers to the logical operations (such as: Filtering,
Alignment, Classification, Refinement…etc) which usually involve the
call to one or several command line programs. Protocols are in charge of
making the needed conversions and preparing files for calling the
programs. A protocol execution can be structured in different steps,
which are more atomic operations that can be resumed if the whole
process stops for any reason.</p>
</div>
<div class="section" id="protocols-plugins">
<h4>Protocols - Plugins<a class="headerlink" href="#protocols-plugins" title="Permalink to this headline">¶</a></h4>
<p>The object model makes it easy to integrate the plugins
for different software packages. Plugins are installed using pip. Besides the regular pip package structure,
Scipion plugins contain a folder with the following items (not all of them are mandatory):</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>: Python-required file for a submodule. In this file we
should define the Plugin class, which takes care of things like variables and
installation of binaries.</li>
<li><code class="docutils literal notranslate"><span class="pre">bibtex.py</span></code>:  contains the bibtex string literal as the Python doc string</li>
<li><code class="docutils literal notranslate"><span class="pre">constants.py</span></code>: Defines constants needed for the plugin and its protocols.</li>
<li><code class="docutils literal notranslate"><span class="pre">convert.py</span></code>: Converts from Scipion objects to files valid
to programs. Also converts from results to Scipion.</li>
<li><code class="docutils literal notranslate"><span class="pre">viewer.py</span></code>: Creates tools to visualize results.</li>
<li><code class="docutils literal notranslate"><span class="pre">wizard.py</span></code>: Creates the wizards used.</li>
<li><code class="docutils literal notranslate"><span class="pre">protocol__*.py</span></code>: We recommend to prefix with <code class="docutils literal notranslate"><span class="pre">protocol</span></code> all protocols
implemented in the package.</li>
</ul>
<p>For further information read our guide on <a class="reference internal" href="creating-a-plugin.html#creating-a-plugin"><span class="std std-ref">How to create a plugin</span></a></p>
</div>
</div>
<div class="section" id="graphical-user-interface">
<h3>Graphical User Interface<a class="headerlink" href="#graphical-user-interface" title="Permalink to this headline">¶</a></h3>
<p>The Graphical User Interface (GUI) is an important part of each
application. Having a nice and easy-to-use GUI will help users to
focus on their tasks. In Scipion, the GUI presents a more
intuitive and consistent way to launch programs and analyze their results
instead of dealing directly with the command line.</p>
<p>There are five major types of GUIs in Scipion:</p>
<ul class="simple">
<li><strong>Manager window</strong>: The first window to open upon launching Scipion.
Here, the user can see a list of all projects and
also select, create, or delete projects.</li>
<li><strong>Project window</strong>: The window where the users will
spend the most time. Here, the users will launch new protocol executions,
or runs, and manage the existing ones. For a selected run, more information
is available in the lower half of the window in separate tabs for the input/output,
the protocol citations and the log files produced by the execution. In the
upper half of the window, it is possible to display the runs in either a list view
or a flowchart view, where the relationships between among different runs
are intuitively represented.</li>
<li><strong>Form window</strong>: This is the second-most important window type. It is
dynamically generated for each protocol and contains fields for each
protocol’s paramaters. This is convenient for developers when creating
new protocols, because they only need to think about defining the input
parameters and not about GUI programming.</li>
<li><strong>Wizards</strong>: Wizards are simple and specific GUIs that assist
users in selecting certain parameters. This normally saves time for users,
since he/she can establish an idea of how a certain parameter will affect the
results of a given operation before launching the job on an entire data set.</li>
<li><strong>Data viewers</strong>: Visualization of data is essential to analyze image
processing results. In Scipion, we have re-used some of the data
visualization tools developed in existing EM software packages, such as
xmipp’s <code class="docutils literal notranslate"><span class="pre">showj</span></code> and Eman particle picking. We have also developed some new
tools, such as a web tool similar to xmipp <code class="docutils literal notranslate"><span class="pre">showj</span></code>, which is very useful
for displaying tables, galleries of images, or volumes.</li>
</ul>
</div>
<div class="section" id="management">
<h3>Management<a class="headerlink" href="#management" title="Permalink to this headline">¶</a></h3>
<p>The work performed in Scipion is organized by project. Each project has
its own folder (inside the <em>`$SCIPION_USER_DATA/projects`</em> directory)
and a separate database (<code class="docutils literal notranslate"><span class="pre">project.sqlite</span></code>). Each time the user
executes a new protocol within the project, it is registered as a new
<em>run</em> in the database. Thus, the user can check at any time which
operations have been executed so far, and the exact parameters used in each
step. Each run also contains its own folder (named as the protocol class
name and the run ID number) where all the outputs of the runs are located.</p>
<p>Scipion will have a user management system. Users will have permission
to perform some operations on each project. It will also be possible to
define groups of users, in which some properties and roles can be
centralized.</p>
<div class="section" id="mapper-layer">
<h4>Mapper layer<a class="headerlink" href="#mapper-layer" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">Mapper</span></code> layer is in charge of storing and retrieving objects. Our
main requirement for this module is to avoid a very complex database schema that
will be very hard to maintain and extend. Since we aim for an easy integration
of new packages and protocols, the <em>Mapper</em> will keep the
developer from dealing directly with databases or other type of storage. It
will provide an interface for storing, updating and retrieving objects
while hiding the implementation details and the underlying storage.</p>
<p>Currently we have implemented two mappers base on sqlite
(<code class="docutils literal notranslate"><span class="pre">$SCIPION_HOME/pyworkflow/mapper/sqlite.py</span></code>). One of them is
designed to store objects’ relationships and easily insert new objects
without needing to create new SQL tables. Actually, there are only two
tables: <em>Objects</em> and <em>Relations</em>. The first one stores one row for
each <em>Scalar</em> object and several rows for <em>Compound</em> ones. The other
mapper implemented so far (although it is used less often) is based on xml;
it is less efficient for querying and iteration, but very convenient
for configuration files.</p>
<p>link:MapperImplementation[here]</p>
</div>
</div>
<div class="section" id="execution-layer">
<h3>Execution layer<a class="headerlink" href="#execution-layer" title="Permalink to this headline">¶</a></h3>
<p>Another added value of Scipion is the configuration of execution hosts
and environments. The idea is that for one project, we can have a set of
execution hosts, each one with their own capabilities. Then, while
executing a <strong>Protocol</strong>, the user can choose the host that best fits
the job’s needs. The data transfer to/from the execution host will be done
by Scipion, so the user will not need to manually copy or move files.
Currently, we have implemented the execution logic related to
launching jobs to queue. Since each queue configuration varies among
different systems, Scipion permits configuration for each execution
host. The configuration of the queue and other settings should be done
only once, while installing Scipion (probably with the help of system
administrators), and the user will no longer need to set up and edit
submission scripts.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: release-2.0.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="architecture.html">release-2.0.0</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>