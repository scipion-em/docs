

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Streaming workflows &mdash; Scipion 2.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../static/documentation_options.js"></script>
        <script type="text/javascript" src="../../static/jquery.js"></script>
        <script type="text/javascript" src="../../static/underscore.js"></script>
        <script type="text/javascript" src="../../static/doctools.js"></script>
        <script type="text/javascript" src="../../static/language_data.js"></script>
    
    <script type="text/javascript" src="../../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Tutorial for Facilities" href="acquisition-simulation.html" />
    <link rel="prev" title="Streaming Processing" href="facilities.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/install-from-sources.html">Installing Scipion v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="facilities.html">Streaming Processing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Streaming workflows</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">Static templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">Dynamic templates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-custom-dynamic-templates">Creating custom dynamic templates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-scipion-s-api">Using Scipion’s API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="acquisition-simulation.html">Tutorial for Facilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/pyworkflow.html">pyworkflow package</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Streaming workflows</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../sources/docs/facilities/facilities-workflows.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="figure">
<a class="reference internal image-reference" href="../../images/scipion_logo.gif"><img alt="scipion logo" src="../../images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="streaming-workflows">
<span id="facilities-workflows"></span><h1>Streaming workflows<a class="headerlink" href="#streaming-workflows" title="Permalink to this headline">¶</a></h1>
<p>Scipion can launch streaming workflows in several ways. The most basic one is
achieved creating an empty project to start a new workflow with an <em>Import Movies</em>
protocol pointing to the microscope’s deposition directory. Since we want to process
the movies that are currently located at that directory but, also, those movies
that are continuously arriving, we must activate the streaming mode in the streaming tab as
shown in the figure below. Afterwards, the rest of the protocols can be
added to the workflow in the same way that in the non streaming workflows
(from the protocols tree at left of finding them with <em>ctrl+F</em>),
but now all the protocols will wait for new data to process.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../images/streaming-tab.png"><img alt="streaming tab" src="../../images/streaming-tab.png" style="width: 300px;" /></a>
</div>
<p>The two main parameters associated to the streaming mode are:</p>
<ul class="simple">
<li><strong>Timeout</strong>: The time to wait, after not receiving new images, to close the acquisition.</li>
<li><strong>File timeout</strong>: Scipion is checking if a new file is growing up. If it do not change after this time, Scipion will consider that it is ready to be imported.</li>
</ul>
<p>Usually the general <em>timeout</em> is a huge value (43,200 seconds = 12 hours) in
order to prevent ending the acquisition in an eventual acquisition issue at the microscope side.
Therefore, EM operator has this time to solve the issue.</p>
<p>When we know that the acquisition is finished, we can manually stop the online
processing by selecting the <em>Import Movies &gt; right-click &gt; STOP STREAMING</em>.
Then, all protocols will be finishing as soon as all the last data is being
processed.</p>
<p>As any Scipion project, the directory placed at</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$SCIPION_USER_DATA</span>/projects/myAcquisitionProject
</pre></div>
</div>
<p>(where <cite>$SCIPION_USER_DATA</cite> usually is <cite>~/ScipionUserData</cite> and
<cite>myAcquisitionProject</cite> is the project name to export) is a self contained
project directory and, then, it can be exported to any other computer
in order to continue with an user-assisted and more in-deep processing
by just coping this directory to the <cite>$SCIPION_USER_DATA/projects</cite> on the
other computer. Take into account that this directory usually doesn’t contain
the initial movies to save disk space (this behavior can be modified in the
<em>Import Movies</em> protocol).</p>
<p>The procedure of creating manual workflows by adding every protocol to use it
might be tedious for a facility, where the same workflow will be usually
employed for most users (or a small number of different workflows).
For this reason, Scipion is able to automatically launch whole workflows by
means of (at least) 3 ways:</p>
<ul class="simple">
<li>Launching <a class="reference external" href="facilities-workflows#static-templates">static templates</a>.</li>
<li>Launching <a class="reference external" href="facilities-workflows#creating-custom-dynamic-templates">dynamic templates</a>.</li>
<li>Launching <a class="reference external" href="facilities-workflows#using-scipion-s-api">Python scripts using the Scipion’s API</a>.</li>
</ul>
<div class="section" id="id1">
<h2>Static templates<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>You can design a workflow by using Scipion GUI as usual. Adding an import,
attaching some processing protocols, including the summary monitor…
When you are happy with your workflow, you can export it by selecting all
protocols that you want to export (<em>ctrl+click</em> to select more than one)
and, then, click the <em>Export</em> button at top.
You can save it as a template (a <em>JSON</em> file) at any directory on your system.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../images/export-and-exportUpload-button.png"><img alt="export workflows" src="../../images/export-and-exportUpload-button.png" style="width: 350px;" /></a>
</div>
<p>Additionally, Scipion has a public workflows repository at
<a class="reference external" href="http://workflows.scipion.i2pc.es">http://workflows.scipion.i2pc.es</a>.
The workflows are classified in different categories, such as <strong>Data Collection</strong>,
2D classification, 3D classification, Model Building… If you click on a certain
workflow, you can see a preview of that workflow. Use the <em>mouse-wheel</em> to zoom
in/out, <em>click and drag</em> in an empty zone to move and click on a box/protocol
to inspect the internal parameters. You can download a certain workflow to any
directory on you system. In addition, anyone can upload workflows (without any
log up) by selecting all the protocols in your Scipion’s project
and by clicking <em>Export &amp; Upload</em>.</p>
<p>In order to launch any template (downloaded or made by yourself), open Scipion
and create an empty project. Then, you can import the workflow with <em>Project &gt;
Import Workflow</em> at the menu bar on top and browsing to where the template is
stored/downloaded (Scipion’s templates are <em>JSON</em> files).
As the template is opened, the workflow is loaded to the project as <em>saved</em>
protocols. At this point, you can check/modify any parameter of a certain
protocol by opening the protocol form by <em>right-click &gt; Edit</em> or <em>double-click</em>.
When you are happy with all the parameters, store the protocol by clicking <strong>Save</strong>
(do <strong>not</strong> click Execute/Schedule). When you are happy with all protocols,
select the <em>Import</em> protocol, <em>right-click &gt; Restart workflow</em>.
Then, the <em>Import</em> should start to import data and the rest of the protocols should
change to the <em>Schedule</em> mode. A scheduled protocol is waiting for ready
inputs, i.e. when all inputs become ready for it, that protocol should
automatically start to process the incoming data changing to the <em>Running</em> mode.</p>
<p>Alternatively, a <em>JSON</em> template can be launched from the command line as follow</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scipion python pyworkflow/project/scripts/create.py <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;myAcquisition&quot;</span> <span class="nv">workflow</span><span class="o">=</span><span class="s2">&quot;path/to/your/workflow.json&quot;</span>
scipion python pyworkflow/project/scripts/schedule.py myAcquisition
scipion project myAcquisition
</pre></div>
</div>
<p>where the first command creates the project named <em>myAcquisition</em>
from the <cite>workflow.json</cite> file (in this case), the second starts the processing
and the third opens the Scipion GUI to see the project.</p>
</div>
<div class="section" id="id2">
<h2>Dynamic templates<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Usually, we always must set the same parameters that are specific for each acquisition,
such as deposition path, gain image path, dose per frame, particle size…
Then, in order to avoid manually editing this parameters by opening every protocol
in which belongs (using the procedure explained for the static templates in the
previous section), Scipion has a mode to open modified templates in such a way
that a wizard is launched asking for all that specific parameters, at once.</p>
<p>To see a demo of this you just have to run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scipion demo
</pre></div>
</div>
<p>This will pop up a small wizard like the one below</p>
<div class="figure align-center">
<img alt="Cryo EM Streaming demo wizard" src="https://user-images.githubusercontent.com/785633/33311258-87304f44-d424-11e7-844a-8360708fa7ed.png" />
</div>
<p>You can fill the form according to your data or just leave all the displayed
fields untouched since it goes right with the test data (*see requirements below).
As you click on the <em>Start demo</em> button, Scipion should appear with the new
project loaded and running in streaming mode.</p>
<p><em>Import movies</em> should already be importing files, whereas the rest should be
scheduled. As soon as there is any input available for each protocol, that protocol
will start processing it and making it available for the next protocol in line.
Also, the <em>Monitor summary</em> should be monitoring the progress and generating an
<em>HTML</em> report with the outcome of the data.</p>
<p><strong>(*) Requirements for the demo</strong>:</p>
<p>To run the demo as it is, you need to have installed</p>
<ul class="simple">
<li>scipion-em-motioncorr</li>
<li>scipion-em-grigoriefflab</li>
<li>scipion-em-eman</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scipion installp -p scipion-em-motioncorr -p scipion-em-grigoriefflab scipion-em-eman2
</pre></div>
</div>
<p><em>Notice that motioncor2 needs GPU acceleration.</em></p>
<p>In addition, the demo use either the jmbFalconMovies dataset for v1.2-Caligula
version or the relion13_tutorial dataset for later versions (also for devel branch).
Thus, you can download the dataset that you need by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scipion testdata --download jmbFalconMovies relion13_tutorial
</pre></div>
</div>
<div class="section" id="creating-custom-dynamic-templates">
<h3>Creating custom dynamic templates<a class="headerlink" href="#creating-custom-dynamic-templates" title="Permalink to this headline">¶</a></h3>
<p>The dynamic template explained above is just an example, but you can create your
custom dynamic templates according with your preferences,
system requirements/availability… using static templates
(explained in the previous section above) as a starting
points to create the dynamic ones.</p>
<p>A Scipion’s template is a <em>JSON</em> file, which
are composed by a list of all the protocols in the workflow.
In the figure below, we have highlight with a blue box
the <em>Import movies</em> protocol part,
where it has listed inside all the internal parameters/fields for
the <em>Import movies</em>, such as the label, the files path, the voltage,
the sampling rate… (underlined in yellow)</p>
<p>In a common <em>JSON</em> file, all fields are made of key-value pairs where <em>key</em>
(what is before ‘:’) is always a <em>string</em> and the <em>value</em> (what is after ‘:’)
can be a <em>string</em> (“something coated”), a <em>number</em>, a
<em>boolean</em> (true or false), a <em>list</em>, a <em>dictionary</em>, a <em>null</em>…
(<a class="reference external" href="https://www.json.org">more info</a>).</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../images/custom-scipion-demo.png"><img alt="custom scipion demo" src="../../images/custom-scipion-demo.png" style="width: 900px;" /></a>
</div>
<p>Additionally, we have created a easy syntax
to add dynamic fields to that <em>JSON</em> file.
Then, to add a dynamic field, you only have to substitute the value
(what is after the ‘:’) of a certain field for a string starting and ending by
‘~’, and with three strings separated by ‘|’, something like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;~label|defaultValue|typeValue~&quot;</span>
</pre></div>
</div>
<p>where <em>label</em> will be the name for the filed in the form, <em>defaultValue</em> will
be the default value inserted in that field and <em>typeValue</em> is a number fixing
the type of the value (0 for <em>strings</em>, 1 for <em>booleans</em>, 2 for <em>paths</em>,
3 for <em>integers</em>, and 4 for <em>floats</em>).</p>
<p>In the figure above, there are three examples: the <em>filesPath</em>, <em>dosePerFrame</em>
and <em>gainFile</em> fields (follow the arrows to see their behavior).
In this case all three belongs to the same protocol.
However there is no restriction in this way and, thus, you can add a dynamic
field to any parameter to any protocol.</p>
<p>Notice that the type for the <em>filesPath</em> field is set to 2, which means <em>path</em>,
then Scipion will check if this path exists before starting to process.
<em>gainFile</em> is set to 0 (<em>string</em>) to allow an empty value (to skip
using a gain image if not needed). Finally, the 4 (<em>float</em> type) set to the
<em>dosePerFrame</em> allows to introduce non integer values.</p>
<p>When you are happy with the modified <em>JSON</em> file, you must save it to</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$SCIPION_HOME</span>/pyworkflow/templates
</pre></div>
</div>
<p>where <em>$SCIPION_HOME</em> is where you have installed Scipion. The extension of this
file must be <strong>.json.template</strong>. You can make as dynamic templates as you want
by storing them in the mentioned directory with certain different file name
as long as they finishes with <strong>.json.template</strong>.</p>
<p>When more than one dynamic template are found in the
<em>$SCIPION_HOME/pyworkflow/templates</em> directory, then the command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scipion demo
</pre></div>
</div>
<p>opens a menu to choose the dynamic template to launch</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../images/multiple-choice-scipion-demo.png"><img alt="multiple choise scipion demo" src="../../images/multiple-choice-scipion-demo.png" style="width: 400px;" /></a>
</div>
</div>
</div>
<div class="section" id="using-scipion-s-api">
<h2>Using Scipion’s API<a class="headerlink" href="#using-scipion-s-api" title="Permalink to this headline">¶</a></h2>
<p>A Scipion’s project can be created, designed (adding protocols) and launched by
a Python script using the <a class="reference external" href="https://scipion-em.github.io/docs/api/pyworkflow.html">Scipion’s API</a>.</p>
<p>We have a repository destined to share Scipion’s scripts potentially useful in
<a class="reference external" href="https://github.com/I2PC/em-facilities">EM-facilities</a>.
Specially, we have an example of <a href="#id3"><span class="problematic" id="id4">`</span></a>creating a Scipion’s project using the API</p>
<blockquote>
<div>&lt;<a class="reference external" href="https://github.com/I2PC/em-facilities/blob/master/usingAPI_demo/acquisition_workflow.py">https://github.com/I2PC/em-facilities/blob/master/usingAPI_demo/acquisition_workflow.py</a>&gt;`_.</div></blockquote>
<p>See the <a class="reference external" href="acquisition-simulation">acquisition simulation</a> section to learn how
to use this script.</p>
<p>Go to <a class="reference external" href="facilities-API-demo">API workflows</a> to see in detail how to make
projects with a Python script.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="acquisition-simulation.html" class="btn btn-neutral float-right" title="Tutorial for Facilities" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="facilities.html" class="btn btn-neutral float-left" title="Streaming Processing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: release-2.0.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../gh-pages/docs/facilities/facilities-workflows.html">gh-pages</a></dd>
            <dd><a href="facilities-workflows.html">release-2.0.0</a></dd>
            <dd><a href="../../../release-3.0.0/docs/facilities/facilities-workflows.html">release-3.0.0</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>