

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Scipion in the EGI Federated Cloud &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/install-from-sources.html">Installing Scipion v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities.html">Streaming Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/acquisition-simulation.html">Tutorial for Facilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/pyworkflow/pyworkflow.html">pyworkflow package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pwem/pwem.html">pwem package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/xmipp3/xmipp3.html">xmipp3 package</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Scipion in the EGI Federated Cloud</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/docs/developer/scipion-on-the-egi-federated-cloud.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="figure">
<a class="reference internal image-reference" href="../../_images/scipion_logo.gif"><img alt="scipion logo" src="../../_images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="scipion-in-the-egi-federated-cloud">
<span id="scipion-on-the-egi-federated-cloud"></span><h1>Scipion in the EGI Federated Cloud<a class="headerlink" href="#scipion-in-the-egi-federated-cloud" title="Permalink to this headline">¶</a></h1>
<p>EGI Federated Cloud is a seamless grid of academic private clouds and virtualised resources, built around open standards and focusing on the requirements of the scientific community.
It can be found under ‘Cloud Compute on the <a class="reference external" href="https://www.egi.eu/services/">EGI services catalog</a>.</p>
<p>More information can be found on <a class="reference external" href="https://www.egi.eu/federation/egi-federated-cloud/">EGI Federated Cloud</a> web site.</p>
<div class="section" id="how-to-use-scipion-in-the-egi-federated-cloud">
<h2>How to use Scipion in the EGI Federated Cloud<a class="headerlink" href="#how-to-use-scipion-in-the-egi-federated-cloud" title="Permalink to this headline">¶</a></h2>
<p>For extended documentation have a look at the <a class="reference external" href="https://wiki.egi.eu/wiki/Federated_Cloud_user_support">User support</a> site but in summary the steps are:</p>
<div class="section" id="user-registration">
<h3>User registration<a class="headerlink" href="#user-registration" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Request a X509 certificate.</p>
<blockquote>
<div><p>Yo can obtain a certificate from your national <a class="reference external" href="https://www.eugridpma.org/members/worldmap/">IGTF Certificate Authority (CA)</a>.
In Spain the CA in charge of issuing these types of certificates is TCS and the steps for CSIC are:</p>
<blockquote>
<div><ul class="simple">
<li>Go to <a class="reference external" href="https://digicert.com/sso">https://digicert.com/sso</a></li>
<li>Write “csic” in the field and select the option with the institution full name. Click on “Start single sign-on”</li>
<li>Provide your CSIC intranet credentials</li>
<li>Fill up the form, select Grid Premium as the certificate type, expiration date and e-mail</li>
<li>Click on “Request  Certificate” and the certificate will be automatically generated and installed on the browser</li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
<li><p class="first">Become part of a supported Virtual Organization (VO):</p>
<blockquote>
<div><ul class="simple">
<li>List of existing VOs can be found link:http://operations-portal.egi.eu/vo/search[here].
In our case, due to our participation in MoBrain and Westlife projects we belong to <cite>enmr.eu</cite>. link:https://voms2.cnaf.infn.it:8443/voms/enmr.eu/[Request access].</li>
<li>There is a ‘test’ VO that can be used to try the EGI cloud for 6 months, it is called fedcloud.egi.eu and access can be requested link:https://perun.metacentrum.cz/cert/registrar/?vo=fedcloud.egi.eu[here].</li>
<li>It is also possible to create a new VO. Follow their link:https://wiki.egi.eu/wiki/PROC14_VO_Registration[VO Registration procedure] and they can invite sites from the infrastructure to support the VO.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Most of the EGI services are accessible using the link:https://www.egi.eu/services/check-in/[EGI CheckIn service]. This authentication service accepts different ‘Identity Providers’:</p>
</li>
</ul>
<div class="figure align-center">
<img alt="EGI CheckIn Identity providers" src="../../_images/EGI-CheckIn-providers.png" />
</div>
<p>It is possible to login with your X509 certificate (once you upload it to the web browser), using Social network accounts such as Google, or with your EduGAIN credentials, among others.</p>
</div>
<div class="section" id="accessing-the-egi-cloud-resources">
<h3>Accessing the EGI cloud resources<a class="headerlink" href="#accessing-the-egi-cloud-resources" title="Permalink to this headline">¶</a></h3>
<p>The user can interact with IaaS cloud resources via programming APIs, command line interfaces or Web dashboards.</p>
<ul>
<li><p class="first">Using the OCCI client</p>
<blockquote>
<div><ul class="simple">
<li>Install and configure <a class="reference external" href="https://wiki.egi.eu/wiki/HOWTO11">OCCI client</a></li>
<li>Browse the <a class="reference external" href="https://appdb.egi.eu/browse/cloud">Application Database Cloud Marketplace</a> the available Virtual Appliances</li>
<li>There are two ScipionCloud appliances: one GPU enabled and one for non GPU machines (this one can also be used on a non GPU machine but it has some extra software which is useless and occupy disk space).</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>On the ‘Availability and Usage’ section below you should see a list of VO’s that endorse this appliance, and for each VO, the list of cloud sites where it can be instantiated.</p>
<blockquote>
<div><ul class="simple">
<li>Get the IDs for starting the appliance at one of the sites.</li>
<li><a class="reference external" href="https://wiki.egi.eu/wiki/HOWTO11#Proxy_Generation">Create a VOMS proxy</a> for getting access to the infrastructure</li>
<li>In order to use VAs you will need to perform some contextualisation, which is the process of customising the appliance when it is instantiated on the resources, e.g. entering some credentials to log into the VM.</li>
</ul>
</div></blockquote>
<p>You have the contextualization script to use on the AppDB entry for the appliance, just modify your public key and vncpassword.</p>
<blockquote>
<div><ul class="simple">
<li>Now you can use the client to <a class="reference external" href="https://wiki.egi.eu/wiki/FAQ10#How_can_I_start_a_VM.3F">start</a> the VM using the IDs obtained from AppDB and passing the contextualization script.</li>
<li>Depending on the cloud provider you may need to allocate a public IP for the VM, check this <a class="reference external" href="https://wiki.egi.eu/wiki/FAQ10#How_can_I_assign_a_public_IP_to_a_VM.3F">FAQ</a> to assign a public IP to a VM in the Federated Cloud.</li>
<li>You can connect to the VM and start using it by login using ssh: <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">-i</span> <span class="pre">YOURPRIVATEKEY</span> <span class="pre">ubuntu&#64;VMIP</span></code> (ubuntu is the default username for the Ubuntu images in AppDB) or pointing your web browser to <a class="reference external" href="http://VMIP:8000/vnc.html">http://VMIP:8000/vnc.html</a> and entering the password you set up on the contextualization script.</li>
</ul>
</div></blockquote>
<p>The following shows examples of the most useful occi commands. Extended info can be found at the link:https://wiki.egi.eu/wiki/HOWTO11_How_to_use_the_rOCCI_Client[FedCloud OCCI tutorial]. For troubleshooting, you can add “–debug” to any of the commands.</p>
</div>
<div class="section" id="list-commands">
<h3>List commands<a class="headerlink" href="#list-commands" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show own compute resources (Virtual Machines)</span>
occi --endpoint https://carach5.ics.muni.cz:11443  --auth x509 --user-cred myproxy-enmr.pem --voms --action list --resource compute

<span class="c1"># Show own storage resources (Block Storage)</span>
occi --endpoint https://carach5.ics.muni.cz:11443  --auth x509 --user-cred myproxy-enmr.pem --voms --action list --resource storage

<span class="c1"># Show OS templates (VM images) available</span>
<span class="c1"># You can use one of these templates to instantiate a Virtual Machine (VM)</span>
occi --endpoint https://carach5.ics.muni.cz:11443  --auth x509 --user-cred myproxy-enmr.pem --voms --action list --resource os_tpl

<span class="c1"># Show resource templates (flavors)  available</span>
occi --endpoint https://carach5.ics.muni.cz:11443  --auth x509 --user-cred myproxy-enmr.pem --voms --action list --resource resource_tpl

<span class="c1"># Describe any of the resources listed with the above commands</span>
occi --endpoint https://carach5.ics.muni.cz:11443  --auth x509 --user-cred myproxy-enmr.pem --voms --action describe --resource RESOURCE_URL
</pre></div>
</div>
</div>
<div class="section" id="instantiation-command">
<h3>Instantiation command<a class="headerlink" href="#instantiation-command" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instantiate a VM</span>
<span class="c1"># You have to specify OS template and hardware flavor as mixin parameters (see list commands above)</span>
occi --endpoint https://carach5.ics.muni.cz:11443  --auth x509 --user-cred myproxy-enmr.pem --voms --action create --resource compute --attribute occi.core.title<span class="o">=</span><span class="s2">&quot;ScipionVM&quot;</span> --mixin OS_TEMPLATE --mixin FLAVOUR  --context <span class="nv">user_data</span><span class="o">=</span><span class="s2">&quot;file://</span><span class="nv">$PWD</span><span class="s2">/tmpfedcloud.login&quot;</span>
</pre></div>
</div>
<p>The <cite>user_data</cite> file is a contextualization script that follows <code class="docutils literal notranslate"><span class="pre">cloud-init</span></code> syntax.</p>
</div>
<div class="section" id="storage-commands">
<h3>Storage commands<a class="headerlink" href="#storage-commands" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a Block Storage (BS). occi.storage.size is measured in GB</span>
occi --endpoint https://carach5.ics.muni.cz:11443  --auth x509 --user-cred myproxy-enmr.pem --voms --action create --resource storage -t occi.storage.size<span class="o">=</span><span class="s1">&#39;num(30)&#39;</span>,occi.core.title<span class="o">=</span><span class="s1">&#39;ScipionBS&#39;</span>
<span class="c1"># Attach BS to VM</span>
occi --endpoint https://carach5.ics.muni.cz:11443  --auth x509 --user-cred myproxy-enmr.pem --voms --action link --resource VM_URL -j BS_ID
<span class="c1"># Detach BS from VM</span>
<span class="c1"># Note: the storage link can be found in VM description</span>
occi --endpoint https://carach5.ics.muni.cz:11443  --auth x509 --user-cred myproxy-enmr.pem --voms --action unlink --resource STORAGE_LINK
<span class="c1"># Delete BS</span>
<span class="c1"># Note: you cannot delete the disks that contain VM images</span>
occi --endpoint https://carach5.ics.muni.cz:11443 --auth x509 --user-cred myproxy-enmr.pem --voms --action delete --resource STORAGE_LINK
</pre></div>
</div>
</div>
</div>
<div class="section" id="network-commands">
<h2>Network commands<a class="headerlink" href="#network-commands" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show available networks</span>
occi --endpoint https://carach5.ics.muni.cz:11443  --auth x509 --user-cred myproxy-enmr.pem --voms --action list --resource network
<span class="c1"># Attach VM to network</span>
<span class="c1"># Note: sites such as CESNET attach new VMs to the public network by default.</span>
<span class="c1"># This provides a public IP address (if available) for the VM. Other sites, like INFN do not automatically do so.</span>
<span class="c1"># Besides, you might want to include a VM in a private network.</span>
occi --endpoint https://carach5.ics.muni.cz:11443  --auth x509 --user-cred myproxy-enmr.pem --voms --action link --resource VM_URL -j NETWORK_ID

<span class="c1"># Detach VM from network</span>
<span class="c1"># Note: the network link can be found in the VM description</span>
occi --endpoint https://carach5.ics.muni.cz:11443  --auth x509 --user-cred myproxy-enmr.pem --voms --action unlink --resource NETWORK_LINK
</pre></div>
</div>
<div class="section" id="life-cycle-trigger-action">
<h3>Life cycle (trigger action)<a class="headerlink" href="#life-cycle-trigger-action" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start/stop/reboot VM</span>
<span class="c1"># Note: actions to be triggered can be found in the VM description</span>
occi --endpoint https://carach5.ics.muni.cz:11443  --auth x509 --user-cred myproxy-enmr.pem --voms --action trigger --resource VM_URL --trigger-action ACTION_URL

<span class="c1"># Delete  VM</span>
<span class="c1"># Note: when deleting a VM, any block storage linked to it will remain.</span>
<span class="c1"># Such BS can be either deleted, or attached to other VM.</span>
occi --endpoint https://carach5.ics.muni.cz:11443  --auth x509 --user-cred myproxy-enmr.pem --voms --action delete --resource VM_URL
</pre></div>
</div>
<ul>
<li><p class="first">Using the VMOps dashboard</p>
<blockquote>
<div><ul>
<li><p class="first">Login to the <a class="reference external" href="https://dashboard.appdb.egi.eu/vmops">dashboard</a> using your EGI CheckIn credentials</p>
</li>
<li><p class="first">Click on “Create a new VM Topology” to start the topology builder wizard, this will guide you through a set of steps:</p>
</li>
<li><p class="first">select the Virtual Appliance (VA) you want to start, these are the same shown in the Application Database Cloud Marketplace, you can use the search field to find your VA (only the VAs endorsed by your VO(s) will be shown)</p>
</li>
<li><p class="first">select the VO to use when instantiating the VA;
select the site where to instantiate the VA; and finally</p>
</li>
<li><p class="first">select the template (flavour) of the instance that will determine the number of cores, memory, disk space and GPUs used in your VM.</p>
</li>
<li><p class="first">Now you will be presented with a summary page where you can further customise your VM by:</p>
<blockquote>
<div><ul class="simple">
<li>Adding more VMs to the topology</li>
<li>Adding block storage devices to the VMs</li>
<li>Define contextualisation parameters (e.g. add new users, execute some script)</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Click on “Launch” and your deployment will be submitted to the infrastructure</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>The topology you just created will appear on your “Topologies” with all the details about it, clicking on a VM of a topology will give you details about its status and IP. You can login into the VM with any user you created in the contextualisation parameters, even if you didn’t specify any users, the AppDB creates one for you and provides the credentials for login via ssh to the new VM.
If the VM has a default password, remember to replace it with a strong secret password immediately.</p>
<p><a class="reference external" href="scipionCloud-images-manual">ScipionCloud images</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: release-3.0.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../release-3.0.0/docs/developer/scipion-on-the-egi-federated-cloud.html">release-3.0.0</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>