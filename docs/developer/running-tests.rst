.. figure:: /docs/images/scipion_logo.gif
   :width: 250
   :alt: scipion logo

.. _running-tests:

==================
Running Tests
==================

From early stages in the development of Scipion, we have included a
number of automatic tests. There is an automatic tool (buildbot) that
executes periodically those tests and those executions can be
examined in http://scipion-test.cnb.csic.es:9980/#/

Some of these tests run very quick. Their main goal is to validate the
behavior of some important classes and functions (in the spirit of unit
tests).

Other tests are more focused on the execution of protocols and complete
workflows. They usually take more time to execute, and require some
input data (which should be downloaded automatically on demand).

In the following sections you will find a brief explanation about the
more important tests, and their input data. All of them must be executed 
from the command line using the specified commands.
.. contents:: Table of Contents


Small tests
============

Classes and functions
---------------------

+-----------+-----------------------------------------------------+
| Software  | scipion                                             |
+-----------+-----------------------------------------------------+
|           | ``scipion test pyworkflow.tests.model.test_object`` |
+-----------+-----------------------------------------------------+
|  Command  | ``scipion test pyworkflow.tests.model.test_mappers``|
+-----------+-----------------------------------------------------+
|           | ``scipion test pyworkflow.tests.em.data.test_data`` |
+-----------+-----------------------------------------------------+
|           | ``scipion tests xmipp3.tests.test_convert_xmipp``   |
+-----------+-----------------------------------------------------+

Spider MDA Workflow
--------------------

+-----------+-------------------------------------------------------+
| Software  | Spider                                                |
+-----------+-------------------------------------------------------+
| Command   | ``scipion test spider.tests.test_workflow_spiderMDA`` |
+-----------+-------------------------------------------------------+
|  Input    | Fake dataset of Worm Hemogoblin with 76 images        |
+-----------+-------------------------------------------------------+
|  Time     | ~50 sec                                               |
+-----------+-------------------------------------------------------+



EMX import
-----------

+-----------+-------------------------------------------------------------+
| Software  | scipion                                                     |
+-----------+-------------------------------------------------------------+
| Command   | ``scipion test emxlib.tests.test_protocols_emx``            |
+-----------+-------------------------------------------------------------+
|  Input    | The different data sets used in http://i2pc.cnb.csic.es/emx |
+-----------+-------------------------------------------------------------+
|  Time     | ~10 sec                                                     |
+-----------+-------------------------------------------------------------+


CTF Discrepancy
-----------------

+-----------+----------------------------------------------------------------------------------+
| Software  | Xmipp                                                                            |
+-----------+----------------------------------------------------------------------------------+
| Command   | ``scipion test pyworkflow.tests.em.workflows.test_workflow_xmipp_ctf_consensus`` |
+-----------+----------------------------------------------------------------------------------+
|  Input    | CTF obtained from micrograph of PcV                                              |
|           | (http://dx.doi.org/doi:10.1073/pnas.1404330111)                                  |
+-----------+----------------------------------------------------------------------------------+
|  Time     | ~10 sec                                                                          |
+-----------+----------------------------------------------------------------------------------+


Medium tests
============

Xmipp Workflow
---------------

+-----------+--------------------------------------------------------------------------------------+
| Software  | Xmipp                                                                                |
+-----------+--------------------------------------------------------------------------------------+
| Command   | ``scipion tests pyworkflow.tests.em.workflows.test_workflow_xmipp``                  |
+-----------+--------------------------------------------------------------------------------------+
|  Input    | Same data as in Xmipp Workflow. A refined volume generated with Frealign is obtained |
+-----------+--------------------------------------------------------------------------------------+
|  Time     | ~300 sec                                                                             |
+-----------+--------------------------------------------------------------------------------------+
|  CPU      | i7-2640M 2.8GHz, 8GB RAM                                                             |
+-----------+--------------------------------------------------------------------------------------+




Mixed Workflow 3D Reconstruction
--------------------------------
+-----------+--------------------------------------------------------------------------------------+
| Software  | Xmipp, CTFfind, EMAN, Frealign                                                       |
+-----------+--------------------------------------------------------------------------------------+
| Command   | ``scipion test pyworkflow.tests.em.workflows.test_workflow_mixed.TestMixedBPV``      |
+-----------+--------------------------------------------------------------------------------------+
|  Input    | Same data as in Xmipp Workflow. A refined volume generated with Frealign is obtained |
+-----------+--------------------------------------------------------------------------------------+
|  Time     | ~150 sec                                                                             |
+-----------+--------------------------------------------------------------------------------------+
|  CPU      | i7-2640M 2.8GHz, 8GB RAM                                                             |
+-----------+--------------------------------------------------------------------------------------+

Mixed Workflow Initial Volume
------------------------------

+-----------+--------------------------------------------------------------------------------------+
| Software  | Xmipp, CTFfind, EMAN, Frealign                                                       |
+-----------+--------------------------------------------------------------------------------------+
| Command   | ``scipion test pyworkflow.tests.em.workflows.test_workflow_mixed.TestMixedBPV2``     |
+-----------+--------------------------------------------------------------------------------------+
|  Input    | Same data as in Xmipp Workflow. An initial volume generated with EMAN is obtained    |
+-----------+--------------------------------------------------------------------------------------+
|  Time     | ~200 sec                                                                             |
+-----------+--------------------------------------------------------------------------------------+
|  CPU      | i7-2640M 2.8GHz, 8GB RAM                                                             |
+-----------+--------------------------------------------------------------------------------------+

Large Tests
===========

[WARNING]
The following tests must be run on computers with enough processing power.

Mixed Workflow Relion 2D classification
-------------------------------------------

+-----------+----------------------------------------------------------------------------------------------------+
| Software  | Xmipp, CTFfind, EMAN, Relion                                                                       |
+-----------+----------------------------------------------------------------------------------------------------+
| Command   | ``scipion test pyworkflow.tests.em.workflows.test_workflow_mixed_large.TestMixedRelionTutorial``   |
+-----------+----------------------------------------------------------------------------------------------------+
|  Input    | Dataset with 20 micrographs of the Ribosome.                                                       |
+-----------+----------------------------------------------------------------------------------------------------+
|  Time     | ~3*h* sec                                                                                          |
+-----------+----------------------------------------------------------------------------------------------------+
|  CPU      | 16 CPUs. Xeon(R) E5540 2.53 GHz, 64 GB RAM                                                         |
+-----------+----------------------------------------------------------------------------------------------------+


Mixed Workflow Frealign 3D classification
--------------------------------------------

+-----------+------------------------------------------------------------------------------------------------------+
| Software  | Xmipp, CTFfind, EMAN, Frealign                                                                       |
+-----------+------------------------------------------------------------------------------------------------------+
| Command   | ``scipion test pyworkflow.tests.em.workflows.test_workflow_mixed_large.TestMixedFrealignClassify``   |
+-----------+------------------------------------------------------------------------------------------------------+
|  Input    | Same data as in **Mixed Workflow Relion 2D classification**.                                         |
+-----------+------------------------------------------------------------------------------------------------------+
|  Time     | ~30 min                                                                                              |
+-----------+------------------------------------------------------------------------------------------------------+
|  CPU      | 16 CPUs. Xeon(R) E5540 2.53 GHz, 64 GB RAM                                                           |
+-----------+------------------------------------------------------------------------------------------------------+


Random Conical Tilt reconstruction
----------------------------------

+-----------+-------------------------------------------------------------------------+
| Software  | Xmipp                                                                   |
+-----------+-------------------------------------------------------------------------+
| Command   | ``scipion test pyworkflow.tests.em.workflows.test_workflow_xmipp_rct``  |
+-----------+-------------------------------------------------------------------------+
|  Input    |  Dataset with 6 pairs of untilted-tilted micrographs.                   |
+-----------+-------------------------------------------------------------------------+
|  Time     | ~15 min                                                                 |
+-----------+-------------------------------------------------------------------------+
|  CPU      | 4 CPUs. Intel(R) Core(TM) i7-2640M CPU @ 2.80GHz, 8 GB RAM              |
+-----------+-------------------------------------------------------------------------+


Procotol Tests
===============

Import different type of objects
---------------------------------

+-----------------------+------------------------------------------------------------------------------------+
| Software              | Scipion                                                                            |
+-----------------------+------------------------------------------------------------------------------------+
| Import micrographs    | ``scipion test pyworkflow.tests.em.protocols.test_protocols_import_micrographs``   |
+-----------------------+------------------------------------------------------------------------------------+
|  Import particles     |  ``scipion test pyworkflow.tests.em.protocols.test_protocols_import_particles``    |
+-----------------------+------------------------------------------------------------------------------------+
|  Import volumes       | ``scipion test pyworkflow.tests.em.protocols.test_protocols_import_volumes``       |
+-----------------------+------------------------------------------------------------------------------------+
|  Input                | From different datasets                                                            |
+-----------------------+------------------------------------------------------------------------------------+
|  Time                 | ~15 min                                                                            |
+-----------------------+------------------------------------------------------------------------------------+
|  CPU                  | i7-2640M 2.8GHz, 8GB RAM                                                           |
+-----------------------+------------------------------------------------------------------------------------+


Processing micrographs
-----------------------

+--------------------+----------------------------------------------------------------------------------------+
| Software           | Xmipp                                                                                  |
+--------------------+----------------------------------------------------------------------------------------+
| preprocess         | ``scipion test xmipp3.tests.test_protocols_xmipp_mics.TestXmippPreprocessMicrographs`` |
+--------------------+----------------------------------------------------------------------------------------+
|  ctf estimation    |  ``scipion test xmipp3.tests.test_protocols_xmipp_mics.TestXmippCTFEstimation``        |
+--------------------+----------------------------------------------------------------------------------------+
|  Extract Particles | ``scipion test xmipp3.tests.test_protocols_xmipp_mics.TestXmippExtractParticles``      |
+--------------------+----------------------------------------------------------------------------------------+
|  Software          | Grigoriefflab                                                                          |
+--------------------+----------------------------------------------------------------------------------------+
|  ctf estimation    | ``scipion test grigoriefflab.tests.test_protocols_grigoriefflab.TestCtffind4``         |
+--------------------+----------------------------------------------------------------------------------------+
|  Input             | Dataset xmipp tutorial                                                                 |
+--------------------+----------------------------------------------------------------------------------------+
|  Time              |                                                                                        |
+--------------------+----------------------------------------------------------------------------------------+
|  CPU               | i7-2640M 2.8GHz, 8GB RAM                                                               |
+--------------------+----------------------------------------------------------------------------------------+



Preprocessing 2D
-----------------

+----------------------+----------------------------------------------------------------------------------+
| Software             | Xmipp                                                                            |
+----------------------+----------------------------------------------------------------------------------+
|  Create Mask 2D      | ``scipion test xmipp3.tests.test_protocols_xmipp_2d.TestXmippCreateMask2D``      |
+----------------------+----------------------------------------------------------------------------------+
|  Apply Mask 2D       |  ``scipion test xmipp3.tests.test_protocols_xmipp_2d.TestXmippApplyMask2D``      |
+----------------------+----------------------------------------------------------------------------------+
|  Filter Particles    | ``scipion test xmipp3.tests.test_protocols_xmipp_2d.TestXmippFilterParticles``   |
+----------------------+----------------------------------------------------------------------------------+
|  Software            | Relion                                                                           |
+----------------------+----------------------------------------------------------------------------------+
| Preprocess Particles | ``scipion test relion.tests.test_protocols_relion.TestRelionPreprocess``         |
+----------------------+----------------------------------------------------------------------------------+
|  Input               | From different datasets                                                          |
+----------------------+----------------------------------------------------------------------------------+
|  Time                |  ~400 sec                                                                        |
+----------------------+----------------------------------------------------------------------------------+
|  CPU                 | i7-2640M 2.8GHz, 8GB RAM                                                         |
+----------------------+----------------------------------------------------------------------------------+

Particles alignment and classification
---------------------------------------

+----------------------+----------------------------------------------------------------------------------+
| Software             | Xmipp                                                                            |
+----------------------+----------------------------------------------------------------------------------+
|  ML2D                | ``scipion test xmipp3.tests.test_protocols_xmipp_2d.TestXmippML2D``              |
+----------------------+----------------------------------------------------------------------------------+
|  CL2D                |  ``scipion test xmipp3.tests.test_protocols_xmipp_2d.TestXmippCL2D``             |
+----------------------+----------------------------------------------------------------------------------+
|  CL2D Align          | ``scipion test xmipp3.tests.test_protocols_xmipp_2d.TestXmippProtCL2DAlign``     |
+----------------------+----------------------------------------------------------------------------------+
|  Apply Alignment     | ``scipion test xmipp3.tests.test_protocols_xmipp_2d.TestXmippApplyAlignment``    |
+----------------------+----------------------------------------------------------------------------------+
|  Rotational Spectra   | ``scipion test xmipp3.tests.test_protocols_xmipp_2d.TestXmippRotSpectra``       |
+----------------------+----------------------------------------------------------------------------------+
|  Kerdensom           | ``scipion test xmipp3.tests.test_protocols_xmipp_2d.TestXmippKerdensom``         |
+----------------------+----------------------------------------------------------------------------------+
|  Software            |  Relion                                                                          |
+----------------------+----------------------------------------------------------------------------------+
|  Classify 2D         | ``scipion test relion.tests.test_protocols_relion.TestRelionClassify2D``         |
+----------------------+----------------------------------------------------------------------------------+
|  Input               | Mda dataset                                                                      |
+----------------------+----------------------------------------------------------------------------------+
|  Time                | ``scipion test relion.tests.test_protocols_relion.TestRelionClassify2D``         |
+----------------------+----------------------------------------------------------------------------------+
|  CPU                 | i7-2640M 2.8GHz, 8GB RAM                                                         |
+----------------------+----------------------------------------------------------------------------------+


Preprocessing 3D
------------------
+----------------------+----------------------------------------------------------------------------------+
| Software             | Xmipp                                                                            |
+----------------------+----------------------------------------------------------------------------------+
|  Create Mask 3D      | ``scipion test xmipp3.tests.test_protocols_xmipp_3d.TestXmippCreateMask3D``      |
+----------------------+----------------------------------------------------------------------------------+
|  Apply Mask 3D       | ``scipion test xmipp3.tests.test_protocols_xmipp_3d.TestXmippApplyMask3D``       |
+----------------------+----------------------------------------------------------------------------------+
|  Filter Volumes      | ``scipion test xmipp3.tests.test_protocols_xmipp_3d.TestXmippFilterVolumes``     |
+----------------------+----------------------------------------------------------------------------------+
| Preprocess Volumes   | ``scipion test xmipp3.tests.test_protocols_xmipp_3d.TestXmippPreprocessVolumes`` |
+----------------------+----------------------------------------------------------------------------------+
|  Input               | Same data as in Xmipp Workflow.                                                  |
+----------------------+----------------------------------------------------------------------------------+
|  Time                |  ~400 sec                                                                        |
+----------------------+----------------------------------------------------------------------------------+
|  CPU                 | i7-2640M 2.8GHz, 8GB RAM                                                         |
+----------------------+----------------------------------------------------------------------------------+



Initial volume
---------------
+--------------------------+--------------------------------------------------------------------------------------------+
| Test                     | *Significant*                                                                              |
+--------------------------+--------------------------------------------------------------------------------------------+
| Software                 | Xmipp                                                                                      |
+--------------------------+--------------------------------------------------------------------------------------------+
|  Reconstruct significant | ``scipion test pyworkflow.tests.em.workflows.test_workflow_initialvolume.TestSignificant`` |
+--------------------------+--------------------------------------------------------------------------------------------+
|  Input                   | Groel data                                                                                 |
+--------------------------+--------------------------------------------------------------------------------------------+
|  Time                    |  ~27 min                                                                                   |
+--------------------------+--------------------------------------------------------------------------------------------+
|  CPU                     | 4 CPUs on Asimov                                                                           |
+--------------------------+--------------------------------------------------------------------------------------------+


Classify 3D
-------------

+--------------------------+--------------------------------------------------------------------------+
| Test                     | *Classify 3D*                                                            |
+--------------------------+--------------------------------------------------------------------------+
| Software                 | Relion                                                                   |
+--------------------------+--------------------------------------------------------------------------+
| Relion Classify 3D       | ``scipion test relion.tests.test_protocols_relion.TestRelionClassify3D`` |
+--------------------------+--------------------------------------------------------------------------+
|  Input                   | MDA data                                                                 |
+--------------------------+--------------------------------------------------------------------------+
|  Time                    | ~200 sec                                                                 |
+--------------------------+--------------------------------------------------------------------------+
|  CPU                     | i7-2640M 2.8GHz, 8GB RAM                                                 |
+--------------------------+--------------------------------------------------------------------------+

