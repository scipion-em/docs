

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ScipionCloud on Amazon Web Services EC2 &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../static/documentation_options.js"></script>
        <script type="text/javascript" src="../../static/jquery.js"></script>
        <script type="text/javascript" src="../../static/underscore.js"></script>
        <script type="text/javascript" src="../../static/doctools.js"></script>
        <script type="text/javascript" src="../../static/language_data.js"></script>
    
    <script type="text/javascript" src="../../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/install-from-sources.html">Installing Scipion v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities.html">Streaming Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/acquisition-simulation.html">Tutorial for Facilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/pyworkflow/pyworkflow.html">pyworkflow package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pwem/pwem.html">pwem package</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>ScipionCloud on Amazon Web Services EC2</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../sources/docs/developer/scipionCloud-on-amazon-web-services-ec2.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="figure">
<a class="reference internal image-reference" href="../../images/scipion_logo.gif"><img alt="scipion logo" src="../../images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="scipioncloud-on-amazon-web-services-ec2">
<span id="id1"></span><h1>ScipionCloud on Amazon Web Services EC2<a class="headerlink" href="#scipioncloud-on-amazon-web-services-ec2" title="Permalink to this headline">¶</a></h1>
<div class="section" id="creating-an-instance-virtual-machine">
<h2>Creating an instance (virtual machine)<a class="headerlink" href="#creating-an-instance-virtual-machine" title="Permalink to this headline">¶</a></h2>
<p>Depending on your computing needs, you can start ScipionCloud on a single node
(“instance”, in Amazon terminology), or using an elastic HPC cluster.</p>
<p>Amazon EC2 offers a wide range of instance types, that can be check
on <a class="reference external" href="https://aws.amazon.com/ec2/instance-types/">AWS instance types</a>.</p>
<ul class="simple">
<li>Connect to <a class="reference external" href="https://aws.amazon.com/">AWS console</a></li>
<li>Open the EC2 dashboard</li>
<li>Launch a ScipionCloud instance: Enter “Instances” panel, then click “Launch instance”. Follow the wizard filling in the required information:<ul>
<li>Choose the ScipionCloud AMI: in <em>“Community AMIs”</em> section, search for “scipion” and find the latest release. The ScipionCloud AMI is currently available only in Ireland region but if you would like to use it in a different region contact us and we will make a copy there.</li>
<li>Choose the instance type, according to how much resources (CPU, RAM, GPU, disk) you want to use. Regarding disk, you can use an integrated SSD disk, or attach an EBS Volumen. Press “Next: Configure instance details”</li>
<li>Configure instance:<ul>
<li>Number of instances: 1</li>
<li>Shutdown behavior: stop</li>
</ul>
</li>
<li>Add storage: specify the disk size of the system disk (that you can use also for data). Here you can also create a new volume of arbitrary size.</li>
<li>Tag instance: Add tag ‘Name’ and give a descriptive name.</li>
<li>Configure security group: by default, SSH is enabled. To use the remote desktop (web based), you need to open ports 443 (HTTPS) and 22 (SSH):</li>
<li>Click “Review and Launch”, then “Launch”</li>
</ul>
</li>
<li>In the “Select an existing key pair” panel, select “Create new key pair”, type the key pair name and click “Download” key pair. Finally, click “Launch instances” and then “View instances”</li>
</ul>
<p>Select your instance within the list of instances, and copy its public IP address. You will need this address to connect to the instance, whether via ssh or Remote Desktop.</p>
<p>Wait until the instance is initialized.</p>
</div>
<div class="section" id="accessing-an-instance">
<h2>Accessing an instance<a class="headerlink" href="#accessing-an-instance" title="Permalink to this headline">¶</a></h2>
<p>First, connect with SSH to your instance:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>chmod <span class="m">600</span> path/to/key.pem
ssh -i path/to/key.pem ubuntu@12.34.56.78 <span class="c1">#(use your IP)</span>
</pre></div>
</div>
<p>There is a performance problem the first time an instance is used
(explanation <a class="reference external" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-initialize.html">[here]</a>). If you want to avoid it you could follow instructions there.</p>
<p>Access the remote desktop from a browser with the URL and password provided.</p>
<p>If you see a “Your connection is not secure” warning, click on “Advanced”, “Add exception” and “Confirm Security Exception”.</p>
<p>This is how the remote desktop will look like:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../images/noVNC-desktop.png"><img alt="noVNC-desktop" src="../../images/noVNC-desktop.png" style="width: 800px;" /></a>
</div>
<p>To resize screen clicks on the Settings icon and choose <cite>Remote resizing</cite> as <cite>Scaling mode</cite>:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../images/noVNC-resize.png"><img alt="noVNC-resize" src="../../images/noVNC-resize.png" style="width: 250px;" /></a>
</div>
<p>To disconnect from the session click on the little arrow that appears on the left (see menu below) and click on the last option:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../images/noVNC-menu.png"><img alt="noVNC-menu" src="../../images/noVNC-menu.png" style="width: 250px;" /></a>
</div>
<p>IMPORTANT!! Do not disconnect from the top right corner, as in a physical machine. If you do so the machine will need to be reboot</p>
<p>There is a shortcut for Scipion on the desktop.</p>
<p>The following software is installed on the machine:</p>
<ul class="simple">
<li>Ubuntu 16</li>
<li>Scipion on /usr/local/scipion (alias scipion): git installation branch release-2.0 with the following EM plugins:<ul>
<li>Ctffind4 4.1.10</li>
<li>Gctf 1.06</li>
<li>Gautomatch 0.53</li>
<li>Eman 2.21</li>
<li>Frealing 9.07</li>
<li>Motioncor2 1.2.1</li>
<li>Relion 3.0</li>
<li>resmap   1.1.5s2</li>
<li>Spider 21.13</li>
<li>Summovie 1.0.2</li>
<li>Unblur 1.0.2</li>
<li>Xmipp 3.19.04</li>
<li>chimera 1.13.1</li>
</ul>
</li>
<li>Nvidia driver version 384</li>
<li>CUDA 8.0</li>
<li>TurboVNC 2.1.1 on</li>
<li>VirtualGL 2.5.2</li>
<li>noVNC</li>
</ul>
</div>
<div class="section" id="managing-instances">
<h2>Managing instances<a class="headerlink" href="#managing-instances" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Login to <a class="reference external" href="https://aws.amazon.com/">AWS console</a></li>
<li>Go to EC2 services</li>
<li>Select Instances on the left side menu</li>
<li>Select the instance and either click on ‘Actions’ or Right-click on the instance and select Instance State and the action required.<ul>
<li>Stop: the instance is turned off, but everything related to it is kept (IP address change unless you use Elastic IPs). You can power it on again with the Start command. While an instance is off, you are only charged for disk use.</li>
<li>Terminate: the instance is deleted, and all non-permanent storage dissappear. You should make sure all your data is safe before terminating an instance.</li>
<li>Change instance type: This can be useful when running EM workflows since one could start with a small machine for the preprocessing steps, or even with a GPU machine if needed, and then switch to a more powerful machine with higher memory for the classification and refinement steps. In order to change the type the VM needs to be stopped first, then click on “Options” and select “Instance settings / Change instance type”.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="using-external-ebs-volumes">
<h2>Using external EBS volumes<a class="headerlink" href="#using-external-ebs-volumes" title="Permalink to this headline">¶</a></h2>
<p>ScipionCloud image has a default disk of 30 Gb, which is clearly insufficient for storing real processing EM data.
When creating a Virtual Machine through the EC2 console, it is possible to specify a bigger disk for the VM, but you have to take into account that this disk cannot be resized and will disappear when the VM is terminated.
To avoid this problem it is a good practise to work with external EBS volumes attached to the VM, which can be used to store data and/or Scipion projects.</p>
<p>For a single instance of Scipion you can attach an EBS volume when creating the Virtual Machine from the EC2 console as explained on the section above.</p>
<p>Then log in the machine and follow these instructions:</p>
<ul class="simple">
<li>If the EBS volume has not been formatted run (assuming your EBS volume is attached on /dev/sdf device):</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo mkfs -t ext4 /dev/xvdf<span class="sb">`</span>
</pre></div>
</div>
<ul class="simple">
<li>Mount the EBS disk</li>
</ul>
<p>There is a /data folder where you could mount the disk but it is up to you to decide the mounting point.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo mount /dev/xvdf /data<span class="sb">`</span>
</pre></div>
</div>
<p>You could also create the EBS volume once the VM is up and running and attach it.
Go to the EC2 console and click on Elastic Block Store / Volumes, select Create Volume and choose size and the same Availability region where the VM is running.
Once the volume is created select it and choose Attach Volume action. Select the VM to which the volume will be attached and device (for instance /dev/sdf).</p>
<p>Then we can proceed with the same instructions as explained above.</p>
</div>
<div class="section" id="costs-on-aws">
<h2>Costs on AWS<a class="headerlink" href="#costs-on-aws" title="Permalink to this headline">¶</a></h2>
<p>The following prices are valid on April 2018 on the AWS Ireland region and are tax free.
Updated prices can be found <a class="reference external" href="https://aws.amazon.com/ec2/pricing/on-demand/">here</a>.</p>
<p>Using ScipionCloud on AWS will have the following costs:</p>
<div class="section" id="computing-instances">
<h3>Computing (instances)<a class="headerlink" href="#computing-instances" title="Permalink to this headline">¶</a></h3>
<p>Current processing is normally done using GPUs so we present here prices for GPU instance types on AWS.</p>
<p>AWS have different families of GPU instance types (P2, P3 and G3) which features and prices are shown below:</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../images/AWS-P2-prices.jpg"><img alt="AWS - P2 types" src="../../images/AWS-P2-prices.jpg" style="width: 500px;" /></a>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../images/AWS-G3-prices.jpg"><img alt="AWS - G3 types" src="../../images/AWS-G3-prices.jpg" style="width: 500px;" /></a>
</div>
<p>ScipionCloud has been extensively tested on P2 instances. G3 instances are
optimized for graphics but its features and compute capability allow them also
to be used to process with Scipion.</p>
<p>AWS EC2 allows to change type of an existing instance (it should be stopped first).
This can be used to choose the best type for each step of the processing
workflow although it should be carefully evaluated if the time waisted doing
this compensate the performance gained on the step. For instance, if a GPU
type is needed for <cite>movie alignment</cite> and then for <cite>classification</cite>,
<cite>CTF estimation</cite> and <cite>automatic picking</cite> could be done on a non GPU machine to
save some money, but it might not be worth the trouble to do it. However,
<cite>manual picking</cite> which could be a tedious and long task could be done on a less
powerful (and cheaper) machine, or even locally.</p>
</div>
<div class="section" id="storage">
<h3>Storage<a class="headerlink" href="#storage" title="Permalink to this headline">¶</a></h3>
<p>As described above on the <cite>Using external EBS volumes</cite> section, it is recommended
to attach an EBS volume big enough to store raw data and project.</p>
<p>EBS storage costs 0.11$ per GB which makes around 113$ per TB per month.</p>
<p>If the amount of movies to be processed require many TBs there are some
strategies to reduce the bill:</p>
<ul class="simple">
<li>Process movies locally and transfer only micrographs to the cloud</li>
<li>Transfer movies to a big EBS but as soon as they are aligned use a smaller EBS disk to continue processing (you could even have two disks, one for raw data and one for project and discard the first one when movies are aligned). You then should be certain that movies will not be required afterwards or you will have to transfer them again (it could compensate anyway if they are needed only at the end of processing). Another possibility will be to move movies from EBS to S3 or Glacier (another cheaper storage on AWS) while you do not need them and retrieve them if needed again.</li>
<li>Process on streaming: use Scipion streaming mode to process movies as they are transferred. You should take care of removing movies from disk as they are processed since Scipion will not do it.</li>
</ul>
</div>
<div class="section" id="transfer-data">
<h3>Transfer data<a class="headerlink" href="#transfer-data" title="Permalink to this headline">¶</a></h3>
<p>AWS does not charge for uploading data into the cloud but it does for downloading
data from it.
First GB per month is free but then it costs 0.09$ per GB (up to 10 TB,
then price slowly decrease).</p>
<p>For a more detailed evaluation of costs and performance you could have a look at
paper [ScipionCloud: An integrative and interactive gateway for large scale
cryo electron microscopy image processing on commercial and academic clouds.](<a class="reference external" href="https://doi.org/10.1016/j.jsb.2017.06.004">https://doi.org/10.1016/j.jsb.2017.06.004</a>)</p>
</div>
<div class="section" id="id4">
<h3><a class="reference external" href="https://github.com/I2PC/scipion/wiki/Scipion-HPC-clusters-on-AWS">[HPC clusters]</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: release-3.0.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../dm_facilitiesUpdate/docs/developer/scipionCloud-on-amazon-web-services-ec2.html">dm_facilitiesUpdate</a></dd>
            <dd><a href="../../release-2.0.0/docs/developer/scipionCloud-on-amazon-web-services-ec2.html">release-2.0.0</a></dd>
            <dd><a href="../../release-3.0.0/docs/developer/scipionCloud-on-amazon-web-services-ec2.html">release-3.0.0</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>