

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyworkflow.utils.utils &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/how-to-install.html">Installing Scipion v3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html#processing-how-to-s">Processing How Toâ€™s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/facilities.html">On-the-fly processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/customize-report.html">Summary Reports</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/api/scipion-API.html">Scipion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/api/plugins-API.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/api/xmipp-API.html">Xmipp API</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pyworkflow.utils.utils</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyworkflow.utils.utils</h1><div class="highlight"><pre>
<span></span><span class="c1"># **************************************************************************</span>
<span class="c1"># *</span>
<span class="c1"># * Authors:     J.M. De la Rosa Trevin (delarosatrevin@scilifelab.se) [1]</span>
<span class="c1"># *</span>
<span class="c1"># * [1] SciLifeLab, Stockholm University</span>
<span class="c1"># *</span>
<span class="c1"># * This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># * it under the terms of the GNU General Public License as published by</span>
<span class="c1"># * the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># * (at your option) any later version.</span>
<span class="c1"># *</span>
<span class="c1"># * This program is distributed in the hope that it will be useful,</span>
<span class="c1"># * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># * GNU General Public License for more details.</span>
<span class="c1"># *</span>
<span class="c1"># * You should have received a copy of the GNU General Public License</span>
<span class="c1"># * along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
<span class="c1"># *</span>
<span class="c1"># *  All comments concerning this program package may be sent to the</span>
<span class="c1"># *  e-mail address &#39;scipion@cnb.csic.es&#39;</span>
<span class="c1"># *</span>
<span class="c1"># **************************************************************************</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="k">import</span> <span class="n">Enum</span>

<span class="kn">import</span> <span class="nn">bibtexparser</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">from</span> <span class="nn">pyworkflow</span> <span class="k">import</span> <span class="n">Config</span>


<div class="viewcode-block" id="prettyDate"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.prettyDate">[docs]</a><span class="k">def</span> <span class="nf">prettyDate</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a datetime object or a int() Epoch timestamp and return a</span>
<span class="sd">    pretty string like &#39;an hour ago&#39;, &#39;Yesterday&#39;, &#39;3 months ago&#39;,</span>
<span class="sd">    &#39;just now&#39;, etc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">time</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">time</span><span class="p">:</span>
        <span class="c1"># Avoid now - now (sonar cloud bug)</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="n">now</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">copy</span>
    <span class="n">second_diff</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">seconds</span>
    <span class="n">day_diff</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">days</span>

    <span class="k">if</span> <span class="n">day_diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">day_diff</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">second_diff</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;just now&quot;</span>
        <span class="k">if</span> <span class="n">second_diff</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">second_diff</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; seconds ago&quot;</span>
        <span class="k">if</span> <span class="n">second_diff</span> <span class="o">&lt;</span> <span class="mi">120</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;a minute ago&quot;</span>
        <span class="k">if</span> <span class="n">second_diff</span> <span class="o">&lt;</span> <span class="mi">3600</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">second_diff</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; minutes ago&quot;</span>
        <span class="k">if</span> <span class="n">second_diff</span> <span class="o">&lt;</span> <span class="mi">7200</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;an hour ago&quot;</span>
        <span class="k">if</span> <span class="n">second_diff</span> <span class="o">&lt;</span> <span class="mi">86400</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">second_diff</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; hours ago&quot;</span>
    <span class="k">if</span> <span class="n">day_diff</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Yesterday&quot;</span>
    <span class="k">if</span> <span class="n">day_diff</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">day_diff</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; days ago&quot;</span>
    <span class="k">if</span> <span class="n">day_diff</span> <span class="o">&lt;</span> <span class="mi">31</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">day_diff</span> <span class="o">/</span> <span class="mi">7</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; weeks ago&quot;</span>
    <span class="k">if</span> <span class="n">day_diff</span> <span class="o">&lt;</span> <span class="mi">365</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">day_diff</span> <span class="o">/</span> <span class="mi">30</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; months ago&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">day_diff</span> <span class="o">/</span> <span class="mi">365</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; years ago&quot;</span></div>


<div class="viewcode-block" id="dateStr"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.dateStr">[docs]</a><span class="k">def</span> <span class="nf">dateStr</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">secs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dateFormat</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Get a normal string representation of datetime. </span>
<span class="sd">    If dt is None, use NOW.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dateFormat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dateFormat</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m-%Y&#39;</span>
        <span class="k">if</span> <span class="n">time</span><span class="p">:</span>
            <span class="n">dateFormat</span> <span class="o">+=</span> <span class="s1">&#39; %H:%M&#39;</span>
            <span class="k">if</span> <span class="n">secs</span><span class="p">:</span>
                <span class="n">dateFormat</span> <span class="o">+=</span> <span class="s1">&#39;:%S&#39;</span>

    <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">dateFormat</span><span class="p">)</span></div>


<span class="n">prettyTime</span> <span class="o">=</span> <span class="n">dateStr</span>


<div class="viewcode-block" id="prettyTimestamp"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.prettyTimestamp">[docs]</a><span class="k">def</span> <span class="nf">prettyTimestamp</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span></div>


<div class="viewcode-block" id="prettySize"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.prettySize">[docs]</a><span class="k">def</span> <span class="nf">prettySize</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Human friendly file size. &quot;&quot;&quot;</span>
    <span class="n">unit_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;bytes&#39;</span><span class="p">,</span> <span class="s1">&#39;kB&#39;</span><span class="p">,</span> <span class="s1">&#39;MB&#39;</span><span class="p">,</span> <span class="s1">&#39;GB&#39;</span><span class="p">,</span> <span class="s1">&#39;TB&#39;</span><span class="p">,</span> <span class="s1">&#39;PB&#39;</span><span class="p">],</span>
                         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">exponent</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">unit_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">quotient</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">**</span> <span class="n">exponent</span>
        <span class="n">unit</span><span class="p">,</span> <span class="n">num_decimals</span> <span class="o">=</span> <span class="n">unit_list</span><span class="p">[</span><span class="n">exponent</span><span class="p">]</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="s1">&#39;{:.</span><span class="si">%s</span><span class="s1">f} </span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">num_decimals</span>
        <span class="k">return</span> <span class="n">format_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">quotient</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;0 bytes&#39;</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;1 byte&#39;</span></div>


<div class="viewcode-block" id="prettyDelta"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.prettyDelta">[docs]</a><span class="k">def</span> <span class="nf">prettyDelta</span><span class="p">(</span><span class="n">timedelta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Remove the milliseconds of the timedelta. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">timedelta</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="prettyLog"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.prettyLog">[docs]</a><span class="k">def</span> <span class="nf">prettyLog</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cyan</span><span class="p">(</span><span class="n">prettyTime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">secs</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span> <span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="Timer"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.Timer">[docs]</a><span class="k">class</span> <span class="nc">Timer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Simple Timer base in datetime.now and timedelta. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Timer.tic"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.Timer.tic">[docs]</a>    <span class="k">def</span> <span class="nf">tic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span></div>

<div class="viewcode-block" id="Timer.getToc"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.Timer.getToc">[docs]</a>    <span class="k">def</span> <span class="nf">getToc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">prettyDelta</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dt</span><span class="p">)</span></div>

<div class="viewcode-block" id="Timer.toc"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.Timer.toc">[docs]</a>    <span class="k">def</span> <span class="nf">toc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Elapsed:&#39;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getToc</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="timeit"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.timeit">[docs]</a><span class="k">def</span> <span class="nf">timeit</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Decorator function to have a simple measurement</span>
<span class="sd">    of the execution time of a given function.</span>
<span class="sd">    Just use:</span>
<span class="sd">    @timeit</span>
<span class="sd">    def func(...)</span>
<span class="sd">        ...</span>
<span class="sd">    to use it.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">timedFunc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
        <span class="n">t</span><span class="o">.</span><span class="n">tic</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">toc</span><span class="p">(</span><span class="s2">&quot;Function &#39;</span><span class="si">%s</span><span class="s2">&#39; took&quot;</span> <span class="o">%</span> <span class="n">func</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">timedFunc</span></div>


<div class="viewcode-block" id="trace"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.trace">[docs]</a><span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="n">nlevels</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39; --&gt; &#39;</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
    <span class="c1"># Example:</span>
    <span class="c1">#   @trace(3)</span>
    <span class="c1">#   def doRefresh(...</span>
    <span class="c1"># gives as output whenever doRefresh is called lines like:</span>
    <span class="c1">#   text.py:486 _addFileTab --&gt; text.py:330 __init__ --&gt; doRefresh</span>

    <span class="k">def</span> <span class="nf">realTrace</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Decorator function to print stack call in a human-readable way.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">tracedFunc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">stack</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">extract_stack</span><span class="p">()[</span><span class="o">-</span><span class="n">nlevels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">stList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">stack</span><span class="p">))</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stList</span> <span class="o">+</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tracedFunc</span>

    <span class="k">return</span> <span class="n">realTrace</span></div>


<div class="viewcode-block" id="prettyDict"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.prettyDict">[docs]</a><span class="k">def</span> <span class="nf">prettyDict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="prettyXml"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.prettyXml">[docs]</a><span class="k">def</span> <span class="nf">prettyXml</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add indentation for XML elements for more human readable text. &quot;&quot;&quot;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">level</span> <span class="o">*</span> <span class="s2">&quot;  &quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;  &quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">for</span> <span class="n">_elem</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
            <span class="n">prettyXml</span><span class="p">(</span><span class="n">_elem</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_elem</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">_elem</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">_elem</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">i</span></div>


<div class="viewcode-block" id="getUniqueItems"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getUniqueItems">[docs]</a><span class="k">def</span> <span class="nf">getUniqueItems</span><span class="p">(</span><span class="n">originalList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Method to remove repeated items from one list </span>
<span class="sd">    originalList -- Original list with repeated items, or not.</span>
<span class="sd">    returns -- New list with the content of original list without repeated items</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">auxDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">resultList</span> <span class="o">=</span> <span class="p">[</span><span class="n">auxDict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">originalList</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">auxDict</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">resultList</span></div>


<div class="viewcode-block" id="executeRemoteX"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.executeRemoteX">[docs]</a><span class="k">def</span> <span class="nf">executeRemoteX</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">hostName</span><span class="p">,</span> <span class="n">userName</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Execute a remote command with X11 forwarding.</span>
<span class="sd">    Params:</span>
<span class="sd">        command: Command to execute.</span>
<span class="sd">        hostName: Remote host name.</span>
<span class="sd">        userName: User name.</span>
<span class="sd">        password: Password.</span>
<span class="sd">    Returns: </span>
<span class="sd">        Tuple with standard output and error output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scriptPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;sshAskPass.sh&quot;</span><span class="p">))</span>
    <span class="n">pswCommand</span> <span class="o">=</span> <span class="s2">&quot;echo &#39;&quot;</span> <span class="o">+</span> <span class="n">password</span> <span class="o">+</span> <span class="s2">&quot;&#39; | &quot;</span> <span class="o">+</span> <span class="n">scriptPath</span> <span class="o">+</span> <span class="s2">&quot; ssh -X &quot;</span> <span class="o">+</span> <span class="n">userName</span> <span class="o">+</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">hostName</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">command</span>
    <span class="kn">import</span> <span class="nn">subprocess</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">pswCommand</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span></div>


<div class="viewcode-block" id="executeRemote"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.executeRemote">[docs]</a><span class="k">def</span> <span class="nf">executeRemote</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">hostName</span><span class="p">,</span> <span class="n">userName</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Execute a remote command.</span>
<span class="sd">    Params:</span>
<span class="sd">        command: Command to execute.</span>
<span class="sd">        hostName: Remote host name.</span>
<span class="sd">        userName: User name.</span>
<span class="sd">        password: Password.</span>
<span class="sd">    Returns: </span>
<span class="sd">        Tuple with standard input, standard output and error output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">paramiko</span>
    <span class="n">ssh</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>
    <span class="n">ssh</span><span class="o">.</span><span class="n">load_system_host_keys</span><span class="p">()</span>
    <span class="n">ssh</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>
    <span class="n">ssh</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">hostName</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="n">userName</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="n">ssh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span></div>


<div class="viewcode-block" id="executeLongRemote"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.executeLongRemote">[docs]</a><span class="k">def</span> <span class="nf">executeLongRemote</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">hostName</span><span class="p">,</span> <span class="n">userName</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Execute a remote command.</span>
<span class="sd">    Params:</span>
<span class="sd">        command: Command to execute.</span>
<span class="sd">        hostName: Remote host name.</span>
<span class="sd">        userName: User name.</span>
<span class="sd">        password: Password.</span>
<span class="sd">    Returns: </span>
<span class="sd">        Tuple with standard input, standard output and error output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">paramiko</span>
    <span class="kn">import</span> <span class="nn">select</span>
    <span class="n">ssh</span> <span class="o">=</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">SSHClient</span><span class="p">()</span>
    <span class="n">ssh</span><span class="o">.</span><span class="n">load_system_host_keys</span><span class="p">()</span>
    <span class="n">ssh</span><span class="o">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="o">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span>
    <span class="n">ssh</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">hostName</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="n">userName</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="n">transport</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">get_transport</span><span class="p">()</span>
    <span class="n">channel</span> <span class="o">=</span> <span class="n">transport</span><span class="o">.</span><span class="n">open_session</span><span class="p">()</span>
    <span class="n">channel</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">exit_status_ready</span><span class="p">():</span>
            <span class="k">break</span>
        <span class="n">rl</span><span class="p">,</span> <span class="n">wl</span><span class="p">,</span> <span class="n">xl</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">channel</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">))</span></div>


<div class="viewcode-block" id="getLocalUserName"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getLocalUserName">[docs]</a><span class="k">def</span> <span class="nf">getLocalUserName</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Recover local machine user name.</span>
<span class="sd">    returns: Local machine user name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">getpass</span>
    <span class="k">return</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span></div>


<div class="viewcode-block" id="getLocalHostName"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getLocalHostName">[docs]</a><span class="k">def</span> <span class="nf">getLocalHostName</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">getHostName</span><span class="p">()</span></div>


<div class="viewcode-block" id="getHostName"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getHostName">[docs]</a><span class="k">def</span> <span class="nf">getHostName</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Return the name of the local machine. &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">socket</span>
    <span class="k">return</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span></div>


<div class="viewcode-block" id="getHostFullName"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getHostFullName">[docs]</a><span class="k">def</span> <span class="nf">getHostFullName</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Return the fully-qualified name of the local machine. &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">socket</span>
    <span class="k">return</span> <span class="n">socket</span><span class="o">.</span><span class="n">getfqdn</span><span class="p">()</span></div>


<div class="viewcode-block" id="isInFile"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.isInFile">[docs]</a><span class="k">def</span> <span class="nf">isInFile</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">filePath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Checks if given text is in the given file.</span>
<span class="sd">    params:</span>
<span class="sd">        text: Text to check.</span>
<span class="sd">        filePath : File path to check.</span>
<span class="sd">    returns: True if the given text is in the given file, </span>
<span class="sd">             False if it is not in the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">text</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span></div>


<div class="viewcode-block" id="getLineInFile"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getLineInFile">[docs]</a><span class="k">def</span> <span class="nf">getLineInFile</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">fileName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Find the line where the given text is located in the given file.</span>
<span class="sd">    params:</span>
<span class="sd">       text: Text to check.</span>
<span class="sd">       filePath : File path to check.</span>
<span class="sd">    returns: File number where the text was located.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<span class="c1"># ------------- Colored message strings -----------------------------</span>

<div class="viewcode-block" id="StrColors"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.StrColors">[docs]</a><span class="k">class</span> <span class="nc">StrColors</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">red</span> <span class="o">=</span> <span class="mi">31</span>
    <span class="n">green</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">yellow</span> <span class="o">=</span> <span class="mi">33</span>
    <span class="n">blue</span> <span class="o">=</span> <span class="mi">34</span>
    <span class="n">magenta</span> <span class="o">=</span> <span class="mi">35</span>
    <span class="n">cyan</span> <span class="o">=</span> <span class="mi">36</span></div>


<div class="viewcode-block" id="getColorStr"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getColorStr">[docs]</a><span class="k">def</span> <span class="nf">getColorStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add ANSI color codes to the string if there is a terminal sys.stdout.</span>
<span class="sd">    Params:</span>
<span class="sd">     text: text to be colored</span>
<span class="sd">     color: red or green</span>
<span class="sd">     bold: bold the text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">envVarOn</span><span class="p">(</span><span class="s1">&#39;SCIPION_SAFE_COLORS&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="n">attr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">bold</span><span class="p">:</span>
        <span class="n">attr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[</span><span class="si">%s</span><span class="s1">m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">attr</span><span class="p">),</span> <span class="n">text</span><span class="p">)</span></div>


<div class="viewcode-block" id="grayStr"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.grayStr">[docs]</a><span class="k">def</span> <span class="nf">grayStr</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">getColorStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">StrColors</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span></div>


<div class="viewcode-block" id="redStr"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.redStr">[docs]</a><span class="k">def</span> <span class="nf">redStr</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">getColorStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">StrColors</span><span class="o">.</span><span class="n">red</span><span class="p">)</span></div>


<div class="viewcode-block" id="greenStr"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.greenStr">[docs]</a><span class="k">def</span> <span class="nf">greenStr</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">getColorStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">StrColors</span><span class="o">.</span><span class="n">green</span><span class="p">)</span></div>


<div class="viewcode-block" id="yellowStr"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.yellowStr">[docs]</a><span class="k">def</span> <span class="nf">yellowStr</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">getColorStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">StrColors</span><span class="o">.</span><span class="n">yellow</span><span class="p">)</span></div>


<div class="viewcode-block" id="blueStr"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.blueStr">[docs]</a><span class="k">def</span> <span class="nf">blueStr</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">getColorStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">StrColors</span><span class="o">.</span><span class="n">blue</span><span class="p">)</span></div>


<div class="viewcode-block" id="magentaStr"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.magentaStr">[docs]</a><span class="k">def</span> <span class="nf">magentaStr</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">getColorStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">StrColors</span><span class="o">.</span><span class="n">magenta</span><span class="p">)</span></div>


<div class="viewcode-block" id="cyanStr"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.cyanStr">[docs]</a><span class="k">def</span> <span class="nf">cyanStr</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">getColorStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">StrColors</span><span class="o">.</span><span class="n">cyan</span><span class="p">)</span></div>


<div class="viewcode-block" id="ansi"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.ansi">[docs]</a><span class="k">def</span> <span class="nf">ansi</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return function that escapes text with ANSI color n.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">txt</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[</span><span class="si">%d%s</span><span class="s1">m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s1">&#39;;1&#39;</span> <span class="k">if</span> <span class="n">bold</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span></div>


<span class="n">black</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">yellow</span><span class="p">,</span> <span class="n">blue</span><span class="p">,</span> <span class="n">magenta</span><span class="p">,</span> <span class="n">cyan</span><span class="p">,</span> <span class="n">white</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">ansi</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">38</span><span class="p">))</span>
<span class="n">blackB</span><span class="p">,</span> <span class="n">redB</span><span class="p">,</span> <span class="n">greenB</span><span class="p">,</span> <span class="n">yellowB</span><span class="p">,</span> <span class="n">blueB</span><span class="p">,</span> <span class="n">magentaB</span><span class="p">,</span> <span class="n">cyanB</span><span class="p">,</span> <span class="n">whiteB</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ansi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">38</span><span class="p">)]</span>

<span class="c1"># -------------- Hyper text highlighting ----------------------------</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">We use a subset of TWiki hyper text conventions.</span>
<span class="sd">In particular:</span>
<span class="sd">    *some_text* will display some_text in bold</span>
<span class="sd">    _some_text_ will display some_text in italic</span>
<span class="sd">    Links:</span>
<span class="sd">        http://www.link-page.com  -&gt; hyperlink using the url as label</span>
<span class="sd">        [[http://www.link-page.com][Link page]] -&gt; hyperlink using &quot;Link page&quot; as label</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Types of recognized styles</span>
<span class="n">HYPER_BOLD</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span>
<span class="n">HYPER_ITALIC</span> <span class="o">=</span> <span class="s1">&#39;italic&#39;</span>
<span class="n">HYPER_LINK1</span> <span class="o">=</span> <span class="s1">&#39;link1&#39;</span>
<span class="n">HYPER_SCIPION_OPEN</span> <span class="o">=</span> <span class="s1">&#39;sci-open&#39;</span>
<span class="n">HYPER_LINK2</span> <span class="o">=</span> <span class="s1">&#39;link2&#39;</span>
<span class="n">HYPER_ALL</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>

<span class="c1"># Associated regular expressions</span>
<span class="n">PATTERN_BOLD</span> <span class="o">=</span> <span class="s2">&quot;(^|[\s])[*](?P&lt;bold&gt;[^\s*][^*]*[^\s*]|[^\s*])[*]&quot;</span>
<span class="c1"># PATTERN_BOLD = r&quot;[\s]+[*]([^\s][^*]+[^\s])[*][\s]+&quot;</span>
<span class="n">PATTERN_ITALIC</span> <span class="o">=</span> <span class="s2">&quot;(^|[\s])[_](?P&lt;italic&gt;[^\s_][^_]*[^\s_]|[^\s_])[_]&quot;</span>
<span class="c1"># PATTERN_ITALIC = r&quot;[\s]+[_]([^\s][^_]+[^\s])[_][\s]+&quot;</span>
<span class="n">PATTERN_LINK1</span> <span class="o">=</span> <span class="s1">&#39;(?P&lt;link1&gt;http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&amp;+#]|[!*\(\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+)&#39;</span>
<span class="n">PATTERN_LINK2</span> <span class="o">=</span> <span class="s2">&quot;[\[]</span><span class="si">{2}</span><span class="s2">(?P&lt;link2&gt;[^\s][^\]]+[^\s])[\]][\[](?P&lt;link2_label&gt;[^\s][^\]]+[^\s])[\]]</span><span class="si">{2}</span><span class="s2">&quot;</span>
<span class="c1"># __PATTERN_LINK2 should be first since it could contain __PATTERN_LINK1</span>
<span class="n">PATTERN_ALL</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">PATTERN_BOLD</span><span class="p">,</span> <span class="n">PATTERN_ITALIC</span><span class="p">,</span> <span class="n">PATTERN_LINK2</span><span class="p">,</span> <span class="n">PATTERN_LINK1</span><span class="p">])</span>

<span class="c1"># Compiled regex</span>
<span class="c1"># Not need now, each pattern compiled separately</span>
<span class="c1"># HYPER_REGEX = {</span>
<span class="c1">#               HYPER_BOLD: re.compile(PATTERN_BOLD),</span>
<span class="c1">#               HYPER_ITALIC: re.compile(PATTERN_ITALIC),</span>
<span class="c1">#               HYPER_LINK1: re.compile(PATTERN_LINK1),</span>
<span class="c1">#               HYPER_LINK2: re.compile(PATTERN_LINK1),</span>
<span class="c1">#               }</span>
<span class="n">HYPER_ALL_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">PATTERN_ALL</span><span class="p">)</span>


<div class="viewcode-block" id="parseHyperText"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.parseHyperText">[docs]</a><span class="k">def</span> <span class="nf">parseHyperText</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">matchCallback</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Parse the text recognizing Hyper definitions below.</span>
<span class="sd">    Params:</span>
<span class="sd">        matchCallback: a callback function to processing each matching,</span>
<span class="sd">                       it should accept the type of match (HYPER_BOLD, ITALIC or LINK)</span>
<span class="sd">    Return:</span>
<span class="sd">        The input text with the replacements made by matchCallback</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_match</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Call the proper matchCallback with some extra info. &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">HYPER_BOLD</span>
        <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">HYPER_ITALIC</span>
        <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">):</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">HYPER_LINK1</span>
        <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[[&#39;</span><span class="p">):</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">HYPER_LINK2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Bad prefix for HyperText match&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">matchCallback</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">HYPER_ALL_RE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_match</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span></div>


<span class="c1">#    for hyperMode, hyperRegex in HYPER_REGEX.iteritems():</span>
<span class="c1">#        text = hyperRegex.sub(lambda match: matchCallback(match, hyperMode), text)</span>
<span class="c1">#</span>
<span class="c1">#    return text</span>

<div class="viewcode-block" id="LazyDict"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.LazyDict">[docs]</a><span class="k">class</span> <span class="nc">LazyDict</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Dictionary to be initialized in the moment it is accessed for the first time.</span>
<span class="sd">    Initialization is done by a callback passed at instantiation&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="nb">dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; :param callback: method to initialize the dictionary. SHould return a dictionary&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>

<div class="viewcode-block" id="LazyDict.evaluate_callback"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.LazyDict.evaluate_callback">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_callback</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_callback</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_callback</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_callback</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">()</span></div>

<div class="viewcode-block" id="parseBibTex"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.parseBibTex">[docs]</a><span class="k">def</span> <span class="nf">parseBibTex</span><span class="p">(</span><span class="n">bibtexStr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Parse a bibtex file and return a dictionary. &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">bibtexparser</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">bibtexStr</span><span class="p">)</span><span class="o">.</span><span class="n">entries_dict</span></div>



<div class="viewcode-block" id="isPower2"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.isPower2">[docs]</a><span class="k">def</span> <span class="nf">isPower2</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return True if &#39;num&#39; is a power of 2. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">num</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">((</span><span class="n">num</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span></div>


<span class="c1"># ---------------------------------------------------------------------------</span>
<span class="c1"># Parsing of arguments</span>
<span class="c1"># ---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="getListFromRangeString"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getListFromRangeString">[docs]</a><span class="k">def</span> <span class="nf">getListFromRangeString</span><span class="p">(</span><span class="n">rangeStr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create a list of integers from a string with range definitions.</span>
<span class="sd">    Examples:</span>
<span class="sd">    &quot;1,5-8,10&quot; -&gt; [1,5,6,7,8,10]</span>
<span class="sd">    &quot;2,6,9-11&quot; -&gt; [2,6,9,10,11]</span>
<span class="sd">    &quot;2 5, 6-8&quot; -&gt; [2,5,6,7,8]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Split elements by command or space</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,| &#39;</span><span class="p">,</span> <span class="n">rangeStr</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">+=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If values are separated by comma also splitted </span>
            <span class="n">values</span> <span class="o">+=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">values</span></div>


<div class="viewcode-block" id="getRangeStringFromList"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getRangeStringFromList">[docs]</a><span class="k">def</span> <span class="nf">getRangeStringFromList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="n">left</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">right</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ranges</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">addRange</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span><span class="p">:</span>  <span class="c1"># Single element</span>
            <span class="n">ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">right</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%(left)d</span><span class="s2">-</span><span class="si">%(right)d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">right</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">right</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">right</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">addRange</span><span class="p">()</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">right</span> <span class="o">=</span> <span class="n">item</span>
    <span class="n">addRange</span><span class="p">()</span>
    <span class="k">return</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ranges</span><span class="p">)</span></div>


<div class="viewcode-block" id="getListFromValues"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getListFromValues">[docs]</a><span class="k">def</span> <span class="nf">getListFromValues</span><span class="p">(</span><span class="n">valuesStr</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert a string representing list items into a list.</span>
<span class="sd">    The items should be separated by spaces and a multiplier &#39;x&#39; can be used.</span>
<span class="sd">    If length is not None, then the last element will be repeated</span>
<span class="sd">    until the desired length is reached.</span>
<span class="sd">    Examples:</span>
<span class="sd">    &#39;1 1 2x2 4 4&#39; -&gt; [&#39;1&#39;, &#39;1&#39;, &#39;2&#39;, &#39;2&#39;, &#39;4&#39;, &#39;4&#39;]</span>
<span class="sd">    &#39;2x3, 3x4, 1&#39; -&gt; [&#39;3&#39;, &#39;3&#39;, &#39;4&#39;, &#39;4&#39;, &#39;4&#39;, &#39;1&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">valuesStr</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># &#39;x&#39; is not present in the chunk, single value</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">values</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># multiple the values by the number after &#39;x&#39;</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;More than one &#39;x&#39; is not allowed in list string value.&quot;</span><span class="p">)</span>

    <span class="c1"># If length is passed, we fill the list with </span>
    <span class="c1"># the last element until length is reached</span>
    <span class="k">if</span> <span class="n">length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="getFloatListFromValues"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getFloatListFromValues">[docs]</a><span class="k">def</span> <span class="nf">getFloatListFromValues</span><span class="p">(</span><span class="n">valuesStr</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert a string to a list of floats&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">getListFromValues</span><span class="p">(</span><span class="n">valuesStr</span><span class="p">,</span> <span class="n">length</span><span class="p">)]</span></div>


<div class="viewcode-block" id="getBoolListFromValues"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getBoolListFromValues">[docs]</a><span class="k">def</span> <span class="nf">getBoolListFromValues</span><span class="p">(</span><span class="n">valuesStr</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert a string to a list of booleans&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pyworkflow.object</span> <span class="k">import</span> <span class="n">Boolean</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">Boolean</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">getListFromValues</span><span class="p">(</span><span class="n">valuesStr</span><span class="p">,</span> <span class="n">length</span><span class="p">)]</span></div>


<div class="viewcode-block" id="getStringListFromValues"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getStringListFromValues">[docs]</a><span class="k">def</span> <span class="nf">getStringListFromValues</span><span class="p">(</span><span class="n">valuesStr</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert a string to a list of booleans&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pyworkflow.object</span> <span class="k">import</span> <span class="n">String</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">String</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">getListFromValues</span><span class="p">(</span><span class="n">valuesStr</span><span class="p">,</span> <span class="n">length</span><span class="p">)]</span></div>


<div class="viewcode-block" id="Environ"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.Environ">[docs]</a><span class="k">class</span> <span class="nc">Environ</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Some utilities to handle environment settings. &quot;&quot;&quot;</span>
    <span class="n">REPLACE</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">BEGIN</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">END</span> <span class="o">=</span> <span class="mi">2</span>

<div class="viewcode-block" id="Environ.getFirst"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.Environ.getFirst">[docs]</a>    <span class="k">def</span> <span class="nf">getFirst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">mandatory</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the value of the first key present in the environment.</span>
<span class="sd">        If none is found, returns the &#39;defaultValue&#39; parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mandatory</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;None of the variables: </span><span class="si">%s</span><span class="s2"> found in the Environment. &quot;</span>
                  <span class="s2">&quot;Please check scipion.conf files.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">keys</span><span class="p">)))</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Environ.set"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.Environ.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varName</span><span class="p">,</span> <span class="n">varValue</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">REPLACE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Modify the value for some variable.</span>
<span class="sd">        Params:</span>
<span class="sd">            varName: for example LD_LIBRARY_PATH</span>
<span class="sd">            varValue: the value to add or replace.</span>
<span class="sd">            position: controls how the value will be changed.</span>
<span class="sd">                If REPLACE, it will overwrite the value of</span>
<span class="sd">                the var.</span>
<span class="sd">                BEGIN or END will preserve the current value</span>
<span class="sd">                and add (at begin or end) the new value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">varName</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">position</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">REPLACE</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">BEGIN</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span> <span class="o">=</span> <span class="n">varValue</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">END</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span> <span class="o">+</span> <span class="n">varValue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span> <span class="o">=</span> <span class="n">varValue</span></div>

<div class="viewcode-block" id="Environ.update"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.Environ.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valuesDict</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">REPLACE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Use set for each key, value pair in valuesDict. &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">valuesDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span></div>

<div class="viewcode-block" id="Environ.addLibrary"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.Environ.addLibrary">[docs]</a>    <span class="k">def</span> <span class="nf">addLibrary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">libraryPath</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">BEGIN</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a path to LD_LIBRARY_PATH at the requested position</span>
<span class="sd">        if the provided paths exist. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">libraryPath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">existsVariablePaths</span><span class="p">(</span><span class="n">libraryPath</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;LD_LIBRARY_PATH&#39;</span><span class="p">:</span> <span class="n">libraryPath</span><span class="p">},</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some paths do not exist in: </span><span class="si">% s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">libraryPath</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="existsVariablePaths"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.existsVariablePaths">[docs]</a><span class="k">def</span> <span class="nf">existsVariablePaths</span><span class="p">(</span><span class="n">variableValue</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check if the path (or paths) in variableValue exists.</span>
<span class="sd">    Multiple paths are allowed if separated by os.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">variableValue</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">())</span></div>


<div class="viewcode-block" id="environAdd"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.environAdd">[docs]</a><span class="k">def</span> <span class="nf">environAdd</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">newValue</span><span class="p">,</span> <span class="n">valueFirst</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add a new value to some environ variable.</span>
<span class="sd">    If valueFirst is true, the new value will be at the beginning.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">varList</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">varName</span><span class="p">]]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">valueFirst</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">varList</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">newValue</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">varList</span><span class="p">)</span></div>


<div class="viewcode-block" id="envVarOn"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.envVarOn">[docs]</a><span class="k">def</span> <span class="nf">envVarOn</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Is variable set to True in the environment? &quot;&quot;&quot;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">varName</span><span class="p">)</span> <span class="k">if</span> <span class="n">env</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">varName</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="getMemoryAvailable"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getMemoryAvailable">[docs]</a><span class="k">def</span> <span class="nf">getMemoryAvailable</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Return the total memory of the system in MB &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">psutil</span> <span class="k">import</span> <span class="n">virtual_memory</span>
    <span class="k">return</span> <span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">//</span> <span class="mi">1024</span> <span class="o">**</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="startDebugger"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.startDebugger">[docs]</a><span class="k">def</span> <span class="nf">startDebugger</span><span class="p">(</span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">Config</span><span class="o">.</span><span class="n">debugOn</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># FIXME: rpdb2 does not support python 3</span>
            <span class="kn">from</span> <span class="nn">rpdb2</span> <span class="k">import</span> <span class="n">start_embedded_debugger</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting debugger...&quot;</span><span class="p">)</span>
            <span class="n">start_embedded_debugger</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error importing rpdb2 debugging module, consider installing winpdb.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="getFreePort"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getFreePort">[docs]</a><span class="k">def</span> <span class="nf">getFreePort</span><span class="p">(</span><span class="n">basePort</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">socket</span>
    <span class="n">port</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">basePort</span><span class="p">))</span>
        <span class="n">ipaddr</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">port</span></div>


<div class="viewcode-block" id="readProperties"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.readProperties">[docs]</a><span class="k">def</span> <span class="nf">readProperties</span><span class="p">(</span><span class="n">propsFile</span><span class="p">):</span>
    <span class="n">myprops</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">propsFile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>  <span class="c1"># removes trailing whitespace and &#39;\n&#39; chars</span>

            <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># skips blanks and comments w/o =</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
                <span class="k">continue</span>  <span class="c1"># skips comments which contain =</span>

            <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">myprops</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">myprops</span></div>


<span class="c1"># ---------------------Color utils --------------------------</span>
<div class="viewcode-block" id="hex_to_rgb"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.hex_to_rgb">[docs]</a><span class="k">def</span> <span class="nf">hex_to_rgb</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
    <span class="n">lv</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">lv</span> <span class="o">//</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lv</span><span class="p">,</span> <span class="n">lv</span> <span class="o">//</span> <span class="mi">3</span><span class="p">))</span></div>


<div class="viewcode-block" id="rgb_to_hex"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.rgb_to_hex">[docs]</a><span class="k">def</span> <span class="nf">rgb_to_hex</span><span class="p">(</span><span class="n">rgb</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;#</span><span class="si">%02x%02x%02x</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">rgb</span></div>


<div class="viewcode-block" id="lighter"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.lighter">[docs]</a><span class="k">def</span> <span class="nf">lighter</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">percent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;assumes color is rgb between (0, 0, 0) and (255, 255, 255)&quot;&quot;&quot;</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">white</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>
    <span class="n">vector</span> <span class="o">=</span> <span class="n">white</span> <span class="o">-</span> <span class="n">color</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">color</span> <span class="o">+</span> <span class="n">vector</span> <span class="o">*</span> <span class="n">percent</span><span class="p">))</span></div>


<div class="viewcode-block" id="formatExceptionInfo"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.formatExceptionInfo">[docs]</a><span class="k">def</span> <span class="nf">formatExceptionInfo</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">error_type</span><span class="p">,</span> <span class="n">error_value</span><span class="p">,</span> <span class="n">trbk</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
    <span class="n">tb_list</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_tb</span><span class="p">(</span><span class="n">trbk</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Error: </span><span class="si">%s</span><span class="s2"> </span><span class="se">\n</span><span class="s2">Description: </span><span class="si">%s</span><span class="s2"> </span><span class="se">\n</span><span class="s2">Traceback:&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">error_type</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                                      <span class="n">error_value</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tb_list</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">s</span></div>


<div class="viewcode-block" id="printTraceBack"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.printTraceBack">[docs]</a><span class="k">def</span> <span class="nf">printTraceBack</span><span class="p">():</span>
    <span class="n">traceback</span><span class="o">.</span><span class="n">print_stack</span><span class="p">()</span></div>


<div class="viewcode-block" id="getEnvVariable"><a class="viewcode-back" href="../../../api/pyworkflow/pyworkflow.utils.utils.html#pyworkflow.utils.utils.getEnvVariable">[docs]</a><span class="k">def</span> <span class="nf">getEnvVariable</span><span class="p">(</span><span class="n">variableName</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exceptionMsg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the value of an environment variable or raise an exception message.</span>
<span class="sd">    Useful when adding variable to the config file and report accurate messages&quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">variableName</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">exceptionMsg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">exceptionMsg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Environment variable </span><span class="si">%s</span><span class="s2"> not found. &quot;</span>
                        <span class="s2">&quot;Please check scipion configuration. &quot;</span>
                        <span class="s2">&quot;Try running : scipion config.&quot;</span> <span class="o">%</span> <span class="n">variableName</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">exceptionMsg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: pconesa-config--show
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../../dependabot_pip_jinja2-2.10.1/index.html">dependabot/pip/jinja2-2.10.1</a></dd>
            <dd><a href="../../../../gh-pages/index.html">gh-pages</a></dd>
            <dd><a href="utils.html">pconesa-config--show</a></dd>
            <dd><a href="../../../../release-2.0.0/index.html">release-2.0.0</a></dd>
            <dd><a href="../../../../release-3.0.0/index.html">release-3.0.0</a></dd>
            <dd><a href="../../../../rsanchezgarc-patch-1/index.html">rsanchezgarc-patch-1</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>