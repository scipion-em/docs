

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pwem.objects.data &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/how-to-install.html">Installing Scipion v3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html#processing-how-to-s">Processing How Toâ€™s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/facilities.html">On-the-fly processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/customize-report.html">Summary Reports</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/api/scipion-API.html">Scipion API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/api/plugins-API.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/api/xmipp-API.html">Xmipp API</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../pwem.html">pwem</a> &raquo;</li>
        
      <li>pwem.objects.data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pwem.objects.data</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># **************************************************************************</span>
<span class="c1"># *</span>
<span class="c1"># * Authors:     J.M. De la Rosa Trevin (jmdelarosa@cnb.csic.es)</span>
<span class="c1"># *</span>
<span class="c1"># * Unidad de  Bioinformatica of Centro Nacional de Biotecnologia , CSIC</span>
<span class="c1"># *</span>
<span class="c1"># * This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># * it under the terms of the GNU General Public License as published by</span>
<span class="c1"># * the Free Software Foundation; either version 3 of the License, or</span>
<span class="c1"># * (at your option) any later version.</span>
<span class="c1"># *</span>
<span class="c1"># * This program is distributed in the hope that it will be useful,</span>
<span class="c1"># * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># * GNU General Public License for more details.</span>
<span class="c1"># *</span>
<span class="c1"># * You should have received a copy of the GNU General Public License</span>
<span class="c1"># * along with this program; if not, write to the Free Software</span>
<span class="c1"># * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA</span>
<span class="c1"># * 02111-1307  USA</span>
<span class="c1"># *</span>
<span class="c1"># *  All comments concerning this program package may be sent to the</span>
<span class="c1"># *  e-mail address &#39;scipion@cnb.csic.es&#39;</span>
<span class="c1"># *</span>
<span class="c1"># **************************************************************************</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This modules contains basic hierarchy</span>
<span class="sd">for EM data objects like: Image, SetOfImage and others</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pyworkflow.object</span> <span class="k">import</span> <span class="p">(</span><span class="n">OrderedObject</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span>
                               <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">CsvList</span><span class="p">,</span> <span class="n">Boolean</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Pointer</span><span class="p">,</span>
                               <span class="n">Scalar</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">pwem.constants</span> <span class="k">import</span> <span class="p">(</span><span class="n">NO_INDEX</span><span class="p">,</span> <span class="n">ALIGN_NONE</span><span class="p">,</span> <span class="n">ALIGN_2D</span><span class="p">,</span> <span class="n">ALIGN_3D</span><span class="p">,</span>
                            <span class="n">ALIGN_PROJ</span><span class="p">,</span> <span class="n">ALIGNMENTS</span><span class="p">)</span>

<div class="viewcode-block" id="EMObject"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.EMObject">[docs]</a><span class="k">class</span> <span class="nc">EMObject</span><span class="p">(</span><span class="n">OrderedObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base object for all EM classes&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">OrderedObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getClassName</span><span class="p">()</span>

<div class="viewcode-block" id="EMObject.getFiles"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.EMObject.getFiles">[docs]</a>    <span class="k">def</span> <span class="nf">getFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get all filePaths &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="Acquisition"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Acquisition">[docs]</a><span class="k">class</span> <span class="nc">Acquisition</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Acquisition information&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_magnification</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;magnification&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="c1"># Microscope voltage in kV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_voltage</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;voltage&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="c1"># Spherical aberration in mm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sphericalAberration</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sphericalAberration&#39;</span><span class="p">,</span>
                                                     <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_amplitudeContrast</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;amplitudeContrast&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_doseInitial</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;doseInitial&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dosePerFrame</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dosePerFrame&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="c1"># Generic string to store information about optics groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opticsGroupInfo</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>

<div class="viewcode-block" id="Acquisition.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Acquisition.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Acquisition.getMagnification"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Acquisition.getMagnification">[docs]</a>    <span class="k">def</span> <span class="nf">getMagnification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_magnification</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Acquisition.setMagnification"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Acquisition.setMagnification">[docs]</a>    <span class="k">def</span> <span class="nf">setMagnification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_magnification</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Acquisition.getVoltage"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Acquisition.getVoltage">[docs]</a>    <span class="k">def</span> <span class="nf">getVoltage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_voltage</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Acquisition.setVoltage"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Acquisition.setVoltage">[docs]</a>    <span class="k">def</span> <span class="nf">setVoltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_voltage</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Acquisition.getSphericalAberration"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Acquisition.getSphericalAberration">[docs]</a>    <span class="k">def</span> <span class="nf">getSphericalAberration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sphericalAberration</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Acquisition.setSphericalAberration"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Acquisition.setSphericalAberration">[docs]</a>    <span class="k">def</span> <span class="nf">setSphericalAberration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sphericalAberration</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Acquisition.getAmplitudeContrast"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Acquisition.getAmplitudeContrast">[docs]</a>    <span class="k">def</span> <span class="nf">getAmplitudeContrast</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_amplitudeContrast</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Acquisition.setAmplitudeContrast"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Acquisition.setAmplitudeContrast">[docs]</a>    <span class="k">def</span> <span class="nf">setAmplitudeContrast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_amplitudeContrast</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Acquisition.getDoseInitial"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Acquisition.getDoseInitial">[docs]</a>    <span class="k">def</span> <span class="nf">getDoseInitial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_doseInitial</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Acquisition.setDoseInitial"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Acquisition.setDoseInitial">[docs]</a>    <span class="k">def</span> <span class="nf">setDoseInitial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_doseInitial</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Acquisition.getDosePerFrame"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Acquisition.getDosePerFrame">[docs]</a>    <span class="k">def</span> <span class="nf">getDosePerFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dosePerFrame</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Acquisition.setDosePerFrame"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Acquisition.setDosePerFrame">[docs]</a>    <span class="k">def</span> <span class="nf">setDosePerFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dosePerFrame</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    mag=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">    volt= </span><span class="si">%s</span><span class="se">\n</span><span class="s2">    Cs=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">    Q0=</span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> \
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_magnification</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_voltage</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sphericalAberration</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_amplitudeContrast</span><span class="o">.</span><span class="n">get</span><span class="p">())</span></div>


<div class="viewcode-block" id="CTFModel"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel">[docs]</a><span class="k">class</span> <span class="nc">CTFModel</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represents a generic CTF model. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusU</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;defocusU&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusV</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;defocusV&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngle</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;defocusAngle&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusRatio</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phaseShift</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;phaseShift&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;phaseShift&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusRatio</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_psdFile</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micObj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resolution</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fitQuality</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">strEx</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;None&quot;</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="si">%0.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span>

        <span class="n">ctfStr</span> <span class="o">=</span> <span class="s2">&quot;defU=</span><span class="si">{}</span><span class="s2">, defV=</span><span class="si">{}</span><span class="s2">, ast=</span><span class="si">{}</span><span class="s2">, &quot;</span> \
                 <span class="s2">&quot;psh=</span><span class="si">{}</span><span class="s2">, res=</span><span class="si">{}</span><span class="s2">, fit=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">strEx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_defocusU</span><span class="o">.</span><span class="n">get</span><span class="p">()),</span>
            <span class="n">strEx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_defocusV</span><span class="o">.</span><span class="n">get</span><span class="p">()),</span>
            <span class="n">strEx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngle</span><span class="o">.</span><span class="n">get</span><span class="p">()),</span>
            <span class="n">strEx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getPhaseShift</span><span class="p">()),</span>
            <span class="n">strEx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolution</span><span class="o">.</span><span class="n">get</span><span class="p">()),</span>
            <span class="n">strEx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fitQuality</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">ctfStr</span>

<div class="viewcode-block" id="CTFModel.getPhaseShift"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.getPhaseShift">[docs]</a>    <span class="k">def</span> <span class="nf">getPhaseShift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phaseShift</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phaseShift</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="CTFModel.setPhaseShift"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.setPhaseShift">[docs]</a>    <span class="k">def</span> <span class="nf">setPhaseShift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phaseShift</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFModel.hasPhaseShift"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.hasPhaseShift">[docs]</a>    <span class="k">def</span> <span class="nf">hasPhaseShift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPhaseShift</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="CTFModel.getResolution"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.getResolution">[docs]</a>    <span class="k">def</span> <span class="nf">getResolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolution</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFModel.hasResolution"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.hasResolution">[docs]</a>    <span class="k">def</span> <span class="nf">hasResolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolution</span><span class="o">.</span><span class="n">hasValue</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFModel.setResolution"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.setResolution">[docs]</a>    <span class="k">def</span> <span class="nf">setResolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resolution</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFModel.getFitQuality"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.getFitQuality">[docs]</a>    <span class="k">def</span> <span class="nf">getFitQuality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fitQuality</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFModel.setFitQuality"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.setFitQuality">[docs]</a>    <span class="k">def</span> <span class="nf">setFitQuality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fitQuality</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFModel.getDefocusU"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.getDefocusU">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocusU</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusU</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFModel.setDefocusU"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.setDefocusU">[docs]</a>    <span class="k">def</span> <span class="nf">setDefocusU</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusU</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFModel.getDefocusV"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.getDefocusV">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocusV</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusV</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFModel.setDefocusV"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.setDefocusV">[docs]</a>    <span class="k">def</span> <span class="nf">setDefocusV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusV</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFModel.getDefocusAngle"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.getDefocusAngle">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocusAngle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngle</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFModel.setDefocusAngle"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.setDefocusAngle">[docs]</a>    <span class="k">def</span> <span class="nf">setDefocusAngle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngle</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFModel.getDefocusRatio"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.getDefocusRatio">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocusRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusRatio</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFModel.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyAttributes</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;_defocusU&#39;</span><span class="p">,</span> <span class="s1">&#39;_defocusV&#39;</span><span class="p">,</span> <span class="s1">&#39;_defocusAngle&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;_defocusRatio&#39;</span><span class="p">,</span> <span class="s1">&#39;_psdFile&#39;</span><span class="p">,</span> <span class="s1">&#39;_micFile&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;_resolution&#39;</span><span class="p">,</span> <span class="s1">&#39;_fitQuality&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">hasPhaseShift</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setPhaseShift</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getPhaseShift</span><span class="p">())</span></div>

<div class="viewcode-block" id="CTFModel.getPsdFile"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.getPsdFile">[docs]</a>    <span class="k">def</span> <span class="nf">getPsdFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_psdFile</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFModel.setPsdFile"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.setPsdFile">[docs]</a>    <span class="k">def</span> <span class="nf">setPsdFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_psdFile</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFModel.getMicrograph"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.getMicrograph">[docs]</a>    <span class="k">def</span> <span class="nf">getMicrograph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micObj</span><span class="o">.</span><span class="n">copyObjId</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_micObj</span></div>

<div class="viewcode-block" id="CTFModel.setMicrograph"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.setMicrograph">[docs]</a>    <span class="k">def</span> <span class="nf">setMicrograph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mic</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micObj</span> <span class="o">=</span> <span class="n">mic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyObjId</span><span class="p">(</span><span class="n">mic</span><span class="p">)</span></div>

<div class="viewcode-block" id="CTFModel.getDefocus"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.getDefocus">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns defocusU, defocusV and defocusAngle. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_defocusU</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_defocusV</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngle</span><span class="o">.</span><span class="n">get</span><span class="p">())</span></div>

<div class="viewcode-block" id="CTFModel.setStandardDefocus"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.setStandardDefocus">[docs]</a>    <span class="k">def</span> <span class="nf">setStandardDefocus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defocusU</span><span class="p">,</span> <span class="n">defocusV</span><span class="p">,</span> <span class="n">defocusAngle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set defocus values following emx conventions.</span>
<span class="sd">        See _standardize function.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusU</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">defocusU</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusV</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">defocusV</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngle</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">defocusAngle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">standardize</span><span class="p">()</span></div>

<div class="viewcode-block" id="CTFModel.standardize"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.standardize">[docs]</a>    <span class="k">def</span> <span class="nf">standardize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Modify defocusU, defocusV and defocusAngle to conform</span>
<span class="sd">        the EMX standard: defocusU &gt; defocusV, 0 &lt;= defocusAngle &lt; 180</span>
<span class="sd">        and the defocusAnges is between x-axis and defocusU. Also</span>
<span class="sd">        determine the defocusRatio(defocusU/defocusV).</span>
<span class="sd">        For more details see:</span>
<span class="sd">        http://i2pc.cnb.csic.es/emx/LoadDictionaryFormat.htm?type=Convention#ctf</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusV</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusU</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_defocusV</span><span class="o">.</span><span class="n">swap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_defocusU</span><span class="p">)</span>  <span class="c1"># exchange defocuU by defocuV</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngle</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mf">90.</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngle</span> <span class="o">&gt;=</span> <span class="mf">180.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngle</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">-</span><span class="mf">180.</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngle</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngle</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mf">180.</span><span class="p">)</span>
        <span class="c1"># At this point defocusU is always greater than defocusV</span>
        <span class="c1"># following the EMX standard</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusRatio</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDefocusU</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefocusV</span><span class="p">())</span></div>

<div class="viewcode-block" id="CTFModel.equalAttributes"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.CTFModel.equalAttributes">[docs]</a>    <span class="k">def</span> <span class="nf">equalAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="p">[],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Override default behaviour to compare two</span>
<span class="sd">        CTF objects, now ignoring the psdFile.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_defocusU</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_defocusU</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_defocusV</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_defocusV</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAngle</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_defocusAngle</span>
                <span class="p">)</span></div></div>


<div class="viewcode-block" id="DefocusGroup"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.DefocusGroup">[docs]</a><span class="k">class</span> <span class="nc">DefocusGroup</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Groups CTFs by defocus&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusMin</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusMax</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusSum</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="DefocusGroup.getDefocusMin"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.DefocusGroup.getDefocusMin">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocusMin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusMin</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="DefocusGroup.getDefocusMax"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.DefocusGroup.getDefocusMax">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocusMax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusMax</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="DefocusGroup.getDefocusAvg"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.DefocusGroup.getDefocusAvg">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocusAvg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusSum</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span></div>

<div class="viewcode-block" id="DefocusGroup.getSize"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.DefocusGroup.getSize">[docs]</a>    <span class="k">def</span> <span class="nf">getSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="DefocusGroup.addCTF"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.DefocusGroup.addCTF">[docs]</a>    <span class="k">def</span> <span class="nf">addCTF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a new CTF to the group.</span>
<span class="sd">        Update values like min, max, avg and size.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="o">.</span><span class="n">increment</span><span class="p">()</span>
        <span class="n">defocusU</span> <span class="o">=</span> <span class="n">ctf</span><span class="o">.</span><span class="n">getDefocusU</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusMin</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">defocusU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusMin</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusMax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">defocusU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusMax</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defocusSum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_defocusSum</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">+</span> <span class="n">defocusU</span><span class="p">)</span></div>

<div class="viewcode-block" id="DefocusGroup.containsCTF"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.DefocusGroup.containsCTF">[docs]</a>    <span class="k">def</span> <span class="nf">containsCTF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return True if a CTF is inside the group defocus range. &quot;&quot;&quot;</span>
        <span class="n">defocusU</span> <span class="o">=</span> <span class="n">ctf</span><span class="o">.</span><span class="n">getDefocusU</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefocusMax</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">defocusU</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefocusMin</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="SetOfDefocusGroups"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfDefocusGroups">[docs]</a><span class="k">class</span> <span class="nc">SetOfDefocusGroups</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Store a set of several defocus groups.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputSet</span><span class="p">,</span>
                 <span class="n">groupRange</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                 <span class="n">groupMinSize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create necessary defocus groups.</span>
<span class="sd">        Params:</span>
<span class="sd">            inputSet: input particles or micrographs with CTF information.</span>
<span class="sd">            groupRange: maximum defocus range allowed in one group.</span>
<span class="sd">            groupMinSize: impose a minimum number of particles per group.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__createGroups</span><span class="p">(</span><span class="n">inputSet</span><span class="p">,</span> <span class="n">groupRange</span><span class="p">,</span> <span class="n">groupMinSize</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__createGroups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputSet</span><span class="p">,</span> <span class="n">groupRange</span><span class="p">,</span> <span class="n">groupMinSize</span><span class="p">):</span>
        <span class="n">iterSet</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">inputSet</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">orderBy</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_ctfModel._defocusU&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;id&#39;</span><span class="p">],</span>
                                          <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;ASC&#39;</span><span class="p">))</span>
        <span class="n">first</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iterSet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__addNewGroup</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">getCTF</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iterSet</span><span class="p">:</span>
            <span class="n">ctf</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getCTF</span><span class="p">()</span>
            <span class="c1"># Keep adding ctf to the current group</span>
            <span class="c1"># if the groupMinSize is not reached or</span>
            <span class="c1"># if the particle is inside the groupRange</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lastGroup</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span> <span class="o">&lt;</span>
                    <span class="n">groupMinSize</span> <span class="ow">or</span>
                    <span class="n">ctf</span><span class="o">.</span><span class="n">getDefocusU</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastDefocus</span> <span class="o">&lt;</span> <span class="n">groupRange</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lastGroup</span><span class="o">.</span><span class="n">addCTF</span><span class="p">(</span><span class="n">ctf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__addNewGroup</span><span class="p">(</span><span class="n">ctf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__addNewGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctf</span><span class="p">):</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">DefocusGroup</span><span class="p">()</span>
        <span class="n">group</span><span class="o">.</span><span class="n">addCTF</span><span class="p">(</span><span class="n">ctf</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">defocusU</span> <span class="o">=</span> <span class="n">ctf</span><span class="o">.</span><span class="n">getDefocusU</span><span class="p">()</span>
        <span class="n">groupName</span> <span class="o">=</span> <span class="s1">&#39;ctfgroup_</span><span class="si">%06d</span><span class="s1">_</span><span class="si">%05d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">defocusU</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">[</span><span class="n">groupName</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lastDefocus</span> <span class="o">=</span> <span class="n">defocusU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastGroup</span> <span class="o">=</span> <span class="n">group</span>

<div class="viewcode-block" id="SetOfDefocusGroups.getGroupByName"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfDefocusGroups.getGroupByName">[docs]</a>    <span class="k">def</span> <span class="nf">getGroupByName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the Group for a given Name.</span>
<span class="sd">        If not exists, return None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">groupName</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfDefocusGroups.getGroupByCTF"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfDefocusGroups.getGroupByCTF">[docs]</a>    <span class="k">def</span> <span class="nf">getGroupByCTF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the CTF group for this ctf. &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">containsCTF</span><span class="p">(</span><span class="n">ctf</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">group</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SetOfDefocusGroups.getDefocusMax"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfDefocusGroups.getDefocusMax">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocusMax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusMax</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfDefocusGroups.getDefocusAvg"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfDefocusGroups.getDefocusAvg">[docs]</a>    <span class="k">def</span> <span class="nf">getDefocusAvg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defocusAvg</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfDefocusGroups.getSize"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfDefocusGroups.getSize">[docs]</a>    <span class="k">def</span> <span class="nf">getSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_groups</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ImageDim"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.ImageDim">[docs]</a><span class="k">class</span> <span class="nc">ImageDim</span><span class="p">(</span><span class="n">CsvList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Just a wrapper to a CsvList to store image dimensions</span>
<span class="sd">    as X, Y and Z.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">CsvList</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pType</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

<div class="viewcode-block" id="ImageDim.getX"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.ImageDim.getX">[docs]</a>    <span class="k">def</span> <span class="nf">getX</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="ImageDim.getY"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.ImageDim.getY">[docs]</a>    <span class="k">def</span> <span class="nf">getY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="ImageDim.getZ"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.ImageDim.getZ">[docs]</a>    <span class="k">def</span> <span class="nf">getZ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;No-Dim&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> x </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getX</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getY</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getZ</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39; x </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getZ</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">s</span></div>


<div class="viewcode-block" id="Image"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image">[docs]</a><span class="k">class</span> <span class="nc">Image</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents an EM Image object&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Params:</span>
<span class="sd">        :param location: Could be a valid location: (index, filename)</span>
<span class="sd">        or  filename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Image location is composed by an index and a filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ctfModel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># _transform property will store the transformation matrix</span>
        <span class="c1"># this matrix can be used for 2D/3D alignment or</span>
        <span class="c1"># to represent projection directions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># default origin by default is box center =</span>
        <span class="c1"># (Xdim/2, Ydim/2,Zdim/2)*sampling</span>
        <span class="c1"># origin stores a matrix that using as input the point (0,0,0)</span>
        <span class="c1"># provides  the position of the actual origin in the system of</span>
        <span class="c1"># coordinates of the default origin.</span>
        <span class="c1"># _origin is an object of the class Transform shifts</span>
        <span class="c1"># units are A.</span>
        <span class="c1"># Origin coordinates follow the MRC convention</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">location</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLocation</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>

<div class="viewcode-block" id="Image.getSamplingRate"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getSamplingRate">[docs]</a>    <span class="k">def</span> <span class="nf">getSamplingRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return image sampling rate. (A/pix) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Image.setSamplingRate"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.setSamplingRate">[docs]</a>    <span class="k">def</span> <span class="nf">setSamplingRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sampling</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">sampling</span><span class="p">)</span></div>

<div class="viewcode-block" id="Image.getFormat"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getFormat">[docs]</a>    <span class="k">def</span> <span class="nf">getFormat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Image.getDataType"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getDataType">[docs]</a>    <span class="k">def</span> <span class="nf">getDataType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Image.getDimensions"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getDimensions">[docs]</a>    <span class="k">def</span> <span class="nf">getDimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getDimensions is redundant here but not in setOfVolumes</span>
<span class="sd">         create it makes easier to create protocols for both images</span>
<span class="sd">         and sets of images</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDim</span><span class="p">()</span></div>

<div class="viewcode-block" id="Image.getDim"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getDim">[docs]</a>    <span class="k">def</span> <span class="nf">getDim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return image dimensions as tuple: (Xdim, Ydim, Zdim)&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pwem.emlib.image</span> <span class="k">import</span> <span class="n">ImageHandler</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">ImageHandler</span><span class="p">()</span><span class="o">.</span><span class="n">getDimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span></div>

<div class="viewcode-block" id="Image.getXDim"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getXDim">[docs]</a>    <span class="k">def</span> <span class="nf">getXDim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDim</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Image.getYDim"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getYDim">[docs]</a>    <span class="k">def</span> <span class="nf">getYDim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDim</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Image.getIndex"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getIndex">[docs]</a>    <span class="k">def</span> <span class="nf">getIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Image.setIndex"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.setIndex">[docs]</a>    <span class="k">def</span> <span class="nf">setIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="Image.getFileName"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getFileName">[docs]</a>    <span class="k">def</span> <span class="nf">getFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Use the _objValue attribute to store filename. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Image.setFileName"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.setFileName">[docs]</a>    <span class="k">def</span> <span class="nf">setFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Use the _objValue attribute to store filename. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="Image.getLocation"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getLocation">[docs]</a>    <span class="k">def</span> <span class="nf">getLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This function return the image index and filename.</span>
<span class="sd">        It will only differs from getFileName, when the image</span>
<span class="sd">        is contained in a stack and the index make sense.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndex</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span></div>

<div class="viewcode-block" id="Image.setLocation"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.setLocation">[docs]</a>    <span class="k">def</span> <span class="nf">setLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the image location, see getLocation.</span>
<span class="sd">        Params:</span>
<span class="sd">            First argument can be:</span>
<span class="sd">             1. a tuple with (index, filename)</span>
<span class="sd">             2. a index, this implies a second argument with filename</span>
<span class="sd">             3. a filename, this implies index=NO_INDEX</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">index</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">first</span>
        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">index</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">first</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">index</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">NO_INDEX</span><span class="p">,</span> <span class="n">first</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;setLocation: unsupported type </span><span class="si">%s</span><span class="s1"> as input.&#39;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFileName</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="Image.getBaseName"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getBaseName">[docs]</a>    <span class="k">def</span> <span class="nf">getBaseName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">())</span></div>

<div class="viewcode-block" id="Image.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyAttributes</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;_samplingRate&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Image.copyLocation"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.copyLocation">[docs]</a>    <span class="k">def</span> <span class="nf">copyLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy location index and filename from other image. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setIndex</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getIndex</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFileName</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getFileName</span><span class="p">())</span></div>

<div class="viewcode-block" id="Image.hasCTF"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.hasCTF">[docs]</a>    <span class="k">def</span> <span class="nf">hasCTF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctfModel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Image.getCTF"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getCTF">[docs]</a>    <span class="k">def</span> <span class="nf">getCTF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the CTF model &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ctfModel</span></div>

<div class="viewcode-block" id="Image.setCTF"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.setCTF">[docs]</a>    <span class="k">def</span> <span class="nf">setCTF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newCTF</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ctfModel</span> <span class="o">=</span> <span class="n">newCTF</span></div>

<div class="viewcode-block" id="Image.hasAcquisition"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.hasAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">hasAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getVoltage</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getMagnification</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="Image.getAcquisition"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">getAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span></div>

<div class="viewcode-block" id="Image.setAcquisition"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.setAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">setAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acquisition</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="n">acquisition</span></div>

<div class="viewcode-block" id="Image.hasTransform"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.hasTransform">[docs]</a>    <span class="k">def</span> <span class="nf">hasTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Image.getTransform"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getTransform">[docs]</a>    <span class="k">def</span> <span class="nf">getTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span></div>

<div class="viewcode-block" id="Image.setTransform"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.setTransform">[docs]</a>    <span class="k">def</span> <span class="nf">setTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newTransform</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span> <span class="o">=</span> <span class="n">newTransform</span></div>

<div class="viewcode-block" id="Image.hasOrigin"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.hasOrigin">[docs]</a>    <span class="k">def</span> <span class="nf">hasOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Image.getOrigin"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getOrigin">[docs]</a>    <span class="k">def</span> <span class="nf">getOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;shifts in A&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasOrigin</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getDefaultOrigin</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_getDefaultOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sampling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Transform</span><span class="p">()</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDim</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">/</span> <span class="o">-</span><span class="mf">2.</span>
        <span class="n">t</span><span class="o">.</span><span class="n">setShifts</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="o">-</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">sampling</span><span class="p">,</span> <span class="n">y</span> <span class="o">/</span> <span class="o">-</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">sampling</span><span class="p">,</span> <span class="n">z</span> <span class="o">*</span> <span class="n">sampling</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span>  <span class="c1"># The identity matrix</span>

<div class="viewcode-block" id="Image.getShiftsFromOrigin"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getShiftsFromOrigin">[docs]</a>    <span class="k">def</span> <span class="nf">getShiftsFromOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOrigin</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">getShifts</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span></div>
        <span class="c1"># x, y, z are floats in Angstroms</span>

<div class="viewcode-block" id="Image.setShiftsInOrigin"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.setShiftsInOrigin">[docs]</a>    <span class="k">def</span> <span class="nf">setShiftsInOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOrigin</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">origin</span><span class="o">.</span><span class="n">setShifts</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span></div>

<div class="viewcode-block" id="Image.setOrigin"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.setOrigin">[docs]</a>    <span class="k">def</span> <span class="nf">setOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newOrigin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;shifts in A&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span> <span class="o">=</span> <span class="n">newOrigin</span></div>

<div class="viewcode-block" id="Image.originResampled"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.originResampled">[docs]</a>    <span class="k">def</span> <span class="nf">originResampled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">originNotResampled</span><span class="p">,</span> <span class="n">oldSampling</span><span class="p">):</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">()</span> <span class="o">/</span> <span class="n">oldSampling</span>
        <span class="n">shifts</span> <span class="o">=</span> <span class="n">originNotResampled</span><span class="o">.</span><span class="n">getShifts</span><span class="p">()</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOrigin</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">origin</span><span class="o">.</span><span class="n">setShifts</span><span class="p">(</span><span class="n">shifts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span><span class="p">,</span>
                         <span class="n">shifts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span><span class="p">,</span>
                         <span class="n">shifts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">origin</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; String representation of an Image. &quot;&quot;&quot;</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDim</span><span class="p">()</span>
        <span class="n">dimStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ImageDim</span><span class="p">(</span><span class="o">*</span><span class="n">dim</span><span class="p">))</span> <span class="k">if</span> <span class="n">dim</span> <span class="k">else</span> <span class="s1">&#39;No-Dim&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%0.2f</span><span class="s2"> â„«/px)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getClassName</span><span class="p">(),</span> <span class="n">dimStr</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">()</span> <span class="ow">or</span> <span class="mf">99999.</span><span class="p">))</span>

<div class="viewcode-block" id="Image.getFiles"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Image.getFiles">[docs]</a>    <span class="k">def</span> <span class="nf">getFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filePaths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">filePaths</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">filePaths</span></div></div>


<div class="viewcode-block" id="Micrograph"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Micrograph">[docs]</a><span class="k">class</span> <span class="nc">Micrograph</span><span class="p">(</span><span class="n">Image</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represents an EM Micrograph object &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Image</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micName</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>

<div class="viewcode-block" id="Micrograph.setMicName"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Micrograph.setMicName">[docs]</a>    <span class="k">def</span> <span class="nf">setMicName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">micName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micName</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">micName</span><span class="p">)</span></div>

<div class="viewcode-block" id="Micrograph.getMicName"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Micrograph.getMicName">[docs]</a>    <span class="k">def</span> <span class="nf">getMicName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_micName</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_micName</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span></div>

<div class="viewcode-block" id="Micrograph.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Micrograph.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information &quot;&quot;&quot;</span>
        <span class="n">Image</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMicName</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getMicName</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="Particle"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Particle">[docs]</a><span class="k">class</span> <span class="nc">Particle</span><span class="p">(</span><span class="n">Image</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represents an EM Particle object &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Image</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># This may be redundant, but make the Particle</span>
        <span class="c1"># object more independent for tracking coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coordinate</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micId</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classId</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>

<div class="viewcode-block" id="Particle.hasCoordinate"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Particle.hasCoordinate">[docs]</a>    <span class="k">def</span> <span class="nf">hasCoordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordinate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Particle.setCoordinate"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Particle.setCoordinate">[docs]</a>    <span class="k">def</span> <span class="nf">setCoordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinate</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coordinate</span> <span class="o">=</span> <span class="n">coordinate</span></div>

<div class="viewcode-block" id="Particle.getCoordinate"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Particle.getCoordinate">[docs]</a>    <span class="k">def</span> <span class="nf">getCoordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordinate</span></div>

<div class="viewcode-block" id="Particle.scaleCoordinate"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Particle.scaleCoordinate">[docs]</a>    <span class="k">def</span> <span class="nf">scaleCoordinate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getCoordinate</span><span class="p">()</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span></div>

<div class="viewcode-block" id="Particle.getMicId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Particle.getMicId">[docs]</a>    <span class="k">def</span> <span class="nf">getMicId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the micrograph id if the coordinate is not None.</span>
<span class="sd">        or have set the _micId property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_micId</span><span class="o">.</span><span class="n">hasValue</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_micId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasCoordinate</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCoordinate</span><span class="p">()</span><span class="o">.</span><span class="n">getMicId</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Particle.setMicId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Particle.setMicId">[docs]</a>    <span class="k">def</span> <span class="nf">setMicId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">micId</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">micId</span><span class="p">)</span></div>

<div class="viewcode-block" id="Particle.hasMicId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Particle.hasMicId">[docs]</a>    <span class="k">def</span> <span class="nf">hasMicId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMicId</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Particle.getClassId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Particle.getClassId">[docs]</a>    <span class="k">def</span> <span class="nf">getClassId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Particle.setClassId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Particle.setClassId">[docs]</a>    <span class="k">def</span> <span class="nf">setClassId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classId</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">classId</span><span class="p">)</span></div>

<div class="viewcode-block" id="Particle.hasClassId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Particle.hasClassId">[docs]</a>    <span class="k">def</span> <span class="nf">hasClassId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classId</span><span class="o">.</span><span class="n">hasValue</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Mask"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Mask">[docs]</a><span class="k">class</span> <span class="nc">Mask</span><span class="p">(</span><span class="n">Particle</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represent a mask. &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="Volume"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Volume">[docs]</a><span class="k">class</span> <span class="nc">Volume</span><span class="p">(</span><span class="n">Image</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represents an EM Volume object &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Image</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classId</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_halfMapFilenames</span> <span class="o">=</span> <span class="n">CsvList</span><span class="p">(</span><span class="n">pType</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

<div class="viewcode-block" id="Volume.getDim"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Volume.getDim">[docs]</a>    <span class="k">def</span> <span class="nf">getDim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return image dimensions as tuple: (Xdim, Ydim, Zdim)&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pwem.emlib.image</span> <span class="k">import</span> <span class="n">ImageHandler</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:mrc&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">ImageHandler</span><span class="p">()</span><span class="o">.</span><span class="n">getDimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Some volumes in mrc format can have the z dimension</span>
            <span class="c1"># as n dimension, so we need to consider this case.</span>
            <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Volume.getClassId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Volume.getClassId">[docs]</a>    <span class="k">def</span> <span class="nf">getClassId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Volume.setClassId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Volume.setClassId">[docs]</a>    <span class="k">def</span> <span class="nf">setClassId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classId</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_classId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">classId</span><span class="p">)</span></div>

<div class="viewcode-block" id="Volume.hasClassId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Volume.hasClassId">[docs]</a>    <span class="k">def</span> <span class="nf">hasClassId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classId</span><span class="o">.</span><span class="n">hasValue</span><span class="p">()</span></div>

<div class="viewcode-block" id="Volume.hasHalfMaps"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Volume.hasHalfMaps">[docs]</a>    <span class="k">def</span> <span class="nf">hasHalfMaps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_halfMapFilenames</span><span class="o">.</span><span class="n">hasValue</span><span class="p">()</span></div>

<div class="viewcode-block" id="Volume.getHalfMaps"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Volume.getHalfMaps">[docs]</a>    <span class="k">def</span> <span class="nf">getHalfMaps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_halfMapFilenames</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Volume.setHalfMaps"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Volume.setHalfMaps">[docs]</a>    <span class="k">def</span> <span class="nf">setHalfMaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listFileNames</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_halfMapFilenames</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">listFileNames</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="VolumeMask"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.VolumeMask">[docs]</a><span class="k">class</span> <span class="nc">VolumeMask</span><span class="p">(</span><span class="n">Volume</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A 3D mask to be used with volumes. &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="EMFile"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.EMFile">[docs]</a><span class="k">class</span> <span class="nc">EMFile</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Class to link usually to text files. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<div class="viewcode-block" id="EMFile.getFileName"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.EMFile.getFileName">[docs]</a>    <span class="k">def</span> <span class="nf">getFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Use the _objValue attribute to store filename. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="EMFile.setFileName"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.EMFile.setFileName">[docs]</a>    <span class="k">def</span> <span class="nf">setFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Use the _objValue attribute to store filename. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Sequence"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Sequence">[docs]</a><span class="k">class</span> <span class="nc">Sequence</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class containing a sequence of aminoacids/nucleotides</span>
<span class="sd">       Attribute names follow the biopython default ones</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sequence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">alphabet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">isAminoacids</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># sequence Id, usually from a database. E.g: P12345</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="c1"># Descriptive alias provided by the user. E.g: CicloxigenasaB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># Id this a aminoacid or nucleotide sequence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isAminoacids</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="n">isAminoacids</span><span class="p">)</span>
        <span class="c1"># So far we just use _description when creating &#39;fasta&#39; sequence files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
        <span class="c1"># sequence stores a string of residues (one character per residue)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="c1"># alphabet is used to describe de convention followed to</span>
        <span class="c1"># store the _sequence. We follow biopython criteria</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alphabet</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">alphabet</span><span class="p">)</span>

<div class="viewcode-block" id="Sequence.getId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Sequence.getId">[docs]</a>    <span class="k">def</span> <span class="nf">getId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequence.setId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Sequence.setId">[docs]</a>    <span class="k">def</span> <span class="nf">setId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span></div>

    <span class="c1"># Note that the natural name for the next two functions are</span>
    <span class="c1"># getName and  setName but</span>
    <span class="c1"># setName is defined in Object for another purpose</span>
<div class="viewcode-block" id="Sequence.getSeqName"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Sequence.getSeqName">[docs]</a>    <span class="k">def</span> <span class="nf">getSeqName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequence.setSeqName"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Sequence.setSeqName">[docs]</a>    <span class="k">def</span> <span class="nf">setSeqName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.getSequence"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Sequence.getSequence">[docs]</a>    <span class="k">def</span> <span class="nf">getSequence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequence.setSequence"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Sequence.setSequence">[docs]</a>    <span class="k">def</span> <span class="nf">setSequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span></div>

<div class="viewcode-block" id="Sequence.getDescription"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Sequence.getDescription">[docs]</a>    <span class="k">def</span> <span class="nf">getDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequence.setDescription"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Sequence.setDescription">[docs]</a>    <span class="k">def</span> <span class="nf">setDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_description</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">description</span><span class="p">)</span></div>

    <span class="c1"># Note: Alphabet is set when the sequence object is created</span>
    <span class="c1"># after that it makes no sense to change the alphabet</span>
<div class="viewcode-block" id="Sequence.getAlphabet"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Sequence.getAlphabet">[docs]</a>    <span class="k">def</span> <span class="nf">getAlphabet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alphabet</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Sequence.getIsAminoacids"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Sequence.getIsAminoacids">[docs]</a>    <span class="k">def</span> <span class="nf">getIsAminoacids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isAminoacids</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Sequence (name = </span><span class="si">{}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSeqName</span><span class="p">())</span></div>


<div class="viewcode-block" id="AtomStruct"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.AtomStruct">[docs]</a><span class="k">class</span> <span class="nc">AtomStruct</span><span class="p">(</span><span class="n">EMFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents an PDB file. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pseudoatoms</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMFile</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pseudoatoms</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="n">pseudoatoms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volume</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># origin stores a matrix that using as input the point (0,0,0)</span>
        <span class="c1"># provides  the position of the actual origin in the system of</span>
        <span class="c1"># coordinates of the default origin.</span>
        <span class="c1"># _origin is an object of the class Transformor shifts</span>
        <span class="c1"># units are Angstroms (in Image units are A)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="AtomStruct.getPseudoAtoms"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.AtomStruct.getPseudoAtoms">[docs]</a>    <span class="k">def</span> <span class="nf">getPseudoAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pseudoatoms</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="AtomStruct.setPseudoAtoms"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.AtomStruct.setPseudoAtoms">[docs]</a>    <span class="k">def</span> <span class="nf">setPseudoAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pseudoatoms</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="AtomStruct.getVolume"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.AtomStruct.getVolume">[docs]</a>    <span class="k">def</span> <span class="nf">getVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume</span></div>

<div class="viewcode-block" id="AtomStruct.hasVolume"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.AtomStruct.hasVolume">[docs]</a>    <span class="k">def</span> <span class="nf">hasVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volume</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="AtomStruct.setVolume"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.AtomStruct.setVolume">[docs]</a>    <span class="k">def</span> <span class="nf">setVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Volume</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_volume</span> <span class="o">=</span> <span class="n">volume</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;TypeError&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR: SetVolume, This is not a &#39;</span>
                                         <span class="s1">&#39;volume&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (pseudoatoms=</span><span class="si">%s</span><span class="s2">, volume=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getClassName</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPseudoAtoms</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasVolume</span><span class="p">()))</span>

<div class="viewcode-block" id="AtomStruct.hasOrigin"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.AtomStruct.hasOrigin">[docs]</a>    <span class="k">def</span> <span class="nf">hasOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="AtomStruct.getOrigin"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.AtomStruct.getOrigin">[docs]</a>    <span class="k">def</span> <span class="nf">getOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasOrigin</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">Transform</span><span class="p">()</span>
                <span class="n">t</span><span class="o">.</span><span class="n">setShifts</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">t</span>  <span class="c1"># The identity matrix</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="AtomStruct.setOrigin"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.AtomStruct.setOrigin">[docs]</a>    <span class="k">def</span> <span class="nf">setOrigin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newOrigin</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span> <span class="o">=</span> <span class="n">newOrigin</span></div></div>


<div class="viewcode-block" id="PdbFile"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.PdbFile">[docs]</a><span class="k">class</span> <span class="nc">PdbFile</span><span class="p">(</span><span class="n">AtomStruct</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pseudoatoms</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">AtomStruct</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">pseudoatoms</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="EMSet"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.EMSet">[docs]</a><span class="k">class</span> <span class="nc">EMSet</span><span class="p">(</span><span class="n">Set</span><span class="p">,</span> <span class="n">EMObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_loadClassesDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">pwem</span> <span class="k">import</span> <span class="n">Domain</span>
        <span class="n">classDict</span> <span class="o">=</span> <span class="n">Domain</span><span class="o">.</span><span class="n">getObjects</span><span class="p">()</span>
        <span class="n">classDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">classDict</span>

<div class="viewcode-block" id="EMSet.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.EMSet.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Define a dummy copyInfo function to be used</span>
<span class="sd">        for some generic operations on sets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="EMSet.clone"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.EMSet.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Override the clone defined in Object</span>
<span class="sd">        to avoid copying _mapperPath property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="EMSet.copyItems"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.EMSet.copyItems">[docs]</a>    <span class="k">def</span> <span class="nf">copyItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">otherSet</span><span class="p">,</span>
                  <span class="n">updateItemCallback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">itemDataIterator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">copyDisabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">doClone</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy items from another set, allowing to update items information</span>
<span class="sd">        based on another source of data, paired with each item.</span>

<span class="sd">        Params:</span>
<span class="sd">            otherSet: input set from where the items will be copied.</span>
<span class="sd">            updateItemCallback: if not None, this will be called for each item</span>
<span class="sd">                and each data row (if the itemDataIterator is not None). Apart</span>
<span class="sd">                from setting item values or new attributes, it is possible to</span>
<span class="sd">                set the special flag _appendItem to False, and then this item</span>
<span class="sd">                will not be added to the set.</span>
<span class="sd">            itemDataIterator: if not None, it must be an iterator that have one</span>
<span class="sd">                data item for each item in the set. Usually the data item is a</span>
<span class="sd">                data row, coming from a table stored in text files (e.g STAR)</span>
<span class="sd">            copyDisabled: By default, disabled items are not copied from the other</span>
<span class="sd">                set. If copyDisable=True, then the enabled property of the item</span>
<span class="sd">                will be ignored.</span>
<span class="sd">            doClone: By default, the new item that will be inserted is a &quot;clone&quot;</span>
<span class="sd">                of the input item. By using doClone=False, the same input item</span>
<span class="sd">                will be passed to the callback and added to the set. This will</span>
<span class="sd">                avoid the clone operation and the related overhead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">itemDataIter</span> <span class="o">=</span> <span class="n">itemDataIterator</span>  <span class="c1"># shortcut</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">otherSet</span><span class="p">:</span>
            <span class="c1"># copy items if enabled or copyDisabled=True</span>
            <span class="k">if</span> <span class="n">copyDisabled</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                <span class="n">newItem</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="k">if</span> <span class="n">doClone</span> <span class="k">else</span> <span class="n">item</span>
                <span class="k">if</span> <span class="n">updateItemCallback</span><span class="p">:</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">itemDataIter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">next</span><span class="p">(</span><span class="n">itemDataIter</span><span class="p">)</span>
                    <span class="n">updateItemCallback</span><span class="p">(</span><span class="n">newItem</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
                <span class="c1"># If updateCallBack function returns attribute</span>
                <span class="c1"># _appendItem to False do not append the item</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">newItem</span><span class="p">,</span> <span class="s2">&quot;_appendItem&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newItem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">itemDataIter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">next</span><span class="p">(</span><span class="n">itemDataIter</span><span class="p">)</span>  <span class="c1"># just skip disabled data row</span></div>

<div class="viewcode-block" id="EMSet.getFiles"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.EMSet.getFiles">[docs]</a>    <span class="k">def</span> <span class="nf">getFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Set</span><span class="o">.</span><span class="n">getFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfImages"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages">[docs]</a><span class="k">class</span> <span class="nc">SetOfImages</span><span class="p">(</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represents a set of Images &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">Image</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hasCtf</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ctf&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alignment</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">ALIGN_NONE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isPhaseFlipped</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isAmplitudeCorrected</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="n">Acquisition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span> <span class="o">=</span> <span class="n">ImageDim</span><span class="p">()</span>  <span class="c1"># Dimensions of the first image</span>

<div class="viewcode-block" id="SetOfImages.getAcquisition"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.getAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">getAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span></div>

<div class="viewcode-block" id="SetOfImages.setAcquisition"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.setAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">setAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acquisition</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span> <span class="o">=</span> <span class="n">acquisition</span></div>

<div class="viewcode-block" id="SetOfImages.hasAcquisition"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.hasAcquisition">[docs]</a>    <span class="k">def</span> <span class="nf">hasAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getMagnification</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SetOfImages.hasCTF"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.hasCTF">[docs]</a>    <span class="k">def</span> <span class="nf">hasCTF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if the SetOfImages has associated a CTF model&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hasCtf</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfImages.setHasCTF"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.setHasCTF">[docs]</a>    <span class="k">def</span> <span class="nf">setHasCTF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hasCtf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfImages.hasAlignment"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.hasAlignment">[docs]</a>    <span class="k">def</span> <span class="nf">hasAlignment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alignment</span> <span class="o">!=</span> <span class="n">ALIGN_NONE</span></div>

<div class="viewcode-block" id="SetOfImages.hasAlignment2D"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.hasAlignment2D">[docs]</a>    <span class="k">def</span> <span class="nf">hasAlignment2D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alignment</span> <span class="o">==</span> <span class="n">ALIGN_2D</span></div>

<div class="viewcode-block" id="SetOfImages.hasAlignment3D"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.hasAlignment3D">[docs]</a>    <span class="k">def</span> <span class="nf">hasAlignment3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alignment</span> <span class="o">==</span> <span class="n">ALIGN_3D</span></div>

<div class="viewcode-block" id="SetOfImages.hasAlignmentProj"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.hasAlignmentProj">[docs]</a>    <span class="k">def</span> <span class="nf">hasAlignmentProj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alignment</span> <span class="o">==</span> <span class="n">ALIGN_PROJ</span></div>

<div class="viewcode-block" id="SetOfImages.getAlignment"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.getAlignment">[docs]</a>    <span class="k">def</span> <span class="nf">getAlignment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alignment</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfImages.setAlignment"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.setAlignment">[docs]</a>    <span class="k">def</span> <span class="nf">setAlignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALIGNMENTS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Invalid alignment value: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alignment</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfImages.setAlignment2D"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.setAlignment2D">[docs]</a>    <span class="k">def</span> <span class="nf">setAlignment2D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">ALIGN_2D</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfImages.setAlignment3D"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.setAlignment3D">[docs]</a>    <span class="k">def</span> <span class="nf">setAlignment3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">ALIGN_3D</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfImages.setAlignmentProj"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.setAlignmentProj">[docs]</a>    <span class="k">def</span> <span class="nf">setAlignmentProj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">ALIGN_PROJ</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfImages.isPhaseFlipped"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.isPhaseFlipped">[docs]</a>    <span class="k">def</span> <span class="nf">isPhaseFlipped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isPhaseFlipped</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfImages.setIsPhaseFlipped"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.setIsPhaseFlipped">[docs]</a>    <span class="k">def</span> <span class="nf">setIsPhaseFlipped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isPhaseFlipped</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfImages.isAmplitudeCorrected"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.isAmplitudeCorrected">[docs]</a>    <span class="k">def</span> <span class="nf">isAmplitudeCorrected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isAmplitudeCorrected</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfImages.setIsAmplitudeCorrected"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.setIsAmplitudeCorrected">[docs]</a>    <span class="k">def</span> <span class="nf">setIsAmplitudeCorrected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isAmplitudeCorrected</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfImages.append"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a image to the set. &quot;&quot;&quot;</span>
        <span class="c1"># If the sampling rate was set before, the same value</span>
        <span class="c1"># will be set for each image added to the set</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">image</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">():</span>
            <span class="n">image</span><span class="o">.</span><span class="n">setSamplingRate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">())</span>
        <span class="c1"># Copy the acquistion from the set to images</span>
        <span class="c1"># only override image acquisition if setofImages acquisition</span>
        <span class="c1"># is not none</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasAcquisition</span><span class="p">():</span>
            <span class="c1"># TODO: image acquisition should not be overwritten</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">image</span><span class="o">.</span><span class="n">hasAcquisition</span><span class="p">():</span>
                <span class="n">image</span><span class="o">.</span><span class="n">setAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getAcquisition</span><span class="p">())</span>
        <span class="c1"># Store the dimensions of the first image, just to</span>
        <span class="c1"># avoid reading image files for further queries to dimensions</span>
        <span class="c1"># only check this for first time append is called</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setFirstDim</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="n">EMSet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_setFirstDim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Store dimensions when the first image is found.</span>
<span class="sd">        This function should be called only once, to avoid reading</span>
<span class="sd">        dimension from image file. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">getDim</span><span class="p">())</span>

<div class="viewcode-block" id="SetOfImages.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information (sampling rate and ctf)</span>
<span class="sd">        from other set of images to current one&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyAttributes</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;_samplingRate&#39;</span><span class="p">,</span> <span class="s1">&#39;_isPhaseFlipped&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;_isAmplitudeCorrected&#39;</span><span class="p">,</span> <span class="s1">&#39;_alignment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_acquisition</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfImages.getFiles"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.getFiles">[docs]</a>    <span class="k">def</span> <span class="nf">getFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filePaths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">uniqueFiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">],</span> <span class="s1">&#39;_filename&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;_filename&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">uniqueFiles</span><span class="p">:</span>
            <span class="n">filePaths</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;_filename&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">filePaths</span></div>

<div class="viewcode-block" id="SetOfImages.setDownsample"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.setDownsample">[docs]</a>    <span class="k">def</span> <span class="nf">setDownsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">downFactor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update the values of samplingRate and scannedPixelSize</span>
<span class="sd">        after applying a downsampling factor of downFactor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSamplingRate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">()</span> <span class="o">*</span> <span class="n">downFactor</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfImages.setSamplingRate"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.setSamplingRate">[docs]</a>    <span class="k">def</span> <span class="nf">setSamplingRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samplingRate</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the sampling rate and adjust the scannedPixelSize. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">samplingRate</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfImages.getSamplingRate"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.getSamplingRate">[docs]</a>    <span class="k">def</span> <span class="nf">getSamplingRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfImages.writeStack"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.writeStack">[docs]</a>    <span class="k">def</span> <span class="nf">writeStack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnStack</span><span class="p">,</span> <span class="n">orderBy</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;ASC&#39;</span><span class="p">,</span>
                   <span class="n">applyTransform</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># TODO create empty file to improve efficiency</span>
        <span class="kn">from</span> <span class="nn">pwem.emlib.image</span> <span class="k">import</span> <span class="n">ImageHandler</span>
        <span class="n">ih</span> <span class="o">=</span> <span class="n">ImageHandler</span><span class="p">()</span>
        <span class="n">applyTransform</span> <span class="o">=</span> <span class="n">applyTransform</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasAlignment2D</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">orderBy</span><span class="o">=</span><span class="n">orderBy</span><span class="p">,</span>
                                               <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">)):</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">getTransform</span><span class="p">()</span> <span class="k">if</span> <span class="n">applyTransform</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">ih</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fnStack</span><span class="p">),</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span></div>

    <span class="c1"># TODO: Check whether this function can be used.</span>
    <span class="c1"># for example: protocol_apply_mask</span>
<div class="viewcode-block" id="SetOfImages.readStack"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.readStack">[docs]</a>    <span class="k">def</span> <span class="nf">readStack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnStack</span><span class="p">,</span> <span class="n">postprocessImage</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Populate the set with the images in the stack &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pwem.emlib.image</span> <span class="k">import</span> <span class="n">ImageHandler</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">=</span> <span class="n">ImageHandler</span><span class="p">()</span><span class="o">.</span><span class="n">getDimensions</span><span class="p">(</span><span class="n">fnStack</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ITEM_TYPE</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">img</span><span class="o">.</span><span class="n">setObjId</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">img</span><span class="o">.</span><span class="n">setLocation</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fnStack</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">postprocessImage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">postprocessImage</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfImages.getDim"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.getDim">[docs]</a>    <span class="k">def</span> <span class="nf">getDim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the dimensions of the first image in the set. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span></div>

<div class="viewcode-block" id="SetOfImages.setDim"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.setDim">[docs]</a>    <span class="k">def</span> <span class="nf">setDim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newDim</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">newDim</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfImages.getXDim"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.getXDim">[docs]</a>    <span class="k">def</span> <span class="nf">getXDim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDim</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="SetOfImages.isOddX"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.isOddX">[docs]</a>    <span class="k">def</span> <span class="nf">isOddX</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return True if the first item x dimension is odd. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getXDim</span><span class="p">()</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="SetOfImages.getDimensions"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.getDimensions">[docs]</a>    <span class="k">def</span> <span class="nf">getDimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return first image dimensions as a tuple: (xdim, ydim, zdim)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; String representation of a set of images. &quot;&quot;&quot;</span>
        <span class="n">sampling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sampling</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FATAL ERROR: Object </span><span class="si">%s</span><span class="s2"> has no sampling rate!!!&quot;</span>
                  <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
            <span class="n">sampling</span> <span class="o">=</span> <span class="o">-</span><span class="mf">999.0</span>

        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%d</span><span class="s2"> items, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%0.2f</span><span class="s2"> â„«/px</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getClassName</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSize</span><span class="p">(),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_dimStr</span><span class="p">(),</span> <span class="n">sampling</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appendStreamState</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">_dimStr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the string representing the dimensions. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span><span class="p">)</span>

<div class="viewcode-block" id="SetOfImages.iterItems"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.iterItems">[docs]</a>    <span class="k">def</span> <span class="nf">iterItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orderBy</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;ASC&#39;</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Redefine iteration to set the acquisition to images. &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">Set</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orderBy</span><span class="o">=</span><span class="n">orderBy</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span>
                                 <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">):</span>

            <span class="c1"># Sometimes the images items in the set could</span>
            <span class="c1"># have the acquisition info per data row and we</span>
            <span class="c1"># don&#39;t want to override with the set acquisition for this case</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">img</span><span class="o">.</span><span class="n">hasAcquisition</span><span class="p">():</span>
                <span class="n">img</span><span class="o">.</span><span class="n">setAcquisition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getAcquisition</span><span class="p">())</span>
            <span class="k">yield</span> <span class="n">img</span></div>

<div class="viewcode-block" id="SetOfImages.appendFromImages"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.appendFromImages">[docs]</a>    <span class="k">def</span> <span class="nf">appendFromImages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imagesSet</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over the images and append</span>
<span class="sd">        every image that is enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imagesSet</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfImages.appendFromClasses"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfImages.appendFromClasses">[docs]</a>    <span class="k">def</span> <span class="nf">appendFromClasses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classesSet</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over the classes and the element inside each</span>
<span class="sd">        class and append to the set all that are enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">classesSet</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="bp">cls</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfMicrographsBase"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMicrographsBase">[docs]</a><span class="k">class</span> <span class="nc">SetOfMicrographsBase</span><span class="p">(</span><span class="n">SetOfImages</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create a base class for both Micrographs and Movies,</span>
<span class="sd">    but avoid to select Movies when Micrographs are required.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">SetOfImages</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scannedPixelSize</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfMicrographsBase.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMicrographsBase.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information (voltage, spherical aberration and</span>
<span class="sd">        sampling rate) from other set of micrographs to current one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">SetOfImages</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scannedPixelSize</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getScannedPixelSize</span><span class="p">())</span></div>

<div class="viewcode-block" id="SetOfMicrographsBase.setSamplingRate"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMicrographsBase.setSamplingRate">[docs]</a>    <span class="k">def</span> <span class="nf">setSamplingRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samplingRate</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the sampling rate and adjust the scannedPixelSize. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">samplingRate</span><span class="p">)</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getMagnification</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scannedPixelSize</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scannedPixelSize</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">1e-4</span> <span class="o">*</span> <span class="n">samplingRate</span> <span class="o">*</span> <span class="n">mag</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfMicrographsBase.getScannedPixelSize"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMicrographsBase.getScannedPixelSize">[docs]</a>    <span class="k">def</span> <span class="nf">getScannedPixelSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scannedPixelSize</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfMicrographsBase.setScannedPixelSize"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMicrographsBase.setScannedPixelSize">[docs]</a>    <span class="k">def</span> <span class="nf">setScannedPixelSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scannedPixelSize</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set scannedPixelSize and update samplingRate. &quot;&quot;&quot;</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span><span class="o">.</span><span class="n">getMagnification</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;SetOfMicrographs: cannot set scanned pixel size &quot;</span>
                            <span class="s2">&quot;if Magnification is not set.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scannedPixelSize</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">scannedPixelSize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_samplingRate</span><span class="o">.</span><span class="n">set</span><span class="p">((</span><span class="mf">1e+4</span> <span class="o">*</span> <span class="n">scannedPixelSize</span><span class="p">)</span> <span class="o">/</span> <span class="n">mag</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfMicrographs"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMicrographs">[docs]</a><span class="k">class</span> <span class="nc">SetOfMicrographs</span><span class="p">(</span><span class="n">SetOfMicrographsBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a set of Micrographs&quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">Micrograph</span></div>


<div class="viewcode-block" id="SetOfParticles"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfParticles">[docs]</a><span class="k">class</span> <span class="nc">SetOfParticles</span><span class="p">(</span><span class="n">SetOfImages</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represents a set of Particles.</span>
<span class="sd">    The purpose of this class is to separate the</span>
<span class="sd">    concepts of Micrographs and Particles, even if</span>
<span class="sd">    both are considered Images</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">Particle</span>
    <span class="n">REP_TYPE</span> <span class="o">=</span> <span class="n">Particle</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">SetOfImages</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coordsPointer</span> <span class="o">=</span> <span class="n">Pointer</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfParticles.hasCoordinates"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfParticles.hasCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">hasCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordsPointer</span><span class="o">.</span><span class="n">hasValue</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfParticles.getCoordinates"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfParticles.getCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">getCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the SetOfCoordinates associated with</span>
<span class="sd">        this SetOfParticles&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordsPointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfParticles.setCoordinates"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfParticles.setCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">setCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the SetOfCoordinates associates with</span>
<span class="sd">        this set of particles.</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coordsPointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfParticles.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfParticles.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information (voltage, spherical aberration and</span>
<span class="sd">        sampling rate) from other set of micrographs to current one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">SetOfImages</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setHasCTF</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">hasCTF</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="SetOfAverages"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfAverages">[docs]</a><span class="k">class</span> <span class="nc">SetOfAverages</span><span class="p">(</span><span class="n">SetOfParticles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a set of Averages.</span>
<span class="sd">    It is a SetOfParticles but it is useful to differentiate outputs.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">SetOfParticles</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="SetOfVolumes"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfVolumes">[docs]</a><span class="k">class</span> <span class="nc">SetOfVolumes</span><span class="p">(</span><span class="n">SetOfImages</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a set of Volumes&quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">Volume</span>
    <span class="n">REP_TYPE</span> <span class="o">=</span> <span class="n">Volume</span>

    <span class="c1"># Hint to GUI components to expose internal items for direct selection</span>
    <span class="n">EXPOSE_ITEMS</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">SetOfImages</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="SetOfCTF"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfCTF">[docs]</a><span class="k">class</span> <span class="nc">SetOfCTF</span><span class="p">(</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Contains a set of CTF models estimated for a set of images.&quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">CTFModel</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micrographsPointer</span> <span class="o">=</span> <span class="n">Pointer</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfCTF.getMicrographs"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfCTF.getMicrographs">[docs]</a>    <span class="k">def</span> <span class="nf">getMicrographs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the SetOFImages used to create the SetOfClasses. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_micrographsPointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfCTF.setMicrographs"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfCTF.setMicrographs">[docs]</a>    <span class="k">def</span> <span class="nf">setMicrographs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">micrographs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the micrographs from which this CTFs were estimated.</span>
<span class="sd">        Params:</span>
<span class="sd">            micrographs: Either a SetOfMicrographs object or a pointer to it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">micrographs</span><span class="o">.</span><span class="n">isPointer</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_micrographsPointer</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">micrographs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_micrographsPointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">micrographs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfDefocusGroup"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfDefocusGroup">[docs]</a><span class="k">class</span> <span class="nc">SetOfDefocusGroup</span><span class="p">(</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Contains a set of DefocusGroup.</span>
<span class="sd">        if min/max/avg exists the corresponding flag must be</span>
<span class="sd">        set to true.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">DefocusGroup</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minSet</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxSet</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_avgSet</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="SetOfDefocusGroup.getMinSet"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfDefocusGroup.getMinSet">[docs]</a>    <span class="k">def</span> <span class="nf">getMinSet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minSet</span></div>

<div class="viewcode-block" id="SetOfDefocusGroup.setMinSet"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfDefocusGroup.setMinSet">[docs]</a>    <span class="k">def</span> <span class="nf">setMinSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minSet</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="SetOfDefocusGroup.getMaxSet"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfDefocusGroup.getMaxSet">[docs]</a>    <span class="k">def</span> <span class="nf">getMaxSet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxSet</span></div>

<div class="viewcode-block" id="SetOfDefocusGroup.setMaxSet"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfDefocusGroup.setMaxSet">[docs]</a>    <span class="k">def</span> <span class="nf">setMaxSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxSet</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="SetOfDefocusGroup.getAvgSet"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfDefocusGroup.getAvgSet">[docs]</a>    <span class="k">def</span> <span class="nf">getAvgSet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_avgSet</span></div>

<div class="viewcode-block" id="SetOfDefocusGroup.setAvgSet"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfDefocusGroup.setAvgSet">[docs]</a>    <span class="k">def</span> <span class="nf">setAvgSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_avgSet</span> <span class="o">=</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="SetOfAtomStructs"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfAtomStructs">[docs]</a><span class="k">class</span> <span class="nc">SetOfAtomStructs</span><span class="p">(</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Set containing PDB items. &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">AtomStruct</span>
    <span class="c1"># Hint to GUI components to expose internal items for direct selection</span>
    <span class="n">EXPOSE_ITEMS</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="SetOfPDBs"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfPDBs">[docs]</a><span class="k">class</span> <span class="nc">SetOfPDBs</span><span class="p">(</span><span class="n">SetOfAtomStructs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Set containing PDB items. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">SetOfAtomStructs</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SetOfPDBs class has been renamed to SetOfAtomStructs. &quot;</span>
              <span class="s2">&quot;Please update your code.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="SetOfSequences"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfSequences">[docs]</a><span class="k">class</span> <span class="nc">SetOfSequences</span><span class="p">(</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set containing Sequence items.&quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">Sequence</span></div>


<div class="viewcode-block" id="Coordinate"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate">[docs]</a><span class="k">class</span> <span class="nc">Coordinate</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class holds the (x,y) position and other information</span>
<span class="sd">    associated with a coordinate&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micrographPointer</span> <span class="o">=</span> <span class="n">Pointer</span><span class="p">(</span><span class="n">objDoStore</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micId</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micName</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>

<div class="viewcode-block" id="Coordinate.getX"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.getX">[docs]</a>    <span class="k">def</span> <span class="nf">getX</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate.setX"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.setX">[docs]</a>    <span class="k">def</span> <span class="nf">setX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate.shiftX"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.shiftX">[docs]</a>    <span class="k">def</span> <span class="nf">shiftX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shiftX</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">shiftX</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate.getY"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.getY">[docs]</a>    <span class="k">def</span> <span class="nf">getY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate.setY"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.setY">[docs]</a>    <span class="k">def</span> <span class="nf">setY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate.shiftY"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.shiftY">[docs]</a>    <span class="k">def</span> <span class="nf">shiftY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shiftY</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">shiftY</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate.scale"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.scale">[docs]</a>    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Scale both x and y coordinates by a given factor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate.getPosition"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.getPosition">[docs]</a>    <span class="k">def</span> <span class="nf">getPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the position of the coordinate as a (x, y) tuple.</span>
<span class="sd">        mode: select if the position is the center of the box</span>
<span class="sd">        or in the top left corner.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getX</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getY</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate.setPosition"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.setPosition">[docs]</a>    <span class="k">def</span> <span class="nf">setPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate.getMicrograph"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.getMicrograph">[docs]</a>    <span class="k">def</span> <span class="nf">getMicrograph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the micrograph object to which</span>
<span class="sd">        this coordinate is associated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_micrographPointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate.setMicrograph"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.setMicrograph">[docs]</a>    <span class="k">def</span> <span class="nf">setMicrograph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">micrograph</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the micrograph to which this coordinate belongs. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micrographPointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">micrograph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">micrograph</span><span class="o">.</span><span class="n">getObjId</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micName</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">micrograph</span><span class="o">.</span><span class="n">getMicName</span><span class="p">())</span></div>

<div class="viewcode-block" id="Coordinate.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy information from other coordinate. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPosition</span><span class="p">(</span><span class="o">*</span><span class="n">coord</span><span class="o">.</span><span class="n">getPosition</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setObjId</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">getObjId</span><span class="p">())</span></div>

<div class="viewcode-block" id="Coordinate.getMicId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.getMicId">[docs]</a>    <span class="k">def</span> <span class="nf">getMicId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_micId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coordinate.setMicId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.setMicId">[docs]</a>    <span class="k">def</span> <span class="nf">setMicId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">micId</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">micId</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate.invertY"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.invertY">[docs]</a>    <span class="k">def</span> <span class="nf">invertY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMicrograph</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMicrograph</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">()</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getY</span><span class="p">())</span></div>
        <span class="c1"># else: error TODO</span>

<div class="viewcode-block" id="Coordinate.setMicName"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.setMicName">[docs]</a>    <span class="k">def</span> <span class="nf">setMicName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">micName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micName</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">micName</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coordinate.getMicName"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Coordinate.getMicName">[docs]</a>    <span class="k">def</span> <span class="nf">getMicName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_micName</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="SetOfCoordinates"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfCoordinates">[docs]</a><span class="k">class</span> <span class="nc">SetOfCoordinates</span><span class="p">(</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Encapsulate the logic of a set of particles coordinates.</span>
<span class="sd">    Each coordinate has a (x,y) position and is related to a Micrograph</span>
<span class="sd">    The SetOfCoordinates can also have information about TiltPairs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">Coordinate</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_micrographsPointer</span> <span class="o">=</span> <span class="n">Pointer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfCoordinates.getBoxSize"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfCoordinates.getBoxSize">[docs]</a>    <span class="k">def</span> <span class="nf">getBoxSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the box size of the particles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfCoordinates.setBoxSize"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfCoordinates.setBoxSize">[docs]</a>    <span class="k">def</span> <span class="nf">setBoxSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boxSize</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the box size of the particles. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">boxSize</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfCoordinates.iterMicrographs"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfCoordinates.iterMicrographs">[docs]</a>    <span class="k">def</span> <span class="nf">iterMicrographs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over the micrographs set associated with this</span>
<span class="sd">        set of coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMicrographs</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfCoordinates.iterMicrographCoordinates"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfCoordinates.iterMicrographCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">iterMicrographCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">micrograph</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterates over the set of coordinates belonging to that micrograph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="SetOfCoordinates.iterCoordinates"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfCoordinates.iterCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">iterCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">micrograph</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over the coordinates associated with a micrograph.</span>
<span class="sd">        If micrograph=None, the iteration is performed over the whole</span>
<span class="sd">        set of coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">micrograph</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">micId</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">micrograph</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">micId</span> <span class="o">=</span> <span class="n">micrograph</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">micrograph</span><span class="p">,</span> <span class="n">Micrograph</span><span class="p">):</span>
            <span class="n">micId</span> <span class="o">=</span> <span class="n">micrograph</span><span class="o">.</span><span class="n">getObjId</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Invalid input micrograph of type </span><span class="si">%s</span><span class="s1">&#39;</span>
                            <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">micrograph</span><span class="p">))</span>

        <span class="c1"># Iterate over all coordinates if micId is None,</span>
        <span class="c1"># otherwise use micId to filter the where selection</span>
        <span class="n">coordWhere</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span> <span class="k">if</span> <span class="n">micId</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;_micId=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">micId</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">coordWhere</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">coord</span></div>

<div class="viewcode-block" id="SetOfCoordinates.getMicrographs"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfCoordinates.getMicrographs">[docs]</a>    <span class="k">def</span> <span class="nf">getMicrographs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the SetOfMicrographs associated with</span>
<span class="sd">        this SetOfCoordinates&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_micrographsPointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfCoordinates.setMicrographs"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfCoordinates.setMicrographs">[docs]</a>    <span class="k">def</span> <span class="nf">setMicrographs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">micrographs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the micrographs associated with this set of coordinates.</span>
<span class="sd">        Params:</span>
<span class="sd">            micrographs: Either a SetOfMicrographs object or a pointer to it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">micrographs</span><span class="o">.</span><span class="n">isPointer</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_micrographsPointer</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">micrographs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_micrographsPointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">micrographs</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfCoordinates.getFiles"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfCoordinates.getFiles">[docs]</a>    <span class="k">def</span> <span class="nf">getFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filePaths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">filePaths</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">filePaths</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; String representation of a set of coordinates. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span><span class="o">.</span><span class="n">hasValue</span><span class="p">():</span>
            <span class="n">boxSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxSize</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">boxStr</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">%d</span><span class="s1"> x </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">boxSize</span><span class="p">,</span> <span class="n">boxSize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boxStr</span> <span class="o">=</span> <span class="s1">&#39;No-Box&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%d</span><span class="s2"> items, </span><span class="si">%s%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getClassName</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSize</span><span class="p">(),</span>
                                     <span class="n">boxStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appendStreamState</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="SetOfCoordinates.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfCoordinates.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information (boxsize)</span>
<span class="sd">                from other set of coordinates to current one&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyAttributes</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;_boxSize&#39;</span><span class="p">)</span></div></div>

        <span class="c1"># TODO: we might what here to copy the mics too, same as done with</span>
        <span class="c1"># acquisition in SetOfImages</span>


<div class="viewcode-block" id="Matrix"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Matrix">[docs]</a><span class="k">class</span> <span class="nc">Matrix</span><span class="p">(</span><span class="n">Scalar</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Scalar</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_convertValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Value should be a str with comma separated values</span>
<span class="sd">        or a list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

<div class="viewcode-block" id="Matrix.getObjValue"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Matrix.getObjValue">[docs]</a>    <span class="k">def</span> <span class="nf">getObjValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_objValue</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objValue</span></div>

<div class="viewcode-block" id="Matrix.setValue"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Matrix.setValue">[docs]</a>    <span class="k">def</span> <span class="nf">setValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Matrix.getMatrix"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Matrix.getMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">getMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return internal numpy matrix. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span></div>

<div class="viewcode-block" id="Matrix.setMatrix"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Matrix.setMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">setMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Override internal numpy matrix. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span> <span class="o">=</span> <span class="n">matrix</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">copyDict</span><span class="p">,</span> <span class="n">copyId</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; Override the default behaviour of copy</span>
<span class="sd">        to also copy array data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_objValue</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_objValue</span></div>


<div class="viewcode-block" id="Transform"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Transform">[docs]</a><span class="k">class</span> <span class="nc">Transform</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class will contain a transformation matrix</span>
<span class="sd">    that can be applied to 2D/3D objects like images and volumes.</span>
<span class="sd">    It should contain information about euler angles, translation(or shift)</span>
<span class="sd">    and mirroring.</span>
<span class="sd">    Shifts are stored in pixels as treated in extract coordinates, or assign angles,...</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMatrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>

<div class="viewcode-block" id="Transform.getMatrix"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Transform.getMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">getMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()</span></div>

<div class="viewcode-block" id="Transform.getMatrixAsList"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Transform.getMatrixAsList">[docs]</a>    <span class="k">def</span> <span class="nf">getMatrixAsList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the values of the Matrix as a list. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

<div class="viewcode-block" id="Transform.setMatrix"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Transform.setMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">setMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">setMatrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span><span class="p">)</span>

<div class="viewcode-block" id="Transform.scale"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Transform.scale">[docs]</a>    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span></div>

<div class="viewcode-block" id="Transform.scaleShifts"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Transform.scaleShifts">[docs]</a>    <span class="k">def</span> <span class="nf">scaleShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="c1"># By default Scipion uses a coordinate system associated with the volume rather than the projection</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span></div>

<div class="viewcode-block" id="Transform.invert"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Transform.invert">[docs]</a>    <span class="k">def</span> <span class="nf">invert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Local import to avoid loop pwem --&gt; data --&gt; convert --&gt; Plugin (at pwem)</span>
        <span class="kn">from</span> <span class="nn">pwem.convert.transformations</span> <span class="k">import</span> <span class="n">inverse_matrix</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">setMatrix</span><span class="p">(</span><span class="n">inverse_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span></div>

<div class="viewcode-block" id="Transform.getShifts"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Transform.getShifts">[docs]</a>    <span class="k">def</span> <span class="nf">getShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span></div>

<div class="viewcode-block" id="Transform.setShifts"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Transform.setShifts">[docs]</a>    <span class="k">def</span> <span class="nf">setShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span></div>

<div class="viewcode-block" id="Transform.setShiftsTuple"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Transform.setShiftsTuple">[docs]</a>    <span class="k">def</span> <span class="nf">setShiftsTuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shifts</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setShifts</span><span class="p">(</span><span class="n">shifts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shifts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">shifts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span></div>

<div class="viewcode-block" id="Transform.composeTransform"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Transform.composeTransform">[docs]</a>    <span class="k">def</span> <span class="nf">composeTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply a transformation matrix to the current matrix &quot;&quot;&quot;</span>
        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">matrix</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">setMatrix</span><span class="p">(</span><span class="n">new_matrix</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Class2D"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Class2D">[docs]</a><span class="k">class</span> <span class="nc">Class2D</span><span class="p">(</span><span class="n">SetOfParticles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represent a Class that groups Particles objects.</span>
<span class="sd">    Usually the representative of the class is another Particle</span>
<span class="sd">    (some kind of average particle from the particles assigned</span>
<span class="sd">    to the class)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Class2D.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Class2D.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information (id and other properties) but</span>
<span class="sd">        not _mapperPath or _size from other set of micrographs to current one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_mapperPath&#39;</span><span class="p">,</span> <span class="s1">&#39;_size&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="Class2D.clone"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Class2D.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getClass</span><span class="p">()()</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_mapperPath&#39;</span><span class="p">,</span> <span class="s1">&#39;_size&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">clone</span></div>

<div class="viewcode-block" id="Class2D.close"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Class2D.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Do nothing on close, since the db will be closed by SetOfClasses</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="Class3D"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Class3D">[docs]</a><span class="k">class</span> <span class="nc">Class3D</span><span class="p">(</span><span class="n">SetOfParticles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represent a Class that groups Particles objects.</span>
<span class="sd">    Usually the representative of the class is a Volume</span>
<span class="sd">    reconstructed from the particles assigned to the class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">REP_TYPE</span> <span class="o">=</span> <span class="n">Volume</span>

<div class="viewcode-block" id="Class3D.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Class3D.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information (id and other properties) but not</span>
<span class="sd">        _mapperPath or _size from other set of micrographs to current one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_mapperPath&#39;</span><span class="p">,</span> <span class="s1">&#39;_size&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="Class3D.clone"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Class3D.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getClass</span><span class="p">()()</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignoreAttrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_mapperPath&#39;</span><span class="p">,</span> <span class="s1">&#39;_size&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">clone</span></div>

<div class="viewcode-block" id="Class3D.close"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Class3D.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Do nothing on close, since the db will be closed by SetOfClasses</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="ClassVol"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.ClassVol">[docs]</a><span class="k">class</span> <span class="nc">ClassVol</span><span class="p">(</span><span class="n">SetOfVolumes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represent a Class that groups Volume objects.</span>
<span class="sd">    Usually the representative of the class is another Volume.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ClassVol.close"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.ClassVol.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Do nothing on close, since the db will be closed by SetOfClasses</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="SetOfClasses"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses">[docs]</a><span class="k">class</span> <span class="nc">SetOfClasses</span><span class="p">(</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Store results from a classification. &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type of classes stored in the set</span>
    <span class="n">REP_TYPE</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type of the representatives of each class</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Store the average images of each class(SetOfParticles)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_representatives</span> <span class="o">=</span> <span class="n">Boolean</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_imagesPointer</span> <span class="o">=</span> <span class="n">Pointer</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfClasses.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy basic information from other set of classes to current one&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyAttributes</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;_representatives&#39;</span><span class="p">,</span> <span class="s1">&#39;_imagesPointer&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfClasses.iterClassItems"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses.iterClassItems">[docs]</a>    <span class="k">def</span> <span class="nf">iterClassItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterDisabled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over the images of a class.</span>
<span class="sd">        Params:</span>
<span class="sd">            iterDisabled: If True, also include the disabled items. &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterItems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">iterDisabled</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="bp">cls</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">iterDisabled</span> <span class="ow">or</span> <span class="n">img</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                        <span class="k">yield</span> <span class="n">img</span></div>

<div class="viewcode-block" id="SetOfClasses.hasRepresentatives"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses.hasRepresentatives">[docs]</a>    <span class="k">def</span> <span class="nf">hasRepresentatives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_representatives</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfClasses.getImages"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses.getImages">[docs]</a>    <span class="k">def</span> <span class="nf">getImages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the SetOFImages used to create the SetOfClasses. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imagesPointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfClasses.setImages"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses.setImages">[docs]</a>    <span class="k">def</span> <span class="nf">setImages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_imagesPointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">images</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfClasses.getDimensions"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses.getDimensions">[docs]</a>    <span class="k">def</span> <span class="nf">getDimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return first image dimensions as a tuple: (xdim, ydim, zdim)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasRepresentatives</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">()</span><span class="o">.</span><span class="n">getRepresentative</span><span class="p">()</span><span class="o">.</span><span class="n">getDim</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_setItemMapperPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classItem</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the mapper path of this class according to the mapper</span>
<span class="sd">        path of the SetOfClasses and also the prefix according to class id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">classPrefix</span> <span class="o">=</span> <span class="s1">&#39;Class</span><span class="si">%03d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">classItem</span><span class="o">.</span><span class="n">getObjId</span><span class="p">()</span>
        <span class="n">classItem</span><span class="o">.</span><span class="n">_mapperPath</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">(),</span> <span class="n">classPrefix</span><span class="p">))</span>
        <span class="n">classItem</span><span class="o">.</span><span class="n">_mapperPath</span><span class="o">.</span><span class="n">setStore</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">classItem</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_insertItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classItem</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create the SetOfImages assigned to a class.</span>
<span class="sd">        If the file exists, it will load the Set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">classItem</span><span class="o">.</span><span class="n">hasRepresentative</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_representatives</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">classItem</span><span class="p">)</span>
        <span class="n">EMSet</span><span class="o">.</span><span class="n">_insertItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classItem</span><span class="p">)</span>
        <span class="n">classItem</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">properties</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Set.write(self)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Setup the mapper classes before returning the item. &quot;&quot;&quot;</span>
        <span class="n">classItem</span> <span class="o">=</span> <span class="n">EMSet</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemId</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">classItem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">classItem</span>

<div class="viewcode-block" id="SetOfClasses.getFirstItem"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses.getFirstItem">[docs]</a>    <span class="k">def</span> <span class="nf">getFirstItem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">classItem</span> <span class="o">=</span> <span class="n">EMSet</span><span class="o">.</span><span class="n">getFirstItem</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">classItem</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">classItem</span></div>

<div class="viewcode-block" id="SetOfClasses.iterItems"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses.iterItems">[docs]</a>    <span class="k">def</span> <span class="nf">iterItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orderBy</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;ASC&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">classItem</span> <span class="ow">in</span> <span class="n">EMSet</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orderBy</span><span class="o">=</span><span class="n">orderBy</span><span class="p">,</span>
                                         <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setItemMapperPath</span><span class="p">(</span><span class="n">classItem</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">classItem</span></div>

<div class="viewcode-block" id="SetOfClasses.iterRepresentatives"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses.iterRepresentatives">[docs]</a>    <span class="k">def</span> <span class="nf">iterRepresentatives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orderBy</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;ASC&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">classItem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="n">orderBy</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">classItem</span><span class="o">.</span><span class="n">hasRepresentative</span><span class="p">():</span>
                <span class="n">rep</span> <span class="o">=</span> <span class="n">classItem</span><span class="o">.</span><span class="n">getRepresentative</span><span class="p">()</span>
                <span class="n">rep</span><span class="o">.</span><span class="n">setObjId</span><span class="p">(</span><span class="n">classItem</span><span class="o">.</span><span class="n">getObjId</span><span class="p">())</span>
                <span class="n">rep</span><span class="o">.</span><span class="n">setSamplingRate</span><span class="p">(</span><span class="n">classItem</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">())</span>

                <span class="k">yield</span> <span class="n">rep</span></div>

<div class="viewcode-block" id="SetOfClasses.getSamplingRate"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses.getSamplingRate">[docs]</a>    <span class="k">def</span> <span class="nf">getSamplingRate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImages</span><span class="p">()</span><span class="o">.</span><span class="n">getSamplingRate</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfClasses.appendFromClasses"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses.appendFromClasses">[docs]</a>    <span class="k">def</span> <span class="nf">appendFromClasses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classesSet</span><span class="p">,</span> <span class="n">filterClassFunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">updateClassCallback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate over the classes and the elements inside each</span>
<span class="sd">        class and append classes and items that are enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filterClassFunc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filterClassFunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">cls</span><span class="p">:</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">classesSet</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">()</span> <span class="ow">and</span> <span class="n">filterClassFunc</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
                <span class="n">newCls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ITEM_TYPE</span><span class="p">()</span>
                <span class="n">newCls</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
                <span class="n">newCls</span><span class="o">.</span><span class="n">setObjId</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">getObjId</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">updateClassCallback</span><span class="p">:</span>
                    <span class="n">updateClassCallback</span><span class="p">(</span><span class="n">newCls</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCls</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="bp">cls</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                        <span class="n">newCls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">newCls</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfClasses.classifyItems"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses.classifyItems">[docs]</a>    <span class="k">def</span> <span class="nf">classifyItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">updateItemCallback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">updateClassCallback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">itemDataIterator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">classifyDisabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">iterParams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">doClone</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Classify items from the self.getImages() and add the needed classes.</span>
<span class="sd">        This function iterates over each item in the images and call</span>
<span class="sd">        the updateItemCallback to register the information coming from</span>
<span class="sd">        the iterator in itemDataIterator. The callback function should</span>
<span class="sd">        set the classId of the image that will be used to classify it.</span>
<span class="sd">        It is also possible to pass a callback to update the class properties.</span>

<span class="sd">        :param updateItemCallback: callback to be invoked on each item&#39;s loop (e.g.: 2d image in a 2d classification)</span>
<span class="sd">        :param updateClassCallback: callback to be invoked when a item.getClassId() changes</span>
<span class="sd">        :param itemDataIterator: an iterator (usually on metadata files, star, xmd,..) that will be called on each loop.</span>
<span class="sd">        usually has that same lines as items and iteration is kept in sync</span>
<span class="sd">        :param classifyDisabled: classify disabled items. By default they are skipped.</span>
<span class="sd">        :param iterParams: Parameters for self.getImages() to leave oot images/filter</span>
<span class="sd">        :param doClone: Make a clone of the item (defaults to true)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">itemDataIter</span> <span class="o">=</span> <span class="n">itemDataIterator</span>  <span class="c1"># shortcut</span>

        <span class="n">clsDict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Dictionary to store the (classId, classSet) pairs</span>
        <span class="n">inputSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImages</span><span class="p">()</span>
        <span class="n">iterParams</span> <span class="o">=</span> <span class="n">iterParams</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">inputSet</span><span class="o">.</span><span class="n">iterItems</span><span class="p">(</span><span class="o">**</span><span class="n">iterParams</span><span class="p">):</span>
            <span class="c1"># copy items if enabled or copyDisabled=True</span>
            <span class="k">if</span> <span class="n">classifyDisabled</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
                <span class="n">newItem</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="k">if</span> <span class="n">doClone</span> <span class="k">else</span> <span class="n">item</span>
                <span class="k">if</span> <span class="n">updateItemCallback</span><span class="p">:</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">itemDataIter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">next</span><span class="p">(</span><span class="n">itemDataIter</span><span class="p">)</span>
                    <span class="n">updateItemCallback</span><span class="p">(</span><span class="n">newItem</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
                    <span class="c1"># If updateCallBack function returns attribute</span>
                    <span class="c1"># _appendItem to False do not append the item</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">newItem</span><span class="p">,</span> <span class="s2">&quot;_appendItem&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                        <span class="k">continue</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="n">newItem</span><span class="o">.</span><span class="n">getClassId</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Particle classId is None!!!&#39;</span><span class="p">)</span>

                <span class="c1"># Register a new class set if the ref was not found.</span>
                <span class="c1"># if not ref in clsDict:</span>
                <span class="k">if</span> <span class="n">ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">clsDict</span><span class="p">:</span>
                    <span class="n">classItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ITEM_TYPE</span><span class="p">(</span><span class="n">objId</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span>
                    <span class="n">rep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">REP_TYPE</span><span class="p">()</span>
                    <span class="n">classItem</span><span class="o">.</span><span class="n">setRepresentative</span><span class="p">(</span><span class="n">rep</span><span class="p">)</span>
                    <span class="n">clsDict</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span> <span class="o">=</span> <span class="n">classItem</span>
                    <span class="n">classItem</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="n">inputSet</span><span class="p">)</span>
                    <span class="n">classItem</span><span class="o">.</span><span class="n">setAcquisition</span><span class="p">(</span><span class="n">inputSet</span><span class="o">.</span><span class="n">getAcquisition</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">updateClassCallback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">updateClassCallback</span><span class="p">(</span><span class="n">classItem</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">classItem</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">classItem</span> <span class="o">=</span> <span class="n">clsDict</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span>
                <span class="n">classItem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newItem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">itemDataIter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">next</span><span class="p">(</span><span class="n">itemDataIter</span><span class="p">)</span>  <span class="c1"># just skip disabled data row</span>

        <span class="k">for</span> <span class="n">classItem</span> <span class="ow">in</span> <span class="n">clsDict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">classItem</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfClasses2D"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses2D">[docs]</a><span class="k">class</span> <span class="nc">SetOfClasses2D</span><span class="p">(</span><span class="n">SetOfClasses</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Store results from a 2D classification of Particles. &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">Class2D</span>
    <span class="n">REP_TYPE</span> <span class="o">=</span> <span class="n">Particle</span>

<div class="viewcode-block" id="SetOfClasses2D.writeStack"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses2D.writeStack">[docs]</a>    <span class="k">def</span> <span class="nf">writeStack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnStack</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Write an stack with the classes averages. &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pwem.emlib.image</span> <span class="k">import</span> <span class="n">ImageHandler</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasRepresentatives</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not write Averages stack &#39;</span>
                            <span class="s1">&#39;if not hasRepresentatives!!!&#39;</span><span class="p">)</span>
        <span class="n">ih</span> <span class="o">=</span> <span class="n">ImageHandler</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">class2D</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">class2D</span><span class="o">.</span><span class="n">getRepresentative</span><span class="p">()</span>
            <span class="n">ih</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fnStack</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="SetOfClasses3D"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClasses3D">[docs]</a><span class="k">class</span> <span class="nc">SetOfClasses3D</span><span class="p">(</span><span class="n">SetOfClasses</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Store results from a 3D classification of Particles. &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">Class3D</span>
    <span class="n">REP_TYPE</span> <span class="o">=</span> <span class="n">Volume</span>

    <span class="k">pass</span></div>


<div class="viewcode-block" id="SetOfClassesVol"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfClassesVol">[docs]</a><span class="k">class</span> <span class="nc">SetOfClassesVol</span><span class="p">(</span><span class="n">SetOfClasses3D</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Store results from a classification of Volumes. &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">ClassVol</span>

    <span class="k">pass</span></div>


<div class="viewcode-block" id="NormalMode"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.NormalMode">[docs]</a><span class="k">class</span> <span class="nc">NormalMode</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Store normal mode information. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modeFile</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;modeFile&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collectivity</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;collectivity&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_score</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

<div class="viewcode-block" id="NormalMode.getModeFile"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.NormalMode.getModeFile">[docs]</a>    <span class="k">def</span> <span class="nf">getModeFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modeFile</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="NormalMode.setModeFile"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.NormalMode.setModeFile">[docs]</a>    <span class="k">def</span> <span class="nf">setModeFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modeFile</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="NormalMode.getCollectivity"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.NormalMode.getCollectivity">[docs]</a>    <span class="k">def</span> <span class="nf">getCollectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collectivity</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="NormalMode.setCollectivity"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.NormalMode.setCollectivity">[docs]</a>    <span class="k">def</span> <span class="nf">setCollectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collectivity</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="NormalMode.getScore"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.NormalMode.getScore">[docs]</a>    <span class="k">def</span> <span class="nf">getScore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="NormalMode.setScore"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.NormalMode.setScore">[docs]</a>    <span class="k">def</span> <span class="nf">setScore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfNormalModes"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfNormalModes">[docs]</a><span class="k">class</span> <span class="nc">SetOfNormalModes</span><span class="p">(</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Set containing NormalMode items. &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">NormalMode</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Store a pointer to the PdbFile object</span>
        <span class="c1"># from which this normal modes where computed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pdbPointer</span> <span class="o">=</span> <span class="n">Pointer</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfNormalModes.setPdb"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfNormalModes.setPdb">[docs]</a>    <span class="k">def</span> <span class="nf">setPdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdbFile</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pdbPointer</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">pdbFile</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfNormalModes.getPdb"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfNormalModes.getPdb">[docs]</a>    <span class="k">def</span> <span class="nf">getPdb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pdbPointer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfNormalModes.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfNormalModes.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pdbPointer</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_pdbPointer</span><span class="p">,</span> <span class="n">copyId</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="FramesRange"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.FramesRange">[docs]</a><span class="k">class</span> <span class="nc">FramesRange</span><span class="p">(</span><span class="n">CsvList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Store first and last frames in a movie. The last element will be</span>
<span class="sd">     the index in the stack of the first frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firstFrame</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lastFrame</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">firstFrameIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Frames numbering always refer to the initial movies imported into</span>
<span class="sd">        the project. Counting goes from 1 to the number of frames.</span>

<span class="sd">        The underlying stack file could have all original frames or just</span>
<span class="sd">        a subset of them, so we need to keep which is the index of the</span>
<span class="sd">        first frame in the stack, again, the first image in a stack is 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">CsvList</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pType</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">firstFrame</span><span class="p">,</span> <span class="n">lastFrame</span><span class="p">,</span> <span class="n">firstFrameIndex</span><span class="p">])</span>

<div class="viewcode-block" id="FramesRange.getFirstFrame"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.FramesRange.getFirstFrame">[docs]</a>    <span class="k">def</span> <span class="nf">getFirstFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="FramesRange.setFirstFrame"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.FramesRange.setFirstFrame">[docs]</a>    <span class="k">def</span> <span class="nf">setFirstFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="FramesRange.getLastFrame"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.FramesRange.getLastFrame">[docs]</a>    <span class="k">def</span> <span class="nf">getLastFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="FramesRange.setLastFrame"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.FramesRange.setLastFrame">[docs]</a>    <span class="k">def</span> <span class="nf">setLastFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="FramesRange.getRange"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.FramesRange.getRange">[docs]</a>    <span class="k">def</span> <span class="nf">getRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the frames range. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="FramesRange.getFirstFrameIndex"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.FramesRange.getFirstFrameIndex">[docs]</a>    <span class="k">def</span> <span class="nf">getFirstFrameIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span></div>

<div class="viewcode-block" id="FramesRange.setFirstFrameIndex"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.FramesRange.setFirstFrameIndex">[docs]</a>    <span class="k">def</span> <span class="nf">setFirstFrameIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="FramesRange.rangeStr"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.FramesRange.rangeStr">[docs]</a>    <span class="k">def</span> <span class="nf">rangeStr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;[</span><span class="si">%d</span><span class="s1">-</span><span class="si">%d</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> starts: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rangeStr</span><span class="p">(),</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span></div>


<div class="viewcode-block" id="Movie"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Movie">[docs]</a><span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">Micrograph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represent a set of frames of micrographs.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Micrograph</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># A movie could could have alignment information after some protocol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alignment</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_framesRange</span> <span class="o">=</span> <span class="n">FramesRange</span><span class="p">()</span>

<div class="viewcode-block" id="Movie.isCompressed"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Movie.isCompressed">[docs]</a>    <span class="k">def</span> <span class="nf">isCompressed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;bz2&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;tbz&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Movie.getDim"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Movie.getDim">[docs]</a>    <span class="k">def</span> <span class="nf">getDim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return image dimensions as tuple: (Xdim, Ydim, Zdim)</span>
<span class="sd">        Consider compressed Movie files&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pwem.emlib.image</span> <span class="k">import</span> <span class="n">ImageHandler</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCompressed</span><span class="p">():</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">ImageHandler</span><span class="p">()</span><span class="o">.</span><span class="n">getDimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Movie.getNumberOfFrames"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Movie.getNumberOfFrames">[docs]</a>    <span class="k">def</span> <span class="nf">getNumberOfFrames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the number of frames of this movie</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_framesRange</span>
        <span class="k">if</span> <span class="n">last</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">last</span> <span class="o">-</span> <span class="n">first</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCompressed</span><span class="p">():</span>
            <span class="kn">from</span> <span class="nn">pwem.emlib.image</span> <span class="k">import</span> <span class="n">ImageHandler</span>

            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">ImageHandler</span><span class="p">()</span><span class="o">.</span><span class="n">getDimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># Protect against evil mrc files</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Movie.hasAlignment"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Movie.hasAlignment">[docs]</a>    <span class="k">def</span> <span class="nf">hasAlignment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alignment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Movie.getAlignment"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Movie.getAlignment">[docs]</a>    <span class="k">def</span> <span class="nf">getAlignment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alignment</span></div>

<div class="viewcode-block" id="Movie.setAlignment"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Movie.setAlignment">[docs]</a>    <span class="k">def</span> <span class="nf">setAlignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alignment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Alignment are stored as a vector</span>
<span class="sd">        containing x and y coordinates. In this way 1 2 3 4</span>
<span class="sd">        are the data related with 2 frames with shifts (1,2)</span>
<span class="sd">        and (3,4)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alignment</span> <span class="o">=</span> <span class="n">alignment</span></div>

<div class="viewcode-block" id="Movie.getFramesRange"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Movie.getFramesRange">[docs]</a>    <span class="k">def</span> <span class="nf">getFramesRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_framesRange</span></div>

<div class="viewcode-block" id="Movie.setFramesRange"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.Movie.setFramesRange">[docs]</a>    <span class="k">def</span> <span class="nf">setFramesRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_framesRange</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MovieAlignment"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.MovieAlignment">[docs]</a><span class="k">class</span> <span class="nc">MovieAlignment</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Store the alignment between the different Movie frames.</span>
<span class="sd">    Also store the first and last frames used for alignment.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">last</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_first</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xshifts</span> <span class="o">=</span> <span class="n">CsvList</span><span class="p">(</span><span class="n">pType</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_yshifts</span> <span class="o">=</span> <span class="n">CsvList</span><span class="p">(</span><span class="n">pType</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xshifts</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xshifts&#39;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_yshifts</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;yshifts&#39;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="c1"># This list contain the coordinate where you begin the crop (x, y),</span>
        <span class="c1"># the width and height of the frames.</span>
        <span class="c1"># The order is: x,y, width and height.</span>
        <span class="c1"># For width and height, 0 means the entire frame.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_roi</span> <span class="o">=</span> <span class="n">CsvList</span><span class="p">(</span><span class="n">pType</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<div class="viewcode-block" id="MovieAlignment.getRange"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.MovieAlignment.getRange">[docs]</a>    <span class="k">def</span> <span class="nf">getRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the first and last frames used for alignment.</span>
<span class="sd">        The first frame in a movie stack is numbered 1 and the maximum value</span>
<span class="sd">        for the last one is N,  where N is the total number of frames.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_first</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="MovieAlignment.getShifts"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.MovieAlignment.getShifts">[docs]</a>    <span class="k">def</span> <span class="nf">getShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the list of alignment between one frame</span>
<span class="sd">        to another, from first to last frame used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xshifts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yshifts</span></div>

<div class="viewcode-block" id="MovieAlignment.setRoi"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.MovieAlignment.setRoi">[docs]</a>    <span class="k">def</span> <span class="nf">setRoi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">roiList</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_roi</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">roiList</span><span class="p">)</span></div>

<div class="viewcode-block" id="MovieAlignment.getRoi"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.MovieAlignment.getRoi">[docs]</a>    <span class="k">def</span> <span class="nf">getRoi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the size used to align the movie</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roi</span></div></div>


<div class="viewcode-block" id="SetOfMovies"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMovies">[docs]</a><span class="k">class</span> <span class="nc">SetOfMovies</span><span class="p">(</span><span class="n">SetOfMicrographsBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represents a set of Movies. &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">Movie</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">SetOfMicrographsBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gainFile</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_darkFile</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="c1"># Store the frames range to avoid loading the items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_firstFramesRange</span> <span class="o">=</span> <span class="n">FramesRange</span><span class="p">()</span>

<div class="viewcode-block" id="SetOfMovies.setGain"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMovies.setGain">[docs]</a>    <span class="k">def</span> <span class="nf">setGain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gain</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gainFile</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">gain</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfMovies.getGain"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMovies.getGain">[docs]</a>    <span class="k">def</span> <span class="nf">getGain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gainFile</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfMovies.setDark"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMovies.setDark">[docs]</a>    <span class="k">def</span> <span class="nf">setDark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dark</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_darkFile</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">dark</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetOfMovies.getDark"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMovies.getDark">[docs]</a>    <span class="k">def</span> <span class="nf">getDark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_darkFile</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetOfMovies.getFramesRange"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMovies.getFramesRange">[docs]</a>    <span class="k">def</span> <span class="nf">getFramesRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstFramesRange</span></div>

<div class="viewcode-block" id="SetOfMovies.setFramesRange"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMovies.setFramesRange">[docs]</a>    <span class="k">def</span> <span class="nf">setFramesRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_firstFramesRange</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_setFirstDim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">getDim</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_firstFramesRange</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">getFramesRange</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_dimStr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the string representing the dimensions. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="n">dimStr</span> <span class="o">=</span> <span class="s1">&#39;No-Dim&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_firstDim</span><span class="p">)</span>
            <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstFramesRange</span>
            <span class="k">if</span> <span class="n">last</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">z</span>
            <span class="n">dimStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ImageDim</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">last</span> <span class="o">-</span> <span class="n">first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dimStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstFramesRange</span><span class="o">.</span><span class="n">rangeStr</span><span class="p">())</span>

<div class="viewcode-block" id="SetOfMovies.copyInfo"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMovies.copyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copy SoM specific information plus inherited &quot;&quot;&quot;</span>
        <span class="n">SetOfMicrographsBase</span><span class="o">.</span><span class="n">copyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gainFile</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getGain</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_darkFile</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getDark</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_firstFramesRange</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">getFramesRange</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="MovieParticle"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.MovieParticle">[docs]</a><span class="k">class</span> <span class="nc">MovieParticle</span><span class="p">(</span><span class="n">Particle</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Particle</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_particleId</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frameId</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">()</span>

<div class="viewcode-block" id="MovieParticle.getParticleId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.MovieParticle.getParticleId">[docs]</a>    <span class="k">def</span> <span class="nf">getParticleId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_particleId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="MovieParticle.setParticleId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.MovieParticle.setParticleId">[docs]</a>    <span class="k">def</span> <span class="nf">setParticleId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partId</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_particleId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">partId</span><span class="p">)</span></div>

<div class="viewcode-block" id="MovieParticle.getFrameId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.MovieParticle.getFrameId">[docs]</a>    <span class="k">def</span> <span class="nf">getFrameId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frameId</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>

<div class="viewcode-block" id="MovieParticle.setFrameId"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.MovieParticle.setFrameId">[docs]</a>    <span class="k">def</span> <span class="nf">setFrameId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameId</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frameId</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">frameId</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfMovieParticles"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfMovieParticles">[docs]</a><span class="k">class</span> <span class="nc">SetOfMovieParticles</span><span class="p">(</span><span class="n">SetOfParticles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This is just to distinguish the special case</span>
<span class="sd">    when the particles have been extracted from a set of movies.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">MovieParticle</span></div>


<div class="viewcode-block" id="FSC"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.FSC">[docs]</a><span class="k">class</span> <span class="nc">FSC</span><span class="p">(</span><span class="n">EMObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Store a Fourier Shell Correlation&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">EMObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">CsvList</span><span class="p">(</span><span class="n">pType</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">CsvList</span><span class="p">(</span><span class="n">pType</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<div class="viewcode-block" id="FSC.loadFromMd"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.FSC.loadFromMd">[docs]</a>    <span class="k">def</span> <span class="nf">loadFromMd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mdObj</span><span class="p">,</span> <span class="n">labelX</span><span class="p">,</span> <span class="n">labelY</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fill the x and y data of the FSC from a metadata.</span>
<span class="sd">        Params:</span>
<span class="sd">            mdObj: either a metadata object of a filename</span>
<span class="sd">            labelX: label used for frequency</span>
<span class="sd">            labelY: label used for FSC values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># iterate through x and y and create csvLists</span>
        <span class="kn">import</span> <span class="nn">pwem.emlib.metadata</span> <span class="k">as</span> <span class="nn">md</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">md</span><span class="o">.</span><span class="n">iterRows</span><span class="p">(</span><span class="n">mdObj</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span><span class="n">labelX</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span><span class="n">labelY</span><span class="p">))</span></div>

<div class="viewcode-block" id="FSC.getData"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.FSC.getData">[docs]</a>    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span></div>

<div class="viewcode-block" id="FSC.setData"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.FSC.setData">[docs]</a>    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xData</span><span class="p">,</span> <span class="n">yData</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xData</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">yData</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SetOfFSCs"><a class="viewcode-back" href="../../../api/pwem/pwem.objects.data.html#pwem.objects.data.SetOfFSCs">[docs]</a><span class="k">class</span> <span class="nc">SetOfFSCs</span><span class="p">(</span><span class="n">EMSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a set of FSCs&quot;&quot;&quot;</span>
    <span class="n">ITEM_TYPE</span> <span class="o">=</span> <span class="n">FSC</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: pconesa-config--show
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../../dependabot_pip_jinja2-2.10.1/index.html">dependabot/pip/jinja2-2.10.1</a></dd>
            <dd><a href="../../../../gh-pages/index.html">gh-pages</a></dd>
            <dd><a href="data.html">pconesa-config--show</a></dd>
            <dd><a href="../../../../release-2.0.0/index.html">release-2.0.0</a></dd>
            <dd><a href="../../../../release-3.0.0/index.html">release-3.0.0</a></dd>
            <dd><a href="../../../../rsanchezgarc-patch-1/index.html">rsanchezgarc-patch-1</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>