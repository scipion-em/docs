

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Installation Script &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/install-from-sources.html">Installing Scipion v3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities.html">Streaming Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/acquisition-simulation.html">Tutorial for Facilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/appion/appion.html">appion package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/atomstructutils/atomstructutils.html">atomstructutils package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/atsas/atsas.html">atsas package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/bamfordlab/bamfordlab.html">bamfordlab package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/bsoft/bsoft.html">bsoft package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/ccp4/ccp4.html">ccp4 package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/chimera/chimera.html">chimera package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/cistem/cistem.html">cistem package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/cryoef/cryoef.html">cryoef package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/cryosparc2/cryosparc2.html">cryosparc2 package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/dynamo/dynamo.html">dynamo package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/eman2/eman2.html">eman2 package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/emxlib/emxlib.html">emxlib package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/fsc3d/fsc3d.html">fsc3d package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/gautomatch/gautomatch.html">gautomatch package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/gctf/gctf.html">gctf package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/imod/imod.html">imod package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/localrec/localrec.html">localrec package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/locscale/locscale.html">locscale package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/motioncorr/motioncorr.html">motioncorr package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/novactf/novactf.html">novactf package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/phenix/phenix.html">phenix package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pyworkflow/pyworkflow.html">pyworkflow package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pwem/pwem.html">pwem package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/relion/relion.html">relion package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/resmap/resmap.html">resmap package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/scipion/scipion.html">scipion package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/sphire/sphire.html">sphire package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/spider/spider.html">spider package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tomo/tomo.html">tomo package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/topaz/topaz.html">topaz package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/xmipp3/xmipp3.html">xmipp3 package</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Installation Script</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/docs/developer/installation-system.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="figure">
<a class="reference internal image-reference" href="../../_images/scipion_logo.gif"><img alt="scipion logo" src="../../_images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="installation-script">
<span id="installation-system"></span><h1><a class="toc-backref" href="#id1">Installation Script</a><a class="headerlink" href="#installation-script" title="Permalink to this headline">¶</a></h1>
<p>This page will explain the Scipion installation system</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#installation-script" id="id1">Installation Script</a><ul>
<li><a class="reference internal" href="#developers" id="id2">Developers</a><ul>
<li><a class="reference internal" href="#repository-at-github" id="id3">Repository at GitHub</a></li>
<li><a class="reference internal" href="#installing-python-modules" id="id4">Installing python modules</a></li>
<li><a class="reference internal" href="#modifying-installation-script" id="id5">Modifying installation script</a></li>
<li><a class="reference internal" href="#generating-binaries" id="id6">Generating Binaries</a></li>
<li><a class="reference internal" href="#installing-on-mac" id="id7">Installing on Mac</a></li>
<li><a class="reference internal" href="#install-howtos-for-clusters" id="id8">Install howtos for clusters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation-script-details" id="id9">Installation Script Details</a><ul>
<li><a class="reference internal" href="#overview" id="id10">Overview</a></li>
<li><a class="reference internal" href="#scenarios" id="id11">Scenarios</a></li>
<li><a class="reference internal" href="#solutions" id="id12">Solutions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="developers">
<h2><a class="toc-backref" href="#id2">Developers</a><a class="headerlink" href="#developers" title="Permalink to this headline">¶</a></h2>
<p>This section contains advance installation topics that can be useful
for developers.</p>
<div class="section" id="repository-at-github">
<h3><a class="toc-backref" href="#id3">Repository at GitHub</a><a class="headerlink" href="#repository-at-github" title="Permalink to this headline">¶</a></h3>
<p>For developers, use this <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span></code> command instead:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone git@github.com:I2PC/scipion.git
</pre></div>
</div>
<p>The Scipion repository was moved from SourceForge to
GitHub (May-2015). If you had a <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span></code> with the previous Sourceforge address, please update the repository with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git remote set-url origin https://github.com/I2PC/scipion.git
</pre></div>
</div>
</div>
<div class="section" id="installing-python-modules">
<h3><a class="toc-backref" href="#id4">Installing python modules</a><a class="headerlink" href="#installing-python-modules" title="Permalink to this headline">¶</a></h3>
<p>The modules required in a typical production installation are handled
in <code class="docutils literal notranslate"><span class="pre">install/script.py</span></code></p>
<p>Some of these modules utility is restricted to specific cases, so you may
need to install them “by hand” after the standard scipion installation. For example,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scipion install pip
</pre></div>
</div>
<p>If you are in development mode and need a quick and dirty installation of
some new python module, you can use scipion pip to install it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scipion run pip install trendy_python_lib
</pre></div>
</div>
<p>When the module integration into scipion has been approved, it will be
integrated in <code class="docutils literal notranslate"><span class="pre">install/script.py</span></code> as others before it.</p>
</div>
<div class="section" id="modifying-installation-script">
<h3><a class="toc-backref" href="#id5">Modifying installation script</a><a class="headerlink" href="#modifying-installation-script" title="Permalink to this headline">¶</a></h3>
<p>Scipion installs several external libraries (like Python, …) and Python
modules from scratch, mainly using the scripts <code class="docutils literal notranslate"><span class="pre">install.py</span></code> and <code class="docutils literal notranslate"><span class="pre">script.py</span></code>. The latter
contains a list of external libraries, versions, and Python modules to be installed
and their dependencies. To add new libraries or change to new versions, check how to
link:Installation-Script[change the installation script].</p>
</div>
<div class="section" id="generating-binaries">
<h3><a class="toc-backref" href="#id6">Generating Binaries</a><a class="headerlink" href="#generating-binaries" title="Permalink to this headline">¶</a></h3>
<p>We generate a binary version of Scipion that can be moved
as a whole and work in basically any machine without recompiling. For
that purpose, we use the <code class="docutils literal notranslate"><span class="pre">--binary</span></code> flag when installing from a fresh
download and compile in an old Linux for libc compatibility. More details
here about link:Generating-Binaries[how to generate binaries].</p>
</div>
<div class="section" id="installing-on-mac">
<h3><a class="toc-backref" href="#id7">Installing on Mac</a><a class="headerlink" href="#installing-on-mac" title="Permalink to this headline">¶</a></h3>
<p>The following page contains our notes on the (not yet available)
link:Installing-on-Mac[installation on Macs].</p>
</div>
<div class="section" id="install-howtos-for-clusters">
<h3><a class="toc-backref" href="#id8">Install howtos for clusters</a><a class="headerlink" href="#install-howtos-for-clusters" title="Permalink to this headline">¶</a></h3>
<p>link:SDSC-Gordon-Howto[SDSC Gordon]</p>
</div>
</div>
<div class="section" id="installation-script-details">
<h2><a class="toc-backref" href="#id9">Installation Script Details</a><a class="headerlink" href="#installation-script-details" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3><a class="toc-backref" href="#id10">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">install.py</span> <span class="pre">script</span></code>. Responsible for downloading, unpacking, and installing SCons under the software/install folder. It also sends the output to a log file and stdout.</li>
<li><code class="docutils literal notranslate"><span class="pre">scipion</span> <span class="pre">script</span></code>. Everything in Scipion is centralized through this script. This is done to ensure that the environment is controlled and to simplify the user’s experience by giving him only one file to look in for searching Scipion actions.</li>
</ul>
</div>
<div class="section" id="scenarios">
<h3><a class="toc-backref" href="#id11">Scenarios</a><a class="headerlink" href="#scenarios" title="Permalink to this headline">¶</a></h3>
<p>Let’s think of the typical installation scenarios as exercises:</p>
<ul class="simple">
<li><strong>Exercise 1</strong>: You need the Scipion path to have an additional python
module in its self-compiled Python. How can you add it to Scipion
python?</li>
<li><strong>Exercise 2</strong>: To fix the version of a specific external library,
you’ve decided to compile it with Scipion, so a shared library will be
placed in the software/lib folder, using it whenever you use Scipion. How
can you do it?</li>
<li><strong>Exercise 3</strong>: A new EM Package, called TRFEMP (The Really
Fantastic EM Package) has appeared, and you don’t want to miss the
opportunity to test it with Scipion and compare the results with the
other EM Packages in the market. How can you add it?</li>
</ul>
</div>
<div class="section" id="solutions">
<h3><a class="toc-backref" href="#id12">Solutions</a><a class="headerlink" href="#solutions" title="Permalink to this headline">¶</a></h3>
<p>In most cases, it will be enough to take a look at the definitions of
packages currently in use, in the file <code class="docutils literal notranslate"><span class="pre">install/script.py</span></code>. The script
is organized to reflect the 3 scenarios (library, python module, EM
package)</p>
<p>If you need to add (or modify) low-level features, <code class="docutils literal notranslate"><span class="pre">install/funcs.py</span></code> is
your file.</p>
<p><strong>Solution to exercise 1</strong></p>
<p>In Exercise 1, the solution would be very simple. Let’s say you’re trying to
add the python module paramiko. With every library, every module, and
every EM package in Scipion, there is always a parameter called
“default” that determines whether the library, module or package has to
be built by default with Scipion. That means that if the user doesn’t
specify anything, the job will be done. In other case, an option called
“–with-name”, with ‘name’ being the name of the library, module, or package,
will be added to the installation parameters, so the user would be able
to use, for example, ./scipion install –with-paramiko. Let’s say we
don’t need paramiko by default, but certain installations may need to
install it, then default=false.</p>
<p>The <em>addModule()</em> function has the following parameters:</p>
<ul class="simple">
<li><strong>name</strong>: the name of the module. ‘paramiko’ in this case. It is
mandatory.</li>
<li><strong>tar</strong>: the compressed file to download with the sources. In case you
don’t provide it, it will assume name.tgz.</li>
<li><strong>buildDir</strong>: the name of the decompressed folder. The tarfile must
contain a folder with the module, and that may not be “name”, so if you
don’t provide it, this will remove “tar.gz” or “tgz” from the tarfile
and assume the name of the folder is that.</li>
<li><strong>targets</strong>: SCons builders (or pseudo-builders) need targets to work.
That is how it builds its dependency tree. A builder generates a list of
targets which will probably be sources for the next builders in the
dependency tree. An adequate target would be a file/folder that is
mandatorily generated by the build process. For example, in a python
module, a folder is usually generated inside
lib/pythonX.Y/site-packages/ with the name of the module. That is the
trick used by addModule() function. When you provide a target, it makes
the untar process dependent on the download one, and the “setup.py
install” will depend on the untar result, and on the other hand, will
generate as a target the folder software/lib/python2.7/site-packages/name
, with ‘name’ being the target passed as argument. If no target is passed, then
‘name’ will be assumed.</li>
<li><strong>url</strong>: the URL used to download the tarfile. If no URL is provided,
then <a class="reference external" href="http://scipionwiki.cnb.csic.es/files/scipion/software/python/name">http://scipionwiki.cnb.csic.es/files/scipion/software/python/name</a>
will be assumed.</li>
<li><strong>flags</strong>: the arguments that may be necessary to pass to the Python
setup.py install call. In any case, –prefix=software will be assumed, so
every module will be built in the Scipion architecture.</li>
<li><strong>deps</strong>: the other elements on which this module may depend.
Usually other builders’ targets may be passed here. Every python module
(as it may be obvious) depends on Python itself.</li>
<li><strong>default</strong>: the yet-to-be-explained default mechanism. If nothing is passed,
True is assumed (meaning the module will be built by default).</li>
</ul>
<p>So taking everything into account, it seems like adding paramiko module,
would only need to write (in SConscript file) the following line.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>addModule<span class="o">(</span>
    <span class="s1">&#39;paramiko&#39;</span>,
    <span class="nv">tar</span><span class="o">=</span><span class="s1">&#39;paramiko-1.14.0.tgz&#39;</span>,
    <span class="nv">default</span><span class="o">=</span>False<span class="o">)</span>
</pre></div>
</div>
<p>This means that if the user runs <code class="docutils literal notranslate"><span class="pre">./scipion</span> <span class="pre">install</span> <span class="pre">--with-paramiko</span></code>,
then a so-called paramiko python module is downloaded from
<a class="reference external" href="http://scipionwiki.cnb.csic.es/files/scipion/software/python/paramiko-1.14.0.tgz">http://scipionwiki.cnb.csic.es/files/scipion/software/python/paramiko-1.14.0.tgz</a>
URL to the <cite>software/tmp</cite> folder, decompressed as
<code class="docutils literal notranslate"><span class="pre">software/paramiko/paramiko-1.14.0</span></code> and then
<code class="docutils literal notranslate"><span class="pre">software/bin/python</span> <span class="pre">setup.py</span> <span class="pre">install</span> <span class="pre">--prefix=software</span></code> will be
executed, installing the module under
software/lib/python2.7/site-packages/paramiko. The resulting log will be
stored at <cite>software/log/paramiko.log</cite>. All those actions will be
committed just by adding that simple line.</p>
<p>But… just a moment… wasn’t it AddModule() instead of addModule()?
Yes, don’t panic. In this case, we’ve also supplied a function called
addModule in the SConscript file, just to avoid needing to introduce
<code class="docutils literal notranslate"><span class="pre">deps=[python]</span></code> (automatically adding python dependency). But please,
note that it is the same as typing the line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>AddModule<span class="o">(</span>
    <span class="s1">&#39;paramiko&#39;</span>,
    <span class="nv">tar</span><span class="o">=</span><span class="s1">&#39;paramiko-1.14.0.tgz&#39;</span>,
    <span class="nv">deps</span><span class="o">=[</span>python<span class="o">]</span>,
    <span class="nv">default</span><span class="o">=</span>False<span class="o">)</span>
</pre></div>
</div>
<p><strong>Solution to exercise 2</strong></p>
<p>Exercise 2 is also simple and is an example of how can we compile a
new external library. In this case, developer will only need to add a
line in SConscript, but this time it will be a call to
<strong>`AddLibrary()`</strong>. Let’s say it’s the sqlite library. If we see the</p>
<blockquote>
<div>AddLibrary() params…</div></blockquote>
<ul class="simple">
<li><strong>name</strong>: similar to AddModule; this will be ‘sqlite’.</li>
<li><strong>tar</strong>: same as in AddModule; this time we will use
‘sqlite-3.6.23.tgz’. If we don’t say anything, it would look for
‘sqlite.tgz’</li>
<li><strong>buildDir</strong>: as in AddModule, it will be generated automatically as
‘sqlite-3.6.23’ taking it from tar name without the extension.</li>
<li><strong>targets</strong>: in libraries, we will expect the build process to
generate a shared library. Starting from software folder, the targets
will be taken here. So in this case we will use ‘lib/libsqlite3.so’ (we
know that installation procedure will generate that file).</li>
<li><strong>url</strong>: as in AddModule, in this case URL can be also guessed, but
this time the guessed address will be
<a class="reference external" href="http://scipionwiki.cnb.csic.es/files/scipion/software/external/name">http://scipionwiki.cnb.csic.es/files/scipion/software/external/name</a>
(‘name’ being ‘sqlite’ in our case).</li>
<li><strong>flags</strong>: as we want to pass, during ./configure process, the line
“./configure CPPFLAGS=-w CFLAGS=-DSQLITE_ENABLE_UPDATE_DELETE_LIMIT=1”,
we will set flags like flags=[‘CPPFLAGS=-w’,
‘CFLAGS=-DSQLITE_ENABLE_UPDATE_DELETE_LIMIT=1’].</li>
<li><strong>autoConfigTarget</strong>: this is very specific for AutoConfig builder. As
a result of the ./configure execution, some files will be generated, and
those files modification will be used to detect whether or not the make
order must be rebuilt. For that purpose, you can pass a specific
target. Usually this target is the Makefile itself, so by default, if we
don’t say anything, ‘Makefile’ will be used.</li>
<li><strong>deps</strong>: same behavior as in AddModule, but in this case, no dep is
assumed by default.</li>
<li><strong>default</strong>: if nothing is passed, True is assumed.</li>
</ul>
<p>We can then write, to solve the exercise, the following line in
SConscript:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">sqlite</span> <span class="o">=</span> env.AddLibrary<span class="o">(</span>
    <span class="s1">&#39;sqlite&#39;</span>,
    <span class="nv">tar</span><span class="o">=</span><span class="s1">&#39;sqlite-3.6.23.tgz&#39;</span>,
    <span class="nv">targets</span><span class="o">=[</span><span class="s1">&#39;lib/libsqlite3.so&#39;</span><span class="o">]</span>,
    <span class="nv">flags</span><span class="o">=[</span><span class="s1">&#39;CPPFLAGS=-w&#39;</span>,
           <span class="s1">&#39;CFLAGS=-DSQLITE_ENABLE_UPDATE_DELETE_LIMIT=1&#39;</span><span class="o">])</span>
</pre></div>
</div>
<p>That line will cause scons execution to download
<a class="reference external" href="http://scipionwiki.cnb.csic.es/files/scipion/software/external/sqlite-3.6.23.tgz">http://scipionwiki.cnb.csic.es/files/scipion/software/external/sqlite-3.6.23.tgz</a>
to software/tmp folder, then unpacked to software/tmp/sqlite-3.6.23
folder, then configured with the order “./configure ‘CPPFLAGS=-w
CFLAGS=-DSQLITE_ENABLE_UPDATE_DELETE_LIMIT=1’” and finally executed
‘make install’ on that folder. The resulting log will be stored at
software/log/sqlite_configure.log and software/log/sqlite_make.log</p>
<p><strong>Solution to exercise 3</strong></p>
<p>The exercise 3 aims at building a new EM Package called ‘TRFEMP’. In
this case we will use the <em>`AddPackage()`</em> pseudo-builder. This one has the
arguments described below:</p>
<ul class="simple">
<li><strong>name</strong>: As usual, we need a key to name the package. In this case,
we will use ‘TRFEMP’</li>
<li><strong>tar</strong>: Same behavior as in the other pseudo-builders. If we don’t
say anything, it will assume the file ‘TRFEMP.tgz’.</li>
<li><strong>buildDir</strong>: Imagine that TRFEMP packages a folder named trfemp-1.0,
and inside it, there’s a Unix folder, where the configure script is placed.
Then buildDir will be ‘trfemp-1.0/unix’. If we don’t pass any parameters,
TRFEMP would be used.</li>
<li><strong>url</strong>: As we placed this file in
<a class="reference external" href="http://scipionwiki.cnb.csic.es/files/scipion/software/em/TRFEMP.tgz">http://scipionwiki.cnb.csic.es/files/scipion/software/em/TRFEMP.tgz</a>
address, there’s no need to explicitly indicate the URL. It will be automatically
generated.</li>
<li><strong>extraActions</strong>: Packages follow a workflow that is a little bit different
from modules and libraries. They’re not supposed to compile as usual
with ./configure &amp;&amp; make &amp;&amp; make install, but they’re supposed to be a
little bit complicated. In case the compilation can be driven
unattended, then there’s a way to provided the orders to Scipion
installer and let it compile. Otherwise, or just because we already have
the package compiled in our system, there is a way to automatically link
an already present and compiled package, and this is by using the option
–with-name=/path/to/package/home (using package name instead of “name”
and the proper path). In that case there will be a link created in
software/em/name pointing to that installation. Now imagine that TRFEMP
can be simply compiled by executing 2 commands. The first one is
“./configure –funny-option”, and among others, that command generates a
Makefile, which can be executed by using “make –very-funny-option”
creating a trfemp binary. The extraActions param expects a list of
tuples. Each tuple is built in the form (target, command), so in this
case, we would configure extraActions=[(‘Makefile’, ‘./configure
–funny-option’), (‘trfemp’, ‘make –very-funny-option’)].</li>
<li><strong>deps</strong>: Deps will behave as usually.</li>
<li><strong>default</strong>: Like the rest of the cases.</li>
</ul>
<p>To include the TRFEMP Package, add to <cite>install/script.py</cite> something
like…</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>env.AddPackage<span class="o">(</span><span class="s1">&#39;TRFEMP&#39;</span>,
               <span class="nv">buildDir</span><span class="o">=</span><span class="s1">&#39;trfemp-1.0/unix&#39;</span>,
               <span class="nv">extraActions</span><span class="o">=[(</span><span class="s1">&#39;Makefile&#39;</span>, <span class="s1">&#39;./configure --funny-option&#39;</span><span class="o">)</span>,
                                     <span class="o">(</span><span class="s1">&#39;trfemp&#39;</span>, <span class="s1">&#39;make --very-funny-option&#39;</span><span class="o">)]</span>,
               <span class="nv">default</span><span class="o">=</span>False<span class="o">)</span>
</pre></div>
</div>
<p>If the TRFEMP package is not installed, executing
<code class="docutils literal notranslate"><span class="pre">./scipion</span> <span class="pre">install</span> <span class="pre">TRFEMP</span></code> will proceed with the download, unpacking,
etc.</p>
<p><strong>Xmipp</strong></p>
<p>Xmipp is installed by default with a similar philosophy: <code class="docutils literal notranslate"><span class="pre">scipion</span></code> uses
<code class="docutils literal notranslate"><span class="pre">install/script.py</span></code> to call <code class="docutils literal notranslate"><span class="pre">install/scons.py</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">scons.py</span></code> runs SCons using scipion environment (python binary,
variables, etc).</p>
<p>Actual Xmipp installation steps (following SCons conventions) are
defined in <cite>software/em/xmipp/scipion_sconscript</cite></p>
<p>Most of the configuration of Xmipp compilation is done with environment
variables. For example, if you need to specify CUDA settings, you can
define the variables <cite>CUDA_SDK_PATH</cite>, <cite>CUDA_LIB_PATH</cite> and <cite>CUDA</cite>. As
usual, it is easier to set those variables in the scipion config files.
Again, for CUDA it would mean to edit <cite>scipion.conf</cite>, set <cite>CUDA</cite> to True
(and change the other variables if needed).</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: scipion3_instalation
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../dm_facilitiesUpdate/docs/developer/installation-system.html">dm_facilitiesUpdate</a></dd>
            <dd><a href="../../../gh-pages/docs/developer/installation-system.html">gh-pages</a></dd>
            <dd><a href="../../../release-2.0.0/docs/developer/installation-system.html">release-2.0.0</a></dd>
            <dd><a href="../../../release-3.0.0/docs/developer/installation-system.html">release-3.0.0</a></dd>
            <dd><a href="installation-system.html">scipion3_instalation</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>