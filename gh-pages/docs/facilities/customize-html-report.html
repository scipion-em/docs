

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>HTML report customization &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../static/documentation_options.js"></script>
        <script type="text/javascript" src="../../static/jquery.js"></script>
        <script type="text/javascript" src="../../static/underscore.js"></script>
        <script type="text/javascript" src="../../static/doctools.js"></script>
        <script type="text/javascript" src="../../static/language_data.js"></script>
    
    <script type="text/javascript" src="../../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/install-from-sources.html">Installing Scipion v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="facilities.html">Streaming Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="acquisition-simulation.html">Tutorial for Facilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>HTML report customization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../sources/docs/facilities/customize-html-report.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="figure">
<a class="reference internal image-reference" href="../../images/scipion_logo.gif"><img alt="scipion logo" src="../../images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="html-report-customization">
<span id="customize-html-report"></span><h1>HTML report customization<a class="headerlink" href="#html-report-customization" title="Permalink to this headline">¶</a></h1>
<div class="section" id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h2>
<p>We can use the summary monitor to track a number of things while our input
protocols run: it encapsulates the CTF Monitor, the system monitor and the movie
gain monitor. All these monitors have some graphs that we can check in the HTML
Report. Here we will focus on the technical details of the HTML report and the
options we have to customize it using some examples.</p>
</div>
<div class="section" id="before-we-start">
<h2>0. Before we start<a class="headerlink" href="#before-we-start" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">We’ll get started with an environment variable so that you can directly copy
and paste all commands in this guide. Replace the values with the right path
for your Scipion installation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">SCIPION_DIR</span><span class="o">=</span>/usr/local/scipion
</pre></div>
</div>
</li>
<li><p class="first">You’d also need a project with a Monitor Summary executed. We’ll use the result of running scipion demo. If you don’t have it yet, run scipion demo in your terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ scipion demo
</pre></div>
</div>
</li>
<li><p class="first">Open the directory of Scipion as a PyCharm project (or the editor of your choice).</p>
</li>
</ul>
</div>
<div class="section" id="changing-the-logo">
<h2>1. Changing the logo<a class="headerlink" href="#changing-the-logo" title="Permalink to this headline">¶</a></h2>
<p>The html code used by the summary monitor is in
<a class="reference external" href="https://github.com/I2PC/scipion/blob/master/pyworkflow/templates/execution.summary.template.html">pyworkflow/templates/execution.summary.template.html</a>.
If we want to use a customized version, we’ll have to modify this file.
It’s always a good idea to keep a copy of the
original:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> <span class="nv">$SCIPION_DIR</span>
$ cp pyworkflow/templates/execution.summary.template.html pyworkflow/templates/execution.summary.template.original.html
</pre></div>
</div>
<p>Now we open <a class="reference external" href="https://github.com/I2PC/scipion/blob/master/config/templates/execution.summary.template.html">pyworkflow/templates/execution.summary.template.html</a>.
to locate the logo and replace the url. We must choose a logo-sized image,
otherwise it’ll change the layout of the page:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">BODY</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;refreshBtn&#39;</span>
   <span class="na">data-toggle</span><span class="o">=</span><span class="s">&quot;tooltip&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;Toggle auto refresh&quot;</span> <span class="na">data-placement</span><span class="o">=</span><span class="s">&quot;bottom&quot;</span>
   <span class="na">href</span><span class="o">=</span><span class="s">&quot;#&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-info btn-lg&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;glyphicon glyphicon-refresh&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">DIV</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;content&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;clearfix container&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">H1</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;valign&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://upload.wikimedia.org/wikipedia/commons/thumb/7/7f/Logo_CNB.jpg/120px-Logo_CNB.jpg&quot;</span><span class="p">&gt;</span><span class="ni">&amp;nbsp;&amp;nbsp;</span> Project %(projectName)s <span class="p">&lt;/</span><span class="nt">H1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">DIV</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">DIV</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;column column-5&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>If our summary monitor is running, the next time it refreshes it should have the
new logo. If it isn’t running, we can make a copy of the protocol to see the new
HTML.</p>
<ul>
<li><p class="first">Right click on the summary monitor and choose <em>copy</em>:</p>
<div class="figure align-center">
<img alt="Copy monitor summary" src="../../images/copy_monitor_summary.png" />
</div>
</li>
<li><p class="first">Adjust the refresh time to a lower amount, so it finishes quicker. Then launch
protocol:</p>
<div class="figure align-center">
<img alt="restart monitor summary" src="../../images/restart_monitor_summary.png" />
</div>
</li>
<li><p class="first">Click on Analyze results -&gt; open html report to see the report with the new logo:</p>
<div class="figure align-center">
<img alt="analyze results" src="../../images/analyze_results.png" />
</div>
<div class="figure align-center">
<img alt="new logo" src="../../images/report_new_logo.png" />
</div>
</li>
</ul>
</div>
<div class="section" id="removing-a-column-from-the-table">
<h2>2. Removing a column from the table<a class="headerlink" href="#removing-a-column-from-the-table" title="Permalink to this headline">¶</a></h2>
<p>In this example we will remove the <em>DefocusU</em> column from the table:</p>
<div class="figure align-center">
<img alt="mic table" src="../../images/mic_table.png" />
</div>
<p>To do this, we have to go one step further and dig into the javascript code of
the html report, which you can find <a class="reference external" href="https://github.com/I2PC/scipion/blob/master/pyworkflow/templates/execution.summary.template.html#L301">after the closing of &lt;/body&gt;</a>.
The first bit of code we find is the variable <cite>report</cite>. This variable has a few
<cite>%(keywords)s</cite>, which are used by Scipion to transfer data from the protocols
watched by the Summary Monitor to the HTML report.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">report</span> <span class="o">=</span><span class="p">{</span>
    <span class="nx">date</span><span class="o">:</span><span class="s2">&quot;%(dateStr)s&quot;</span><span class="p">,</span>
    <span class="nx">project</span><span class="o">:</span><span class="s2">&quot;%(projectName)s&quot;</span><span class="p">,</span>
    <span class="nx">scipionVersion</span><span class="o">:</span><span class="s2">&quot;%(scipionVersion)s&quot;</span><span class="p">,</span>
    <span class="nx">acquisition</span><span class="o">:</span><span class="p">[</span>
        <span class="o">%</span><span class="p">(</span><span class="nx">acquisitionLines</span><span class="p">)</span><span class="nx">s</span>
    <span class="p">],</span>
    <span class="nx">runs</span><span class="o">:</span><span class="p">[</span>
        <span class="o">%</span><span class="p">(</span><span class="nx">runLines</span><span class="p">)</span><span class="nx">s</span>
    <span class="p">],</span>
    <span class="nx">ctfData</span><span class="o">:</span> <span class="o">%</span><span class="p">(</span><span class="nx">ctfData</span><span class="p">)</span><span class="nx">s</span><span class="p">,</span>
    <span class="nx">movieGainData</span><span class="o">:</span> <span class="o">%</span><span class="p">(</span><span class="nx">movieGainData</span><span class="p">)</span><span class="nx">s</span><span class="p">,</span>
    <span class="nx">systemData</span><span class="o">:</span> <span class="o">%</span><span class="p">(</span><span class="nx">systemData</span><span class="p">)</span><span class="nx">s</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then, we have a bunch of Javascript functions. It is a good idea to take a look
at the <a class="reference external" href="https://github.com/I2PC/scipion/blob/d1a60f69960d1079bbbecde5bf3f5f4017b36927/pyworkflow/templates/execution.summary.template.html#L1035-L1042">populateReport()</a>,
function, which has the high level functions responsible of each visible section
in the HTML report. In our case, we’ll want to go check <cite>addMicTable()</cite>.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">populateReport</span><span class="p">(){</span>
    <span class="nx">addAcquisition</span><span class="p">();</span>
    <span class="nx">addRuns</span><span class="p">();</span>
    <span class="nx">addCTFChart</span><span class="p">();</span>
    <span class="nx">addMovieGainChart</span><span class="p">();</span>
    <span class="nx">addSystemChart</span><span class="p">();</span>
    <span class="nx">addMicTable</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</div>
<ul>
<li><p class="first">Remove the column name from the header:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="s1">&#39;defocusU&#39;</span> <span class="k">in</span> <span class="nx">report</span><span class="p">.</span><span class="nx">ctfData</span><span class="p">){</span>
    <span class="nx">cols</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
              <span class="c1">// {&quot;title&quot;: &quot;DefocusU (µm)&quot;,</span>
              <span class="c1">//   &quot;render&quot;: $.fn.dataTable.render.number( &#39;,&#39;, &#39;.&#39;, 2)},</span>
              <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Astigmatism (µm)&quot;</span><span class="p">,</span>
               <span class="s2">&quot;render&quot;</span><span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">dataTable</span><span class="p">.</span><span class="nx">render</span><span class="p">.</span><span class="nx">number</span><span class="p">(</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)},</span>
     <span class="p">...</span>
</pre></div>
</div>
</li>
<li><p class="first">Don’t add DefocusU data to the rows:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="s1">&#39;defocusU&#39;</span> <span class="k">in</span> <span class="nx">report</span><span class="p">.</span><span class="nx">ctfData</span><span class="p">){</span>
    <span class="nx">rowValues</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
                   <span class="c1">// report.ctfData.defocusU[index]*1e-4,</span>
                   <span class="nx">report</span><span class="p">.</span><span class="nx">ctfData</span><span class="p">.</span><span class="nx">astigmatism</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="nx">e</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span>
                   <span class="nx">report</span><span class="p">.</span><span class="nx">ctfData</span><span class="p">.</span><span class="nx">resolution</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span>
              <span class="p">...</span>
</pre></div>
</div>
</li>
<li><p class="first">Re-run the summary monitor, check the table and voila! Defocus column is gone:</p>
<div class="figure align-center">
<img alt="mic table without defocus" src="../../images/mic_table_without_defocus.png" />
</div>
</li>
</ul>
</div>
<div class="section" id="adding-a-column-to-defocus-table">
<h2>3. Adding a column to defocus table<a class="headerlink" href="#adding-a-column-to-defocus-table" title="Permalink to this headline">¶</a></h2>
<p>In this section, we’ll add the fit quality value to the micrograph table.
As we have seen in the beginning of the previous example, the template has some
keywords that are used by Scipion to provide data to the HTML report.
In this example, we’ll see where Scipion generates that data and modify it.
Pay attention to the last step of example 2: the data of the defocusU column is
accessed with <cite>report.ctfData.defocusU[index]*1e-4</cite>.
In the report variable, we see that <cite>ctfData</cite> is assigned a keyword to be
replaced by Scipion:</p>
<p><a class="reference external" href="https://github.com/I2PC/scipion/blob/master/pyworkflow/templates/execution.summary.template.html#L301">pyworkflow/templates/execution.summary.template.html</a>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">report</span> <span class="o">=</span><span class="p">{</span>
    <span class="nx">date</span><span class="o">:</span><span class="s2">&quot;%(dateStr)s&quot;</span><span class="p">,</span>
    <span class="nx">project</span><span class="o">:</span><span class="s2">&quot;%(projectName)s&quot;</span><span class="p">,</span>
    <span class="nx">scipionVersion</span><span class="o">:</span><span class="s2">&quot;%(scipionVersion)s&quot;</span><span class="p">,</span>
    <span class="nx">acquisition</span><span class="o">:</span><span class="p">[</span>
        <span class="o">%</span><span class="p">(</span><span class="nx">acquisitionLines</span><span class="p">)</span><span class="nx">s</span>
    <span class="p">],</span>
    <span class="nx">runs</span><span class="o">:</span><span class="p">[</span>
        <span class="o">%</span><span class="p">(</span><span class="nx">runLines</span><span class="p">)</span><span class="nx">s</span>
    <span class="p">],</span>
    <span class="nx">ctfData</span><span class="o">:</span> <span class="o">%</span><span class="p">(</span><span class="nx">ctfData</span><span class="p">)</span><span class="nx">s</span><span class="p">,</span> <span class="c1">// we need to find how does scipion generate this ctfData</span>
    <span class="nx">movieGainData</span><span class="o">:</span> <span class="o">%</span><span class="p">(</span><span class="nx">movieGainData</span><span class="p">)</span><span class="nx">s</span><span class="p">,</span>
    <span class="nx">systemData</span><span class="o">:</span> <span class="o">%</span><span class="p">(</span><span class="nx">systemData</span><span class="p">)</span><span class="nx">s</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The place where Scipion performs the replacement of all the <cite>%(keywords)s</cite> is in
<a class="reference external" href="https://github.com/I2PC/scipion/blob/d1a60f69960d1079bbbecde5bf3f5f4017b36927/pyworkflow/em/protocol/monitors/report_html.py#L392">pyworkflow/em/protocol/monitors/report_html.py</a>.</p>
<ul>
<li><p class="first">First, we can take a look at which data is available in the monitor’s input
protocols. In our case, the fit quality is in the SetOfCtf. We can click on
CTFFIND’s <strong>`Analyze results`</strong> button to open its output (or double click in
any output set). Then we can inspect all the data available for this set by
clicking on <strong>Display -&gt; Columns</strong>.</p>
<div class="figure align-center">
<img alt="set of ctf columns" src="../../images/set_of_ctf_columns.png" />
</div>
</li>
<li><p class="first">Next, we need to add the <cite>_fitQuality</cite> field to ctfData. Lets look for it in
<a class="reference external" href="https://github.com/I2PC/scipion/blob/d1a60f69960d1079bbbecde5bf3f5f4017b36927/pyworkflow/em/protocol/monitors/report_html.py#L448">report_html.py</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;projectName&#39;</span><span class="p">:</span> <span class="n">projName</span><span class="p">,</span>
        <span class="s1">&#39;startTime&#39;</span><span class="p">:</span> <span class="n">pwutils</span><span class="o">.</span><span class="n">dateStr</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">getCreationTime</span><span class="p">(),</span> <span class="n">secs</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="s1">&#39;dateStr&#39;</span><span class="p">:</span> <span class="n">pwutils</span><span class="o">.</span><span class="n">prettyTime</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">tnow</span><span class="p">,</span> <span class="n">secs</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="s1">&#39;projectDuration&#39;</span><span class="p">:</span> <span class="n">pwutils</span><span class="o">.</span><span class="n">prettyDelta</span><span class="p">(</span><span class="n">tnow</span><span class="o">-</span><span class="n">project</span><span class="o">.</span><span class="n">getCreationTime</span><span class="p">()),</span>
        <span class="s1">&#39;projectStatus&#39;</span><span class="p">:</span> <span class="s2">&quot;FINISHED&quot;</span> <span class="k">if</span> <span class="n">finished</span> <span class="k">else</span> <span class="s2">&quot;RUNNING&quot;</span><span class="p">,</span>
        <span class="s1">&#39;scipionVersion&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SCIPION_VERSION&#39;</span><span class="p">],</span>
        <span class="s1">&#39;acquisitionLines&#39;</span><span class="p">:</span> <span class="n">acquisitionLines</span><span class="p">,</span>
        <span class="s1">&#39;runLines&#39;</span><span class="p">:</span> <span class="n">runLines</span><span class="p">,</span>
        <span class="s1">&#39;ctfData&#39;</span><span class="p">:</span> <span class="n">ctfData</span><span class="p">,</span>  <span class="c1">############## WE LOOK FOR THIS ##################</span>
        <span class="s1">&#39;movieGainData&#39;</span><span class="p">:</span> <span class="n">movieGainData</span><span class="p">,</span>
        <span class="s1">&#39;systemData&#39;</span><span class="p">:</span> <span class="n">systemData</span><span class="p">,</span>
        <span class="s1">&#39;refresh&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">refreshSecs</span>
        <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ctfData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1">####### NOW WE LOOK FOR &quot;data&quot; ########</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfMonitor</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctfMonitor</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>  <span class="c1">####### Lets check whats in this getData() ########</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/I2PC/scipion/blob/d1a60f69960d1079bbbecde5bf3f5f4017b36927/pyworkflow/em/protocol/monitors/protocol_monitor_ctf.py#L246">pyworkflow/em/protocol/monitors/prototol_monitor_ctf.py</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select </span><span class="si">%s</span><span class="s2"> from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableName</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;MonitorCTF, ERROR reading data from db: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workingDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataBase</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;defocusU&#39;</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;defocusU&#39;</span><span class="p">),</span>
        <span class="s1">&#39;defocusV&#39;</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;defocusV&#39;</span><span class="p">),</span>
        <span class="s1">&#39;astigmatism&#39;</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;astigmatism&#39;</span><span class="p">),</span>
        <span class="s1">&#39;ratio&#39;</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;ratio&#39;</span><span class="p">),</span>
        <span class="s1">&#39;idValues&#39;</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;ctfID&#39;</span><span class="p">),</span>
        <span class="s1">&#39;resolution&#39;</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;resolution&#39;</span><span class="p">),</span>
        <span class="s1">&#39;fitQuality&#39;</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;fitQuality&#39;</span><span class="p">),</span>   <span class="c1">###### FIT QUALITY IS ALREADY HERE!!! YAY ########</span>
        <span class="s1">&#39;imgMicPath&#39;</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;micPath&#39;</span><span class="p">),</span>
        <span class="s1">&#39;imgPsdPath&#39;</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;psdPath&#39;</span><span class="p">),</span>
        <span class="s1">&#39;imgShiftPath&#39;</span><span class="p">:</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;shiftPlotPath&#39;</span><span class="p">)</span>
     <span class="p">}</span>
    <span class="c1"># conn.close()</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
</li>
<li><p class="first">Now we just need to add it at the same place where we previously deleted de DefocusU.</p>
<ul>
<li><p class="first">First we add a name for the column:</p>
<p><a class="reference external" href="https://github.com/I2PC/scipion/blob/master/pyworkflow/templates/execution.summary.template.html#L301">pyworkflow/templates/execution.summary.template.html</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>if (&#39;defocusU&#39; in report.ctfData){
    cols.push(
              {&quot;title&quot;: &quot;Fit Quality&quot;,
               &quot;render&quot;: $.fn.dataTable.render.number( &#39;,&#39;, &#39;.&#39;, 2)},
              {&quot;title&quot;: &quot;Astigmatism (µm)&quot;,
               &quot;render&quot;: $.fn.dataTable.render.number( &#39;,&#39;, &#39;.&#39;, 3)},
</pre></div>
</div>
</li>
<li><p class="first">Then add data to the rows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="s1">&#39;defocusU&#39;</span> <span class="ow">in</span> <span class="n">report</span><span class="o">.</span><span class="n">ctfData</span><span class="p">){</span>
    <span class="n">rowValues</span><span class="o">.</span><span class="n">push</span><span class="p">(</span>
                   <span class="n">report</span><span class="o">.</span><span class="n">ctfData</span><span class="o">.</span><span class="n">fitQuality</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                   <span class="n">report</span><span class="o">.</span><span class="n">ctfData</span><span class="o">.</span><span class="n">astigmatism</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-4</span><span class="p">,</span>
                   <span class="n">report</span><span class="o">.</span><span class="n">ctfData</span><span class="o">.</span><span class="n">resolution</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Run the summary again and check that we have our new column:</p>
<div class="figure align-center">
<img alt="mic table with fit quality" src="../../images/mic_table_with_fit_quality.png" />
</div>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: gh-pages
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="customize-html-report.html">gh-pages</a></dd>
            <dd><a href="../../../release-2.0.0/docs/facilities/customize-html-report.html">release-2.0.0</a></dd>
            <dd><a href="../../../release-3.0.0/index.html">release-3.0.0</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>