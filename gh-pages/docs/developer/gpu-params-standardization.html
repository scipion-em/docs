

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>GPU parameters standardization in Scipion protocols &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../static/documentation_options.js"></script>
        <script type="text/javascript" src="../../static/jquery.js"></script>
        <script type="text/javascript" src="../../static/underscore.js"></script>
        <script type="text/javascript" src="../../static/doctools.js"></script>
        <script type="text/javascript" src="../../static/language_data.js"></script>
    
    <script type="text/javascript" src="../../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/install-from-sources.html">Installing Scipion v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities.html">Streaming Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/acquisition-simulation.html">Tutorial for Facilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>GPU parameters standardization in Scipion protocols</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../sources/docs/developer/gpu-params-standardization.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="figure">
<a class="reference internal image-reference" href="../../images/scipion_logo.gif"><img alt="scipion logo" src="../../images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="gpu-parameters-standardization-in-scipion-protocols">
<span id="gpu-params-standardization"></span><h1>GPU parameters standardization in Scipion protocols<a class="headerlink" href="#gpu-parameters-standardization-in-scipion-protocols" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This entry is intended for Scipion developers and explains the basic ideas behind the GPU parameters standardization among different protocols. Computing with GPUs has increasingly being used by different programs for CryoEM image processing. So, after introducing many GPU-based Scipion protocols, we have realized that similar parameters are named different and in some protocols, we couldn’t use multiple GPUs. So, the ideas explained here addressed mainly the following two related issues:</p>
<ul class="simple">
<li>Name in a similar way GPUs related params</li>
<li>Allow that multiple GPUs can be used in some protocols</li>
</ul>
</div>
<div class="section" id="standardization-of-gpu-parameters">
<h2>Standardization of GPU parameters<a class="headerlink" href="#standardization-of-gpu-parameters" title="Permalink to this headline">¶</a></h2>
<p>We propose the introduction of the following parameters (name constants defined
in <a class="reference external" href="https://github.com/delarosatrevin/scipion/blob/cd1001579cdd4d53cbd4b8c666ead06c84e0303c/pyworkflow/protocol/constants.py#L67">constanst.py</a>):</p>
<ul class="simple">
<li>USE_GPU: a boolean parameter to ask if use the GPU or not in this protocol. Some programs only run in GPU, so the protocol should not define this parameter and the use of the GPU is compulsory.</li>
<li>GPU_LIST: a string parameter that define the list of GPU IDs that will be used by the protocol.</li>
</ul>
<p>The use of those parameter is not forced right now for GPU protocols.This will
allow to progressively modify the protocols but keep them working as expected
in the meantime. When these parameters are defined, some functions are available
in the <a class="reference external" href="https://github.com/delarosatrevin/scipion/blob/cd1001579cdd4d53cbd4b8c666ead06c84e0303c/pyworkflow/protocol/protocol.py#L625">Protocol class</a></p>
<p>When the GPU_LIST param is used, then it will be displayed on the top of the protocol form together with other common execution parameters (see image below).</p>
<div class="figure">
<img alt="Scipion GPU Form" src="../../images/scipion-gpu-form.png" />
</div>
<p>The value of these parameters can be used as usual to form the command line of a given program. But if you want to enable execution in multiple GPUs/threads (handled by the Scipion execution engine), the special %(GPU)s should be used. Keep reading next section to know more details.</p>
</div>
<div class="section" id="execution-on-multiple-gpus-threads">
<h2>Execution on multiple GPUs/threads<a class="headerlink" href="#execution-on-multiple-gpus-threads" title="Permalink to this headline">¶</a></h2>
<p>When a protocol use the STEPS_PARALLEL execution mode, Scipion provides an automatic parallelization of the steps using either MPI or Threads. Now this can be combined with the GPU_LIST (only for threads, not tested with MPIs).</p>
<p>Apart from using the STEPS_PARALLEL mode, the command line should use a special mark: %(GPU)s. This value will be later replaced by the StepsExecutor with the value of the GPU(s) assigned to a given step. For example, in the MotionCor2 protocol, the command line should be modified as shown below:</p>
<p>Before:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">args</span> <span class="o">+=</span> <span class="s1">&#39;-gpu %s&#39;</span> % self.gpuList.get<span class="o">()</span>
</pre></div>
</div>
<p>After:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">args</span> <span class="o">+=</span> <span class="s1">&#39;-gpu %(GPU)s&#39;</span>
</pre></div>
</div>
<p>For example, in MotionCor2…if the user set 3 threads and GPU List = 0 1, then thread 0 will be master and thread 1 will use GPU 0 and thread 2 in GPU 1. If the user set 5 threads, then two threads will run on GPU 0 and two threads in GPU 1 (which is not recommended with the new version of MC2). If 3 threads and 0 1 2 3 GPUs, then again 1 master and thread 1 will have GPUs 0 1 and thread 2 GPUs 2 3.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: gh-pages
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="gpu-params-standardization.html">gh-pages</a></dd>
            <dd><a href="../../../release-2.0.0/docs/developer/gpu-params-standardization.html">release-2.0.0</a></dd>
            <dd><a href="../../../release-3.0.0/docs/developer/gpu-params-standardization.html">release-3.0.0</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>