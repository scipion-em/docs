

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Scipion web volume map visualization &mdash; Scipion 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../static/documentation_options.js"></script>
        <script type="text/javascript" src="../../static/jquery.js"></script>
        <script type="text/javascript" src="../../static/underscore.js"></script>
        <script type="text/javascript" src="../../static/doctools.js"></script>
        <script type="text/javascript" src="../../static/language_data.js"></script>
    
    <script type="text/javascript" src="../../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/install-from-sources.html">Installing Scipion v2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scipion-modes/host-configuration.html">Host configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html#processing-how-to-s">Processing How To’s</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities.html">Streaming Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facilities/acquisition-simulation.html">Tutorial for Facilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Scipion web volume map visualization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../sources/docs/developer/scipion-web-volume-map-visualization.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="figure">
<a class="reference internal image-reference" href="../../images/scipion_logo.gif"><img alt="scipion logo" src="../../images/scipion_logo.gif" style="width: 250px;" /></a>
</div>
<div class="section" id="scipion-web-volume-map-visualization">
<span id="id1"></span><h1>Scipion web volume map visualization<a class="headerlink" href="#scipion-web-volume-map-visualization" title="Permalink to this headline">¶</a></h1>
<div class="section" id="objectives">
<h2>Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">¶</a></h2>
<p>Scipion web client environment can have some limitations compared to the
desktop client environment. One of these hypothetical limitations is the
possibility of using client machine tools to visualize some Scipion
files.</p>
<p>In volume visualization, it is possible to use some tools
that allow the user to open and interact with volumes in a web client. Here,
we will see several alternative ways to do so:</p>
</div>
<div class="section" id="open-astex-viewer">
<h2>Open Astex viewer<a class="headerlink" href="#open-astex-viewer" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://openastexviewer.net/web/">Open Astex Viewer</a> is a Java molecular
graphics program that assists in structure-based drug design. It can be
used as an applet in a web page or as a desktop application.</p>
<div class="section" id="advantages">
<h3>Advantages<a class="headerlink" href="#advantages" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>We are familiar with Open Astex Viewer because we have another project in the
laboratory that uses it: <a class="reference external" href="http://pepper.cnb.csic.es/das/PeppeR/">PeppeR</a>.</li>
<li>It can be displayed as an applet in a web page.</li>
<li>It can be customized.</li>
<li>It allows interaction.</li>
</ol>
</div>
<div class="section" id="disadvantages">
<h3>Disadvantages<a class="headerlink" href="#disadvantages" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>When it is displayed as an applet it has all the disadvantages of an
applet.</li>
<li>When it is used as an applet it has some restrictions that we
will see below in the Installation section.</li>
</ol>
</div>
<div class="section" id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>We are not going to use the Open Astex Viewer jar published on their
official web page because we have detected some problems with it, so we
will use <a class="reference external" href="http://www.ebi.ac.uk/pdbe/entry/applets/OpenAstexViewer.jar">EMDB jar</a>.</p>
<p>Since we are working with Django, the installation is referred in to this
framework.</p>
<ol class="arabic simple">
<li>Place jar file in the Django static folder (Django: STATIC_ROOT = ‘static’).</li>
<li>In the html code include the applet code (here is an example):</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;applet
       <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;600px&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;600px&quot;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;av&quot;</span>
       <span class="nv">archive</span><span class="o">=</span><span class="s2">&quot;{{ STATIC_URL }}astex/OpenAstexViewer.jar&quot;</span>
       <span class="nv">codebase</span><span class="o">=</span><span class="s2">&quot;..&quot;</span>
       <span class="nv">code</span><span class="o">=</span><span class="s2">&quot;MoleculeViewerApplet.class&quot;</span>&gt;
       &lt;param <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;script&quot;</span>
             <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;map load volMap &#39;{{volLink}}&#39; {{form.volType.value}} {{form.threshold.value}};</span>
<span class="s2">                    map volMap contour 0 solid on;</span>
<span class="s2">                    radius 50;</span>
<span class="s2">                    center map volMap;</span>
<span class="s2">                    view -background lightgrey;</span>
<span class="s2">                    map volMap -reread true;&quot;</span>&gt;
&lt;/applet&gt;
</pre></div>
</div>
<p><em>NOTES</em></p>
<p>Jar and script file paths must be defined using a “static” value set in
Django “settings.py” file. To load the applet you can add a parameter (HTML element) called “script” and set it to the script code you want to use or you can use a “scriptfile” parameter and set its value to the script file path.</p>
<p>Script file and volume maps must be placed in jar location sub-folders and
volume files path must follow “/staticUrl/path” format.</p>
</div>
<div class="section" id="problems">
<h3>Problems<a class="headerlink" href="#problems" title="Permalink to this headline">¶</a></h3>
<p>Continuous conflicts with java navigator and installed JRE versions.</p>
<p>Now we get errors executing commands in the visualizer after loading it
(even in 3demloupe web).</p>
</div>
<div class="section" id="chimera">
<h3>Chimera<a class="headerlink" href="#chimera" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.cgl.ucsf.edu/chimera/">UCSF Chimera</a> is a program for interactive
visualization and analysis of molecular structures and related data.
This program has an export option where you can export a volume path as
a webGL page; this functionality will allow us to visualize volume maps
in a web page.</p>
</div>
<div class="section" id="id3">
<h3>Advantages<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>It does not use an applet; it is html, css and javascript code.</li>
<li>It has no restrictions.</li>
</ol>
</div>
<div class="section" id="id4">
<h3>Disadvantages<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>It must be installed on the server machine.</li>
<li>It does not allow complex interactions.</li>
</ol>
</div>
<div class="section" id="id5">
<h3>Installation<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>We must install a headless Chimera version; this version is for servers or other places where we do not need a user GUI, and it avoids   some problems for our operations.</li>
<li>Our code must open Chimera, load the volume map, export it, take the needed code from exported file, and add it to our html code. Here is an example code:</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">p</span> <span class="o">=</span> Popen<span class="o">([</span><span class="s1">&#39;chimera&#39;</span>, <span class="s1">&#39;--start&#39;</span>, <span class="s1">&#39;ReadStdin&#39;</span>, volPath<span class="o">]</span>, <span class="nv">stdout</span><span class="o">=</span>PIPE, <span class="nv">stdin</span><span class="o">=</span>PIPE, <span class="nv">stderr</span><span class="o">=</span>PIPE<span class="o">)</span> <span class="c1"># Read problems section. This has changed.</span>
<span class="nv">outputHtmlFile</span> <span class="o">=</span> <span class="s1">&#39;/home/ballotelli/tmpDir/test.html&#39;</span>
<span class="nv">threshold</span> <span class="o">=</span> exampleThreshold
<span class="nv">stdout_data</span> <span class="o">=</span> p.communicate<span class="o">(</span><span class="nv">input</span><span class="o">=</span><span class="s1">&#39;volume #0 level &#39;</span> + str<span class="o">(</span>threshold<span class="o">)</span> + <span class="s1">&#39;; export format WebGL &#39;</span> + outputHtmlFile + <span class="s1">&#39;; stop&#39;</span><span class="o">)[</span><span class="m">0</span><span class="o">]</span>
<span class="nv">f</span> <span class="o">=</span> open<span class="o">(</span>outputHtmlFile<span class="o">)</span>
<span class="nv">chimeraHtml</span> <span class="o">=</span> f.read<span class="o">()</span>.decode<span class="o">(</span><span class="s1">&#39;string-escape&#39;</span><span class="o">)</span>.decode<span class="o">(</span><span class="s2">&quot;utf-8&quot;</span><span class="o">)</span>.split<span class="o">(</span><span class="s2">&quot;&lt;/html&gt;&quot;</span><span class="o">)[</span><span class="m">1</span><span class="o">]</span>
</pre></div>
</div>
<p>We are going to look at each line function:</p>
<p>. Execute Chimera, telling it to run ReadStdin utility upon starting (to read commands from Stdin) and passing the file to open.</p>
<p>. Define a temporal html file path for the webGL exportation.</p>
<p>. Define an initial threshold value.</p>
<p>. Execute Chimera commands to apply a threshold to the volume, export to a webGL html file, and close Chimera.</p>
<p>. Open the exported file to read it.</p>
<p>. Extract the html code that we need. After this you can include this html in your page, adding more static code (code that is always the same) taken from the exported file that is needed for the corect webGL visualization.</p>
</div>
<div class="section" id="id6">
<h3>Problems<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>With an incorrect threshold we will see a black result. With a very</li>
</ol>
<blockquote>
<div>bad threshold we will not see anything.</div></blockquote>
<ol class="arabic simple" start="2">
<li>After some use, ReadStdin utility command has been</li>
</ol>
<blockquote>
<div>removed because we had some problems, but we must know it. Now we use
this instruction:</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">p</span> <span class="o">=</span> Popen<span class="o">([</span><span class="s1">&#39;chimera&#39;</span>, inputVolume<span class="o">]</span>, <span class="nv">stdout</span><span class="o">=</span>PIPE, <span class="nv">stdin</span><span class="o">=</span>PIPE, <span class="nv">stderr</span><span class="o">=</span>PIPE<span class="o">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: gh-pages
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="scipion-web-volume-map-visualization.html">gh-pages</a></dd>
            <dd><a href="../../../release-2.0.0/docs/developer/scipion-web-volume-map-visualization.html">release-2.0.0</a></dd>
            <dd><a href="../../../release-3.0.0/docs/developer/scipion-web-volume-map-visualization.html">release-3.0.0</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>